<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Modern R with the tidyverse</title>
  <meta name="description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Modern R with the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Modern R with the tidyverse" />
  
  <meta name="twitter:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

<meta name="author" content="Bruno Rodrigues">


<meta name="date" content="2018-11-11">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="statistical-models.html">
<link rel="next" href="references.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern R with the tidyverse</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-r"><i class="fa fa-check"></i>What is R?</a></li>
<li><a href="index.html#why-modern-r">Why <em>modern</em> R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-rstudio"><i class="fa fa-check"></i>What is RStudio?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect-from-this-book"><i class="fa fa-check"></i>What to expect from this book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-are-packages"><i class="fa fa-check"></i>What are packages?</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-author"><i class="fa fa-check"></i>The author</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting to know RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#panes"><i class="fa fa-check"></i><b>1.1</b> Panes</a></li>
<li class="chapter" data-level="1.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#console"><i class="fa fa-check"></i><b>1.2</b> Console</a></li>
<li class="chapter" data-level="1.3" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#scripts"><i class="fa fa-check"></i><b>1.3</b> Scripts</a><ul>
<li class="chapter" data-level="1.3.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-help-pane"><i class="fa fa-check"></i><b>1.3.1</b> The help pane</a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-environment-pane"><i class="fa fa-check"></i><b>1.3.2</b> The Environment pane</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#options"><i class="fa fa-check"></i><b>1.4</b> Options</a></li>
<li class="chapter" data-level="1.5" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>1.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="1.6" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#projects"><i class="fa fa-check"></i><b>1.6</b> Projects</a></li>
<li class="chapter" data-level="1.7" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#history"><i class="fa fa-check"></i><b>1.7</b> History</a></li>
<li class="chapter" data-level="1.8" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#plots"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
<li class="chapter" data-level="1.9" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#addins"><i class="fa fa-check"></i><b>1.9</b> Addins</a></li>
<li class="chapter" data-level="1.10" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercises"><i class="fa fa-check"></i><b>1.10</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>2</b> Packages</a></li>
<li class="chapter" data-level="3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html"><i class="fa fa-check"></i><b>3</b> Data types and objects</a><ul>
<li class="chapter" data-level="3.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-numeric-class"><i class="fa fa-check"></i><b>3.1</b> The <code>numeric</code> class</a></li>
<li class="chapter" data-level="3.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-character-class"><i class="fa fa-check"></i><b>3.2</b> The <code>character</code> class</a></li>
<li class="chapter" data-level="3.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-factor-class"><i class="fa fa-check"></i><b>3.3</b> The <code>factor</code> class</a></li>
<li class="chapter" data-level="3.4" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#vectors-and-matrices"><i class="fa fa-check"></i><b>3.4</b> Vectors and matrices</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-c-function"><i class="fa fa-check"></i><b>3.4.1</b> The <code>c()</code> function</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#cbind-and-rbind"><i class="fa fa-check"></i><b>3.4.2</b> <code>cbind()</code> and <code>rbind()</code></a></li>
<li class="chapter" data-level="3.4.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-matrix-class"><i class="fa fa-check"></i><b>3.4.3</b> The <code>matrix</code> class</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-logical-class"><i class="fa fa-check"></i><b>3.5</b> The <code>logical</code> class</a></li>
<li class="chapter" data-level="3.6" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-list-class"><i class="fa fa-check"></i><b>3.6</b> The <code>list</code> class</a></li>
<li class="chapter" data-level="3.7" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-data.frame-and-tibble-classes"><i class="fa fa-check"></i><b>3.7</b> The <code>data.frame</code> and <code>tibble</code> classes</a></li>
<li class="chapter" data-level="3.8" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#formulas"><i class="fa fa-check"></i><b>3.8</b> Formulas</a></li>
<li class="chapter" data-level="3.9" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercises-1"><i class="fa fa-check"></i><b>3.9</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-1-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-5"><i class="fa fa-check"></i>Exercise 5</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-6"><i class="fa fa-check"></i>Exercise 6</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-7"><i class="fa fa-check"></i>Exercise 7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>4</b> Reading and writing data</a><ul>
<li class="chapter" data-level="4.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#the-swiss-army-knife-of-data-import-and-export-rio"><i class="fa fa-check"></i><b>4.1</b> The swiss army knife of data import and export: <code>rio</code></a></li>
<li class="chapter" data-level="4.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-any-object-to-disk"><i class="fa fa-check"></i><b>4.2</b> Writing any object to disk</a></li>
<li class="chapter" data-level="4.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#using-rstudio-projects-to-manage-paths"><i class="fa fa-check"></i><b>4.3</b> Using RStudio projects to manage paths</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html"><i class="fa fa-check"></i><b>5</b> Descriptive statistics and data manipulation</a><ul>
<li class="chapter" data-level="5.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#smoking-is-bad-for-you-but-pipes-are-your-friend"><i class="fa fa-check"></i><b>5.1</b> Smoking is bad for you, but pipes are your friend</a></li>
<li class="chapter" data-level="5.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#the-tidyverses-enfant-prodige-dplyr"><i class="fa fa-check"></i><b>5.2</b> The <code>{tidyverse}</code>‚Äôs <em>enfant prodige</em>: <code>{dplyr}</code></a><ul>
<li class="chapter" data-level="5.2.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-first-taste-of-data-manipulation-with-dplyr"><i class="fa fa-check"></i><b>5.2.1</b> A first taste of data manipulation with <code>{dplyr}</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter-the-rows-of-a-dataset-with-filter"><i class="fa fa-check"></i><b>5.2.2</b> Filter the rows of a dataset with <code>filter()</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#select-columns-with-select"><i class="fa fa-check"></i><b>5.2.3</b> Select columns with <code>select()</code></a></li>
<li class="chapter" data-level="5.2.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group-the-observations-of-your-dataset-with-group_by"><i class="fa fa-check"></i><b>5.2.4</b> Group the observations of your dataset with <code>group_by()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#groups-country-18"><i class="fa fa-check"></i><b>5.3</b> # Groups: country [18]</a><ul>
<li class="chapter" data-level="5.3.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#get-summary-statistics-with-summarise"><i class="fa fa-check"></i><b>5.3.1</b> Get summary statistics with <code>summarise()</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#adding-columns-with-mutate-and-transmute"><i class="fa fa-check"></i><b>5.3.2</b> Adding columns with <code>mutate()</code> and <code>transmute()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#reshaping-data-with-tidyr"><i class="fa fa-check"></i><b>5.4</b> Reshaping data with <code>tidyr</code></a></li>
<li class="chapter" data-level="5.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#getting-to-know-factor-variables"><i class="fa fa-check"></i><b>5.5</b> Getting to know <code>factor</code> variables</a></li>
<li class="chapter" data-level="5.6" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#scoped-tidyverse-verbs"><i class="fa fa-check"></i><b>5.6</b> Scoped <code>{tidyverse}</code> verbs</a><ul>
<li class="chapter" data-level="5.6.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter_"><i class="fa fa-check"></i><b>5.6.1</b> filter_()</a></li>
<li class="chapter" data-level="5.6.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#select_"><i class="fa fa-check"></i><b>5.6.2</b> select_()</a></li>
<li class="chapter" data-level="5.6.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group_by_"><i class="fa fa-check"></i><b>5.6.3</b> group_by_()</a></li>
<li class="chapter" data-level="5.6.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#summarise_"><i class="fa fa-check"></i><b>5.6.4</b> summarise_()</a></li>
<li class="chapter" data-level="5.6.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#mutate_"><i class="fa fa-check"></i><b>5.6.5</b> mutate_()</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#other-useful-tidyverse-functions"><i class="fa fa-check"></i><b>5.7</b> Other useful <code>{tidyverse}</code> functions</a><ul>
<li class="chapter" data-level="5.7.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#if_else-case_when-and-recode"><i class="fa fa-check"></i><b>5.7.1</b> <code>if_else()</code>, <code>case_when()</code> and <code>recode()</code></a></li>
<li class="chapter" data-level="5.7.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#lead-and-lag"><i class="fa fa-check"></i><b>5.7.2</b> <code>lead()</code> and <code>lag()</code></a></li>
<li class="chapter" data-level="5.7.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#ntile"><i class="fa fa-check"></i><b>5.7.3</b> <code>ntile()</code></a></li>
<li class="chapter" data-level="5.7.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#arrange"><i class="fa fa-check"></i><b>5.7.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="5.7.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#tally-and-count"><i class="fa fa-check"></i><b>5.7.5</b> <code>tally()</code> and <code>count()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#joining-tibbles-with-full_join-left_join-right_join-and-all-the-others"><i class="fa fa-check"></i><b>5.8</b> Joining <code>tibble</code>s with <code>full_join()</code>, <code>left_join()</code>, <code>right_join()</code> and all the others</a></li>
<li class="chapter" data-level="5.9" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#special-packages-for-special-kinds-of-data-forcats-lubridate-and-stringr"><i class="fa fa-check"></i><b>5.9</b> Special packages for special kinds of data: <code>{forcats}</code>, <code>{lubridate}</code>, and <code>{stringr}</code></a><ul>
<li class="chapter" data-level="5.9.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#section"><i class="fa fa-check"></i><b>5.9.1</b> üêàüêàüêàüêà</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#wor-get-your-dates-right-with-lubridate"><i class="fa fa-check"></i><b>5.10</b> Wor# Get your dates right with <code>{lubridate}</code></a><ul>
<li class="chapter" data-level="5.10.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#manipulate-strings-with-stringr"><i class="fa fa-check"></i><b>5.10.1</b> Manipulate strings with <code>{stringr}</code></a></li>
<li class="chapter" data-level="5.10.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#getting-to-know-map"><i class="fa fa-check"></i><b>5.10.2</b> Getting to know <code>map()</code></a></li>
<li class="chapter" data-level="5.10.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#getting-to-know-reduce"><i class="fa fa-check"></i><b>5.10.3</b> Getting to know <code>reduce()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#list-columns"><i class="fa fa-check"></i><b>5.11</b> List-columns</a></li>
<li class="chapter" data-level="5.12" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercises-2"><i class="fa fa-check"></i><b>5.12</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-1-2"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-2-1"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-3-1"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>6</b> Graphs</a><ul>
<li class="chapter" data-level="6.1" data-path="graphs.html"><a href="graphs.html#resources"><i class="fa fa-check"></i><b>6.1</b> Resources</a></li>
<li class="chapter" data-level="6.2" data-path="graphs.html"><a href="graphs.html#examples"><i class="fa fa-check"></i><b>6.2</b> Examples</a><ul>
<li class="chapter" data-level="6.2.1" data-path="graphs.html"><a href="graphs.html#barplots"><i class="fa fa-check"></i><b>6.2.1</b> Barplots</a></li>
<li class="chapter" data-level="6.2.2" data-path="graphs.html"><a href="graphs.html#density"><i class="fa fa-check"></i><b>6.2.2</b> Density</a></li>
<li class="chapter" data-level="6.2.3" data-path="graphs.html"><a href="graphs.html#line-plots"><i class="fa fa-check"></i><b>6.2.3</b> Line plots</a></li>
<li class="chapter" data-level="6.2.4" data-path="graphs.html"><a href="graphs.html#facets"><i class="fa fa-check"></i><b>6.2.4</b> Facets</a></li>
<li class="chapter" data-level="6.2.5" data-path="graphs.html"><a href="graphs.html#pie-charts"><i class="fa fa-check"></i><b>6.2.5</b> Pie Charts</a></li>
<li class="chapter" data-level="6.2.6" data-path="graphs.html"><a href="graphs.html#adding-text-to-plots"><i class="fa fa-check"></i><b>6.2.6</b> Adding text to plots</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="graphs.html"><a href="graphs.html#customization"><i class="fa fa-check"></i><b>6.3</b> Customization</a><ul>
<li class="chapter" data-level="6.3.1" data-path="graphs.html"><a href="graphs.html#titles-axes-names-and-more"><i class="fa fa-check"></i><b>6.3.1</b> Titles, axes names and more</a></li>
<li class="chapter" data-level="6.3.2" data-path="graphs.html"><a href="graphs.html#themes"><i class="fa fa-check"></i><b>6.3.2</b> Themes</a></li>
<li class="chapter" data-level="6.3.3" data-path="graphs.html"><a href="graphs.html#colour-schemes-from-ggthemes"><i class="fa fa-check"></i><b>6.3.3</b> Colour schemes from <code>ggthemes</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="graphs.html"><a href="graphs.html#using-your-own-colours"><i class="fa fa-check"></i><b>6.3.4</b> Using your own colours</a></li>
<li class="chapter" data-level="6.3.5" data-path="graphs.html"><a href="graphs.html#saving-plots-on-disk"><i class="fa fa-check"></i><b>6.3.5</b> Saving plots on disk</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="graphs.html"><a href="graphs.html#many-plots"><i class="fa fa-check"></i><b>6.4</b> Many plots</a></li>
<li class="chapter" data-level="6.5" data-path="graphs.html"><a href="graphs.html#exercises-3"><i class="fa fa-check"></i><b>6.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="graphs.html"><a href="graphs.html#exercise-1-3"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>7</b> Statistical models</a><ul>
<li class="chapter" data-level="7.1" data-path="statistical-models.html"><a href="statistical-models.html#fitting-a-model-to-data"><i class="fa fa-check"></i><b>7.1</b> Fitting a model to data</a></li>
<li class="chapter" data-level="7.2" data-path="statistical-models.html"><a href="statistical-models.html#diagnostics"><i class="fa fa-check"></i><b>7.2</b> Diagnostics</a></li>
<li class="chapter" data-level="7.3" data-path="statistical-models.html"><a href="statistical-models.html#interpreting-models"><i class="fa fa-check"></i><b>7.3</b> Interpreting models</a></li>
<li class="chapter" data-level="7.4" data-path="statistical-models.html"><a href="statistical-models.html#comparing-models"><i class="fa fa-check"></i><b>7.4</b> Comparing models</a></li>
<li class="chapter" data-level="7.5" data-path="statistical-models.html"><a href="statistical-models.html#using-a-model-for-prediction"><i class="fa fa-check"></i><b>7.5</b> Using a model for prediction</a></li>
<li class="chapter" data-level="7.6" data-path="statistical-models.html"><a href="statistical-models.html#beyond-linear-regression"><i class="fa fa-check"></i><b>7.6</b> Beyond linear regression</a></li>
<li class="chapter" data-level="7.7" data-path="statistical-models.html"><a href="statistical-models.html#advanced-topics"><i class="fa fa-check"></i><b>7.7</b> Advanced topics</a><ul>
<li class="chapter" data-level="7.7.1" data-path="statistical-models.html"><a href="statistical-models.html#bootstrapping"><i class="fa fa-check"></i><b>7.7.1</b> Bootstrapping</a></li>
<li class="chapter" data-level="7.7.2" data-path="statistical-models.html"><a href="statistical-models.html#cross-validation"><i class="fa fa-check"></i><b>7.7.2</b> Cross-validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html"><i class="fa fa-check"></i><b>8</b> Functional programming and other advanced topics</a><ul>
<li class="chapter" data-level="8.1" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#control-flow"><i class="fa fa-check"></i><b>8.1</b> Control flow</a><ul>
<li class="chapter" data-level="8.1.1" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#if-else"><i class="fa fa-check"></i><b>8.1.1</b> If-else</a></li>
<li class="chapter" data-level="8.1.2" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#for-loops"><i class="fa fa-check"></i><b>8.1.2</b> For loops</a></li>
<li class="chapter" data-level="8.1.3" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#while-loops"><i class="fa fa-check"></i><b>8.1.3</b> While loops</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#programming-your-own-functions"><i class="fa fa-check"></i><b>8.2</b> Programming your own functions</a><ul>
<li class="chapter" data-level="8.2.1" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#declaring-functions-in-r"><i class="fa fa-check"></i><b>8.2.1</b> Declaring functions in R</a></li>
<li class="chapter" data-level="8.2.2" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#fibonacci-numbers"><i class="fa fa-check"></i><b>8.2.2</b> Fibonacci numbers</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercises-4"><i class="fa fa-check"></i><b>8.3</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-1-4"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-2-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-3-2"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#functions-that-take-functions-as-arguments"><i class="fa fa-check"></i><b>8.4</b> Functions that take functions as arguments</a></li>
<li class="chapter" data-level="8.5" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#functions-that-take-columns-of-data-as-arguments"><i class="fa fa-check"></i><b>8.5</b> Functions that take columns of data as arguments</a></li>
<li class="chapter" data-level="8.6" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#functions-that-use-loops"><i class="fa fa-check"></i><b>8.6</b> Functions that use loops</a></li>
<li class="chapter" data-level="8.7" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#anonymous-functions"><i class="fa fa-check"></i><b>8.7</b> Anonymous functions</a></li>
<li class="chapter" data-level="8.8" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#using-your-functions-inside-mutate"><i class="fa fa-check"></i><b>8.8</b> Using your functions inside <code>mutate()</code></a></li>
<li class="chapter" data-level="8.9" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#mapping-your-homebrewed-functions-to-lists-of-datasets"><i class="fa fa-check"></i><b>8.9</b> Mapping your homebrewed functions to lists of datasets</a></li>
<li class="chapter" data-level="8.10" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#functional-programming"><i class="fa fa-check"></i><b>8.10</b> Functional programming</a><ul>
<li class="chapter" data-level="8.10.1" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#functions-definition"><i class="fa fa-check"></i><b>8.10.1</b> Functions definition</a></li>
<li class="chapter" data-level="8.10.2" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#properties-of-functions"><i class="fa fa-check"></i><b>8.10.2</b> Properties of functions</a></li>
<li class="chapter" data-level="8.10.3" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#functional-programming-with-purrr"><i class="fa fa-check"></i><b>8.10.3</b> Functional programming with <code>{purrr}</code></a></li>
<li class="chapter" data-level="8.10.4" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#the-map-family-of-functions"><i class="fa fa-check"></i><b>8.10.4</b> The <code>map*()</code> family of functions</a></li>
<li class="chapter" data-level="8.10.5" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#reducing-with-purrr"><i class="fa fa-check"></i><b>8.10.5</b> Reducing with <code>purrr</code></a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#generating-pdf-or-word-reports-with-r"><i class="fa fa-check"></i><b>8.11</b> Generating Pdf or Word reports with R</a></li>
<li class="chapter" data-level="8.12" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#scraping-the-internet"><i class="fa fa-check"></i><b>8.12</b> Scraping the internet</a></li>
<li class="chapter" data-level="8.13" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#writing-your-own-package"><i class="fa fa-check"></i><b>8.13</b> Writing your own package</a></li>
<li class="chapter" data-level="8.14" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#random-tips-and-tricks"><i class="fa fa-check"></i><b>8.14</b> Random tips and tricks</a><ul>
<li class="chapter" data-level="8.14.1" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#creating-a-log-file"><i class="fa fa-check"></i><b>8.14.1</b> Creating a log file</a></li>
</ul></li>
<li class="chapter" data-level="8.15" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercises-5"><i class="fa fa-check"></i><b>8.15</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-1-5"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-2-3"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-3-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-4-1"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern R with the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functional-programming-and-other-advanced-topics" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Functional programming and other advanced topics</h1>
<p>In this section we are going to learn some advanced concepts that are going to make you into a
full-fledged R programmer. Before this chapter you only used whatever R came with, as well as the
numerous R packages. This already allowed you to do a lot of things and solve a variety of problems!
The next step is now to learn how to actually build your own functions.</p>
<div id="control-flow" class="section level2">
<h2><span class="header-section-number">8.1</span> Control flow</h2>
<div id="if-else" class="section level3">
<h3><span class="header-section-number">8.1.1</span> If-else</h3>
<p>Imagine you want a variable to be equal to a certain value if a condition is met. This is a typical
problem that requires the <code>if ... else ...</code> construct. For instance:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">a =<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb1-2" title="2">b =<span class="st"> </span><span class="dv">5</span></a></code></pre></div>
<p>If <code>a &gt; b</code> then <code>f</code> should be equal to 20, else <code>f</code> should be equal to 10. Using <code>if ... else ...</code> you can achieve this like so:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="cf">if</span> (a <span class="op">&gt;</span><span class="st"> </span>b) {</a>
<a class="sourceLine" id="cb2-2" title="2">  f =<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb2-3" title="3">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb2-4" title="4">  f =<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb2-5" title="5">}</a></code></pre></div>
<p>Obviously, here <code>f = 10</code>. Another way to achieve this is by using the <code>ifelse()</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">f =<span class="st"> </span><span class="kw">ifelse</span>(a <span class="op">&gt;</span><span class="st"> </span>b, <span class="dv">20</span>, <span class="dv">10</span>)</a></code></pre></div>
<p>This is exactly equivalent as using the longer <code>if ... else ...</code> construct.</p>
<p>Nested <code>if ... else ...</code> constructs can get messy:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="cf">if</span> (<span class="dv">10</span> <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">print</span>(<span class="st">&quot;10 is divisible by 3&quot;</span>)</a>
<a class="sourceLine" id="cb4-3" title="3">  } <span class="cf">else</span> <span class="cf">if</span> (<span class="dv">10</span> <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="kw">print</span>(<span class="st">&quot;10 is divisible by 2&quot;</span>)</a>
<a class="sourceLine" id="cb4-5" title="5">}</a></code></pre></div>
<pre><code>## [1] &quot;10 is divisible by 2&quot;</code></pre>
<p>10 being obviously divisible by 2 and not 3, it is the second phrase that will be printed. The
<code>%%</code> operator is the modulus operator, which gives the rest of the division of 10 by 2.</p>
<p>Remember that if you are working on a dataset and wish to create a new column with values
conditionally on the values of another column, you can use <code>case_when()</code>, which is much easier.</p>
</div>
<div id="for-loops" class="section level3">
<h3><span class="header-section-number">8.1.2</span> For loops</h3>
<p>You are wondering why it took so long for <em>for loops</em> to show up. This is because we learned about
<code>map()</code> and <code>reduce()</code> which solve a lot of problems that for loops were originally intended to
tackle. And actually, you should only use for loops in a very specific situation; whenever you have
a recursive relationship. For all the rest, <code>map()</code> and <code>reduce()</code> are much easier, and return nice
objects. However, for the sake of completeness, I will present for loops in the section.</p>
<p>For loops make it possible to repeat a set of instructions <code>i</code> times. For example, try the following:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="kw">print</span>(<span class="st">&quot;hello&quot;</span>)</a>
<a class="sourceLine" id="cb6-3" title="3">}</a></code></pre></div>
<pre><code>## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;</code></pre>
<p>If you want print ‚Äúhello‚Äù using a function from <code>purrr</code> you would need to use <code>rerun()</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">rerun</span>(<span class="dv">10</span>, <span class="st">&quot;hello&quot;</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;hello&quot;
## 
## [[2]]
## [1] &quot;hello&quot;
## 
## [[3]]
## [1] &quot;hello&quot;
## 
## [[4]]
## [1] &quot;hello&quot;
## 
## [[5]]
## [1] &quot;hello&quot;
## 
## [[6]]
## [1] &quot;hello&quot;
## 
## [[7]]
## [1] &quot;hello&quot;
## 
## [[8]]
## [1] &quot;hello&quot;
## 
## [[9]]
## [1] &quot;hello&quot;
## 
## [[10]]
## [1] &quot;hello&quot;</code></pre>
<p><code>rerun()</code> simply runs an expression (which can be arbitrarily complex) <code>n</code> times, whereas <code>map()</code>
maps a function to a list of inputs, so to achieve the same with <code>map()</code>, you need to map the <code>print()</code>
function to a vector of characters:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">map</span>(<span class="kw">rep</span>(<span class="st">&quot;hello&quot;</span>, <span class="dv">10</span>), print)</a></code></pre></div>
<pre><code>## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;</code></pre>
<pre><code>## [[1]]
## [1] &quot;hello&quot;
## 
## [[2]]
## [1] &quot;hello&quot;
## 
## [[3]]
## [1] &quot;hello&quot;
## 
## [[4]]
## [1] &quot;hello&quot;
## 
## [[5]]
## [1] &quot;hello&quot;
## 
## [[6]]
## [1] &quot;hello&quot;
## 
## [[7]]
## [1] &quot;hello&quot;
## 
## [[8]]
## [1] &quot;hello&quot;
## 
## [[9]]
## [1] &quot;hello&quot;
## 
## [[10]]
## [1] &quot;hello&quot;</code></pre>
<p><code>rep()</code> is a function that creates a vector by repeating something, in this case the string ‚Äúhello‚Äù,
as many times as needed, here 10. The output here is a bit different that before though, because first
you will see ‚Äúhello‚Äù printed 10 times, but <code>map()</code> always returns a list, this means that you will also
get a list where each element is the string ‚Äúhello‚Äù.</p>
<p>It is also possible to do calculations using for loops. Let‚Äôs compute the sum of the first 100 integers:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">result =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>){</a>
<a class="sourceLine" id="cb13-3" title="3">  result =<span class="st"> </span>result <span class="op">+</span><span class="st"> </span>i</a>
<a class="sourceLine" id="cb13-4" title="4">}</a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="kw">print</span>(result)</a></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p><code>result</code> is equal to 5050, the expected result. What happened in that loop? First, we defined a
variable called <code>result</code> and set it to 0. Then, when the loops starts, <code>i</code> equals 1, so we add
<code>result</code> to <code>1</code>, which is 1. Then, <code>i</code> equals 2, and again, we add <code>result</code> to <code>i</code>. But this time,
<code>result</code> equals 1 and <code>i</code> equals 2, so now <code>result</code> equals 3, and we repeat this until <code>i</code>
equals 100.</p>
<p>Contrast this to the <code>purrr</code> solution using <code>reduce()</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">result =<span class="st"> </span><span class="kw">reduce</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">100</span>), <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">print</span>(result)</a></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>You certainly agree with me that is simpler to understand. You can even see what happens in more
detail using <code>accumulate</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">accumulate</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>), <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>##   [1]    1    3    6   10   15   21   28   36   45   55   66   78   91  105
##  [15]  120  136  153  171  190  210  231  253  276  300  325  351  378  406
##  [29]  435  465  496  528  561  595  630  666  703  741  780  820  861  903
##  [43]  946  990 1035 1081 1128 1176 1225 1275 1326 1378 1431 1485 1540 1596
##  [57] 1653 1711 1770 1830 1891 1953 2016 2080 2145 2211 2278 2346 2415 2485
##  [71] 2556 2628 2701 2775 2850 2926 3003 3081 3160 3240 3321 3403 3486 3570
##  [85] 3655 3741 3828 3916 4005 4095 4186 4278 4371 4465 4560 4656 4753 4851
##  [99] 4950 5050</code></pre>
<p>However this does not mean that loops do not have their place. We are going to this in more detail
in the next sections, but first, let‚Äôs learn about while loops.</p>
</div>
<div id="while-loops" class="section level3">
<h3><span class="header-section-number">8.1.3</span> While loops</h3>
<p>While loops are very similar to for loops. The instructions inside a while loop are repeat while a
certain condition holds true. Let‚Äôs consider the sum of the first 100 integers again:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">result =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb19-2" title="2">i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="cf">while</span> (i<span class="op">&lt;=</span><span class="dv">100</span>){</a>
<a class="sourceLine" id="cb19-4" title="4">  result =<span class="st"> </span>result <span class="op">+</span><span class="st"> </span>i</a>
<a class="sourceLine" id="cb19-5" title="5">  i =<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb19-6" title="6">}</a>
<a class="sourceLine" id="cb19-7" title="7"></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="kw">print</span>(result)</a></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>Here, we first set <code>result</code> and <code>i</code> to 0. Then, while <code>i</code> is inferior, or equal to 100, we add <code>i</code>
to <code>result</code>. Notice that there is one more line than in the for loop: we need to increment the value
of <code>i</code>, if not, <code>i</code> would stay equal to 1, and the condition would always be fulfilled, and
the loop would run forever (not really, only until your computer runs out of memory).</p>
<p>In the next section we are going to learn how to write our own functions; this is when we are going
to learn about recursive relationships that for and while loops can solve very well.</p>
</div>
</div>
<div id="programming-your-own-functions" class="section level2">
<h2><span class="header-section-number">8.2</span> Programming your own functions</h2>
<p>As you have seen by now, R includes a very large amount of preprogrammed functions, but also much
more functions are available in packages. However, you will always need to write your own. In this
section we are going to learn how to write our own functions.</p>
<div id="declaring-functions-in-r" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Declaring functions in R</h3>
<p>Suppose you want to create the following function: <span class="math inline">\(f(x) = \dfrac{1}{\sqrt{x}}\)</span>.
This is the syntax you would use:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">my_function &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">return</span>(<span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(x))</a>
<a class="sourceLine" id="cb21-3" title="3">}</a></code></pre></div>
<p>While in general, it is a good idea to add comments to your functions to explain what they do, I
would avoid adding comments to functions that do things that are very obvious, such as with this
one. Function names should be of the form: <code>function_name()</code>. Always give your function very
explicit names! In mathematics it is standard to give functions just one letter as a name, but I
would advise against doing that in your code. Functions that you write are not special in any way;
this means that R will treat them the same way, and they will work in conjunction with any other
function just as if it was built-in into R. They have one limitation though (which is shared with
R‚Äôs native function): just like in math, they can only return one value. However, sometimes, you
may need to return more than one value. To be able to do this, you must put your values in a list,
and return the list of values. For example:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">average_and_sd &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb22-2" title="2">  result =<span class="st"> </span><span class="kw">c</span>(<span class="kw">mean</span>(x), <span class="kw">sd</span>(x))</a>
<a class="sourceLine" id="cb22-3" title="3"><span class="kw">return</span>(result)</a>
<a class="sourceLine" id="cb22-4" title="4">}</a>
<a class="sourceLine" id="cb22-5" title="5"></a>
<a class="sourceLine" id="cb22-6" title="6"><span class="kw">average_and_sd</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>))</a></code></pre></div>
<pre><code>## [1] 7.166667 4.262237</code></pre>
<p>If you need to use a function from a package inside your function, you have two solutions at your
disposal: if you only need one single function, use <code>::</code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">my_sum &lt;-<span class="st"> </span><span class="cf">function</span>(a_vector){</a>
<a class="sourceLine" id="cb24-2" title="2">  purrr<span class="op">::</span><span class="kw">reduce</span>(a_vector, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb24-3" title="3">}</a></code></pre></div>
<p>or, if you need several functions, use <code>library(package_name)</code>, inside the function:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">my_sum &lt;-<span class="st"> </span><span class="cf">function</span>(a_vector){</a>
<a class="sourceLine" id="cb25-2" title="2">  <span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb25-3" title="3">  <span class="kw">reduce</span>(a_vector, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb25-4" title="4">}</a></code></pre></div>
<p>Loading the library inside the function has the advantage that you will be sure that the package
upon which your function depends will be loaded. If the package is already loaded, it will not be
loaded again, thus not impacting performance, but if you forgot to load it at the beginning of your
script, then, no worries, your function will load it the first time you use it!</p>
<p>You can put a lot of instructions inside a function, such as loops. Let‚Äôs create the function that
returns my_fibonacci numbers.</p>
</div>
<div id="fibonacci-numbers" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Fibonacci numbers</h3>
<p>The Fibonacci sequence is the following:</p>
<p><span class="math display">\[1, 1, 2, 3, 5, 8, 13, 21, 34, 55, ...\]</span></p>
<p>Each subsequent number is composed of the sum of the two preceding ones. In R, it is possible to define a function that returns the <span class="math inline">\(n^{th}\)</span> my_fibonacci number:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">my_fibo &lt;-<span class="st"> </span><span class="cf">function</span>(n){</a>
<a class="sourceLine" id="cb26-2" title="2"> a =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb26-3" title="3"> b =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb26-4" title="4"> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n){</a>
<a class="sourceLine" id="cb26-5" title="5">  temp =<span class="st"> </span>b</a>
<a class="sourceLine" id="cb26-6" title="6">  b =<span class="st"> </span>a</a>
<a class="sourceLine" id="cb26-7" title="7">  a =<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>temp</a>
<a class="sourceLine" id="cb26-8" title="8"> }</a>
<a class="sourceLine" id="cb26-9" title="9"> <span class="kw">return</span>(a)</a>
<a class="sourceLine" id="cb26-10" title="10">}</a></code></pre></div>
<p>Inside the loop, we defined a variable called <code>temp</code>. Defining temporary variables is usually very
useful inside loops. Let‚Äôs try to understand what happens inside this loop:</p>
<ul>
<li>First, we assign the value 0 to variable <code>a</code> and value 1 to variable <code>b</code>.</li>
<li>We start a loop, that goes from 1 to <code>n</code>.</li>
<li>We assign the value inside of <code>b</code> to a temporary variable, called <code>temp</code>.</li>
<li><code>b</code> becomes <code>a</code>.</li>
<li>We assign the sum of <code>a</code> and <code>temp</code> to <code>a</code>.</li>
<li>When the loop is finished, we return <code>a</code>.</li>
</ul>
<p>What happens if we want the 3rd my_fibonacci number? At <code>n = 1</code> we have first <code>a = 0</code> and <code>b = 1</code>,
then <code>temp = 1</code>, <code>b = 0</code> and <code>a = 0 + 1</code>. Then <code>n = 2</code>. Now <code>b = 0</code> and <code>temp = 0</code>. The previous
result, <code>a = 0 + 1</code> is now assigned to <code>b</code>, so <code>b = 1</code>. Then, <code>a = 1 + 0</code>. Finally, <code>n = 3</code>. <code>temp = 1</code> (because <code>b = 1</code>), the previous result <code>a = 1</code> is assigned to <code>b</code> and finally, <code>a = 1 + 1</code>. So
the third my_fibonacci number equals 2. Reading this might be a bit confusing; I strongly advise you
to run the algorithm on a sheet of paper, step by step.</p>
<p>The above algorithm is called an iterative algorithm, because it uses a loop to compute the result.
Let‚Äôs look at another way to think about the problem, with a so-called recursive function:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">fibo_recur &lt;-<span class="st"> </span><span class="cf">function</span>(n){</a>
<a class="sourceLine" id="cb27-2" title="2"> <span class="cf">if</span> (n <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>n <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb27-3" title="3">   <span class="kw">return</span>(n)</a>
<a class="sourceLine" id="cb27-4" title="4">   } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb27-5" title="5">     <span class="kw">return</span>(<span class="kw">fibo_recur</span>(n<span class="dv">-1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">fibo_recur</span>(n<span class="dv">-2</span>))</a>
<a class="sourceLine" id="cb27-6" title="6">   }</a>
<a class="sourceLine" id="cb27-7" title="7">}</a></code></pre></div>
<p>This algorithm should be easier to understand: if <code>n = 0</code> or <code>n = 1</code> the function should return <code>n</code>
(0 or 1). If <code>n</code> is strictly bigger than <code>1</code>, <code>fibo_recur()</code> should return the sum of
<code>fibo_recur(n-1)</code> and <code>fibo_recur(n-2)</code>. This version of the function is very much the same as the
mathematical definition of the fibonacci sequence. So why not use only recursive algorithms
then? Try to run the following:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">system.time</span>(<span class="kw">my_fibo</span>(<span class="dv">30</span>))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.036   0.239   0.181</code></pre>
<p>The result should be printed very fast (the <code>system.time()</code> function returns the time that it took
to execute <code>my_fibo(30)</code>). Let‚Äôs try with the recursive version:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">system.time</span>(<span class="kw">fibo_recur</span>(<span class="dv">30</span>))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   1.085   0.082   1.164</code></pre>
<p>It takes much longer to execute! Recursive algorithms are very CPU demanding, so if speed is
critical, it‚Äôs best to avoid recursive algorithms. Also, in <code>fibo_recur()</code> try to remove this line:
<code>if (n == 0 || n == 1)</code> and try to run <code>fibo_recur(5)</code> for example and see what happens. You should
get an error: this is because for recursive algorithms you need a stopping condition, or else, it would
run forever. This is not the case for iterative algorithms, because the stopping condition is the
last step of the loop.</p>
<p>So as you can see, for recursive relationships, for or while loops are the way to go in R, whether
you‚Äôre writing these loops inside functions or not.</p>
</div>
</div>
<div id="exercises-4" class="section level2">
<h2><span class="header-section-number">8.3</span> Exercises</h2>
<div id="exercise-1-4" class="section level3 unnumbered">
<h3>Exercise 1</h3>
<p>In this exercise, you will write a function to compute the sum of the n first integers. Combine the
algorithm we saw in section about while loops and what you learned about functions
in this section.</p>
</div>
<div id="exercise-2-2" class="section level3 unnumbered">
<h3>Exercise 2</h3>
<p>Write a function called <code>my_fact()</code> that computes the factorial of a number <code>n</code>. Do it using a
loop, using a recursive function, and using a functional:</p>
</div>
<div id="exercise-3-2" class="section level3 unnumbered">
<h3>Exercise 3</h3>
<p>Write a function to find the roots of quadratic functions. Your function should take 3 arguments,
<code>a</code>, <code>b</code> and <code>c</code> and return the two roots. Only consider the case where there are two real roots
(delta &gt; 0).</p>
</div>
</div>
<div id="functions-that-take-functions-as-arguments" class="section level2">
<h2><span class="header-section-number">8.4</span> Functions that take functions as arguments</h2>
<p>Functions that take functions as arguments are very powerful and useful tools. You already know a
couple, <code>purrr::map()</code> and <code>purrr::reduce()</code>. But you can also write your own! A very simple example would be the
following:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">my_func &lt;-<span class="st"> </span><span class="cf">function</span>(x, func){</a>
<a class="sourceLine" id="cb32-2" title="2">  <span class="kw">func</span>(x)</a>
<a class="sourceLine" id="cb32-3" title="3">}</a></code></pre></div>
<p><code>my_func()</code> is a very simple function that takes <code>x</code> and <code>func()</code> as arguments and that simply
executes <code>func(x)</code>. This might seem pretty useful (after all, you could simply use <code>func(x)!</code>) but
this is just for illustration purposes, in practice, your functions would be more useful than that!
Let‚Äôs try to use <code>my_func()</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">8</span>), mean)</a></code></pre></div>
<pre><code>## [1] 3.6</code></pre>
<p>As expected, this returns the mean of the given vector. But now suppose the following:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean)</a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Because one element of the list is <code>NA</code>, the whole mean is <code>NA</code>. <code>mean()</code> has a <code>na.rm</code> argument
that you can set to <code>TRUE</code> to ignore the <code>NA</code>s in the vector. However, here, there is no way to
provide this argument to the function <code>mean()</code>! Let‚Äôs see what happens when we try to:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>Error in my_func(c(1, 8, 1, NA, 8), mean, na.rm = TRUE) :
  unused argument (na.rm = TRUE)</code></pre>
<p>So what you could do is pass the value <code>TRUE</code> to the <code>na.rm</code> argument of <code>mean()</code> from your own
function:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">my_func &lt;-<span class="st"> </span><span class="cf">function</span>(x, func, remove_na){</a>
<a class="sourceLine" id="cb39-2" title="2">  <span class="kw">func</span>(x, <span class="dt">na.rm =</span> remove_na)</a>
<a class="sourceLine" id="cb39-3" title="3">}</a>
<a class="sourceLine" id="cb39-4" title="4"></a>
<a class="sourceLine" id="cb39-5" title="5"><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean, <span class="dt">remove_na =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 4.5</code></pre>
<p>This is one solution, but <code>mean()</code> also has another argument called <code>trim</code>. What if some other user needs
this argument? Should you also add it to your function? Surely there‚Äôs a way to avoid this problem?
Yes, there is, and it‚Äôs the <em>dots</em>. The <code>...</code> simply mean ‚Äúany other argument as needed‚Äù, and it‚Äôs
very easy to use:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">my_func &lt;-<span class="st"> </span><span class="cf">function</span>(x, func, ...){</a>
<a class="sourceLine" id="cb41-2" title="2">  <span class="kw">func</span>(x, ...)</a>
<a class="sourceLine" id="cb41-3" title="3">}</a>
<a class="sourceLine" id="cb41-4" title="4"></a>
<a class="sourceLine" id="cb41-5" title="5"><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 4.5</code></pre>
<p>or, now, if you need the <code>trim</code> argument:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">trim =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<pre><code>## [1] 4.5</code></pre>
<p>The <code>...</code> very useful when writing wrappers such as <code>my_func()</code>.</p>
</div>
<div id="functions-that-take-columns-of-data-as-arguments" class="section level2">
<h2><span class="header-section-number">8.5</span> Functions that take columns of data as arguments</h2>
<p>In many situations, you will want to write functions that look similar to this:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="kw">my_function</span>(my_data, one_column_inside_data)</a></code></pre></div>
<p>Such a function would be useful in situation where you have to apply a certain number of operations
to columns for different data frames. For example if you need to create tables of descriptive
statistics or graphs periodically, it might be very interesting to put these operations inside a
function and then call the function whenever you need it, on the fresh batch of data.</p>
<p>However, if you try to write something like that, something that might seem unexpected, at first,
will happen:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="kw">data</span>(mtcars)</a>
<a class="sourceLine" id="cb46-2" title="2"></a>
<a class="sourceLine" id="cb46-3" title="3">simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, col_name){</a>
<a class="sourceLine" id="cb46-4" title="4">  dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb46-5" title="5"><span class="st">    </span><span class="kw">group_by</span>(col_name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb46-6" title="6"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_speed =</span> <span class="kw">mean</span>(speed)) -&gt;<span class="st"> </span>dataset</a>
<a class="sourceLine" id="cb46-7" title="7">  <span class="kw">return</span>(dataset)</a>
<a class="sourceLine" id="cb46-8" title="8">}</a>
<a class="sourceLine" id="cb46-9" title="9"></a>
<a class="sourceLine" id="cb46-10" title="10"></a>
<a class="sourceLine" id="cb46-11" title="11"><span class="kw">simple_function</span>(cars, <span class="st">&quot;dist&quot;</span>)</a></code></pre></div>
<pre><code>Error: unknown variable to group by : col_name</code></pre>
<p>The variable <code>col_name</code> is passed to <code>simple_function()</code> as a string, but <code>group_by()</code> requires a
variable name. So why not try to convert <code>col_name</code> to a name?</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1">simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, col_name){</a>
<a class="sourceLine" id="cb48-2" title="2">  col_name &lt;-<span class="st"> </span><span class="kw">as.name</span>(col_name)</a>
<a class="sourceLine" id="cb48-3" title="3">  dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-4" title="4"><span class="st">    </span><span class="kw">group_by</span>(col_name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-5" title="5"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_speed =</span> <span class="kw">mean</span>(speed)) -&gt;<span class="st"> </span>dataset</a>
<a class="sourceLine" id="cb48-6" title="6">  <span class="kw">return</span>(dataset)</a>
<a class="sourceLine" id="cb48-7" title="7">}</a>
<a class="sourceLine" id="cb48-8" title="8"></a>
<a class="sourceLine" id="cb48-9" title="9"></a>
<a class="sourceLine" id="cb48-10" title="10"><span class="kw">simple_function</span>(cars, <span class="st">&quot;dist&quot;</span>)</a></code></pre></div>
<pre><code>Error: unknown variable to group by : col_name</code></pre>
<p>This is because R is literally looking for the variable <code>&quot;dist&quot;</code> somewhere in the global
environment, and not as a column of the data. R does not understand that you are refering to the
column <code>&quot;dist&quot;</code> that is inside the dataset. So how can we make R understand what you mean?</p>
<p>To be able to do that, we need to use a framework that was introduced recently in the <code>tidyverse</code>,
called <code>tidyeval</code>. This discussion can get very technical, so I will spare you the details.
However, you can read about it <a href="http://dplyr.tidyverse.org/articles/programming.html">here</a> and
<a href="https://cran.r-project.org/web/packages/rlang/vignettes/tidy-evaluation.html">here</a>. The
discussion can get complicated, but using <code>tidyeval</code> is actually quite easy, and you can get a
cookbook approach to it. Take a look at the code below:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, col_name){</a>
<a class="sourceLine" id="cb50-2" title="2">  col_name &lt;-<span class="st"> </span><span class="kw">enquo</span>(col_name)</a>
<a class="sourceLine" id="cb50-3" title="3">  dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-4" title="4"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!</span>col_name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-5" title="5"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_mpg =</span> <span class="kw">mean</span>(mpg)) -&gt;<span class="st"> </span>dataset</a>
<a class="sourceLine" id="cb50-6" title="6">  <span class="kw">return</span>(dataset)</a>
<a class="sourceLine" id="cb50-7" title="7">}</a>
<a class="sourceLine" id="cb50-8" title="8"></a>
<a class="sourceLine" id="cb50-9" title="9"></a>
<a class="sourceLine" id="cb50-10" title="10"><span class="kw">simple_function</span>(mtcars, cyl)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##     cyl mean_mpg
##   &lt;int&gt;    &lt;dbl&gt;
## 1     4     26.7
## 2     6     19.7
## 3     8     15.1</code></pre>
<p>As you can see, the previous idea we had, which was using <code>as.name()</code> was not very far away from
the solution. The solution, with <code>tidyeval</code>, consists in using <code>enquo()</code>, which for our purposes,
let‚Äôs say that this function does something similar to <code>as.name()</code> (in truth, it doesn‚Äôt). Now that
<code>col_name</code> is (R programmers call it) quoted, we need to tell <code>group_by()</code> to evaluate the input as
is. This is done with <code>!!()</code>, which is another <code>tidyeval</code> function. I say it again;
don‚Äôt worry if you don‚Äôt understand everything. Just remember to use <code>enquo()</code> on your column names
and then <code>!!()</code> inside the <code>dplyr</code> function you want to use.</p>
<p>Let‚Äôs see some other examples:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, col_name, value){</a>
<a class="sourceLine" id="cb52-2" title="2">  col_name &lt;-<span class="st"> </span><span class="kw">enquo</span>(col_name)</a>
<a class="sourceLine" id="cb52-3" title="3">  dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-4" title="4"><span class="st">    </span><span class="kw">filter</span>((<span class="op">!!</span>col_name) <span class="op">==</span><span class="st"> </span>value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-5" title="5"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_cyl =</span> <span class="kw">mean</span>(cyl)) -&gt;<span class="st"> </span>dataset</a>
<a class="sourceLine" id="cb52-6" title="6">  <span class="kw">return</span>(dataset)</a>
<a class="sourceLine" id="cb52-7" title="7">}</a>
<a class="sourceLine" id="cb52-8" title="8"></a>
<a class="sourceLine" id="cb52-9" title="9"></a>
<a class="sourceLine" id="cb52-10" title="10"><span class="kw">simple_function</span>(mtcars, am, <span class="dv">1</span>)</a></code></pre></div>
<pre><code>##   mean_cyl
## 1 5.076923</code></pre>
<p>Notice that I‚Äôve written:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1"><span class="kw">filter</span>((<span class="op">!!</span>col_name) <span class="op">==</span><span class="st"> </span>value)</a></code></pre></div>
<p>and not:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="kw">filter</span>(<span class="op">!!</span>col_name <span class="op">==</span><span class="st"> </span>value)</a></code></pre></div>
<p>I have enclosed <code>!!col_name</code> inside parentheses. This is because operators such as <code>==</code> have
precedence over <code>!!</code>, so you have to be explicit. Also, notice that I didn‚Äôt have to quote <code>1</code>.
This is because it‚Äôs <em>standard</em> variable, not a column inside the dataset. Let‚Äôs make this function
a bit more general. I hard-coded the variable cyl inside the body of the function, but maybe you‚Äôd
like the mean of another variable?</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1">simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, filter_col, mean_col, value){</a>
<a class="sourceLine" id="cb56-2" title="2">  filter_col &lt;-<span class="st"> </span><span class="kw">enquo</span>(filter_col)</a>
<a class="sourceLine" id="cb56-3" title="3">  mean_col &lt;-<span class="st"> </span><span class="kw">enquo</span>(mean_col)</a>
<a class="sourceLine" id="cb56-4" title="4">  dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-5" title="5"><span class="st">    </span><span class="kw">filter</span>((<span class="op">!!</span>filter_col) <span class="op">==</span><span class="st"> </span>value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-6" title="6"><span class="st">    </span><span class="kw">summarise</span>(<span class="kw">mean</span>((<span class="op">!!</span>mean_col))) -&gt;<span class="st"> </span>dataset</a>
<a class="sourceLine" id="cb56-7" title="7">  <span class="kw">return</span>(dataset)</a>
<a class="sourceLine" id="cb56-8" title="8">}</a>
<a class="sourceLine" id="cb56-9" title="9"></a>
<a class="sourceLine" id="cb56-10" title="10"></a>
<a class="sourceLine" id="cb56-11" title="11"><span class="kw">simple_function</span>(mtcars, am, cyl, <span class="dv">1</span>)</a></code></pre></div>
<pre><code>##   mean(cyl)
## 1  5.076923</code></pre>
<p>Notice that I had to quote <code>mean_col</code> too.</p>
<p>Using the <code>...</code> that we discovered in the previous section, we can pass more than one column:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1">simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, ...){</a>
<a class="sourceLine" id="cb58-2" title="2">  col_vars &lt;-<span class="st"> </span><span class="kw">quos</span>(...)</a>
<a class="sourceLine" id="cb58-3" title="3">  dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-4" title="4"><span class="st">    </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(<span class="op">!!!</span>col_vars), <span class="kw">funs</span>(mean, sd))</a>
<a class="sourceLine" id="cb58-5" title="5">}</a></code></pre></div>
<p>Because these <em>dots</em> contain more than one variable, you have to use <code>quos()</code> instead of <code>enquo()</code>.
This will put the arguments provided via the dots in a list. Then, because we have a list of
columns, we have to use <code>summarise_at()</code>, which you should know if you did the exercices of
chapter 5. So if you didn‚Äôt do them, go back to them and finish them first. Doing the exercise will
also teach you what <code>vars()</code> and <code>funs()</code> are. The last thing you have to pay attention to is to
use <code>!!!()</code> if you used <code>quos()</code>. So 3 <code>!</code> instead of only 2. This allows you to then do things
like this:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1"><span class="kw">simple_function</span>(mtcars, am, cyl, mpg)</a></code></pre></div>
<pre><code>##   am_mean cyl_mean mpg_mean     am_sd   cyl_sd   mpg_sd
## 1 0.40625   6.1875 20.09062 0.4989909 1.785922 6.026948</code></pre>
<p>Using <code>...</code> with <code>!!!()</code> allows you to write very flexible functions.</p>
<p>If you need to be even more general, you can also provide the summary functions as arguments of
your function, but you have to rewrite your function a little bit:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, cols, funcs){</a>
<a class="sourceLine" id="cb61-2" title="2">  dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-3" title="3"><span class="st">    </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(<span class="op">!!!</span>cols), <span class="kw">funs</span>(<span class="op">!!!</span>funcs))</a>
<a class="sourceLine" id="cb61-4" title="4">}</a></code></pre></div>
<p>You might be wondering where the <code>quos()</code> went? Well because now we are passing two lists of, a list
columns that we have to quote, and a list of functions, that we have to quote, we need to use <code>quos()</code>
when calling the function:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1"><span class="kw">simple_function</span>(mtcars, <span class="kw">quos</span>(am, cyl, mpg), <span class="kw">quos</span>(mean, sd, sum))</a></code></pre></div>
<pre><code>##   am_mean cyl_mean mpg_mean     am_sd   cyl_sd   mpg_sd am_sum cyl_sum
## 1 0.40625   6.1875 20.09062 0.4989909 1.785922 6.026948     13     198
##   mpg_sum
## 1   642.9</code></pre>
<p>This works, but I don‚Äôt think you‚Äôll need to have that much flexibility; either the columns are variable,
or the functions, but rarely both at the same time. I guess.</p>
</div>
<div id="functions-that-use-loops" class="section level2">
<h2><span class="header-section-number">8.6</span> Functions that use loops</h2>
<p>It is entirely possible to put a loop inside a function. For example, consider the following
function that return the square root of a number using Newton‚Äôs algorithm:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1">sqrt_newton &lt;-<span class="st"> </span><span class="cf">function</span>(a, <span class="dt">init =</span> <span class="dv">1</span>, <span class="dt">eps =</span> <span class="fl">0.01</span>){</a>
<a class="sourceLine" id="cb64-2" title="2">    <span class="kw">stopifnot</span>(a <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb64-3" title="3">    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</a>
<a class="sourceLine" id="cb64-4" title="4">        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</a>
<a class="sourceLine" id="cb64-5" title="5">    }</a>
<a class="sourceLine" id="cb64-6" title="6">    <span class="kw">return</span>(init)</a>
<a class="sourceLine" id="cb64-7" title="7">}</a></code></pre></div>
<p>This functions contains a while loop inside its body. Let‚Äôs see if it works:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1"><span class="kw">sqrt_newton</span>(<span class="dv">16</span>)</a></code></pre></div>
<pre><code>## [1] 4.000001</code></pre>
<p>In the definition of the function, I wrote <code>init = 1</code> and <code>eps = 0.01</code> which means that this
argument can be omitted and will have the provided value (0.01) as the default. You can then use
this function as any other, for example with <code>map()</code>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1"><span class="kw">map</span>(<span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">12</span>), sqrt_newton)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 4.000001
## 
## [[2]]
## [1] 2.645767
## 
## [[3]]
## [1] 2.828469
## 
## [[4]]
## [1] 3.000092
## 
## [[5]]
## [1] 3.464616</code></pre>
<p>This is what I meant before with ‚Äúyour functions are nothing special‚Äù. Once the function is
defined, you can use it like any other base R function.</p>
<p>Notice the use of <code>stopifnot()</code> inside the body of the function. This is a way to return an error
in case a condition is not fulfilled.</p>
</div>
<div id="anonymous-functions" class="section level2">
<h2><span class="header-section-number">8.7</span> Anonymous functions</h2>
<p>As the name implies, anonymous functions are functions that do not have a name. These are useful inside
functions that have functions as arguments, such as <code>purrr::map()</code> or <code>purrr::reduce()</code>:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1"><span class="kw">map</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="cf">function</span>(x){<span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(x)})</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 0.7071068
## 
## [[3]]
## [1] 0.5773503
## 
## [[4]]
## [1] 0.5</code></pre>
<p>These anonymous functions get defined in a very similar way to regular functions, you just skip the
name and that‚Äôs it. <code>tidyverse</code> functions also support formulas; these get converted to anonymous functions:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1"><span class="kw">map</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="op">~</span>{<span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(.)})</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 0.7071068
## 
## [[3]]
## [1] 0.5773503
## 
## [[4]]
## [1] 0.5</code></pre>
<p>Using a formula instead of an anonymous function is less verbose; you use <code>~</code> instead of <code>function(x)</code>
and a single dot <code>.</code> instead of <code>x</code>. What if you need an anonymous function that requires more than
one argument? This is not a problem:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1"><span class="kw">map2</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">5</span>), <span class="cf">function</span>(x, y){(x<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>y})</a></code></pre></div>
<pre><code>## [[1]]
## [1] 0.1111111
## 
## [[2]]
## [1] 0.5
## 
## [[3]]
## [1] 1.285714
## 
## [[4]]
## [1] 2.666667
## 
## [[5]]
## [1] 5</code></pre>
<p>or, using a formula:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1"><span class="kw">map2</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">5</span>), <span class="op">~</span>{(.x<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>.y})</a></code></pre></div>
<pre><code>## [[1]]
## [1] 0.1111111
## 
## [[2]]
## [1] 0.5
## 
## [[3]]
## [1] 1.285714
## 
## [[4]]
## [1] 2.666667
## 
## [[5]]
## [1] 5</code></pre>
<p>Because you have now two arguments, a single dot could not work, so instead you use <code>.x</code> and <code>.y</code> to
avoid confusion.</p>
</div>
<div id="using-your-functions-inside-mutate" class="section level2">
<h2><span class="header-section-number">8.8</span> Using your functions inside <code>mutate()</code></h2>
<p>Once you wrote a function, you can easily use it inside a pipe workflow:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">double_number &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb77-2" title="2">  x<span class="op">+</span>x</a>
<a class="sourceLine" id="cb77-3" title="3">}</a></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">double_mpg =</span> <span class="kw">double_number</span>(mpg))</a></code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat    wt  qsec vs am gear carb double_mpg
## 1  21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4       42.0
## 2  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4       42.0
## 3  22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1       45.6
## 4  21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1       42.8
## 5  18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2       37.4
## 6  18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1       36.2
## 7  14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4       28.6
## 8  24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2       48.8
## 9  22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2       45.6
## 10 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4       38.4
## 11 17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4       35.6
## 12 16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3       32.8
## 13 17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3       34.6
## 14 15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3       30.4
## 15 10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4       20.8
## 16 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4       20.8
## 17 14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4       29.4
## 18 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1       64.8
## 19 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2       60.8
## 20 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1       67.8
## 21 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1       43.0
## 22 15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2       31.0
## 23 15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2       30.4
## 24 13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4       26.6
## 25 19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2       38.4
## 26 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1       54.6
## 27 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2       52.0
## 28 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2       60.8
## 29 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4       31.6
## 30 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6       39.4
## 31 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8       30.0
## 32 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2       42.8</code></pre>
<p>Granted this example is stupid, but it shows you, again, that functions you define are nothing
special. You can use them just as any other.</p>
<p>You can also avoid to define a function altogether, especially if you need an operation only once,
by using the <code>.</code> like this:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb80-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">double_mpg =</span> .<span class="op">$</span>mpg <span class="op">+</span><span class="st"> </span>.<span class="op">$</span>mpg)</a></code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat    wt  qsec vs am gear carb double_mpg
## 1  21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4       42.0
## 2  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4       42.0
## 3  22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1       45.6
## 4  21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1       42.8
## 5  18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2       37.4
## 6  18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1       36.2
## 7  14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4       28.6
## 8  24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2       48.8
## 9  22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2       45.6
## 10 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4       38.4
## 11 17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4       35.6
## 12 16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3       32.8
## 13 17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3       34.6
## 14 15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3       30.4
## 15 10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4       20.8
## 16 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4       20.8
## 17 14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4       29.4
## 18 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1       64.8
## 19 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2       60.8
## 20 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1       67.8
## 21 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1       43.0
## 22 15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2       31.0
## 23 15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2       30.4
## 24 13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4       26.6
## 25 19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2       38.4
## 26 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1       54.6
## 27 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2       52.0
## 28 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2       60.8
## 29 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4       31.6
## 30 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6       39.4
## 31 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8       30.0
## 32 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2       42.8</code></pre>
</div>
<div id="mapping-your-homebrewed-functions-to-lists-of-datasets" class="section level2">
<h2><span class="header-section-number">8.9</span> Mapping your homebrewed functions to lists of datasets</h2>
<p>Before merging these datasets together, we would need them to have a <code>year</code> column indicating the
year. It would also be helpful if gave names to these datasets. For this task, we can use
<code>purrr::set_names()</code>:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">all_datasets =<span class="st"> </span><span class="kw">set_names</span>(all_datasets, <span class="kw">as.character</span>(<span class="kw">seq</span>(<span class="dv">2013</span>, <span class="dv">2016</span>)))</a></code></pre></div>
<p>Let‚Äôs take a look at the list now:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1"><span class="kw">str</span>(all_datasets)</a></code></pre></div>
<pre><code>## List of 4
##  $ 2013:&#39;data.frame&#39;:    118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 223407 17802 1703 844 1431 4094 2146 971 1218 3002 ...
##   ..$ of_which_wage_earners       : int [1:118] 203535 15993 1535 750 1315 3800 1874 858 1029 2664 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 19872 1809 168 94 116 294 272 113 189 338 ...
##   ..$ unemployed                  : int [1:118] 19287 1071 114 25 74 261 98 45 66 207 ...
##   ..$ active_population           : int [1:118] 242694 18873 1817 869 1505 4355 2244 1016 1284 3209 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.95 5.67 6.27 2.88 4.92 ...
##   ..$ year                        : int [1:118] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ 2014:&#39;data.frame&#39;:    118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 228423 18166 1767 845 1505 4129 2172 1007 1268 3124 ...
##   ..$ of_which_wage_earners       : int [1:118] 208238 16366 1606 757 1390 3840 1897 887 1082 2782 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20185 1800 161 88 115 289 275 120 186 342 ...
##   ..$ unemployed                  : int [1:118] 19362 1066 122 19 66 287 91 38 61 202 ...
##   ..$ active_population           : int [1:118] 247785 19232 1889 864 1571 4416 2263 1045 1329 3326 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.81 5.54 6.46 2.2 4.2 ...
##   ..$ year                        : int [1:118] 2014 2014 2014 2014 2014 2014 2014 2014 2014 2014 ...
##  $ 2015:&#39;data.frame&#39;:    118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 233130 18310 1780 870 1470 4130 2170 1050 1300 3140 ...
##   ..$ of_which_wage_earners       : int [1:118] 212530 16430 1620 780 1350 3820 1910 920 1100 2770 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20600 1880 160 90 120 310 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18806 988 106 29 73 260 80 41 72 169 ...
##   ..$ active_population           : int [1:118] 251936 19298 1886 899 1543 4390 2250 1091 1372 3309 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.46 5.12 5.62 3.23 4.73 ...
##   ..$ year                        : int [1:118] 2015 2015 2015 2015 2015 2015 2015 2015 2015 2015 ...
##  $ 2016:&#39;data.frame&#39;:    118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 236100 18380 1790 870 1470 4160 2160 1030 1330 3150 ...
##   ..$ of_which_wage_earners       : int [1:118] 215430 16500 1640 780 1350 3840 1900 900 1130 2780 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20670 1880 150 90 120 320 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18185 975 91 27 66 246 76 35 70 206 ...
##   ..$ active_population           : int [1:118] 254285 19355 1881 897 1536 4406 2236 1065 1400 3356 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.15 5.04 4.84 3.01 4.3 ...
##   ..$ year                        : int [1:118] 2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ...</code></pre>
<p>As you can see, each <code>data.frame</code> object contained in the list has been renamed. You can thus
access them with the <code>$</code> operator:</p>
<p><img src="pics/all_datasets_names.png" width="135" /></p>
</div>
<div id="functional-programming" class="section level2">
<h2><span class="header-section-number">8.10</span> Functional programming</h2>
<p>By now, you are pretty familiar with functions in R. Now, let‚Äôs introduce the functional programming
paradigm, but first, let‚Äôs go over some definitions.</p>
<div id="functions-definition" class="section level3">
<h3><span class="header-section-number">8.10.1</span> Functions definition</h3>
<p>You should be familiar with function definitions in R. For example, suppose you want to compute
the square root of a number and want to do so using Newton‚Äôs algorithm:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1">sqrt_newton &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">eps =</span> <span class="fl">0.01</span>){</a>
<a class="sourceLine" id="cb85-2" title="2">    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</a>
<a class="sourceLine" id="cb85-3" title="3">        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</a>
<a class="sourceLine" id="cb85-4" title="4">    }</a>
<a class="sourceLine" id="cb85-5" title="5">    <span class="kw">return</span>(init)</a>
<a class="sourceLine" id="cb85-6" title="6">}</a></code></pre></div>
<p>You can then use this function to get the square root of a number:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1"><span class="kw">sqrt_newton</span>(<span class="dv">16</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 4.00122</code></pre>
<p>We are using a <code>while</code> loop inside the body. The <em>body</em> of a function are the instructions that
define the function. You can get the body of a function with <code>body(some_func)</code>] of the function.
In <em>pure</em> functional programming languages, like Haskell, you don‚Äôt have loops. How can you
program without loops, you may ask? In functional programming, loops are replaced by recursion.
Let‚Äôs rewrite our little example above with recursion:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1">sqrt_newton_recur &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">eps =</span> <span class="fl">0.01</span>){</a>
<a class="sourceLine" id="cb88-2" title="2">    <span class="cf">if</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&lt;</span><span class="st"> </span>eps){</a>
<a class="sourceLine" id="cb88-3" title="3">        result &lt;-<span class="st"> </span>init</a>
<a class="sourceLine" id="cb88-4" title="4">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb88-5" title="5">        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</a>
<a class="sourceLine" id="cb88-6" title="6">        result &lt;-<span class="st"> </span><span class="kw">sqrt_newton_recur</span>(a, init, eps)</a>
<a class="sourceLine" id="cb88-7" title="7">    }</a>
<a class="sourceLine" id="cb88-8" title="8">    <span class="kw">return</span>(result)</a>
<a class="sourceLine" id="cb88-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" title="1"><span class="kw">sqrt_newton_recur</span>(<span class="dv">16</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 4.00122</code></pre>
<p>R is not a pure functional programming language though, so we can still use loops (be it <code>while</code> or
<code>for</code> loops) in the bodies of our functions. Actually, for R specifically, it is better,
performance-wise, to use loops instead of recursion, because R is not tail-call optimized. I won‚Äôt
got into the details of what tail-call optimization is but just remember that if performance is
important a loop will be faster. However, sometimes, it is easier to write a function using
recursion. I personally tend to avoid loops if performance is not important, because I find that
code that avoids loops is easier to read and debug. However, knowing that you have can use loops
is reassuring. In the coming sections I will show you some built-in function that make it
possible to avoid writing loops and that don‚Äôt rely on recursion, so performance won‚Äôt be
penalized.</p>
</div>
<div id="properties-of-functions" class="section level3">
<h3><span class="header-section-number">8.10.2</span> Properties of functions</h3>
<p>Mathematical functions have a nice property: we always get the same output for a given input. This
is called referential transparency and we should aim to write our R functions in such a way.</p>
<p>For example, the following function:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1">increment &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb91-2" title="2">    <span class="kw">return</span>(x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb91-3" title="3">}</a></code></pre></div>
<p>Is a referential transparent function. We always get the same result for any <code>x</code> that we give to
this function.</p>
<p>This:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1"><span class="kw">increment</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>will always produce <code>11</code>.</p>
<p>However, this one:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1">increment_opaque &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb94-2" title="2">    <span class="kw">return</span>(x <span class="op">+</span><span class="st"> </span>spam)</a>
<a class="sourceLine" id="cb94-3" title="3">}</a></code></pre></div>
<p>is not a referential transparent function, because its value depends on the global variable <code>spam</code>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1">spam &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb95-2" title="2"></a>
<a class="sourceLine" id="cb95-3" title="3"><span class="kw">increment_opaque</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>will only produce <code>11</code> if <code>spam = 1</code>. But what if <code>spam = 19</code>?</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1">spam &lt;-<span class="st"> </span><span class="dv">19</span></a>
<a class="sourceLine" id="cb97-2" title="2"></a>
<a class="sourceLine" id="cb97-3" title="3"><span class="kw">increment_opaque</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 29</code></pre>
<p>To make <code>increment_opaque()</code> a referential transparent function, it is enough to make <code>spam</code> an
argument:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1">increment_not_opaque &lt;-<span class="st"> </span><span class="cf">function</span>(x, spam){</a>
<a class="sourceLine" id="cb99-2" title="2">    <span class="kw">return</span>(x <span class="op">+</span><span class="st"> </span>spam)</a>
<a class="sourceLine" id="cb99-3" title="3">}</a></code></pre></div>
<p>Now even if there is a global variable called <code>spam</code>, this will not influence our function:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1">spam &lt;-<span class="st"> </span><span class="dv">19</span></a>
<a class="sourceLine" id="cb100-2" title="2"></a>
<a class="sourceLine" id="cb100-3" title="3"><span class="kw">increment_not_opaque</span>(<span class="dv">10</span>, <span class="dv">34</span>)</a></code></pre></div>
<pre><code>## [1] 44</code></pre>
<p>This is because the variable <code>spam</code> defined in the body of the function is a local variable. It
could have been called anything else, really. Avoiding opaque functions makes our life easier.</p>
<p>Another property that adepts of functional programming value is that functions should have no, or
very limited, side-effects. This means that functions should not change the state of your program.</p>
<p>For example this function (which is not a referential transparent function):</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1">count_iter &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb102-2" title="2"></a>
<a class="sourceLine" id="cb102-3" title="3">sqrt_newton_side_effect &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">eps =</span> <span class="fl">0.01</span>){</a>
<a class="sourceLine" id="cb102-4" title="4">    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</a>
<a class="sourceLine" id="cb102-5" title="5">        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</a>
<a class="sourceLine" id="cb102-6" title="6">        count_iter &lt;&lt;-<span class="st"> </span>count_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="co"># The &quot;&lt;&lt;-&quot; symbol means that we assign the</span></a>
<a class="sourceLine" id="cb102-7" title="7">    }                                 <span class="co"># RHS value in a variable in the global environment</span></a>
<a class="sourceLine" id="cb102-8" title="8">    <span class="kw">return</span>(init)</a>
<a class="sourceLine" id="cb102-9" title="9">}</a></code></pre></div>
<p>If you look in the environment pane, you will see that <code>count_iter</code> equals 0. Now call this
function with the following arguments:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1"><span class="kw">sqrt_newton_side_effect</span>(<span class="dv">16000</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 126.4911</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1"><span class="kw">print</span>(count_iter)</a></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>If you check the value of <code>count_iter</code> now, you will see that it increased! This is a side effect,
because the function changed something outside its scope. It changed a value in the global
environment. In general, it is good practice to avoid side-effects. For example, we could make the
above function not have any side effects like this:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1">sqrt_newton_count &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">count_iter =</span> <span class="dv">0</span>, <span class="dt">eps =</span> <span class="fl">0.01</span>){</a>
<a class="sourceLine" id="cb107-2" title="2">    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</a>
<a class="sourceLine" id="cb107-3" title="3">        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</a>
<a class="sourceLine" id="cb107-4" title="4">        count_iter &lt;-<span class="st"> </span>count_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb107-5" title="5">    }</a>
<a class="sourceLine" id="cb107-6" title="6">    <span class="kw">return</span>(<span class="kw">c</span>(init, count_iter))</a>
<a class="sourceLine" id="cb107-7" title="7">}</a></code></pre></div>
<p>Now, this function returns a list with two elements, the result, and the number of iterations it
took to get the result:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1"><span class="kw">sqrt_newton_count</span>(<span class="dv">16000</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 126.4911   9.0000</code></pre>
<p>Writing to disk is also considered a side effect, because the function changes something (a file)
outside its scope. But this cannot be avoided (and it‚Äôs actually a good thing to have, functions
that can write to disk) so just remember: try to avoid having functions changing variables in the
global environment unless you have a very good reason of doing so.</p>
<p>Finally, another property of mathematical functions, is that they do one single thing. Functional
programming purists also program their functions to do one single task. This has benefits, but
can complicate things. The function we wrote previously does two things: it computes the square
root of a number and also returns the number of iterations it took to compute the result. However,
this is not a bad thing; the function is doing two tasks, but these tasks are related to each other
and it makes sense to have them together. My piece of advice: avoid having functions that do too
many <em>unrelated</em> things. This makes debugging harder.</p>
<p>In conclusion: you should strive for referential transparency, try to avoid side effects unless you
have a good reason to have them and try to keep your functions short and do as little tasks as
possible. This makes testing and debugging easier, as you will see.</p>
</div>
<div id="functional-programming-with-purrr" class="section level3">
<h3><span class="header-section-number">8.10.3</span> Functional programming with <code>{purrr}</code></h3>
<p>Hadley Wickham developed a package called <code>purrr</code> which contains a lot of very useful functions. I
will show some of them here, but in the next chapter, we are going to study <code>purrr</code> in greater
depth. Also, take the time to read <code>purrr</code>‚Äôs documentation, and of course you can read more about
<code>purrr</code> in <span class="citation">(<span class="citeproc-not-found" data-reference-id="wickham2016"><strong>???</strong></span>)</span>.</p>
</div>
<div id="the-map-family-of-functions" class="section level3">
<h3><span class="header-section-number">8.10.4</span> The <code>map*()</code> family of functions</h3>
<p>In the previous section we saw how to map a function to each element of a list. Each version of an
<code>*apply()</code> function has a different purpose, but it is not very easy to remember which one returns
a list, which other one returns an atomic vector and so on. If you‚Äôre working on data frames you
can use <code>apply()</code> to sum (for example) over columns or rows, because you can specify which <code>MARGIN</code>
you want to sum over. But you do not get a data frame back. In the <code>purrr</code> package, each of the
functions that do mapping have a similar name. The first part of these functions‚Äô names all start
with <code>map_</code> and the second part tells you what this function is going to output. For example, if
you want <code>double</code>s out, you would use <code>map_dbl()</code>. If you are working on data frames want a data
frame back, you would use <code>map_df()</code>. These are much more intuitive and easier to remember and we‚Äôre
going to learn how to use them in the chapter about <a href="#tidyverse">The Tidyverse</a>. For now, let‚Äôs just focus on
the basic functions, <code>map()</code> and <code>reduce()</code> (and some variants of <code>reduce()</code>). To map a function
to every element of a list, simply use <code>map()</code>:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1"><span class="kw">library</span>(<span class="st">&quot;purrr&quot;</span>)</a>
<a class="sourceLine" id="cb110-2" title="2"><span class="kw">map</span>(numbers, sqrt_newton, <span class="dt">init =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 1.416667
## 
## [[3]]
## [1] 1.732143
## 
## [[4]]
## [1] 2.00061
## 
## [[5]]
## [1] 2.238095</code></pre>
<p>Compared to <code>Map()</code>, the function and the list are given in the reverse order, but the result is
the same, of course.</p>
</div>
<div id="reducing-with-purrr" class="section level3">
<h3><span class="header-section-number">8.10.5</span> Reducing with <code>purrr</code></h3>
<p>In the <code>purrr</code> package, you can find two more functions for folding: <code>reduce()</code> and
<code>reduce_right()</code>. The difference between <code>reduce()</code> and <code>reduce_right()</code> is pretty obvious:
<code>reduce_right()</code> starts from the right!</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1">a &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb112-2" title="2"></a>
<a class="sourceLine" id="cb112-3" title="3"><span class="kw">reduce</span>(a, <span class="st">`</span><span class="dt">-</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>## [1] -53</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1"><span class="kw">reduce_right</span>(a, <span class="st">`</span><span class="dt">-</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>## [1] -35</code></pre>
<p>For operations that are not commutative, this makes a difference. Other interesting folding
functions are <code>accumulate()</code> and <code>accumulate_right()</code>:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1">a &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb116-2" title="2"></a>
<a class="sourceLine" id="cb116-3" title="3"><span class="kw">accumulate</span>(a, <span class="st">`</span><span class="dt">-</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>##  [1]   1  -1  -4  -8 -13 -19 -26 -34 -43 -53</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1"><span class="kw">accumulate_right</span>(a, <span class="st">`</span><span class="dt">-</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>##  [1] -35 -34 -32 -29 -25 -20 -14  -7   1  10</code></pre>
<p>These two functions keep the intermediary results.</p>
</div>
</div>
<div id="generating-pdf-or-word-reports-with-r" class="section level2">
<h2><span class="header-section-number">8.11</span> Generating Pdf or Word reports with R</h2>
</div>
<div id="scraping-the-internet" class="section level2">
<h2><span class="header-section-number">8.12</span> Scraping the internet</h2>
</div>
<div id="writing-your-own-package" class="section level2">
<h2><span class="header-section-number">8.13</span> Writing your own package</h2>
</div>
<div id="random-tips-and-tricks" class="section level2">
<h2><span class="header-section-number">8.14</span> Random tips and tricks</h2>
<div id="creating-a-log-file" class="section level3">
<h3><span class="header-section-number">8.14.1</span> Creating a log file</h3>
</div>
</div>
<div id="exercises-5" class="section level2">
<h2><span class="header-section-number">8.15</span> Exercises</h2>
<div id="exercise-1-5" class="section level3 unnumbered">
<h3>Exercise 1</h3>
<ul>
<li>Create the following vector:</li>
</ul>
<p><span class="math display">\[a = (1,6,7,8,8,9,2)\]</span></p>
<p>Using a for loop and a while loop, compute the sum of its elements. To avoid issues, use <code>i</code>
as the counter inside the for loop, and <code>j</code> as the counter for the while loop.</p>
<ul>
<li>How would you achieve that with a functional (a function that takes a function as an argument)?</li>
</ul>
</div>
<div id="exercise-2-3" class="section level3 unnumbered">
<h3>Exercise 2</h3>
<ul>
<li>Let‚Äôs use a loop to get the matrix product of a matrix A and B. Follow these steps to create the loop:</li>
</ul>
<ol style="list-style-type: decimal">
<li>Create matrix A:</li>
</ol>
<p><span class="math display">\[A = \left(
  \begin{array}{ccc}
   9 &amp; 4 &amp; 12 \\
   5 &amp; 0 &amp; 7 \\
   2 &amp; 6 &amp; 8 \\
   9 &amp; 2 &amp; 9
  \end{array} \right)
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>Create matrix B:</li>
</ol>
<p><span class="math display">\[B = \left(
\begin{array}{cccc}
 5 &amp; 4 &amp; 2 &amp; 5 \\
 2 &amp; 7 &amp; 2 &amp; 1 \\
 8 &amp; 3 &amp; 2 &amp; 6 \\
\end{array} \right)
\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li><p>Create a matrix C, with dimension 4x4 that will hold the result. Use this command: `C = matrix(rep(0,16), nrow = 4)}</p></li>
<li><p>Using a for loop, loop over the rows of A first: `for(i in 1:nrow(A))}</p></li>
<li><p>Inside this loop, loop over the columns of B: `for(j in 1:ncol(B))}</p></li>
<li><p>Again, inside this loop, loop over the rows of B: `for(k in 1:nrow(B))}</p></li>
<li><p>Inside this last loop, compute the result and save it inside C: `C[i,j] = C[i,j] + A[i,k] * B[k,j]}</p></li>
</ol>
<ul>
<li>R has a built-in function to compute the dot product of 2 matrices. Which is it?</li>
</ul>
</div>
<div id="exercise-3-3" class="section level3 unnumbered">
<h3>Exercise 3</h3>
<ul>
<li>Fizz Buzz: Print integers from 1 to 100. If a number is divisible by 3, print the word <code>Fizz</code> if
it‚Äôs divisible by 5, print <code>Buzz</code>. Use a for loop and if statements.</li>
</ul>
</div>
<div id="exercise-4-1" class="section level3 unnumbered">
<h3>Exercise 4</h3>
<ul>
<li>Fizz Buzz 2: Same as above, but now add this third condition: if a number is both divisible by 3 and 5, print <code>&quot;FizzBuzz&quot;</code>.</li>
</ul>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>){</a>
<a class="sourceLine" id="cb120-2" title="2"><span class="cf">if</span> (i <span class="op">%%</span><span class="st"> </span><span class="dv">15</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb120-3" title="3">  <span class="kw">print</span>(<span class="st">&quot;FizzBuzz&quot;</span>)</a>
<a class="sourceLine" id="cb120-4" title="4">} <span class="cf">else</span> <span class="cf">if</span> (i <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb120-5" title="5">  <span class="kw">print</span>(<span class="st">&quot;Fizz&quot;</span>)</a>
<a class="sourceLine" id="cb120-6" title="6">} <span class="cf">else</span> <span class="cf">if</span> (i <span class="op">%%</span><span class="st"> </span><span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb120-7" title="7">  <span class="kw">print</span>(<span class="st">&quot;Buzz&quot;</span>)</a>
<a class="sourceLine" id="cb120-8" title="8">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb120-9" title="9">  <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb120-10" title="10">}</a>
<a class="sourceLine" id="cb120-11" title="11">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] &quot;Fizz&quot;
## [1] 4
## [1] &quot;Buzz&quot;
## [1] &quot;Fizz&quot;
## [1] 7
## [1] 8
## [1] &quot;Fizz&quot;
## [1] &quot;Buzz&quot;
## [1] 11
## [1] &quot;Fizz&quot;
## [1] 13
## [1] 14
## [1] &quot;FizzBuzz&quot;
## [1] 16
## [1] 17
## [1] &quot;Fizz&quot;
## [1] 19
## [1] &quot;Buzz&quot;
## [1] &quot;Fizz&quot;
## [1] 22
## [1] 23
## [1] &quot;Fizz&quot;
## [1] &quot;Buzz&quot;
## [1] 26
## [1] &quot;Fizz&quot;
## [1] 28
## [1] 29
## [1] &quot;FizzBuzz&quot;
## [1] 31
## [1] 32
## [1] &quot;Fizz&quot;
## [1] 34
## [1] &quot;Buzz&quot;
## [1] &quot;Fizz&quot;
## [1] 37
## [1] 38
## [1] &quot;Fizz&quot;
## [1] &quot;Buzz&quot;
## [1] 41
## [1] &quot;Fizz&quot;
## [1] 43
## [1] 44
## [1] &quot;FizzBuzz&quot;
## [1] 46
## [1] 47
## [1] &quot;Fizz&quot;
## [1] 49
## [1] &quot;Buzz&quot;
## [1] &quot;Fizz&quot;
## [1] 52
## [1] 53
## [1] &quot;Fizz&quot;
## [1] &quot;Buzz&quot;
## [1] 56
## [1] &quot;Fizz&quot;
## [1] 58
## [1] 59
## [1] &quot;FizzBuzz&quot;
## [1] 61
## [1] 62
## [1] &quot;Fizz&quot;
## [1] 64
## [1] &quot;Buzz&quot;
## [1] &quot;Fizz&quot;
## [1] 67
## [1] 68
## [1] &quot;Fizz&quot;
## [1] &quot;Buzz&quot;
## [1] 71
## [1] &quot;Fizz&quot;
## [1] 73
## [1] 74
## [1] &quot;FizzBuzz&quot;
## [1] 76
## [1] 77
## [1] &quot;Fizz&quot;
## [1] 79
## [1] &quot;Buzz&quot;
## [1] &quot;Fizz&quot;
## [1] 82
## [1] 83
## [1] &quot;Fizz&quot;
## [1] &quot;Buzz&quot;
## [1] 86
## [1] &quot;Fizz&quot;
## [1] 88
## [1] 89
## [1] &quot;FizzBuzz&quot;
## [1] 91
## [1] 92
## [1] &quot;Fizz&quot;
## [1] 94
## [1] &quot;Buzz&quot;
## [1] &quot;Fizz&quot;
## [1] 97
## [1] 98
## [1] &quot;Fizz&quot;
## [1] &quot;Buzz&quot;</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistical-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
