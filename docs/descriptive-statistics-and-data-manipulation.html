<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Descriptive statistics and data manipulation | Modern R with the tidyverse</title>
  <meta name="description" content="This book will teach you how to use R to solve your statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Descriptive statistics and data manipulation | Modern R with the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book will teach you how to use R to solve your statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Descriptive statistics and data manipulation | Modern R with the tidyverse" />
  
  <meta name="twitter:description" content="This book will teach you how to use R to solve your statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

<meta name="author" content="Bruno Rodrigues" />


<meta name="date" content="2022-06-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reading-and-writing-data.html"/>
<link rel="next" href="graphs.html"/>
<script src="libs/header-attrs-2.13/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern R with the tidyverse</a></li>

<li class="divider"></li>
<li><a href="index.html#preface">Preface<span></span></a>
<ul>
<li><a href="index.html#note-to-the-reader">Note to the reader<span></span></a></li>
<li><a href="index.html#what-is-r">What is R?<span></span></a></li>
<li><a href="index.html#who-is-this-book-for">Who is this book for?<span></span></a></li>
<li><a href="index.html#why-this-book">Why this book?<span></span></a></li>
<li><a href="index.html#why-modern-r">Why <em>modern</em> R?<span></span></a></li>
<li><a href="index.html#what-is-rstudio">What is RStudio?<span></span></a></li>
<li><a href="index.html#what-to-expect-from-this-book">What to expect from this book?<span></span></a></li>
<li><a href="index.html#prerequisites">Prerequisites<span></span></a></li>
<li><a href="index.html#what-are-packages">What are packages?<span></span></a></li>
<li><a href="index.html#the-author">The author<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting to know RStudio<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#panes"><i class="fa fa-check"></i><b>1.1</b> Panes<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#console"><i class="fa fa-check"></i><b>1.2</b> Console<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#scripts"><i class="fa fa-check"></i><b>1.3</b> Scripts<span></span></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-help-pane"><i class="fa fa-check"></i><b>1.3.1</b> The help pane<span></span></a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-environment-pane"><i class="fa fa-check"></i><b>1.3.2</b> The Environment pane<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#options"><i class="fa fa-check"></i><b>1.4</b> Options<span></span></a></li>
<li class="chapter" data-level="1.5" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>1.5</b> Keyboard shortcuts<span></span></a></li>
<li class="chapter" data-level="1.6" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#projects"><i class="fa fa-check"></i><b>1.6</b> Projects<span></span></a></li>
<li class="chapter" data-level="1.7" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#history"><i class="fa fa-check"></i><b>1.7</b> History<span></span></a></li>
<li class="chapter" data-level="1.8" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#plots"><i class="fa fa-check"></i><b>1.8</b> Plots<span></span></a></li>
<li class="chapter" data-level="1.9" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#addins"><i class="fa fa-check"></i><b>1.9</b> Addins<span></span></a></li>
<li class="chapter" data-level="1.10" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#packages"><i class="fa fa-check"></i><b>1.10</b> Packages<span></span></a></li>
<li class="chapter" data-level="1.11" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercises"><i class="fa fa-check"></i><b>1.11</b> Exercises<span></span></a>
<ul>
<li><a href="getting-to-know-rstudio.html#exercise-1">Exercise 1<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><i class="fa fa-check"></i><b>2</b> Objects, their classes and types, and useful R functions to get you started<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#the-numeric-class"><i class="fa fa-check"></i><b>2.1</b> The <code>numeric</code> class<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#the-character-class"><i class="fa fa-check"></i><b>2.2</b> The <code>character</code> class<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#the-factor-class"><i class="fa fa-check"></i><b>2.3</b> The <code>factor</code> class<span></span></a></li>
<li class="chapter" data-level="2.4" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#the-date-class"><i class="fa fa-check"></i><b>2.4</b> The <code>Date</code> class<span></span></a></li>
<li class="chapter" data-level="2.5" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#the-logical-class"><i class="fa fa-check"></i><b>2.5</b> The <code>logical</code> class<span></span></a></li>
<li class="chapter" data-level="2.6" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#vectors-and-matrices"><i class="fa fa-check"></i><b>2.6</b> Vectors and matrices<span></span></a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#the-c-function"><i class="fa fa-check"></i><b>2.6.1</b> The <code>c()</code> function<span></span></a></li>
<li class="chapter" data-level="2.6.2" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#cbind-and-rbind"><i class="fa fa-check"></i><b>2.6.2</b> <code>cbind()</code> and <code>rbind()</code><span></span></a></li>
<li class="chapter" data-level="2.6.3" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#the-matrix-class"><i class="fa fa-check"></i><b>2.6.3</b> The <code>matrix</code> class<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#the-list-class"><i class="fa fa-check"></i><b>2.7</b> The <code>list</code> class<span></span></a></li>
<li class="chapter" data-level="2.8" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#the-data.frame-and-tibble-classes"><i class="fa fa-check"></i><b>2.8</b> The <code>data.frame</code> and <code>tibble</code> classes<span></span></a></li>
<li class="chapter" data-level="2.9" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#formulas"><i class="fa fa-check"></i><b>2.9</b> Formulas<span></span></a></li>
<li class="chapter" data-level="2.10" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#models"><i class="fa fa-check"></i><b>2.10</b> Models<span></span></a></li>
<li class="chapter" data-level="2.11" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#null-na-and-nan"><i class="fa fa-check"></i><b>2.11</b> NULL, NA and NaN<span></span></a></li>
<li class="chapter" data-level="2.12" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#useful-functions-to-get-you-started"><i class="fa fa-check"></i><b>2.12</b> Useful functions to get you started<span></span></a>
<ul>
<li class="chapter" data-level="2.12.1" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#sequences"><i class="fa fa-check"></i><b>2.12.1</b> Sequences<span></span></a></li>
<li class="chapter" data-level="2.12.2" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#basic-string-manipulation"><i class="fa fa-check"></i><b>2.12.2</b> Basic string manipulation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html"><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#exercises-1"><i class="fa fa-check"></i><b>2.13</b> Exercises<span></span></a>
<ul>
<li><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#exercise-1-1">Exercise 1<span></span></a></li>
<li><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#exercise-2">Exercise 2<span></span></a></li>
<li><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#exercise-3">Exercise 3<span></span></a></li>
<li><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#exercise-4">Exercise 4<span></span></a></li>
<li><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#exercise-5">Exercise 5<span></span></a></li>
<li><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#exercise-6">Exercise 6<span></span></a></li>
<li><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#exercise-7">Exercise 7<span></span></a></li>
<li><a href="objects-their-classes-and-types-and-useful-r-functions-to-get-you-started.html#exercise-8">Exercise 8<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>3</b> Reading and writing data<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#the-swiss-army-knife-of-data-import-and-export-rio"><i class="fa fa-check"></i><b>3.1</b> The swiss army knife of data import and export: <code>{rio}</code><span></span></a></li>
<li class="chapter" data-level="3.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-any-object-to-disk"><i class="fa fa-check"></i><b>3.2</b> Writing any object to disk<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#using-rstudio-projects-to-manage-paths"><i class="fa fa-check"></i><b>3.3</b> Using RStudio projects to manage paths<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html"><i class="fa fa-check"></i><b>4</b> Descriptive statistics and data manipulation<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-data-exploration-exercice-using-base-r"><i class="fa fa-check"></i><b>4.1</b> A data exploration exercice using <em>base</em> R<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#smoking-is-bad-for-you-but-pipes-are-your-friend"><i class="fa fa-check"></i><b>4.2</b> Smoking is bad for you, but pipes are your friend<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#the-tidyverses-enfant-prodige-dplyr"><i class="fa fa-check"></i><b>4.3</b> The <code>{tidyverse}</code>’s <em>enfant prodige</em>: <code>{dplyr}</code><span></span></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-first-taste-of-data-manipulation-with-dplyr"><i class="fa fa-check"></i><b>4.3.1</b> A first taste of data manipulation with <code>{dplyr}</code><span></span></a></li>
<li class="chapter" data-level="4.3.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter-the-rows-of-a-dataset-with-filter"><i class="fa fa-check"></i><b>4.3.2</b> Filter the rows of a dataset with <code>filter()</code><span></span></a></li>
<li class="chapter" data-level="4.3.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#select-columns-with-select"><i class="fa fa-check"></i><b>4.3.3</b> Select columns with <code>select()</code><span></span></a></li>
<li class="chapter" data-level="4.3.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group-the-observations-of-your-dataset-with-group_by"><i class="fa fa-check"></i><b>4.3.4</b> Group the observations of your dataset with <code>group_by()</code><span></span></a></li>
<li class="chapter" data-level="4.3.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#get-summary-statistics-with-summarise"><i class="fa fa-check"></i><b>4.3.5</b> Get summary statistics with <code>summarise()</code><span></span></a></li>
<li class="chapter" data-level="4.3.6" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#adding-columns-with-mutate-and-transmute"><i class="fa fa-check"></i><b>4.3.6</b> Adding columns with <code>mutate()</code> and <code>transmute()</code><span></span></a></li>
<li class="chapter" data-level="4.3.7" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#joining-tibbles-with-full_join-left_join-right_join-and-all-the-others"><i class="fa fa-check"></i><b>4.3.7</b> Joining <code>tibble</code>s with <code>full_join()</code>, <code>left_join()</code>, <code>right_join()</code> and all the others<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#reshaping-and-sprucing-up-data-with-tidyr"><i class="fa fa-check"></i><b>4.4</b> Reshaping and sprucing up data with <code>{tidyr}</code><span></span></a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#pivot_wider-and-pivot_longer"><i class="fa fa-check"></i><b>4.4.1</b> <code>pivot_wider()</code> and <code>pivot_longer()</code><span></span></a></li>
<li class="chapter" data-level="4.4.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#fill-and-full_seq"><i class="fa fa-check"></i><b>4.4.2</b> <code>fill()</code> and <code>full_seq()</code><span></span></a></li>
<li class="chapter" data-level="4.4.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#put-order-in-your-columns-with-separate-unite-and-in-your-rows-with-separate_rows"><i class="fa fa-check"></i><b>4.4.3</b> Put order in your columns with <code>separate()</code>, <code>unite()</code>, and in your rows with <code>separate_rows()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#working-on-many-columns-with-across"><i class="fa fa-check"></i><b>4.5</b> Working on many columns with <code>across()</code><span></span></a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter-and-across"><i class="fa fa-check"></i><b>4.5.1</b> <code>filter()</code> and <code>across()</code><span></span></a></li>
<li class="chapter" data-level="4.5.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#selecting-and-renaming-with-across"><i class="fa fa-check"></i><b>4.5.2</b> Selecting and renaming with <code>across()</code><span></span></a></li>
<li class="chapter" data-level="4.5.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group_by-and-across"><i class="fa fa-check"></i><b>4.5.3</b> <code>group_by()</code> and <code>across()</code><span></span></a></li>
<li class="chapter" data-level="4.5.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#summarise-across-many-columns"><i class="fa fa-check"></i><b>4.5.4</b> <code>summarise()</code> across many columns<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#other-useful-tidyverse-functions"><i class="fa fa-check"></i><b>4.6</b> Other useful <code>{tidyverse}</code> functions<span></span></a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#if_else-case_when-and-recode"><i class="fa fa-check"></i><b>4.6.1</b> <code>if_else()</code>, <code>case_when()</code> and <code>recode()</code><span></span></a></li>
<li class="chapter" data-level="4.6.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#lead-and-lag"><i class="fa fa-check"></i><b>4.6.2</b> <code>lead()</code> and <code>lag()</code><span></span></a></li>
<li class="chapter" data-level="4.6.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#ntile"><i class="fa fa-check"></i><b>4.6.3</b> <code>ntile()</code><span></span></a></li>
<li class="chapter" data-level="4.6.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#arrange"><i class="fa fa-check"></i><b>4.6.4</b> <code>arrange()</code><span></span></a></li>
<li class="chapter" data-level="4.6.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#tally-and-count"><i class="fa fa-check"></i><b>4.6.5</b> <code>tally()</code> and <code>count()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#special-packages-for-special-kinds-of-data-forcats-lubridate-and-stringr"><i class="fa fa-check"></i><b>4.7</b> Special packages for special kinds of data: <code>{forcats}</code>, <code>{lubridate}</code>, and <code>{stringr}</code><span></span></a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#section"><i class="fa fa-check"></i><b>4.7.1</b> 🐱🐱🐱🐱<span></span></a></li>
<li class="chapter" data-level="4.7.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#get-your-dates-right-with-lubridate"><i class="fa fa-check"></i><b>4.7.2</b> Get your dates right with <code>{lubridate}</code><span></span></a></li>
<li class="chapter" data-level="4.7.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#manipulate-strings-with-stringr"><i class="fa fa-check"></i><b>4.7.3</b> Manipulate strings with <code>{stringr}</code><span></span></a></li>
<li class="chapter" data-level="4.7.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#tidy-data-frames-with-tibble"><i class="fa fa-check"></i><b>4.7.4</b> Tidy data frames with <code>{tibble}</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#list-columns"><i class="fa fa-check"></i><b>4.8</b> List-columns<span></span></a></li>
<li class="chapter" data-level="4.9" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#going-beyond-descriptive-statistics-and-data-manipulation"><i class="fa fa-check"></i><b>4.9</b> Going beyond descriptive statistics and data manipulation<span></span></a></li>
<li class="chapter" data-level="4.10" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercises-2"><i class="fa fa-check"></i><b>4.10</b> Exercises<span></span></a>
<ul>
<li><a href="descriptive-statistics-and-data-manipulation.html#exercise-1-2">Exercise 1<span></span></a></li>
<li><a href="descriptive-statistics-and-data-manipulation.html#exercise-2-1">Exercise 2<span></span></a></li>
<li><a href="descriptive-statistics-and-data-manipulation.html#exercise-3-1">Exercise 3<span></span></a></li>
<li><a href="descriptive-statistics-and-data-manipulation.html#exercise-4-1">Exercise 4<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>5</b> Graphs<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="graphs.html"><a href="graphs.html#resources"><i class="fa fa-check"></i><b>5.1</b> Resources<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="graphs.html"><a href="graphs.html#examples"><i class="fa fa-check"></i><b>5.2</b> Examples<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="graphs.html"><a href="graphs.html#barplots"><i class="fa fa-check"></i><b>5.2.1</b> Barplots<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="graphs.html"><a href="graphs.html#scatter-plots"><i class="fa fa-check"></i><b>5.2.2</b> Scatter plots<span></span></a></li>
<li class="chapter" data-level="5.2.3" data-path="graphs.html"><a href="graphs.html#density"><i class="fa fa-check"></i><b>5.2.3</b> Density<span></span></a></li>
<li class="chapter" data-level="5.2.4" data-path="graphs.html"><a href="graphs.html#line-plots"><i class="fa fa-check"></i><b>5.2.4</b> Line plots<span></span></a></li>
<li class="chapter" data-level="5.2.5" data-path="graphs.html"><a href="graphs.html#facets"><i class="fa fa-check"></i><b>5.2.5</b> Facets<span></span></a></li>
<li class="chapter" data-level="5.2.6" data-path="graphs.html"><a href="graphs.html#pie-charts"><i class="fa fa-check"></i><b>5.2.6</b> Pie Charts<span></span></a></li>
<li class="chapter" data-level="5.2.7" data-path="graphs.html"><a href="graphs.html#adding-text-to-plots"><i class="fa fa-check"></i><b>5.2.7</b> Adding text to plots<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="graphs.html"><a href="graphs.html#customization"><i class="fa fa-check"></i><b>5.3</b> Customization<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="graphs.html"><a href="graphs.html#changing-titles-axes-labels-options-mixing-geoms-and-changing-themes"><i class="fa fa-check"></i><b>5.3.1</b> Changing titles, axes labels, options, mixing geoms and changing themes<span></span></a></li>
<li class="chapter" data-level="5.3.2" data-path="graphs.html"><a href="graphs.html#colour-schemes"><i class="fa fa-check"></i><b>5.3.2</b> Colour schemes<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="graphs.html"><a href="graphs.html#saving-plots-to-disk"><i class="fa fa-check"></i><b>5.4</b> Saving plots to disk<span></span></a></li>
<li class="chapter" data-level="5.5" data-path="graphs.html"><a href="graphs.html#exercises-3"><i class="fa fa-check"></i><b>5.5</b> Exercises<span></span></a>
<ul>
<li><a href="graphs.html#exercise-1-3">Exercise 1<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>6</b> Statistical models<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="statistical-models.html"><a href="statistical-models.html#terminology"><i class="fa fa-check"></i><b>6.1</b> Terminology<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="statistical-models.html"><a href="statistical-models.html#fitting-a-model-to-data"><i class="fa fa-check"></i><b>6.2</b> Fitting a model to data<span></span></a></li>
<li class="chapter" data-level="6.3" data-path="statistical-models.html"><a href="statistical-models.html#diagnostics"><i class="fa fa-check"></i><b>6.3</b> Diagnostics<span></span></a></li>
<li class="chapter" data-level="6.4" data-path="statistical-models.html"><a href="statistical-models.html#interpreting-models"><i class="fa fa-check"></i><b>6.4</b> Interpreting models<span></span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="statistical-models.html"><a href="statistical-models.html#marginal-effects"><i class="fa fa-check"></i><b>6.4.1</b> Marginal effects<span></span></a></li>
<li class="chapter" data-level="6.4.2" data-path="statistical-models.html"><a href="statistical-models.html#explainability-of-black-box-models"><i class="fa fa-check"></i><b>6.4.2</b> Explainability of <em>black-box</em> models<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="statistical-models.html"><a href="statistical-models.html#comparing-models"><i class="fa fa-check"></i><b>6.5</b> Comparing models<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="statistical-models.html"><a href="statistical-models.html#using-a-model-for-prediction"><i class="fa fa-check"></i><b>6.6</b> Using a model for prediction<span></span></a></li>
<li class="chapter" data-level="6.7" data-path="statistical-models.html"><a href="statistical-models.html#beyond-linear-regression"><i class="fa fa-check"></i><b>6.7</b> Beyond linear regression<span></span></a></li>
<li class="chapter" data-level="6.8" data-path="statistical-models.html"><a href="statistical-models.html#hyper-parameters"><i class="fa fa-check"></i><b>6.8</b> Hyper-parameters<span></span></a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="statistical-models.html"><a href="statistical-models.html#ridge-regression"><i class="fa fa-check"></i><b>6.8.1</b> Ridge regression<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="statistical-models.html"><a href="statistical-models.html#training-validating-and-testing-models"><i class="fa fa-check"></i><b>6.9</b> Training, validating, and testing models<span></span></a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="statistical-models.html"><a href="statistical-models.html#set-up"><i class="fa fa-check"></i><b>6.9.1</b> Set up<span></span></a></li>
<li class="chapter" data-level="6.9.2" data-path="statistical-models.html"><a href="statistical-models.html#bayesian-hyperparameter-optimization"><i class="fa fa-check"></i><b>6.9.2</b> Bayesian hyperparameter optimization<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html"><i class="fa fa-check"></i><b>7</b> Defining your own functions<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#control-flow"><i class="fa fa-check"></i><b>7.1</b> Control flow<span></span></a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#if-else"><i class="fa fa-check"></i><b>7.1.1</b> If-else<span></span></a></li>
<li class="chapter" data-level="7.1.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#for-loops"><i class="fa fa-check"></i><b>7.1.2</b> For loops<span></span></a></li>
<li class="chapter" data-level="7.1.3" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#while-loops"><i class="fa fa-check"></i><b>7.1.3</b> While loops<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#writing-your-own-functions"><i class="fa fa-check"></i><b>7.2</b> Writing your own functions<span></span></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#declaring-functions-in-r"><i class="fa fa-check"></i><b>7.2.1</b> Declaring functions in R<span></span></a></li>
<li class="chapter" data-level="7.2.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#fibonacci-numbers"><i class="fa fa-check"></i><b>7.2.2</b> Fibonacci numbers<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercises-4"><i class="fa fa-check"></i><b>7.3</b> Exercises<span></span></a>
<ul>
<li><a href="defining-your-own-functions.html#exercise-1-4">Exercise 1<span></span></a></li>
<li><a href="defining-your-own-functions.html#exercise-2-2">Exercise 2<span></span></a></li>
<li><a href="defining-your-own-functions.html#exercise-3-2">Exercise 3<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-take-functions-as-arguments-writing-your-own-higher-order-functions"><i class="fa fa-check"></i><b>7.4</b> Functions that take functions as arguments: writing your own higher-order functions<span></span></a></li>
<li class="chapter" data-level="7.5" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-return-functions"><i class="fa fa-check"></i><b>7.5</b> Functions that return functions<span></span></a></li>
<li class="chapter" data-level="7.6" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-take-columns-of-data-as-arguments"><i class="fa fa-check"></i><b>7.6</b> Functions that take columns of data as arguments<span></span></a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#the-enquo---approach"><i class="fa fa-check"></i><b>7.6.1</b> The <code>enquo() - !!()</code> approach<span></span></a></li>
<li class="chapter" data-level="7.6.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#curly-curly-a-simplified-approach-to-the-enquo-and-framework"><i class="fa fa-check"></i><b>7.6.2</b> Curly Curly, a simplified approach to the <code>enquo()</code> and <code>!!()</code> framework<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-use-loops"><i class="fa fa-check"></i><b>7.7</b> Functions that use loops<span></span></a></li>
<li class="chapter" data-level="7.8" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#anonymous-functions"><i class="fa fa-check"></i><b>7.8</b> Anonymous functions<span></span></a></li>
<li class="chapter" data-level="7.9" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercises-5"><i class="fa fa-check"></i><b>7.9</b> Exercises<span></span></a>
<ul>
<li><a href="defining-your-own-functions.html#exercise-1-5">Exercise 1<span></span></a></li>
<li><a href="defining-your-own-functions.html#exercise-2-3">Exercise 2<span></span></a></li>
<li><a href="defining-your-own-functions.html#exercise-3-3">Exercise 3<span></span></a></li>
<li><a href="defining-your-own-functions.html#exercise-4-2">Exercise 4<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>8</b> Functional programming<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="functional-programming.html"><a href="functional-programming.html#function-definitions"><i class="fa fa-check"></i><b>8.1</b> Function definitions<span></span></a></li>
<li class="chapter" data-level="8.2" data-path="functional-programming.html"><a href="functional-programming.html#properties-of-functions"><i class="fa fa-check"></i><b>8.2</b> Properties of functions<span></span></a></li>
<li class="chapter" data-level="8.3" data-path="functional-programming.html"><a href="functional-programming.html#functional-programming-with-purrr"><i class="fa fa-check"></i><b>8.3</b> Functional programming with <code>{purrr}</code><span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="functional-programming.html"><a href="functional-programming.html#doing-away-with-loops-the-map-family-of-functions"><i class="fa fa-check"></i><b>8.3.1</b> Doing away with loops: the <code>map*()</code> family of functions<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="functional-programming.html"><a href="functional-programming.html#reducing-with-purrr"><i class="fa fa-check"></i><b>8.3.2</b> Reducing with <code>purrr</code><span></span></a></li>
<li class="chapter" data-level="8.3.3" data-path="functional-programming.html"><a href="functional-programming.html#error-handling-with-safely-and-possibly"><i class="fa fa-check"></i><b>8.3.3</b> Error handling with <code>safely()</code> and <code>possibly()</code><span></span></a></li>
<li class="chapter" data-level="8.3.4" data-path="functional-programming.html"><a href="functional-programming.html#partial-applications-with-partial"><i class="fa fa-check"></i><b>8.3.4</b> Partial applications with <code>partial()</code><span></span></a></li>
<li class="chapter" data-level="8.3.5" data-path="functional-programming.html"><a href="functional-programming.html#function-composition-using-compose"><i class="fa fa-check"></i><b>8.3.5</b> Function composition using <code>compose</code><span></span></a></li>
<li class="chapter" data-level="8.3.6" data-path="functional-programming.html"><a href="functional-programming.html#transposing-lists"><i class="fa fa-check"></i><b>8.3.6</b> «Transposing lists»<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="functional-programming.html"><a href="functional-programming.html#list-based-workflows-for-efficiency"><i class="fa fa-check"></i><b>8.4</b> List-based workflows for efficiency<span></span></a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="functional-programming.html"><a href="functional-programming.html#functional-programming-and-plotting"><i class="fa fa-check"></i><b>8.4.1</b> Functional programming and plotting<span></span></a></li>
<li class="chapter" data-level="8.4.2" data-path="functional-programming.html"><a href="functional-programming.html#modeling-with-functional-programming"><i class="fa fa-check"></i><b>8.4.2</b> Modeling with functional programming<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="functional-programming.html"><a href="functional-programming.html#exercises-6"><i class="fa fa-check"></i><b>8.5</b> Exercises<span></span></a>
<ul>
<li><a href="functional-programming.html#exercise-1-6">Exercise 1<span></span></a></li>
<li><a href="functional-programming.html#exercise-2-4">Exercise 2<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="package-development.html"><a href="package-development.html"><i class="fa fa-check"></i><b>9</b> Package development<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="package-development.html"><a href="package-development.html#why-you-need-to-write-your-own-package"><i class="fa fa-check"></i><b>9.1</b> Why you need to write your own package<span></span></a></li>
<li class="chapter" data-level="9.2" data-path="package-development.html"><a href="package-development.html#starting-easy-creating-a-package-to-share-data"><i class="fa fa-check"></i><b>9.2</b> Starting easy: creating a package to share data<span></span></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="package-development.html"><a href="package-development.html#setting-up-a-github-account"><i class="fa fa-check"></i><b>9.2.1</b> Setting up a Github account<span></span></a></li>
<li class="chapter" data-level="9.2.2" data-path="package-development.html"><a href="package-development.html#starting-your-package"><i class="fa fa-check"></i><b>9.2.2</b> Starting your package<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="package-development.html"><a href="package-development.html#including-data-inside-the-package"><i class="fa fa-check"></i><b>9.3</b> Including data inside the package<span></span></a></li>
<li class="chapter" data-level="9.4" data-path="package-development.html"><a href="package-development.html#adding-functions-to-your-package"><i class="fa fa-check"></i><b>9.4</b> Adding functions to your package<span></span></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="package-development.html"><a href="package-development.html#one-function-inside-one-script"><i class="fa fa-check"></i><b>9.4.1</b> One function inside one script<span></span></a></li>
<li class="chapter" data-level="9.4.2" data-path="package-development.html"><a href="package-development.html#many-functions-inside-a-script"><i class="fa fa-check"></i><b>9.4.2</b> Many functions inside a script<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="package-development.html"><a href="package-development.html#documenting-your-package"><i class="fa fa-check"></i><b>9.5</b> Documenting your package<span></span></a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="package-development.html"><a href="package-development.html#description"><i class="fa fa-check"></i><b>9.5.1</b> Description<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="package-development.html"><a href="package-development.html#unit-testing-your-package"><i class="fa fa-check"></i><b>9.6</b> Unit testing your package<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="further-topics.html"><a href="further-topics.html"><i class="fa fa-check"></i><b>10</b> Further topics<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="further-topics.html"><a href="further-topics.html#using-python-from-r-with-reticulate"><i class="fa fa-check"></i><b>10.1</b> Using Python from R with <code>{reticulate}</code><span></span></a></li>
<li class="chapter" data-level="10.2" data-path="further-topics.html"><a href="further-topics.html#generating-pdf-or-word-reports-with-r"><i class="fa fa-check"></i><b>10.2</b> Generating Pdf or Word reports with R<span></span></a></li>
<li class="chapter" data-level="10.3" data-path="further-topics.html"><a href="further-topics.html#scraping-the-internet"><i class="fa fa-check"></i><b>10.3</b> Scraping the internet<span></span></a></li>
<li class="chapter" data-level="10.4" data-path="further-topics.html"><a href="further-topics.html#regular-expressions"><i class="fa fa-check"></i><b>10.4</b> Regular expressions<span></span></a></li>
<li class="chapter" data-level="10.5" data-path="further-topics.html"><a href="further-topics.html#setting-up-a-blog-with-blogdown"><i class="fa fa-check"></i><b>10.5</b> Setting up a blog with <code>{blogdown}</code><span></span></a></li>
</ul></li>
<li><a href="references.html#references">References<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern R with the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="descriptive-statistics-and-data-manipulation" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Descriptive statistics and data manipulation<a href="descriptive-statistics-and-data-manipulation.html#descriptive-statistics-and-data-manipulation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Now that we are familiar with some R objects and know how to import data, it is time to write some
code. In this chapter, we are going to compute descriptive statistics for a single dataset, but
also for a list of datasets later in the chapter. However, I will not give a list of functions to
compute descriptive statistics; if you need a specific function you can find easily in the <em>Help</em>
pane in Rstudio or using any modern internet search engine. What I will do is show you a workflow
that allows you to compute the descripitive statisics you need fast. R has a lot of built-in
functions for descriptive statistics; however, if you want to compute statistics for different
sub-groups, some more complex manipulations are needed. At least this was true in the past.
Nowadays, thanks to the packages from the <code>{tidyverse}</code>, it is very easy and fast to compute
descriptive statistics by any stratifying variable(s). The package we are going to use for this is
called <code>{dplyr}</code>. <code>{dplyr}</code> contains a lot of functions that make manipulating data and computing
descriptive statistics very easy. To make things easier for now, we are going to use example data
included with <code>{dplyr}</code>. So no need to import an external dataset; this does not change anything to
the example that we are going to study here; the source of the data does not matter for this. Using
<code>dplyr</code> is possible only if the data you are working with is already in a useful shape. When data
is more messy, you will need to first manipulate it to bring it a <em>tidy</em> format. For this, we will
use <code>{tidyr}</code>, which is very useful package to reshape data and to do advanced cleaning of your
data. All these tidyverse functions are also called <em>verbs</em>. However, before getting to know these
verbs, let’s do an analysis using standard, or <em>base</em> R functions. This will be the benchmark
against which we are going to measure a <code>{tidyverse}</code> workflow.</p>
<div id="a-data-exploration-exercice-using-base-r" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> A data exploration exercice using <em>base</em> R<a href="descriptive-statistics-and-data-manipulation.html#a-data-exploration-exercice-using-base-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s first load the <code>starwars</code> data set, included in the <code>{dplyr}</code> package:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="descriptive-statistics-and-data-manipulation.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb205-2"><a href="descriptive-statistics-and-data-manipulation.html#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(starwars)</span></code></pre></div>
<p>Let’s first take a look at the data:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="descriptive-statistics-and-data-manipulation.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(starwars)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…
## 2 C-3PO        167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
## 3 R2-D2         96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
## 4 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
## 5 Leia Org…    150    49 brown      light      brown           19   fema… femin…
## 6 Owen Lars    178   120 brown, gr… light      blue            52   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>This data contains information on Star Wars characters. The first question you have to answer is
to find the average height of the characters:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="descriptive-statistics-and-data-manipulation.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(starwars<span class="sc">$</span>height)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>As discussed in Chapter 2, <code>$</code> allows you to access columns of a <code>data.frame</code> objects.</p>
<p>Because there are <code>NA</code> values in the data, the result is also <code>NA</code>. To get the result, you need to
add an option to <code>mean()</code>:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="descriptive-statistics-and-data-manipulation.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(starwars<span class="sc">$</span>height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 174.358</code></pre>
<p>Let’s also take a look at the standard deviation:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="descriptive-statistics-and-data-manipulation.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(starwars<span class="sc">$</span>height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 34.77043</code></pre>
<p>It might be more informative to compute these two statistics by sex, so for this, we are going
to use <code>aggregate()</code>:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="descriptive-statistics-and-data-manipulation.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(starwars<span class="sc">$</span>height,</span>
<span id="cb214-2"><a href="descriptive-statistics-and-data-manipulation.html#cb214-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">sex =</span> starwars<span class="sc">$</span>sex),</span>
<span id="cb214-3"><a href="descriptive-statistics-and-data-manipulation.html#cb214-3" aria-hidden="true" tabindex="-1"></a>          mean)</span></code></pre></div>
<pre><code>##              sex   x
## 1         female  NA
## 2 hermaphroditic 175
## 3           male  NA
## 4           none  NA</code></pre>
<p>Oh, shoot! Most groups have missing values in them, so we get <code>NA</code> back. We need to use <code>na.rm = TRUE</code>
just like before. Thankfully, it is possible to pass this option to <code>mean()</code> inside <code>aggregate()</code> as well:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="descriptive-statistics-and-data-manipulation.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(starwars<span class="sc">$</span>height,</span>
<span id="cb216-2"><a href="descriptive-statistics-and-data-manipulation.html#cb216-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">sex =</span> starwars<span class="sc">$</span>sex),</span>
<span id="cb216-3"><a href="descriptive-statistics-and-data-manipulation.html#cb216-3" aria-hidden="true" tabindex="-1"></a>          mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##              sex        x
## 1         female 169.2667
## 2 hermaphroditic 175.0000
## 3           male 179.1053
## 4           none 131.2000</code></pre>
<p>Later in the book, we are also going to see how to define our own functions (with the default options that
are useful to us), and this will also help in this sort of situation.
Even though we can use <code>na.rm = TRUE</code>, let’s also use <code>subset()</code> to filter out the <code>NA</code> values beforehand:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="descriptive-statistics-and-data-manipulation.html#cb218-1" aria-hidden="true" tabindex="-1"></a>starwars_no_nas <span class="ot">&lt;-</span> <span class="fu">subset</span>(starwars,</span>
<span id="cb218-2"><a href="descriptive-statistics-and-data-manipulation.html#cb218-2" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">!</span><span class="fu">is.na</span>(height))</span>
<span id="cb218-3"><a href="descriptive-statistics-and-data-manipulation.html#cb218-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-4"><a href="descriptive-statistics-and-data-manipulation.html#cb218-4" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(starwars_no_nas<span class="sc">$</span>height,</span>
<span id="cb218-5"><a href="descriptive-statistics-and-data-manipulation.html#cb218-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">sex =</span> starwars_no_nas<span class="sc">$</span>sex),</span>
<span id="cb218-6"><a href="descriptive-statistics-and-data-manipulation.html#cb218-6" aria-hidden="true" tabindex="-1"></a>          mean)</span></code></pre></div>
<pre><code>##              sex        x
## 1         female 169.2667
## 2 hermaphroditic 175.0000
## 3           male 179.1053
## 4           none 131.2000</code></pre>
<p>(<code>aggregate()</code> also has a <code>subset =</code> option, but I prefer to explicitely subset the data set with <code>subset()</code>).</p>
<p>Even if you are not familiar with <code>aggregate()</code>, I believe the above lines are quite
self-explanatory. You need to provide <code>aggregate()</code> with 3 things; the variable you want to
summarize (or only the data frame, if you want to summarize all variables), a list of grouping
variables and then the function that will be applied to each subgroup. And by the way, to test for
<code>NA</code>, one uses the function <code>is.na()</code> not something like <code>species == "NA"</code> or anything like that.
<code>!is.na()</code> does the opposite (<code>!</code> reverses booleans, so <code>!TRUE</code> becomes <code>FALSE</code> and vice-versa).</p>
<p>You can easily add another grouping variable:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="descriptive-statistics-and-data-manipulation.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(starwars_no_nas<span class="sc">$</span>height,</span>
<span id="cb220-2"><a href="descriptive-statistics-and-data-manipulation.html#cb220-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Sex =</span> starwars_no_nas<span class="sc">$</span>sex,</span>
<span id="cb220-3"><a href="descriptive-statistics-and-data-manipulation.html#cb220-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">Hair color</span><span class="st">`</span> <span class="ot">=</span> starwars_no_nas<span class="sc">$</span>hair_color),</span>
<span id="cb220-4"><a href="descriptive-statistics-and-data-manipulation.html#cb220-4" aria-hidden="true" tabindex="-1"></a>          mean)</span></code></pre></div>
<pre><code>##       Sex    Hair color        x
## 1  female        auburn 150.0000
## 2    male  auburn, grey 180.0000
## 3    male auburn, white 182.0000
## 4  female         black 166.3333
## 5    male         black 176.2500
## 6    male         blond 176.6667
## 7  female        blonde 168.0000
## 8  female         brown 160.4000
## 9    male         brown 182.6667
## 10   male   brown, grey 178.0000
## 11   male          grey 170.0000
## 12 female          none 188.2500
## 13   male          none 182.2414
## 14   none          none 148.0000
## 15 female         white 167.0000
## 16   male         white 152.3333</code></pre>
<p>or use another function:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="descriptive-statistics-and-data-manipulation.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(starwars_no_nas<span class="sc">$</span>height,</span>
<span id="cb222-2"><a href="descriptive-statistics-and-data-manipulation.html#cb222-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Sex =</span> starwars_no_nas<span class="sc">$</span>sex),</span>
<span id="cb222-3"><a href="descriptive-statistics-and-data-manipulation.html#cb222-3" aria-hidden="true" tabindex="-1"></a>          sd)</span></code></pre></div>
<pre><code>##              Sex        x
## 1         female 15.32256
## 2 hermaphroditic       NA
## 3           male 36.01075
## 4           none 49.14977</code></pre>
<p>(let’s ignore the <code>NA</code>s). It is important to note that <code>aggregate()</code> returns a <code>data.frame</code> object.</p>
<p>You can only give one function to <code>aggregate()</code>, so if you need the mean and the standard deviation of <code>height</code>,
you must do it in two steps.</p>
<p>Since R 4.1, a new infix operator <code>|&gt;</code> has been introduced, which is really handy for writing the kind of
code we’ve been looking at in this chapter. <code>|&gt;</code> is also called a pipe, or the <em>base</em> pipe to distinguish
it from <em>another</em> pipe that we’ll discuss in the next section. For now, let’s learn about <code>|&gt;</code>.
Consider the following:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="descriptive-statistics-and-data-manipulation.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span></code></pre></div>
<pre><code>## [1] 3.162278</code></pre>
<p>This computes <code>sqrt(10)</code>; so what <code>|&gt;</code> does, is pass the left hand side (<code>10</code>, in the example above) to the
right hand side (<code>sqrt()</code>). Using <code>|&gt;</code> might seem more complicated and verbose than not using it, but you
will see in a bit why it can be useful. The next function I would like to introduce at this point is <code>with()</code>.
<code>with()</code> makes it possible to apply functions on <code>data.frame</code> columns without having to write <code>$</code> all the time.
For example, consider this:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="descriptive-statistics-and-data-manipulation.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(starwars<span class="sc">$</span>height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 174.358</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="descriptive-statistics-and-data-manipulation.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(starwars,</span>
<span id="cb228-2"><a href="descriptive-statistics-and-data-manipulation.html#cb228-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] 174.358</code></pre>
<p>The advantage of using <code>with()</code> is that we can directly reference <code>height</code> without using <code>$</code>. Here again, this
is more verbose than simply using <code>$</code>… so why bother with it? It turns out that by combining <code>|&gt;</code> and <code>with()</code>,
we can write very clean and concise code. Let’s go back to a previous example to illustrate this idea:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="descriptive-statistics-and-data-manipulation.html#cb230-1" aria-hidden="true" tabindex="-1"></a>starwars_no_nas <span class="ot">&lt;-</span> <span class="fu">subset</span>(starwars,</span>
<span id="cb230-2"><a href="descriptive-statistics-and-data-manipulation.html#cb230-2" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">!</span><span class="fu">is.na</span>(height))</span>
<span id="cb230-3"><a href="descriptive-statistics-and-data-manipulation.html#cb230-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-4"><a href="descriptive-statistics-and-data-manipulation.html#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(starwars_no_nas<span class="sc">$</span>height,</span>
<span id="cb230-5"><a href="descriptive-statistics-and-data-manipulation.html#cb230-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">sex =</span> starwars_no_nas<span class="sc">$</span>sex),</span>
<span id="cb230-6"><a href="descriptive-statistics-and-data-manipulation.html#cb230-6" aria-hidden="true" tabindex="-1"></a>          mean)</span></code></pre></div>
<pre><code>##              sex        x
## 1         female 169.2667
## 2 hermaphroditic 175.0000
## 3           male 179.1053
## 4           none 131.2000</code></pre>
<p>First, we created a new dataset where we filtered out rows where <code>height</code> is <code>NA</code>. This dataset is useless otherwise,
but we need it for the next part, where we actually do what we want (computing the average <code>height</code> by <code>sex</code>).
Using <code>|&gt;</code> and <code>with()</code>, we can write this in one go:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="descriptive-statistics-and-data-manipulation.html#cb232-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb232-2"><a href="descriptive-statistics-and-data-manipulation.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span><span class="fu">is.na</span>(sex)) <span class="sc">|&gt;</span></span>
<span id="cb232-3"><a href="descriptive-statistics-and-data-manipulation.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">aggregate</span>(height,</span>
<span id="cb232-4"><a href="descriptive-statistics-and-data-manipulation.html#cb232-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Species =</span> species,</span>
<span id="cb232-5"><a href="descriptive-statistics-and-data-manipulation.html#cb232-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Sex =</span> sex),</span>
<span id="cb232-6"><a href="descriptive-statistics-and-data-manipulation.html#cb232-6" aria-hidden="true" tabindex="-1"></a>                 mean))</span></code></pre></div>
<pre><code>##           Species            Sex        x
## 1        Clawdite         female 168.0000
## 2           Human         female       NA
## 3        Kaminoan         female 213.0000
## 4        Mirialan         female 168.0000
## 5      Tholothian         female 184.0000
## 6         Togruta         female 178.0000
## 7         Twi&#39;lek         female 178.0000
## 8            Hutt hermaphroditic 175.0000
## 9          Aleena           male  79.0000
## 10       Besalisk           male 198.0000
## 11         Cerean           male 198.0000
## 12       Chagrian           male 196.0000
## 13            Dug           male 112.0000
## 14           Ewok           male  88.0000
## 15      Geonosian           male 183.0000
## 16         Gungan           male 208.6667
## 17          Human           male       NA
## 18       Iktotchi           male 188.0000
## 19        Kaleesh           male 216.0000
## 20       Kaminoan           male 229.0000
## 21        Kel Dor           male 188.0000
## 22   Mon Calamari           male 180.0000
## 23           Muun           male 191.0000
## 24       Nautolan           male 196.0000
## 25      Neimodian           male 191.0000
## 26         Pau&#39;an           male 206.0000
## 27       Quermian           male 264.0000
## 28         Rodian           male 173.0000
## 29        Skakoan           male 193.0000
## 30      Sullustan           male 160.0000
## 31          Toong           male 163.0000
## 32      Toydarian           male 137.0000
## 33     Trandoshan           male 190.0000
## 34        Twi&#39;lek           male 180.0000
## 35     Vulptereen           male  94.0000
## 36        Wookiee           male 231.0000
## 37          Xexto           male 122.0000
## 38 Yoda&#39;s species           male  66.0000
## 39         Zabrak           male 173.0000
## 40          Droid           none       NA</code></pre>
<p>So let’s unpack this. In the first two rows, using <code>|&gt;</code>, we pass the <code>starwars</code> <code>data.frame</code> to <code>subset()</code>:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="descriptive-statistics-and-data-manipulation.html#cb234-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb234-2"><a href="descriptive-statistics-and-data-manipulation.html#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span><span class="fu">is.na</span>(sex))</span></code></pre></div>
<pre><code>## # A tibble: 83 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
##  3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
##  4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
##  5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
##  6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
##  7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
##  9 Biggs D…    183    84 black      light      brown           24   male  mascu…
## 10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
## # … with 73 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>as I explained before, this is exactly the same as <code>subset(starwars, !is.na(sex))</code>. Then, we pass the result of
<code>subset()</code> to the next function, <code>with()</code>. The first argument of <code>with()</code> must be a <code>data.frame</code>, and this is exactly
what <code>subset()</code> returns! So now the output of <code>subset()</code> is passed down to <code>with()</code>, which makes it now possible
to reference the columns of the <code>data.frame</code> in <code>aggregate()</code> directly. If you have a hard time understanding what
is going on, you can use <code>quote()</code> to see what’s going on. <code>quote()</code> returns an expression with evaluating it:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="descriptive-statistics-and-data-manipulation.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(<span class="fu">log</span>(<span class="dv">10</span>))</span></code></pre></div>
<pre><code>## log(10)</code></pre>
<p>Why am I bring this up? Well, since <code>a |&gt; f()</code> is exactly equal to <code>f(a)</code>, quoting the code above will return
an expression with <code>|&gt;</code>. For instance:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="descriptive-statistics-and-data-manipulation.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(<span class="dv">10</span> <span class="sc">|&gt;</span> <span class="fu">log</span>())</span></code></pre></div>
<pre><code>## log(10)</code></pre>
<p>So let’s quote the big block of code from above:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="descriptive-statistics-and-data-manipulation.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(</span>
<span id="cb240-2"><a href="descriptive-statistics-and-data-manipulation.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  starwars <span class="sc">|&gt;</span></span>
<span id="cb240-3"><a href="descriptive-statistics-and-data-manipulation.html#cb240-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span><span class="fu">is.na</span>(sex)) <span class="sc">|&gt;</span></span>
<span id="cb240-4"><a href="descriptive-statistics-and-data-manipulation.html#cb240-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">aggregate</span>(height,</span>
<span id="cb240-5"><a href="descriptive-statistics-and-data-manipulation.html#cb240-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Species =</span> species,</span>
<span id="cb240-6"><a href="descriptive-statistics-and-data-manipulation.html#cb240-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Sex =</span> sex),</span>
<span id="cb240-7"><a href="descriptive-statistics-and-data-manipulation.html#cb240-7" aria-hidden="true" tabindex="-1"></a>                 mean))</span>
<span id="cb240-8"><a href="descriptive-statistics-and-data-manipulation.html#cb240-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## with(subset(starwars, !is.na(sex)), aggregate(height, by = list(Species = species, 
##     Sex = sex), mean))</code></pre>
<p>I think now you see why using <code>|&gt;</code> makes code much clearer; the nested expression you would need to write otherwise
is much less readable, unless you define intermediate objects. And without <code>with()</code>, this is what you
would need to write:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="descriptive-statistics-and-data-manipulation.html#cb242-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">subset</span>(starwars, <span class="sc">!</span><span class="fu">is.na</span>(height))</span>
<span id="cb242-2"><a href="descriptive-statistics-and-data-manipulation.html#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="descriptive-statistics-and-data-manipulation.html#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(b<span class="sc">$</span>height, <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Species =</span> b<span class="sc">$</span>species, <span class="at">Sex =</span> b<span class="sc">$</span>sex), mean)</span></code></pre></div>
<p>To finish this section, let’s say that you wanted to have the average <code>height</code> and <code>mass</code> by sex. In this case
you need to specify the columns in <code>aggregate()</code> with <code>cbind()</code> (let’s use <code>na.rm = TRUE</code> again instead of
<code>subset()</code>ing the data beforehand):</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="descriptive-statistics-and-data-manipulation.html#cb243-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span></span>
<span id="cb243-2"><a href="descriptive-statistics-and-data-manipulation.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">aggregate</span>(<span class="fu">cbind</span>(height, mass),</span>
<span id="cb243-3"><a href="descriptive-statistics-and-data-manipulation.html#cb243-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Sex =</span> sex),</span>
<span id="cb243-4"><a href="descriptive-statistics-and-data-manipulation.html#cb243-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>##              Sex   height       mass
## 1         female 169.2667   54.68889
## 2 hermaphroditic 175.0000 1358.00000
## 3           male 179.1053   81.00455
## 4           none 131.2000   69.75000</code></pre>
<p>Let’s now continue with some more advanced operations using this fake dataset:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="descriptive-statistics-and-data-manipulation.html#cb245-1" aria-hidden="true" tabindex="-1"></a>survey_data_base <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb245-2"><a href="descriptive-statistics-and-data-manipulation.html#cb245-2" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb245-3"><a href="descriptive-statistics-and-data-manipulation.html#cb245-3" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span>id, <span class="sc">~</span>var1, <span class="sc">~</span>var2, <span class="sc">~</span>var3,</span>
<span id="cb245-4"><a href="descriptive-statistics-and-data-manipulation.html#cb245-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>,</span>
<span id="cb245-5"><a href="descriptive-statistics-and-data-manipulation.html#cb245-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>, <span class="fl">1.4</span>, <span class="fl">1.9</span>, <span class="fl">4.1</span>,</span>
<span id="cb245-6"><a href="descriptive-statistics-and-data-manipulation.html#cb245-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>, <span class="fl">0.1</span>, <span class="fl">2.8</span>, <span class="fl">8.9</span>,</span>
<span id="cb245-7"><a href="descriptive-statistics-and-data-manipulation.html#cb245-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>, <span class="fl">1.7</span>, <span class="fl">1.9</span>, <span class="fl">7.6</span></span>
<span id="cb245-8"><a href="descriptive-statistics-and-data-manipulation.html#cb245-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb245-9"><a href="descriptive-statistics-and-data-manipulation.html#cb245-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="descriptive-statistics-and-data-manipulation.html#cb246-1" aria-hidden="true" tabindex="-1"></a>survey_data_base</span></code></pre></div>
<pre><code>##   id var1 var2 var3
## 1  1  1.0  0.2  0.3
## 2  2  1.4  1.9  4.1
## 3  3  0.1  2.8  8.9
## 4  4  1.7  1.9  7.6</code></pre>
<p>Depending on what you want to do with this data, it is not in the right shape. For example, it
would not be possible to simply compute the average of <code>var1</code>, <code>var2</code> and <code>var3</code> for each <code>id</code>.
This is because this would require running <code>mean()</code> by row, but this is not very easy. This is
because R is not suited to row-based workflows. Well I’m lying a little bit here, it turns here
that R comes with a <code>rowMeans()</code> function. So this would work:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="descriptive-statistics-and-data-manipulation.html#cb248-1" aria-hidden="true" tabindex="-1"></a>survey_data_base <span class="sc">|&gt;</span></span>
<span id="cb248-2"><a href="descriptive-statistics-and-data-manipulation.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">mean_id =</span> <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(var1, var2, var3))) <span class="co">#transform adds a column to a data.frame</span></span></code></pre></div>
<pre><code>##   id var1 var2 var3  mean_id
## 1  1  1.0  0.2  0.3 0.500000
## 2  2  1.4  1.9  4.1 2.466667
## 3  3  0.1  2.8  8.9 3.933333
## 4  4  1.7  1.9  7.6 3.733333</code></pre>
<p>But there is no <code>rowSD()</code> or <code>rowMax()</code>, etc… so it is much better to reshape the data and put it in a
format that gives us maximum flexibility. To reshape the data, we’ll be using the aptly-called <code>reshape()</code> command:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="descriptive-statistics-and-data-manipulation.html#cb250-1" aria-hidden="true" tabindex="-1"></a>survey_data_long <span class="ot">&lt;-</span> <span class="fu">reshape</span>(survey_data_base,</span>
<span id="cb250-2"><a href="descriptive-statistics-and-data-manipulation.html#cb250-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">varying =</span> <span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>), <span class="at">v.names =</span> <span class="st">&quot;variable&quot;</span>, <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>)</span></code></pre></div>
<p>We can now easily compute the average of <code>variable</code> for each <code>id</code>:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="descriptive-statistics-and-data-manipulation.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(survey_data_long<span class="sc">$</span>variable,</span>
<span id="cb251-2"><a href="descriptive-statistics-and-data-manipulation.html#cb251-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Id =</span> survey_data_long<span class="sc">$</span>id),</span>
<span id="cb251-3"><a href="descriptive-statistics-and-data-manipulation.html#cb251-3" aria-hidden="true" tabindex="-1"></a>          mean)</span></code></pre></div>
<pre><code>##   Id        x
## 1  1 0.500000
## 2  2 2.466667
## 3  3 3.933333
## 4  4 3.733333</code></pre>
<p>or any other variable:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="descriptive-statistics-and-data-manipulation.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(survey_data_long<span class="sc">$</span>variable,</span>
<span id="cb253-2"><a href="descriptive-statistics-and-data-manipulation.html#cb253-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="at">Id =</span> survey_data_long<span class="sc">$</span>id),</span>
<span id="cb253-3"><a href="descriptive-statistics-and-data-manipulation.html#cb253-3" aria-hidden="true" tabindex="-1"></a>          max)</span></code></pre></div>
<pre><code>##   Id   x
## 1  1 1.0
## 2  2 4.1
## 3  3 8.9
## 4  4 7.6</code></pre>
<p>As you can see, R comes with very powerful functions right out of the box, ready to use. When I was
studying, unfortunately, my professors had been brought up on FORTRAN loops, so we had to do to all
this using loops (not reshaping, thankfully), which was not so easy.
Now that we have seen how <em>base</em> R works, let’s redo the analysis using <code>{tidyverse}</code> verbs.
The <code>{tidyverse}</code> provides many more functions, each of them doing only one single thing. You will
shortly see why this is quite important; by focusing on just one task, and by focusing on the data frame
as the central object, it becomes possible to build really complex workflows, piece by piece,
very easily.</p>
<p>But before deep diving into the <code>{tidyverse}</code>, let’s take a moment to discuss about another infix
operator, <code>%&gt;%</code>.</p>
</div>
<div id="smoking-is-bad-for-you-but-pipes-are-your-friend" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Smoking is bad for you, but pipes are your friend<a href="descriptive-statistics-and-data-manipulation.html#smoking-is-bad-for-you-but-pipes-are-your-friend" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The title of this section might sound weird at first, but by the end of it, you’ll get this
(terrible) pun.</p>
<p>You probably know the following painting by René Magritte, <em>La trahison des images</em>:</p>
<p><img src="assets/pas_une_pipe.png" width="350" /></p>
<p>It turns out there’s an R package from the <code>tidyverse</code> that is called <code>magrittr</code>. What does this
package do? This package introduced <em>pipes</em> to R, way before <code>|&gt;</code> in R 4.1. Pipes are a concept
from the Unix operating system; if you’re using a GNU+Linux distribution or macOS, you’re basically
using a <em>modern</em> unix (that’s an oversimplification, but I’m an economist by training, and
outrageously oversimplifying things is what we do, deal with it). The <em>magrittr</em> pipe is written as
<code>%&gt;%</code>. Just like <code>|&gt;</code>, <code>%&gt;%</code> takes the left hand side to feed it as the first argument of the
function in the right hand side. Try the following:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="descriptive-statistics-and-data-manipulation.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code></pre></div>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="descriptive-statistics-and-data-manipulation.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span> <span class="sc">%&gt;%</span> sqrt</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>You can chain multiple functions, as you can with <code>|&gt;</code>:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="descriptive-statistics-and-data-manipulation.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span> <span class="sc">%&gt;%</span></span>
<span id="cb258-2"><a href="descriptive-statistics-and-data-manipulation.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  sqrt <span class="sc">%&gt;%</span></span>
<span id="cb258-3"><a href="descriptive-statistics-and-data-manipulation.html#cb258-3" aria-hidden="true" tabindex="-1"></a>  log</span></code></pre></div>
<pre><code>## [1] 1.386294</code></pre>
<p>But unlike with <code>|&gt;</code>, you can omit <code>()</code>. <code>%&gt;%</code> also has other features. For example, you can
pipe things to other infix operators. For example, <code>+</code>. You can use <code>+</code> as usual:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="descriptive-statistics-and-data-manipulation.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">12</span></span></code></pre></div>
<pre><code>## [1] 14</code></pre>
<p>Or as a prefix operator:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="descriptive-statistics-and-data-manipulation.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">12</span>)</span></code></pre></div>
<pre><code>## [1] 14</code></pre>
<p>You can use this notation with <code>%&gt;%</code>:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="descriptive-statistics-and-data-manipulation.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span> <span class="sc">%&gt;%</span> sqrt <span class="sc">%&gt;%</span> <span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">18</span>)</span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<p>This also works using <code>|&gt;</code> since R version 4.2, but only if you use the <code>_</code> pipe placeholder:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="descriptive-statistics-and-data-manipulation.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span> <span class="sc">|&gt;</span> <span class="fu">sqrt</span>() <span class="sc">|&gt;</span> <span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="at">x =</span> _, <span class="dv">18</span>)</span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<p>The output of <code>16</code> (<code>16</code>) got fed to <code>sqrt()</code>, and the output of <code>sqrt(16)</code> (4) got fed to <code>+(18)</code>
(so we got <code>+(4, 18)</code> = 22). Without <code>%&gt;%</code> you’d write the line just above like this:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="descriptive-statistics-and-data-manipulation.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">16</span>) <span class="sc">+</span> <span class="dv">18</span></span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<p>Just like before, with <code>|&gt;</code>, this might seem overly complicated, but using these pipes will
make our code much more readable. I’m sure you’ll be convinced by the end of this chapter.</p>
<p><code>%&gt;%</code> is not the only pipe operator in <code>magrittr</code>. There’s <code>%T%</code>, <code>%&lt;&gt;%</code> and <code>%$%</code>. All have their
uses, but are basically shortcuts to some common tasks with <code>%&gt;%</code> plus another function. Which
means that you can live without them, and because of this, I will not discuss them.</p>
</div>
<div id="the-tidyverses-enfant-prodige-dplyr" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> The <code>{tidyverse}</code>’s <em>enfant prodige</em>: <code>{dplyr}</code><a href="descriptive-statistics-and-data-manipulation.html#the-tidyverses-enfant-prodige-dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The best way to get started with the tidyverse packages is to get to know <code>{dplyr}</code>. <code>{dplyr}</code>
provides a lot of very useful functions that makes it very easy to get discriptive statistics or
add new columns to your data.</p>
<div id="a-first-taste-of-data-manipulation-with-dplyr" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> A first taste of data manipulation with <code>{dplyr}</code><a href="descriptive-statistics-and-data-manipulation.html#a-first-taste-of-data-manipulation-with-dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section will walk you through a typical analysis using <code>{dplyr}</code> funcitons. Just go with it; I
will give more details in the next sections.</p>
<p>First, let’s load <code>{dplyr}</code> and the included <code>starwars</code> dataset. Let’s also take a look at the
first 5 lines of the dataset:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="descriptive-statistics-and-data-manipulation.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb270-2"><a href="descriptive-statistics-and-data-manipulation.html#cb270-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-3"><a href="descriptive-statistics-and-data-manipulation.html#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(starwars)</span>
<span id="cb270-4"><a href="descriptive-statistics-and-data-manipulation.html#cb270-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-5"><a href="descriptive-statistics-and-data-manipulation.html#cb270-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(starwars)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…
## 2 C-3PO        167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
## 3 R2-D2         96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
## 4 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
## 5 Leia Org…    150    49 brown      light      brown           19   fema… femin…
## 6 Owen Lars    178   120 brown, gr… light      blue            52   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p><code>data(starwars)</code> loads the example dataset called <code>starwars</code> that is included in the package
<code>dplyr</code>. As I said earlier, this is just an example; you could have loaded an external dataset,
from a <code>.csv</code> file for instance. This does not matter for what comes next.</p>
<p>Like we saw earlier, R includes a lot of functions for descriptive statistics, such as <code>mean()</code>,
<code>sd()</code>, <code>cov()</code>, and many more. What <code>dplyr</code> brings to the table (among other niceties) is the</p>
<p>Just like before, we are going to compute the average height by <code>sex</code>:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="descriptive-statistics-and-data-manipulation.html#cb272-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb272-2"><a href="descriptive-statistics-and-data-manipulation.html#cb272-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb272-3"><a href="descriptive-statistics-and-data-manipulation.html#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   sex            mean_height
##   &lt;chr&gt;                &lt;dbl&gt;
## 1 female                169.
## 2 hermaphroditic        175 
## 3 male                  179.
## 4 none                  131.
## 5 &lt;NA&gt;                  181.</code></pre>
<p>The very nice thing about using <code>%&gt;%</code> and <code>{dplyr}</code> verbs/functions, is that this is really
readable. The above three lines can be translated like so in English:</p>
<p><em>Take the starwars dataset, then group by sex, then compute the mean height (for each subgroup) by
omitting missing values.</em></p>
<p><code>%&gt;%</code> can be translated by “then”. Without <code>%&gt;%</code> you would need to change the code to:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="descriptive-statistics-and-data-manipulation.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="fu">group_by</span>(starwars, sex), <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   sex            `mean(height, na.rm = TRUE)`
##   &lt;chr&gt;                                 &lt;dbl&gt;
## 1 female                                 169.
## 2 hermaphroditic                         175 
## 3 male                                   179.
## 4 none                                   131.
## 5 &lt;NA&gt;                                   181.</code></pre>
<p>Unlike with the <em>base</em> approach, each function does only one thing. With the base function
<code>aggregate()</code> was used to also define the subgroups. This is not the case with <code>{dplyr}</code>; one
function to create the groups (<code>group_by()</code>) and then one function to compute the summaries
(<code>summarise()</code>). Also, <code>group_by()</code> creates a specific subgroup for individuals where <code>sex</code> is
missing. This is the last line in the data frame, where <code>sex</code> is <code>NA</code>. Another nice thing is that
you can specify the column containing the average height. I chose to name it <code>mean_height</code>.</p>
<p>Now, let’s suppose that we want to filter some data first:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="descriptive-statistics-and-data-manipulation.html#cb276-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb276-2"><a href="descriptive-statistics-and-data-manipulation.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gender <span class="sc">==</span> <span class="st">&quot;masculine&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb276-3"><a href="descriptive-statistics-and-data-manipulation.html#cb276-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb276-4"><a href="descriptive-statistics-and-data-manipulation.html#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   sex            mean_height
##   &lt;chr&gt;                &lt;dbl&gt;
## 1 hermaphroditic        175 
## 2 male                  179.
## 3 none                  140</code></pre>
<p>Again, the <code>%&gt;%</code> makes the above lines of code very easy to read. Without it, one would need to
write:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="descriptive-statistics-and-data-manipulation.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="fu">group_by</span>(<span class="fu">filter</span>(starwars, gender <span class="sc">==</span> <span class="st">&quot;masculine&quot;</span>), sex), <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   sex            `mean(height, na.rm = TRUE)`
##   &lt;chr&gt;                                 &lt;dbl&gt;
## 1 hermaphroditic                         175 
## 2 male                                   179.
## 3 none                                   140</code></pre>
<p>I think you agree with me that this is not very readable. One way to make it more readable would
be to save intermediary variables:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="descriptive-statistics-and-data-manipulation.html#cb280-1" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(starwars, gender <span class="sc">==</span> <span class="st">&quot;masculine&quot;</span>)</span>
<span id="cb280-2"><a href="descriptive-statistics-and-data-manipulation.html#cb280-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-3"><a href="descriptive-statistics-and-data-manipulation.html#cb280-3" aria-hidden="true" tabindex="-1"></a>grouped_data <span class="ot">&lt;-</span> <span class="fu">group_by</span>(<span class="fu">filter</span>(starwars, gender <span class="sc">==</span> <span class="st">&quot;masculine&quot;</span>), sex)</span>
<span id="cb280-4"><a href="descriptive-statistics-and-data-manipulation.html#cb280-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-5"><a href="descriptive-statistics-and-data-manipulation.html#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(grouped_data, <span class="fu">mean</span>(height))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   sex            `mean(height)`
##   &lt;chr&gt;                   &lt;dbl&gt;
## 1 hermaphroditic            175
## 2 male                       NA
## 3 none                       NA</code></pre>
<p>But this can get very tedious. Once you’re used to <code>%&gt;%</code>, you won’t go back to not use it.</p>
<p>Before continuing and to make things clearer; <code>filter()</code>, <code>group_by()</code> and <code>summarise()</code> are
functions that are included in <code>{dplyr}</code>. <code>%&gt;%</code> is actually a function from <code>{magrittr}</code>, but this
package gets loaded on the fly when you load <code>{dplyr}</code>, so you do not need to worry about it.</p>
<p>The result of all these operations that use <code>{dplyr}</code> functions are actually other datasets, or
<code>tibbles</code>. This means that you can save them in variable, or write them to disk, and then work with
these as any other datasets.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="descriptive-statistics-and-data-manipulation.html#cb282-1" aria-hidden="true" tabindex="-1"></a>mean_height <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span></span>
<span id="cb282-2"><a href="descriptive-statistics-and-data-manipulation.html#cb282-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb282-3"><a href="descriptive-statistics-and-data-manipulation.html#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(height))</span>
<span id="cb282-4"><a href="descriptive-statistics-and-data-manipulation.html#cb282-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-5"><a href="descriptive-statistics-and-data-manipulation.html#cb282-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mean_height)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="descriptive-statistics-and-data-manipulation.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mean_height)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   sex            `mean(height)`
##   &lt;chr&gt;                   &lt;dbl&gt;
## 1 female                     NA
## 2 hermaphroditic            175
## 3 male                       NA
## 4 none                       NA
## 5 &lt;NA&gt;                       NA</code></pre>
<p>You could then write this data to disk using <code>rio::export()</code> for instance. If you need more than
the mean of the height, you can keep adding as many functions as needed (another advantage over
<code>aggregate()</code>:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="descriptive-statistics-and-data-manipulation.html#cb286-1" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span></span>
<span id="cb286-2"><a href="descriptive-statistics-and-data-manipulation.html#cb286-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb286-3"><a href="descriptive-statistics-and-data-manipulation.html#cb286-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-4"><a href="descriptive-statistics-and-data-manipulation.html#cb286-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">var_height =</span> <span class="fu">var</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-5"><a href="descriptive-statistics-and-data-manipulation.html#cb286-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_obs =</span> <span class="fu">n</span>())</span>
<span id="cb286-6"><a href="descriptive-statistics-and-data-manipulation.html#cb286-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-7"><a href="descriptive-statistics-and-data-manipulation.html#cb286-7" aria-hidden="true" tabindex="-1"></a>summary_table</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
##   sex            mean_height var_height n_obs
##   &lt;chr&gt;                &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1 female                169.     235.      16
## 2 hermaphroditic        175       NA        1
## 3 male                  179.    1297.      60
## 4 none                  131.    2416.       6
## 5 &lt;NA&gt;                  181.       8.33     4</code></pre>
<p>I’ve added more functions, namely <code>var()</code>, to get the variance of height, and <code>n()</code>, which
is a function from <code>{dplyr}</code>, not base R, to get the number of observations. This is quite useful,
because we see that there is a group with only one individual. Let’s focus on the
sexes for which we have more than 1 individual. Since we save all the previous operations (which
produce a <code>tibble</code>) in a variable, we can keep going from there:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="descriptive-statistics-and-data-manipulation.html#cb288-1" aria-hidden="true" tabindex="-1"></a>summary_table2 <span class="ot">&lt;-</span> summary_table <span class="sc">%&gt;%</span></span>
<span id="cb288-2"><a href="descriptive-statistics-and-data-manipulation.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_obs <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb288-3"><a href="descriptive-statistics-and-data-manipulation.html#cb288-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-4"><a href="descriptive-statistics-and-data-manipulation.html#cb288-4" aria-hidden="true" tabindex="-1"></a>summary_table2</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##   sex    mean_height var_height n_obs
##   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1 female        169.     235.      16
## 2 male          179.    1297.      60
## 3 none          131.    2416.       6
## 4 &lt;NA&gt;          181.       8.33     4</code></pre>
<p>As mentioned before, there’s a lot of <code>NA</code>s; this is because by default, <code>mean()</code> and <code>var()</code>
return <code>NA</code> if even one single observation is <code>NA</code>. This is good, because it forces you to look at
the data to see what is going on. If you would get a number, even if there were <code>NA</code>s you could
very easily miss these missing values. It is better for functions to fail early and often than the
opposite. This is way we keep using <code>na.rm = TRUE</code> for <code>mean()</code> and <code>var()</code>.</p>
<p>Now let’s actually take a look at the rows where <code>sex</code> is <code>NA</code>:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="descriptive-statistics-and-data-manipulation.html#cb290-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb290-2"><a href="descriptive-statistics-and-data-manipulation.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(sex))</span></code></pre></div>
<pre><code>## # A tibble: 4 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Ric Olié     183    NA brown      fair       blue              NA &lt;NA&gt;  &lt;NA&gt;  
## 2 Quarsh P…    183    NA black      dark       brown             62 &lt;NA&gt;  &lt;NA&gt;  
## 3 Sly Moore    178    48 none       pale       white             NA &lt;NA&gt;  &lt;NA&gt;  
## 4 Captain …     NA    NA unknown    unknown    unknown           NA &lt;NA&gt;  &lt;NA&gt;  
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>There’s only 4 rows where <code>sex</code> is <code>NA</code>. Let’s ignore them:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="descriptive-statistics-and-data-manipulation.html#cb292-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb292-2"><a href="descriptive-statistics-and-data-manipulation.html#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sex)) <span class="sc">%&gt;%</span></span>
<span id="cb292-3"><a href="descriptive-statistics-and-data-manipulation.html#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb292-4"><a href="descriptive-statistics-and-data-manipulation.html#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ave_height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb292-5"><a href="descriptive-statistics-and-data-manipulation.html#cb292-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">var_height =</span> <span class="fu">var</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb292-6"><a href="descriptive-statistics-and-data-manipulation.html#cb292-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_obs =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb292-7"><a href="descriptive-statistics-and-data-manipulation.html#cb292-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_obs <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   sex    ave_height var_height n_obs
##   &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1 female       169.       235.    16
## 2 male         179.      1297.    60
## 3 none         131.      2416.     6</code></pre>
<p>And why not compute the same table, but first add another stratifying variable?</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="descriptive-statistics-and-data-manipulation.html#cb294-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb294-2"><a href="descriptive-statistics-and-data-manipulation.html#cb294-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sex)) <span class="sc">%&gt;%</span></span>
<span id="cb294-3"><a href="descriptive-statistics-and-data-manipulation.html#cb294-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, eye_color) <span class="sc">%&gt;%</span></span>
<span id="cb294-4"><a href="descriptive-statistics-and-data-manipulation.html#cb294-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ave_height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb294-5"><a href="descriptive-statistics-and-data-manipulation.html#cb294-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">var_height =</span> <span class="fu">var</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb294-6"><a href="descriptive-statistics-and-data-manipulation.html#cb294-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_obs =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb294-7"><a href="descriptive-statistics-and-data-manipulation.html#cb294-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_obs <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;sex&#39;. You can override using the `.groups`
## argument.</code></pre>
<pre><code>## # A tibble: 12 × 5
## # Groups:   sex [3]
##    sex    eye_color ave_height var_height n_obs
##    &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
##  1 female black           196.      612.      2
##  2 female blue            167       118.      6
##  3 female brown           160        42       5
##  4 female hazel           178        NA       2
##  5 male   black           182      1197       7
##  6 male   blue            190.      434.     12
##  7 male   brown           167.     1663.     15
##  8 male   orange          181.     1306.      7
##  9 male   red             190.        0.5     2
## 10 male   unknown         136      6498       2
## 11 male   yellow          180.     2196.      9
## 12 none   red             131      3571       3</code></pre>
<p>Ok, that’s it for a first taste. We have already discovered some very useful <code>{dplyr}</code> functions,
<code>filter()</code>, <code>group_by()</code> and summarise <code>summarise()</code>.</p>
<p>Now, we are going to learn more about these functions in more detail.</p>
</div>
<div id="filter-the-rows-of-a-dataset-with-filter" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Filter the rows of a dataset with <code>filter()</code><a href="descriptive-statistics-and-data-manipulation.html#filter-the-rows-of-a-dataset-with-filter" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’re going to use the <code>Gasoline</code> dataset from the <code>plm</code> package, so install that first:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="descriptive-statistics-and-data-manipulation.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;plm&quot;</span>)</span></code></pre></div>
<p>Then load the required data:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="descriptive-statistics-and-data-manipulation.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Gasoline, <span class="at">package =</span> <span class="st">&quot;plm&quot;</span>)</span></code></pre></div>
<p>and load dplyr:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="descriptive-statistics-and-data-manipulation.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>This dataset gives the consumption of gasoline for 18 countries from 1960 to 1978. When you load
the data like this, it is a standard <code>data.frame</code>. <code>{dplyr}</code> functions can be used on standard
<code>data.frame</code> objects, but also on <code>tibble</code>s. <code>tibble</code>s are just like data frame, but with a better
print method (and other niceties). I’ll discuss the <code>{tibble}</code> package later, but for now, let’s
convert the data to a <code>tibble</code> and change its name, and also transform the <code>country</code> column to
lower case:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="descriptive-statistics-and-data-manipulation.html#cb300-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Gasoline)</span>
<span id="cb300-2"><a href="descriptive-statistics-and-data-manipulation.html#cb300-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-3"><a href="descriptive-statistics-and-data-manipulation.html#cb300-3" aria-hidden="true" tabindex="-1"></a>gasoline <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb300-4"><a href="descriptive-statistics-and-data-manipulation.html#cb300-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">tolower</span>(country))</span></code></pre></div>
<p><code>filter()</code> is pretty straightforward. What if you would like to subset the data to focus on the
year 1969? Simple:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="descriptive-statistics-and-data-manipulation.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(gasoline, year <span class="sc">==</span> <span class="dv">1969</span>)</span></code></pre></div>
<pre><code>## # A tibble: 18 × 6
##    country   year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria   1969     4.05    -6.15 -0.559    -8.79
##  2 belgium   1969     3.85    -5.86 -0.355    -8.52
##  3 canada    1969     4.86    -5.56 -1.04     -8.10
##  4 denmark   1969     4.17    -5.72 -0.407    -8.47
##  5 france    1969     3.77    -5.84 -0.315    -8.37
##  6 germany   1969     3.90    -5.83 -0.589    -8.44
##  7 greece    1969     4.89    -6.59 -0.180   -10.7 
##  8 ireland   1969     4.21    -6.38 -0.272    -8.95
##  9 italy     1969     3.74    -6.28 -0.248    -8.67
## 10 japan     1969     4.52    -6.16 -0.417    -9.61
## 11 netherla  1969     3.99    -5.88 -0.417    -8.63
## 12 norway    1969     4.09    -5.74 -0.338    -8.69
## 13 spain     1969     3.99    -5.60  0.669    -9.72
## 14 sweden    1969     3.99    -7.77 -2.73     -8.20
## 15 switzerl  1969     4.21    -5.91 -0.918    -8.47
## 16 turkey    1969     5.72    -7.39 -0.298   -12.5 
## 17 u.k.      1969     3.95    -6.03 -0.383    -8.47
## 18 u.s.a.    1969     4.84    -5.41 -1.22     -7.79</code></pre>
<p>Let’s use <code>%&gt;%</code>, since we’re familiar with it now:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="descriptive-statistics-and-data-manipulation.html#cb303-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb303-2"><a href="descriptive-statistics-and-data-manipulation.html#cb303-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1969</span>)</span></code></pre></div>
<pre><code>## # A tibble: 18 × 6
##    country   year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria   1969     4.05    -6.15 -0.559    -8.79
##  2 belgium   1969     3.85    -5.86 -0.355    -8.52
##  3 canada    1969     4.86    -5.56 -1.04     -8.10
##  4 denmark   1969     4.17    -5.72 -0.407    -8.47
##  5 france    1969     3.77    -5.84 -0.315    -8.37
##  6 germany   1969     3.90    -5.83 -0.589    -8.44
##  7 greece    1969     4.89    -6.59 -0.180   -10.7 
##  8 ireland   1969     4.21    -6.38 -0.272    -8.95
##  9 italy     1969     3.74    -6.28 -0.248    -8.67
## 10 japan     1969     4.52    -6.16 -0.417    -9.61
## 11 netherla  1969     3.99    -5.88 -0.417    -8.63
## 12 norway    1969     4.09    -5.74 -0.338    -8.69
## 13 spain     1969     3.99    -5.60  0.669    -9.72
## 14 sweden    1969     3.99    -7.77 -2.73     -8.20
## 15 switzerl  1969     4.21    -5.91 -0.918    -8.47
## 16 turkey    1969     5.72    -7.39 -0.298   -12.5 
## 17 u.k.      1969     3.95    -6.03 -0.383    -8.47
## 18 u.s.a.    1969     4.84    -5.41 -1.22     -7.79</code></pre>
<p>You can also filter more than just one year, by using the <code>%in%</code> operator:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="descriptive-statistics-and-data-manipulation.html#cb305-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb305-2"><a href="descriptive-statistics-and-data-manipulation.html#cb305-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1969</span>, <span class="dv">1973</span>))</span></code></pre></div>
<pre><code>## # A tibble: 90 × 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1969     4.05    -6.15 -0.559    -8.79
##  2 austria  1970     4.08    -6.08 -0.597    -8.73
##  3 austria  1971     4.11    -6.04 -0.654    -8.64
##  4 austria  1972     4.13    -5.98 -0.596    -8.54
##  5 austria  1973     4.20    -5.90 -0.594    -8.49
##  6 belgium  1969     3.85    -5.86 -0.355    -8.52
##  7 belgium  1970     3.87    -5.80 -0.378    -8.45
##  8 belgium  1971     3.87    -5.76 -0.399    -8.41
##  9 belgium  1972     3.91    -5.71 -0.311    -8.36
## 10 belgium  1973     3.90    -5.64 -0.373    -8.31
## # … with 80 more rows</code></pre>
<p>It is also possible use <code>between()</code>, a helper function:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="descriptive-statistics-and-data-manipulation.html#cb307-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb307-2"><a href="descriptive-statistics-and-data-manipulation.html#cb307-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">between</span>(year, <span class="dv">1969</span>, <span class="dv">1973</span>))</span></code></pre></div>
<pre><code>## # A tibble: 90 × 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1969     4.05    -6.15 -0.559    -8.79
##  2 austria  1970     4.08    -6.08 -0.597    -8.73
##  3 austria  1971     4.11    -6.04 -0.654    -8.64
##  4 austria  1972     4.13    -5.98 -0.596    -8.54
##  5 austria  1973     4.20    -5.90 -0.594    -8.49
##  6 belgium  1969     3.85    -5.86 -0.355    -8.52
##  7 belgium  1970     3.87    -5.80 -0.378    -8.45
##  8 belgium  1971     3.87    -5.76 -0.399    -8.41
##  9 belgium  1972     3.91    -5.71 -0.311    -8.36
## 10 belgium  1973     3.90    -5.64 -0.373    -8.31
## # … with 80 more rows</code></pre>
<p>To select non-consecutive years:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="descriptive-statistics-and-data-manipulation.html#cb309-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb309-2"><a href="descriptive-statistics-and-data-manipulation.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1969</span>, <span class="dv">1973</span>, <span class="dv">1977</span>))</span></code></pre></div>
<pre><code>## # A tibble: 54 × 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1969     4.05    -6.15 -0.559    -8.79
##  2 austria  1973     4.20    -5.90 -0.594    -8.49
##  3 austria  1977     3.93    -5.83 -0.422    -8.25
##  4 belgium  1969     3.85    -5.86 -0.355    -8.52
##  5 belgium  1973     3.90    -5.64 -0.373    -8.31
##  6 belgium  1977     3.85    -5.56 -0.432    -8.14
##  7 canada   1969     4.86    -5.56 -1.04     -8.10
##  8 canada   1973     4.90    -5.41 -1.13     -7.94
##  9 canada   1977     4.81    -5.34 -1.07     -7.77
## 10 denmark  1969     4.17    -5.72 -0.407    -8.47
## # … with 44 more rows</code></pre>
<p><code>%in%</code> tests if an object is part of a set.</p>
</div>
<div id="select-columns-with-select" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Select columns with <code>select()</code><a href="descriptive-statistics-and-data-manipulation.html#select-columns-with-select" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While <code>filter()</code> allows you to keep or discard rows of data, <code>select()</code> allows you to keep or
discard entire columns. To keep columns:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="descriptive-statistics-and-data-manipulation.html#cb311-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb311-2"><a href="descriptive-statistics-and-data-manipulation.html#cb311-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, lrpmg)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 3
##    country  year  lrpmg
##    &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1 austria  1960 -0.335
##  2 austria  1961 -0.351
##  3 austria  1962 -0.380
##  4 austria  1963 -0.414
##  5 austria  1964 -0.445
##  6 austria  1965 -0.497
##  7 austria  1966 -0.467
##  8 austria  1967 -0.506
##  9 austria  1968 -0.522
## 10 austria  1969 -0.559
## # … with 332 more rows</code></pre>
<p>To discard them:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="descriptive-statistics-and-data-manipulation.html#cb313-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb313-2"><a href="descriptive-statistics-and-data-manipulation.html#cb313-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>country, <span class="sc">-</span>year, <span class="sc">-</span>lrpmg)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 3
##    lgaspcar lincomep lcarpcap
##       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1     4.17    -6.47    -9.77
##  2     4.10    -6.43    -9.61
##  3     4.07    -6.41    -9.46
##  4     4.06    -6.37    -9.34
##  5     4.04    -6.32    -9.24
##  6     4.03    -6.29    -9.12
##  7     4.05    -6.25    -9.02
##  8     4.05    -6.23    -8.93
##  9     4.05    -6.21    -8.85
## 10     4.05    -6.15    -8.79
## # … with 332 more rows</code></pre>
<p>To rename them:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="descriptive-statistics-and-data-manipulation.html#cb315-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb315-2"><a href="descriptive-statistics-and-data-manipulation.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, <span class="at">date =</span> year, lrpmg)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 3
##    country  date  lrpmg
##    &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1 austria  1960 -0.335
##  2 austria  1961 -0.351
##  3 austria  1962 -0.380
##  4 austria  1963 -0.414
##  5 austria  1964 -0.445
##  6 austria  1965 -0.497
##  7 austria  1966 -0.467
##  8 austria  1967 -0.506
##  9 austria  1968 -0.522
## 10 austria  1969 -0.559
## # … with 332 more rows</code></pre>
<p>There’s also <code>rename()</code>:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="descriptive-statistics-and-data-manipulation.html#cb317-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb317-2"><a href="descriptive-statistics-and-data-manipulation.html#cb317-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date =</span> year)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
##    country  date lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77
##  2 austria  1961     4.10    -6.43 -0.351    -9.61
##  3 austria  1962     4.07    -6.41 -0.380    -9.46
##  4 austria  1963     4.06    -6.37 -0.414    -9.34
##  5 austria  1964     4.04    -6.32 -0.445    -9.24
##  6 austria  1965     4.03    -6.29 -0.497    -9.12
##  7 austria  1966     4.05    -6.25 -0.467    -9.02
##  8 austria  1967     4.05    -6.23 -0.506    -8.93
##  9 austria  1968     4.05    -6.21 -0.522    -8.85
## 10 austria  1969     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p><code>rename()</code> does not do any kind of selection, but just renames.</p>
<p>You can also use <code>select()</code> to re-order columns:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="descriptive-statistics-and-data-manipulation.html#cb319-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb319-2"><a href="descriptive-statistics-and-data-manipulation.html#cb319-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, country, lrpmg, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
##     year country  lrpmg lgaspcar lincomep lcarpcap
##    &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1  1960 austria -0.335     4.17    -6.47    -9.77
##  2  1961 austria -0.351     4.10    -6.43    -9.61
##  3  1962 austria -0.380     4.07    -6.41    -9.46
##  4  1963 austria -0.414     4.06    -6.37    -9.34
##  5  1964 austria -0.445     4.04    -6.32    -9.24
##  6  1965 austria -0.497     4.03    -6.29    -9.12
##  7  1966 austria -0.467     4.05    -6.25    -9.02
##  8  1967 austria -0.506     4.05    -6.23    -8.93
##  9  1968 austria -0.522     4.05    -6.21    -8.85
## 10  1969 austria -0.559     4.05    -6.15    -8.79
## # … with 332 more rows</code></pre>
<p><code>everything()</code> is a helper function, and there’s also <code>starts_with()</code>, and <code>ends_with()</code>. For
example, what if we are only interested in columns whose name start with “l”?</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="descriptive-statistics-and-data-manipulation.html#cb321-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb321-2"><a href="descriptive-statistics-and-data-manipulation.html#cb321-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;l&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 342 × 4
##    lgaspcar lincomep  lrpmg lcarpcap
##       &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1     4.17    -6.47 -0.335    -9.77
##  2     4.10    -6.43 -0.351    -9.61
##  3     4.07    -6.41 -0.380    -9.46
##  4     4.06    -6.37 -0.414    -9.34
##  5     4.04    -6.32 -0.445    -9.24
##  6     4.03    -6.29 -0.497    -9.12
##  7     4.05    -6.25 -0.467    -9.02
##  8     4.05    -6.23 -0.506    -8.93
##  9     4.05    -6.21 -0.522    -8.85
## 10     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p><code>ends_with()</code> works in a similar fashion. There is also <code>contains()</code>:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="descriptive-statistics-and-data-manipulation.html#cb323-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb323-2"><a href="descriptive-statistics-and-data-manipulation.html#cb323-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, <span class="fu">contains</span>(<span class="st">&quot;car&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 342 × 4
##    country  year lgaspcar lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -9.77
##  2 austria  1961     4.10    -9.61
##  3 austria  1962     4.07    -9.46
##  4 austria  1963     4.06    -9.34
##  5 austria  1964     4.04    -9.24
##  6 austria  1965     4.03    -9.12
##  7 austria  1966     4.05    -9.02
##  8 austria  1967     4.05    -8.93
##  9 austria  1968     4.05    -8.85
## 10 austria  1969     4.05    -8.79
## # … with 332 more rows</code></pre>
<p>Another verb, similar to <code>select()</code>, is <code>pull()</code>. Let’s compare the two:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="descriptive-statistics-and-data-manipulation.html#cb325-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb325-2"><a href="descriptive-statistics-and-data-manipulation.html#cb325-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(lrpmg)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 1
##     lrpmg
##     &lt;dbl&gt;
##  1 -0.335
##  2 -0.351
##  3 -0.380
##  4 -0.414
##  5 -0.445
##  6 -0.497
##  7 -0.467
##  8 -0.506
##  9 -0.522
## 10 -0.559
## # … with 332 more rows</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="descriptive-statistics-and-data-manipulation.html#cb327-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb327-2"><a href="descriptive-statistics-and-data-manipulation.html#cb327-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lrpmg) <span class="sc">%&gt;%</span></span>
<span id="cb327-3"><a href="descriptive-statistics-and-data-manipulation.html#cb327-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="co"># using head() because there&#39;s 337 elements in total</span></span></code></pre></div>
<pre><code>## [1] -0.3345476 -0.3513276 -0.3795177 -0.4142514 -0.4453354 -0.4970607</code></pre>
<p><code>pull()</code>, unlike <code>select()</code>, does not return a <code>tibble</code>, but only the column you want, as a
vector.</p>
</div>
<div id="group-the-observations-of-your-dataset-with-group_by" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Group the observations of your dataset with <code>group_by()</code><a href="descriptive-statistics-and-data-manipulation.html#group-the-observations-of-your-dataset-with-group_by" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>group_by()</code> is a very useful verb; as the name implies, it allows you to create groups and then,
for example, compute descriptive statistics by groups. For example, let’s group our data by
country:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="descriptive-statistics-and-data-manipulation.html#cb329-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb329-2"><a href="descriptive-statistics-and-data-manipulation.html#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77
##  2 austria  1961     4.10    -6.43 -0.351    -9.61
##  3 austria  1962     4.07    -6.41 -0.380    -9.46
##  4 austria  1963     4.06    -6.37 -0.414    -9.34
##  5 austria  1964     4.04    -6.32 -0.445    -9.24
##  6 austria  1965     4.03    -6.29 -0.497    -9.12
##  7 austria  1966     4.05    -6.25 -0.467    -9.02
##  8 austria  1967     4.05    -6.23 -0.506    -8.93
##  9 austria  1968     4.05    -6.21 -0.522    -8.85
## 10 austria  1969     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p>It looks like nothing much happened, but if you look at the second line of the output you can read
the following:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="descriptive-statistics-and-data-manipulation.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   country [18]</span></span></code></pre></div>
<p>this means that the data is grouped, and every computation you will do now will take these groups
into account. It is also possible to group by more than one variable:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="descriptive-statistics-and-data-manipulation.html#cb332-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb332-2"><a href="descriptive-statistics-and-data-manipulation.html#cb332-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
## # Groups:   country, year [342]
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77
##  2 austria  1961     4.10    -6.43 -0.351    -9.61
##  3 austria  1962     4.07    -6.41 -0.380    -9.46
##  4 austria  1963     4.06    -6.37 -0.414    -9.34
##  5 austria  1964     4.04    -6.32 -0.445    -9.24
##  6 austria  1965     4.03    -6.29 -0.497    -9.12
##  7 austria  1966     4.05    -6.25 -0.467    -9.02
##  8 austria  1967     4.05    -6.23 -0.506    -8.93
##  9 austria  1968     4.05    -6.21 -0.522    -8.85
## 10 austria  1969     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p>and so on. You can then also ungroup:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="descriptive-statistics-and-data-manipulation.html#cb334-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb334-2"><a href="descriptive-statistics-and-data-manipulation.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span></span>
<span id="cb334-3"><a href="descriptive-statistics-and-data-manipulation.html#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77
##  2 austria  1961     4.10    -6.43 -0.351    -9.61
##  3 austria  1962     4.07    -6.41 -0.380    -9.46
##  4 austria  1963     4.06    -6.37 -0.414    -9.34
##  5 austria  1964     4.04    -6.32 -0.445    -9.24
##  6 austria  1965     4.03    -6.29 -0.497    -9.12
##  7 austria  1966     4.05    -6.25 -0.467    -9.02
##  8 austria  1967     4.05    -6.23 -0.506    -8.93
##  9 austria  1968     4.05    -6.21 -0.522    -8.85
## 10 austria  1969     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p>Once your data is grouped, the operations that will follow will be executed inside each group.</p>
</div>
<div id="get-summary-statistics-with-summarise" class="section level3 hasAnchor" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> Get summary statistics with <code>summarise()</code><a href="descriptive-statistics-and-data-manipulation.html#get-summary-statistics-with-summarise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ok, now that we have learned the basic verbs, we can start to do more interesting stuff. For
example, one might want to compute the average gasoline consumption in each country, for
the whole period:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="descriptive-statistics-and-data-manipulation.html#cb336-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb336-2"><a href="descriptive-statistics-and-data-manipulation.html#cb336-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb336-3"><a href="descriptive-statistics-and-data-manipulation.html#cb336-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(lgaspcar))</span></code></pre></div>
<pre><code>## # A tibble: 18 × 2
##    country  `mean(lgaspcar)`
##    &lt;chr&gt;               &lt;dbl&gt;
##  1 austria              4.06
##  2 belgium              3.92
##  3 canada               4.86
##  4 denmark              4.19
##  5 france               3.82
##  6 germany              3.89
##  7 greece               4.88
##  8 ireland              4.23
##  9 italy                3.73
## 10 japan                4.70
## 11 netherla             4.08
## 12 norway               4.11
## 13 spain                4.06
## 14 sweden               4.01
## 15 switzerl             4.24
## 16 turkey               5.77
## 17 u.k.                 3.98
## 18 u.s.a.               4.82</code></pre>
<p><code>mean()</code> was given as an argument to <code>summarise()</code>, which is a <code>{dplyr}</code> verb. What we get is
another <code>tibble</code>, that contains the variable we used to group, as well as the average per country.
We can also rename this column:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="descriptive-statistics-and-data-manipulation.html#cb338-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb338-2"><a href="descriptive-statistics-and-data-manipulation.html#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb338-3"><a href="descriptive-statistics-and-data-manipulation.html#cb338-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_gaspcar =</span> <span class="fu">mean</span>(lgaspcar))</span></code></pre></div>
<pre><code>## # A tibble: 18 × 2
##    country  mean_gaspcar
##    &lt;chr&gt;           &lt;dbl&gt;
##  1 austria          4.06
##  2 belgium          3.92
##  3 canada           4.86
##  4 denmark          4.19
##  5 france           3.82
##  6 germany          3.89
##  7 greece           4.88
##  8 ireland          4.23
##  9 italy            3.73
## 10 japan            4.70
## 11 netherla         4.08
## 12 norway           4.11
## 13 spain            4.06
## 14 sweden           4.01
## 15 switzerl         4.24
## 16 turkey           5.77
## 17 u.k.             3.98
## 18 u.s.a.           4.82</code></pre>
<p>and because the output is a <code>tibble</code>, we can continue to use <code>{dplyr}</code> verbs on it:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="descriptive-statistics-and-data-manipulation.html#cb340-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb340-2"><a href="descriptive-statistics-and-data-manipulation.html#cb340-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb340-3"><a href="descriptive-statistics-and-data-manipulation.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_gaspcar =</span> <span class="fu">mean</span>(lgaspcar)) <span class="sc">%&gt;%</span></span>
<span id="cb340-4"><a href="descriptive-statistics-and-data-manipulation.html#cb340-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;france&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   country mean_gaspcar
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 france          3.82</code></pre>
<p><code>summarise()</code> is a very useful verb. For example, we can compute several descriptive statistics at once:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="descriptive-statistics-and-data-manipulation.html#cb342-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb342-2"><a href="descriptive-statistics-and-data-manipulation.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb342-3"><a href="descriptive-statistics-and-data-manipulation.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_gaspcar =</span> <span class="fu">mean</span>(lgaspcar),</span>
<span id="cb342-4"><a href="descriptive-statistics-and-data-manipulation.html#cb342-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_gaspcar =</span> <span class="fu">sd</span>(lgaspcar),</span>
<span id="cb342-5"><a href="descriptive-statistics-and-data-manipulation.html#cb342-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_gaspcar =</span> <span class="fu">max</span>(lgaspcar),</span>
<span id="cb342-6"><a href="descriptive-statistics-and-data-manipulation.html#cb342-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_gaspcar =</span> <span class="fu">min</span>(lgaspcar))</span></code></pre></div>
<pre><code>## # A tibble: 18 × 5
##    country  mean_gaspcar sd_gaspcar max_gaspcar min_gaspcar
##    &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 austria          4.06     0.0693        4.20        3.92
##  2 belgium          3.92     0.103         4.16        3.82
##  3 canada           4.86     0.0262        4.90        4.81
##  4 denmark          4.19     0.158         4.50        4.00
##  5 france           3.82     0.0499        3.91        3.75
##  6 germany          3.89     0.0239        3.93        3.85
##  7 greece           4.88     0.255         5.38        4.48
##  8 ireland          4.23     0.0437        4.33        4.16
##  9 italy            3.73     0.220         4.05        3.38
## 10 japan            4.70     0.684         6.00        3.95
## 11 netherla         4.08     0.286         4.65        3.71
## 12 norway           4.11     0.123         4.44        3.96
## 13 spain            4.06     0.317         4.75        3.62
## 14 sweden           4.01     0.0364        4.07        3.91
## 15 switzerl         4.24     0.102         4.44        4.05
## 16 turkey           5.77     0.329         6.16        5.14
## 17 u.k.             3.98     0.0479        4.10        3.91
## 18 u.s.a.           4.82     0.0219        4.86        4.79</code></pre>
<p>Because the output is a <code>tibble</code>, you can save it in a variable of course:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="descriptive-statistics-and-data-manipulation.html#cb344-1" aria-hidden="true" tabindex="-1"></a>desc_gasoline <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb344-2"><a href="descriptive-statistics-and-data-manipulation.html#cb344-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb344-3"><a href="descriptive-statistics-and-data-manipulation.html#cb344-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_gaspcar =</span> <span class="fu">mean</span>(lgaspcar),</span>
<span id="cb344-4"><a href="descriptive-statistics-and-data-manipulation.html#cb344-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_gaspcar =</span> <span class="fu">sd</span>(lgaspcar),</span>
<span id="cb344-5"><a href="descriptive-statistics-and-data-manipulation.html#cb344-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_gaspcar =</span> <span class="fu">max</span>(lgaspcar),</span>
<span id="cb344-6"><a href="descriptive-statistics-and-data-manipulation.html#cb344-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_gaspcar =</span> <span class="fu">min</span>(lgaspcar))</span></code></pre></div>
<p>And then you can answer questions such as, <em>which country has the maximum average gasoline
consumption?</em>:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="descriptive-statistics-and-data-manipulation.html#cb345-1" aria-hidden="true" tabindex="-1"></a>desc_gasoline <span class="sc">%&gt;%</span></span>
<span id="cb345-2"><a href="descriptive-statistics-and-data-manipulation.html#cb345-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">max</span>(mean_gaspcar) <span class="sc">==</span> mean_gaspcar)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   country mean_gaspcar sd_gaspcar max_gaspcar min_gaspcar
##   &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 turkey          5.77      0.329        6.16        5.14</code></pre>
<p>Turns out it’s Turkey. What about the minimum consumption?</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="descriptive-statistics-and-data-manipulation.html#cb347-1" aria-hidden="true" tabindex="-1"></a>desc_gasoline <span class="sc">%&gt;%</span></span>
<span id="cb347-2"><a href="descriptive-statistics-and-data-manipulation.html#cb347-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">min</span>(mean_gaspcar) <span class="sc">==</span> mean_gaspcar)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   country mean_gaspcar sd_gaspcar max_gaspcar min_gaspcar
##   &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 italy           3.73      0.220        4.05        3.38</code></pre>
<p>Because the output of <code>{dplyr}</code> verbs is a tibble, it is possible to continue working with it. This
is one shortcoming of using the base <code>summary()</code> function. The object returned by that function is
not very easy to manipulate.</p>
</div>
<div id="adding-columns-with-mutate-and-transmute" class="section level3 hasAnchor" number="4.3.6">
<h3><span class="header-section-number">4.3.6</span> Adding columns with <code>mutate()</code> and <code>transmute()</code><a href="descriptive-statistics-and-data-manipulation.html#adding-columns-with-mutate-and-transmute" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>mutate()</code> adds a column to the <code>tibble</code>, which can contain any transformation of any other
variable:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="descriptive-statistics-and-data-manipulation.html#cb349-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb349-2"><a href="descriptive-statistics-and-data-manipulation.html#cb349-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb349-3"><a href="descriptive-statistics-and-data-manipulation.html#cb349-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 342 × 7
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap `n()`
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77    19
##  2 austria  1961     4.10    -6.43 -0.351    -9.61    19
##  3 austria  1962     4.07    -6.41 -0.380    -9.46    19
##  4 austria  1963     4.06    -6.37 -0.414    -9.34    19
##  5 austria  1964     4.04    -6.32 -0.445    -9.24    19
##  6 austria  1965     4.03    -6.29 -0.497    -9.12    19
##  7 austria  1966     4.05    -6.25 -0.467    -9.02    19
##  8 austria  1967     4.05    -6.23 -0.506    -8.93    19
##  9 austria  1968     4.05    -6.21 -0.522    -8.85    19
## 10 austria  1969     4.05    -6.15 -0.559    -8.79    19
## # … with 332 more rows</code></pre>
<p>Using <code>mutate()</code> I’ve added a column that counts how many times the country appears in the <code>tibble</code>,
using <code>n()</code>, another <code>dplyr</code> function. There’s also <code>count()</code> and <code>tally()</code>, which we are going to
see further down. It is also possible to rename the column on the fly:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="descriptive-statistics-and-data-manipulation.html#cb351-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb351-2"><a href="descriptive-statistics-and-data-manipulation.html#cb351-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb351-3"><a href="descriptive-statistics-and-data-manipulation.html#cb351-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 342 × 7
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap count
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77    19
##  2 austria  1961     4.10    -6.43 -0.351    -9.61    19
##  3 austria  1962     4.07    -6.41 -0.380    -9.46    19
##  4 austria  1963     4.06    -6.37 -0.414    -9.34    19
##  5 austria  1964     4.04    -6.32 -0.445    -9.24    19
##  6 austria  1965     4.03    -6.29 -0.497    -9.12    19
##  7 austria  1966     4.05    -6.25 -0.467    -9.02    19
##  8 austria  1967     4.05    -6.23 -0.506    -8.93    19
##  9 austria  1968     4.05    -6.21 -0.522    -8.85    19
## 10 austria  1969     4.05    -6.15 -0.559    -8.79    19
## # … with 332 more rows</code></pre>
<p>It is possible to do any arbitrary operation:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="descriptive-statistics-and-data-manipulation.html#cb353-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb353-2"><a href="descriptive-statistics-and-data-manipulation.html#cb353-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb353-3"><a href="descriptive-statistics-and-data-manipulation.html#cb353-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">spam =</span> <span class="fu">exp</span>(lgaspcar <span class="sc">+</span> lincomep))</span></code></pre></div>
<pre><code>## # A tibble: 342 × 7
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap   spam
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77 0.100 
##  2 austria  1961     4.10    -6.43 -0.351    -9.61 0.0978
##  3 austria  1962     4.07    -6.41 -0.380    -9.46 0.0969
##  4 austria  1963     4.06    -6.37 -0.414    -9.34 0.0991
##  5 austria  1964     4.04    -6.32 -0.445    -9.24 0.102 
##  6 austria  1965     4.03    -6.29 -0.497    -9.12 0.104 
##  7 austria  1966     4.05    -6.25 -0.467    -9.02 0.110 
##  8 austria  1967     4.05    -6.23 -0.506    -8.93 0.113 
##  9 austria  1968     4.05    -6.21 -0.522    -8.85 0.115 
## 10 austria  1969     4.05    -6.15 -0.559    -8.79 0.122 
## # … with 332 more rows</code></pre>
<p><code>transmute()</code> is the same as <code>mutate()</code>, but only returns the created variable:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="descriptive-statistics-and-data-manipulation.html#cb355-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb355-2"><a href="descriptive-statistics-and-data-manipulation.html#cb355-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb355-3"><a href="descriptive-statistics-and-data-manipulation.html#cb355-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">spam =</span> <span class="fu">exp</span>(lgaspcar <span class="sc">+</span> lincomep))</span></code></pre></div>
<pre><code>## # A tibble: 342 × 2
## # Groups:   country [18]
##    country   spam
##    &lt;chr&gt;    &lt;dbl&gt;
##  1 austria 0.100 
##  2 austria 0.0978
##  3 austria 0.0969
##  4 austria 0.0991
##  5 austria 0.102 
##  6 austria 0.104 
##  7 austria 0.110 
##  8 austria 0.113 
##  9 austria 0.115 
## 10 austria 0.122 
## # … with 332 more rows</code></pre>
</div>
<div id="joining-tibbles-with-full_join-left_join-right_join-and-all-the-others" class="section level3 hasAnchor" number="4.3.7">
<h3><span class="header-section-number">4.3.7</span> Joining <code>tibble</code>s with <code>full_join()</code>, <code>left_join()</code>, <code>right_join()</code> and all the others<a href="descriptive-statistics-and-data-manipulation.html#joining-tibbles-with-full_join-left_join-right_join-and-all-the-others" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I will end this section on <code>dplyr</code> with the very useful verbs: the <code>*_join()</code> verbs. Let’s first
start by loading another dataset from the <code>plm</code> package. <code>SumHes</code> and let’s convert it to <code>tibble</code>
and rename it:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="descriptive-statistics-and-data-manipulation.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(SumHes, <span class="at">package =</span> <span class="st">&quot;plm&quot;</span>)</span>
<span id="cb357-2"><a href="descriptive-statistics-and-data-manipulation.html#cb357-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-3"><a href="descriptive-statistics-and-data-manipulation.html#cb357-3" aria-hidden="true" tabindex="-1"></a>pwt <span class="ot">&lt;-</span> SumHes <span class="sc">%&gt;%</span></span>
<span id="cb357-4"><a href="descriptive-statistics-and-data-manipulation.html#cb357-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb357-5"><a href="descriptive-statistics-and-data-manipulation.html#cb357-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">tolower</span>(country))</span></code></pre></div>
<p>Let’s take a quick look at the data:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="descriptive-statistics-and-data-manipulation.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(pwt)</span></code></pre></div>
<pre><code>## Rows: 3,250
## Columns: 7
## $ year    &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 1969, 19…
## $ country &lt;chr&gt; &quot;algeria&quot;, &quot;algeria&quot;, &quot;algeria&quot;, &quot;algeria&quot;, &quot;algeria&quot;, &quot;algeri…
## $ opec    &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no, no…
## $ com     &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no, no…
## $ pop     &lt;int&gt; 10800, 11016, 11236, 11460, 11690, 11923, 12267, 12622, 12986,…
## $ gdp     &lt;int&gt; 1723, 1599, 1275, 1517, 1589, 1584, 1548, 1600, 1758, 1835, 18…
## $ sr      &lt;dbl&gt; 19.9, 21.1, 15.0, 13.9, 10.6, 11.0, 8.3, 11.3, 15.1, 18.2, 19.…</code></pre>
<p>We can merge both <code>gasoline</code> and <code>pwt</code> by country and year, as these two variables are common to
both datasets. There are more countries and years in the <code>pwt</code> dataset, so when merging both, and
depending on which function you use, you will either have <code>NA</code>’s for the variables where there is
no match, or rows that will be dropped. Let’s start with <code>full_join</code>:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="descriptive-statistics-and-data-manipulation.html#cb360-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_full <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb360-2"><a href="descriptive-statistics-and-data-manipulation.html#cb360-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(pwt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</span></code></pre></div>
<p>Let’s see which countries and years are included:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="descriptive-statistics-and-data-manipulation.html#cb361-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_full <span class="sc">%&gt;%</span></span>
<span id="cb361-2"><a href="descriptive-statistics-and-data-manipulation.html#cb361-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(country, year)</span></code></pre></div>
<pre><code>## # A tibble: 3,307 × 3
##    country  year     n
##    &lt;chr&gt;   &lt;int&gt; &lt;int&gt;
##  1 algeria  1960     1
##  2 algeria  1961     1
##  3 algeria  1962     1
##  4 algeria  1963     1
##  5 algeria  1964     1
##  6 algeria  1965     1
##  7 algeria  1966     1
##  8 algeria  1967     1
##  9 algeria  1968     1
## 10 algeria  1969     1
## # … with 3,297 more rows</code></pre>
<p>As you see, every country and year was included, but what happened for, say, the U.S.S.R? This country
is in <code>pwt</code> but not in <code>gasoline</code> at all:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="descriptive-statistics-and-data-manipulation.html#cb363-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_full <span class="sc">%&gt;%</span></span>
<span id="cb363-2"><a href="descriptive-statistics-and-data-manipulation.html#cb363-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;u.s.s.r.&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 26 × 11
##    country  year lgaspcar lincomep lrpmg lcarpcap opec  com      pop   gdp    sr
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;  &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1 u.s.s.…  1960       NA       NA    NA       NA no    yes   214400  2397  37.9
##  2 u.s.s.…  1961       NA       NA    NA       NA no    yes   217896  2542  39.4
##  3 u.s.s.…  1962       NA       NA    NA       NA no    yes   221449  2656  38.4
##  4 u.s.s.…  1963       NA       NA    NA       NA no    yes   225060  2681  38.4
##  5 u.s.s.…  1964       NA       NA    NA       NA no    yes   227571  2854  39.5
##  6 u.s.s.…  1965       NA       NA    NA       NA no    yes   230109  3049  39.9
##  7 u.s.s.…  1966       NA       NA    NA       NA no    yes   232676  3247  39.9
##  8 u.s.s.…  1967       NA       NA    NA       NA no    yes   235272  3454  40.2
##  9 u.s.s.…  1968       NA       NA    NA       NA no    yes   237896  3730  40.6
## 10 u.s.s.…  1969       NA       NA    NA       NA no    yes   240550  3808  37.9
## # … with 16 more rows</code></pre>
<p>As you probably guessed, the variables from <code>gasoline</code> that are not included in <code>pwt</code> are filled with
<code>NA</code>s. One could remove all these lines and only keep countries for which these variables are not
<code>NA</code> everywhere with <code>filter()</code>, but there is a simpler solution:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="descriptive-statistics-and-data-manipulation.html#cb365-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_inner <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb365-2"><a href="descriptive-statistics-and-data-manipulation.html#cb365-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(pwt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</span></code></pre></div>
<p>Let’s use the <code>tabyl()</code> from the <code>janitor</code> packages which is a very nice alternative to the <code>table()</code>
function from base R:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="descriptive-statistics-and-data-manipulation.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb366-2"><a href="descriptive-statistics-and-data-manipulation.html#cb366-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-3"><a href="descriptive-statistics-and-data-manipulation.html#cb366-3" aria-hidden="true" tabindex="-1"></a>gas_pwt_inner <span class="sc">%&gt;%</span></span>
<span id="cb366-4"><a href="descriptive-statistics-and-data-manipulation.html#cb366-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(country)</span></code></pre></div>
<pre><code>##  country  n    percent
##  austria 19 0.06666667
##  belgium 19 0.06666667
##   canada 19 0.06666667
##  denmark 19 0.06666667
##   france 19 0.06666667
##   greece 19 0.06666667
##  ireland 19 0.06666667
##    italy 19 0.06666667
##    japan 19 0.06666667
##   norway 19 0.06666667
##    spain 19 0.06666667
##   sweden 19 0.06666667
##   turkey 19 0.06666667
##     u.k. 19 0.06666667
##   u.s.a. 19 0.06666667</code></pre>
<p>Only countries with values in both datasets were returned. It’s almost every country from <code>gasoline</code>,
apart from Germany (called “germany west” in <code>pwt</code> and “germany” in <code>gasoline</code>. I left it as is to
provide an example of a country not in <code>pwt</code>). Let’s also look at the variables:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="descriptive-statistics-and-data-manipulation.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gas_pwt_inner)</span></code></pre></div>
<pre><code>## Rows: 285
## Columns: 11
## $ country  &lt;chr&gt; &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austr…
## $ year     &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 1969, 1…
## $ lgaspcar &lt;dbl&gt; 4.173244, 4.100989, 4.073177, 4.059509, 4.037689, 4.033983, 4…
## $ lincomep &lt;dbl&gt; -6.474277, -6.426006, -6.407308, -6.370679, -6.322247, -6.294…
## $ lrpmg    &lt;dbl&gt; -0.3345476, -0.3513276, -0.3795177, -0.4142514, -0.4453354, -…
## $ lcarpcap &lt;dbl&gt; -9.766840, -9.608622, -9.457257, -9.343155, -9.237739, -9.123…
## $ opec     &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no, n…
## $ com      &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no, n…
## $ pop      &lt;int&gt; 7048, 7087, 7130, 7172, 7215, 7255, 7308, 7338, 7362, 7384, 7…
## $ gdp      &lt;int&gt; 5143, 5388, 5481, 5688, 5978, 6144, 6437, 6596, 6847, 7162, 7…
## $ sr       &lt;dbl&gt; 24.3, 24.5, 23.3, 22.9, 25.2, 25.2, 26.7, 25.6, 25.7, 26.1, 2…</code></pre>
<p>The variables from both datasets are in the joined data.</p>
<p>Contrast this to <code>semi_join()</code>:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="descriptive-statistics-and-data-manipulation.html#cb370-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_semi <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb370-2"><a href="descriptive-statistics-and-data-manipulation.html#cb370-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(pwt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</span>
<span id="cb370-3"><a href="descriptive-statistics-and-data-manipulation.html#cb370-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-4"><a href="descriptive-statistics-and-data-manipulation.html#cb370-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gas_pwt_semi)</span></code></pre></div>
<pre><code>## Rows: 285
## Columns: 6
## $ country  &lt;chr&gt; &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austr…
## $ year     &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 1969, 1…
## $ lgaspcar &lt;dbl&gt; 4.173244, 4.100989, 4.073177, 4.059509, 4.037689, 4.033983, 4…
## $ lincomep &lt;dbl&gt; -6.474277, -6.426006, -6.407308, -6.370679, -6.322247, -6.294…
## $ lrpmg    &lt;dbl&gt; -0.3345476, -0.3513276, -0.3795177, -0.4142514, -0.4453354, -…
## $ lcarpcap &lt;dbl&gt; -9.766840, -9.608622, -9.457257, -9.343155, -9.237739, -9.123…</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="descriptive-statistics-and-data-manipulation.html#cb372-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_semi <span class="sc">%&gt;%</span></span>
<span id="cb372-2"><a href="descriptive-statistics-and-data-manipulation.html#cb372-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(country)</span></code></pre></div>
<pre><code>##  country  n    percent
##  austria 19 0.06666667
##  belgium 19 0.06666667
##   canada 19 0.06666667
##  denmark 19 0.06666667
##   france 19 0.06666667
##   greece 19 0.06666667
##  ireland 19 0.06666667
##    italy 19 0.06666667
##    japan 19 0.06666667
##   norway 19 0.06666667
##    spain 19 0.06666667
##   sweden 19 0.06666667
##   turkey 19 0.06666667
##     u.k. 19 0.06666667
##   u.s.a. 19 0.06666667</code></pre>
<p>Only columns of <code>gasoline</code> are returned, and only rows of <code>gasoline</code> that were matched with rows
from <code>pwt</code>. <code>semi_join()</code> is not a commutative operation:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="descriptive-statistics-and-data-manipulation.html#cb374-1" aria-hidden="true" tabindex="-1"></a>pwt_gas_semi <span class="ot">&lt;-</span> pwt <span class="sc">%&gt;%</span></span>
<span id="cb374-2"><a href="descriptive-statistics-and-data-manipulation.html#cb374-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(gasoline, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</span>
<span id="cb374-3"><a href="descriptive-statistics-and-data-manipulation.html#cb374-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-4"><a href="descriptive-statistics-and-data-manipulation.html#cb374-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(pwt_gas_semi)</span></code></pre></div>
<pre><code>## Rows: 285
## Columns: 7
## $ year    &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 1969, 19…
## $ country &lt;chr&gt; &quot;canada&quot;, &quot;canada&quot;, &quot;canada&quot;, &quot;canada&quot;, &quot;canada&quot;, &quot;canada&quot;, &quot;c…
## $ opec    &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no, no…
## $ com     &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no, no…
## $ pop     &lt;int&gt; 17910, 18270, 18614, 18963, 19326, 19678, 20049, 20411, 20744,…
## $ gdp     &lt;int&gt; 7258, 7261, 7605, 7876, 8244, 8664, 9093, 9231, 9582, 9975, 10…
## $ sr      &lt;dbl&gt; 22.7, 21.5, 22.1, 21.9, 22.9, 24.8, 25.4, 23.1, 22.6, 23.4, 21…</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="descriptive-statistics-and-data-manipulation.html#cb376-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_semi <span class="sc">%&gt;%</span></span>
<span id="cb376-2"><a href="descriptive-statistics-and-data-manipulation.html#cb376-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(country)</span></code></pre></div>
<pre><code>##  country  n    percent
##  austria 19 0.06666667
##  belgium 19 0.06666667
##   canada 19 0.06666667
##  denmark 19 0.06666667
##   france 19 0.06666667
##   greece 19 0.06666667
##  ireland 19 0.06666667
##    italy 19 0.06666667
##    japan 19 0.06666667
##   norway 19 0.06666667
##    spain 19 0.06666667
##   sweden 19 0.06666667
##   turkey 19 0.06666667
##     u.k. 19 0.06666667
##   u.s.a. 19 0.06666667</code></pre>
<p>The rows are the same, but not the columns.</p>
<p><code>left_join()</code> and <code>right_join()</code> return all the rows from either the dataset that is on the
“left” (the first argument of the fonction) or on the “right” (the second argument of the
function) but all columns from both datasets. So depending on which countries you’re interested in,
you’re going to use either one of these functions:</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="descriptive-statistics-and-data-manipulation.html#cb378-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_left <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb378-2"><a href="descriptive-statistics-and-data-manipulation.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pwt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</span>
<span id="cb378-3"><a href="descriptive-statistics-and-data-manipulation.html#cb378-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-4"><a href="descriptive-statistics-and-data-manipulation.html#cb378-4" aria-hidden="true" tabindex="-1"></a>gas_pwt_left <span class="sc">%&gt;%</span></span>
<span id="cb378-5"><a href="descriptive-statistics-and-data-manipulation.html#cb378-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(country)</span></code></pre></div>
<pre><code>##   country  n    percent
##   austria 19 0.05555556
##   belgium 19 0.05555556
##    canada 19 0.05555556
##   denmark 19 0.05555556
##    france 19 0.05555556
##   germany 19 0.05555556
##    greece 19 0.05555556
##   ireland 19 0.05555556
##     italy 19 0.05555556
##     japan 19 0.05555556
##  netherla 19 0.05555556
##    norway 19 0.05555556
##     spain 19 0.05555556
##    sweden 19 0.05555556
##  switzerl 19 0.05555556
##    turkey 19 0.05555556
##      u.k. 19 0.05555556
##    u.s.a. 19 0.05555556</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="descriptive-statistics-and-data-manipulation.html#cb380-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_right <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb380-2"><a href="descriptive-statistics-and-data-manipulation.html#cb380-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(pwt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</span>
<span id="cb380-3"><a href="descriptive-statistics-and-data-manipulation.html#cb380-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-4"><a href="descriptive-statistics-and-data-manipulation.html#cb380-4" aria-hidden="true" tabindex="-1"></a>gas_pwt_right <span class="sc">%&gt;%</span></span>
<span id="cb380-5"><a href="descriptive-statistics-and-data-manipulation.html#cb380-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb380-6"><a href="descriptive-statistics-and-data-manipulation.html#cb380-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##     country  n percent
##     algeria 26   0.008
##      angola 26   0.008
##   argentina 26   0.008
##   australia 26   0.008
##     austria 26   0.008
##  bangladesh 26   0.008</code></pre>
<p>The last merge function is <code>anti_join()</code>:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="descriptive-statistics-and-data-manipulation.html#cb382-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_anti <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb382-2"><a href="descriptive-statistics-and-data-manipulation.html#cb382-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(pwt, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</span>
<span id="cb382-3"><a href="descriptive-statistics-and-data-manipulation.html#cb382-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-4"><a href="descriptive-statistics-and-data-manipulation.html#cb382-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gas_pwt_anti)</span></code></pre></div>
<pre><code>## Rows: 57
## Columns: 6
## $ country  &lt;chr&gt; &quot;germany&quot;, &quot;germany&quot;, &quot;germany&quot;, &quot;germany&quot;, &quot;germany&quot;, &quot;germa…
## $ year     &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 1969, 1…
## $ lgaspcar &lt;dbl&gt; 3.916953, 3.885345, 3.871484, 3.848782, 3.868993, 3.861049, 3…
## $ lincomep &lt;dbl&gt; -6.159837, -6.120923, -6.094258, -6.068361, -6.013442, -5.966…
## $ lrpmg    &lt;dbl&gt; -0.1859108, -0.2309538, -0.3438417, -0.3746467, -0.3996526, -…
## $ lcarpcap &lt;dbl&gt; -9.342481, -9.183841, -9.037280, -8.913630, -8.811013, -8.711…</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="descriptive-statistics-and-data-manipulation.html#cb384-1" aria-hidden="true" tabindex="-1"></a>gas_pwt_anti <span class="sc">%&gt;%</span></span>
<span id="cb384-2"><a href="descriptive-statistics-and-data-manipulation.html#cb384-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(country)</span></code></pre></div>
<pre><code>##   country  n   percent
##   germany 19 0.3333333
##  netherla 19 0.3333333
##  switzerl 19 0.3333333</code></pre>
<p><code>gas_pwt_anti</code> has the columns the <code>gasoline</code> dataset as well as the only country from <code>gasoline</code>
that is not in <code>pwt</code>: “germany”.</p>
<p>That was it for the basic <code>{dplyr}</code> verbs. Next, we’re going to learn about <code>{tidyr}</code>.</p>
</div>
</div>
<div id="reshaping-and-sprucing-up-data-with-tidyr" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Reshaping and sprucing up data with <code>{tidyr}</code><a href="descriptive-statistics-and-data-manipulation.html#reshaping-and-sprucing-up-data-with-tidyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Note: this section is going to be a lot harder than anything you’ve seen until now. Reshaping
data is tricky, and to really grok it, you need time, and you need to run each line, and see what
happens. Take your time, and don’t be discouraged.</p>
<p>Another important package from the <code>{tidyverse}</code> that goes hand in hand with <code>{dplyr}</code> is <code>{tidyr}</code>.
<code>{tidyr}</code> is the package you need when it’s time to reshape data.</p>
<p>I will start by presenting <code>pivot_wider()</code> and <code>pivot_longer()</code>.</p>
<div id="pivot_wider-and-pivot_longer" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> <code>pivot_wider()</code> and <code>pivot_longer()</code><a href="descriptive-statistics-and-data-manipulation.html#pivot_wider-and-pivot_longer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s first create a fake dataset:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="descriptive-statistics-and-data-manipulation.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code></pre></div>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="descriptive-statistics-and-data-manipulation.html#cb387-1" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb387-2"><a href="descriptive-statistics-and-data-manipulation.html#cb387-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id, <span class="sc">~</span>variable, <span class="sc">~</span>value,</span>
<span id="cb387-3"><a href="descriptive-statistics-and-data-manipulation.html#cb387-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&quot;var1&quot;</span>, <span class="dv">1</span>,</span>
<span id="cb387-4"><a href="descriptive-statistics-and-data-manipulation.html#cb387-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">0.2</span>,</span>
<span id="cb387-5"><a href="descriptive-statistics-and-data-manipulation.html#cb387-5" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>, <span class="st">&quot;var3&quot;</span>, <span class="fl">0.3</span>,</span>
<span id="cb387-6"><a href="descriptive-statistics-and-data-manipulation.html#cb387-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;var1&quot;</span>, <span class="fl">1.4</span>,</span>
<span id="cb387-7"><a href="descriptive-statistics-and-data-manipulation.html#cb387-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">1.9</span>,</span>
<span id="cb387-8"><a href="descriptive-statistics-and-data-manipulation.html#cb387-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;var3&quot;</span>, <span class="fl">4.1</span>,</span>
<span id="cb387-9"><a href="descriptive-statistics-and-data-manipulation.html#cb387-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">&quot;var1&quot;</span>, <span class="fl">0.1</span>,</span>
<span id="cb387-10"><a href="descriptive-statistics-and-data-manipulation.html#cb387-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">2.8</span>,</span>
<span id="cb387-11"><a href="descriptive-statistics-and-data-manipulation.html#cb387-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">&quot;var3&quot;</span>, <span class="fl">8.9</span>,</span>
<span id="cb387-12"><a href="descriptive-statistics-and-data-manipulation.html#cb387-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="st">&quot;var1&quot;</span>, <span class="fl">1.7</span>,</span>
<span id="cb387-13"><a href="descriptive-statistics-and-data-manipulation.html#cb387-13" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">1.9</span>,</span>
<span id="cb387-14"><a href="descriptive-statistics-and-data-manipulation.html#cb387-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="st">&quot;var3&quot;</span>, <span class="fl">7.6</span></span>
<span id="cb387-15"><a href="descriptive-statistics-and-data-manipulation.html#cb387-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb387-16"><a href="descriptive-statistics-and-data-manipulation.html#cb387-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-17"><a href="descriptive-statistics-and-data-manipulation.html#cb387-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survey_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##      id variable value
##   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1     1 var1       1  
## 2     1 var2       0.2
## 3    NA var3       0.3
## 4     2 var1       1.4
## 5     2 var2       1.9
## 6     2 var3       4.1</code></pre>
<p>I used the <code>tribble()</code> function from the <code>{tibble}</code> package to create this fake dataset.
I’ll discuss this package later, for now, let’s focus on <code>{tidyr}.</code></p>
<p>Let’s suppose that we need the data to be in the wide format which means <code>var1</code>, <code>var2</code> and <code>var3</code>
need to be their own columns. To do this, we need to use the <code>pivot_wider()</code> function. Why <em>wide</em>?
Because the data set will be wide, meaning, having more columns than rows.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="descriptive-statistics-and-data-manipulation.html#cb389-1" aria-hidden="true" tabindex="-1"></a>survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb389-2"><a href="descriptive-statistics-and-data-manipulation.html#cb389-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> id,</span>
<span id="cb389-3"><a href="descriptive-statistics-and-data-manipulation.html#cb389-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> variable,</span>
<span id="cb389-4"><a href="descriptive-statistics-and-data-manipulation.html#cb389-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> value)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
##      id  var1  var2  var3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1   1     0.2  NA  
## 2    NA  NA     1.9   0.3
## 3     2   1.4   1.9   4.1
## 4     3   0.1   2.8   8.9
## 5     4   1.7  NA     7.6</code></pre>
<p>Let’s go through <code>pivot_wider()</code>’s arguments: the first is <code>id_cols =</code> which requires the variable
that uniquely identifies the rows to be supplied. <code>names_from =</code> is where you input the variable that will
generate the names of the new columns. In our case, the <code>variable</code> colmuns has three values; <code>var1</code>,
<code>var2</code> and <code>var3</code>, and these are now the names of the new columns. Finally, <code>values_from =</code> is where
you can specify the column containing the values that will fill the data frame.
I find the argument names <code>names_from =</code> and <code>values_from =</code> quite explicit.</p>
<p>As you can see, there are some missing values. Let’s suppose that we know that these missing values
are true 0’s. <code>pivot_wider()</code> has an argument called <code>values_fill =</code> that makes it easy to replace
the missing values:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="descriptive-statistics-and-data-manipulation.html#cb391-1" aria-hidden="true" tabindex="-1"></a>survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb391-2"><a href="descriptive-statistics-and-data-manipulation.html#cb391-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> id,</span>
<span id="cb391-3"><a href="descriptive-statistics-and-data-manipulation.html#cb391-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> variable,</span>
<span id="cb391-4"><a href="descriptive-statistics-and-data-manipulation.html#cb391-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> value,</span>
<span id="cb391-5"><a href="descriptive-statistics-and-data-manipulation.html#cb391-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fill =</span> <span class="fu">list</span>(<span class="at">value =</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
##      id  var1  var2  var3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1   1     0.2   0  
## 2    NA   0     1.9   0.3
## 3     2   1.4   1.9   4.1
## 4     3   0.1   2.8   8.9
## 5     4   1.7   0     7.6</code></pre>
<p>A list of variables and their respective values to replace NA’s with must be supplied to <code>values_fill</code>.</p>
<p>Let’s now use another dataset, which you can get from
<a href="https://github.com/b-rodrigues/modern_R/tree/master/datasets/unemployment/all">here</a>
(downloaded from: <a href="http://www.statistiques.public.lu/stat/TableViewer/tableView.aspx?ReportId=12950&amp;IF_Language=eng&amp;MainTheme=2&amp;FldrName=3&amp;RFPath=91" class="uri">http://www.statistiques.public.lu/stat/TableViewer/tableView.aspx?ReportId=12950&amp;IF_Language=eng&amp;MainTheme=2&amp;FldrName=3&amp;RFPath=91</a>). This data set gives the unemployment rate for each Luxembourguish
canton from 2001 to 2015. We will come back to this data later on to learn how to plot it. For now,
let’s use it to learn more about <code>{tidyr}</code>.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="descriptive-statistics-and-data-manipulation.html#cb393-1" aria-hidden="true" tabindex="-1"></a>unemp_lux_data <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(</span>
<span id="cb393-2"><a href="descriptive-statistics-and-data-manipulation.html#cb393-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;https://raw.githubusercontent.com/b-rodrigues/modern_R/master/datasets/unemployment/all/unemployment_lux_all.csv&quot;</span></span>
<span id="cb393-3"><a href="descriptive-statistics-and-data-manipulation.html#cb393-3" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb393-4"><a href="descriptive-statistics-and-data-manipulation.html#cb393-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-5"><a href="descriptive-statistics-and-data-manipulation.html#cb393-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(unemp_lux_data)</span></code></pre></div>
<pre><code>##   division year active_population of_which_non_wage_earners
## 1 Beaufort 2001               688                        85
## 2 Beaufort 2002               742                        85
## 3 Beaufort 2003               773                        85
## 4 Beaufort 2004               828                        80
## 5 Beaufort 2005               866                        96
## 6 Beaufort 2006               893                        87
##   of_which_wage_earners total_employed_population unemployed
## 1                   568                       653         35
## 2                   631                       716         26
## 3                   648                       733         40
## 4                   706                       786         42
## 5                   719                       815         51
## 6                   746                       833         60
##   unemployment_rate_in_percent
## 1                         5.09
## 2                         3.50
## 3                         5.17
## 4                         5.07
## 5                         5.89
## 6                         6.72</code></pre>
<p>Now, let’s suppose that for our purposes, it would make more sense to have the data in a wide format,
where columns are “divison times year” and the value is the unemployment rate. This can be easily done
with providing more columns to <code>names_from =</code>.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="descriptive-statistics-and-data-manipulation.html#cb395-1" aria-hidden="true" tabindex="-1"></a>unemp_lux_data2 <span class="ot">&lt;-</span> unemp_lux_data <span class="sc">%&gt;%</span> </span>
<span id="cb395-2"><a href="descriptive-statistics-and-data-manipulation.html#cb395-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">2013</span>, <span class="dv">2017</span>),</span>
<span id="cb395-3"><a href="descriptive-statistics-and-data-manipulation.html#cb395-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">str_detect</span>(division, <span class="st">&quot;.*ange$&quot;</span>),</span>
<span id="cb395-4"><a href="descriptive-statistics-and-data-manipulation.html#cb395-4" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">str_detect</span>(division, <span class="st">&quot;.*Canton.*&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb395-5"><a href="descriptive-statistics-and-data-manipulation.html#cb395-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(division, year, unemployment_rate_in_percent) <span class="sc">%&gt;%</span> </span>
<span id="cb395-6"><a href="descriptive-statistics-and-data-manipulation.html#cb395-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>()</span>
<span id="cb395-7"><a href="descriptive-statistics-and-data-manipulation.html#cb395-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-8"><a href="descriptive-statistics-and-data-manipulation.html#cb395-8" aria-hidden="true" tabindex="-1"></a>unemp_lux_data2 <span class="sc">%&gt;%</span> </span>
<span id="cb395-9"><a href="descriptive-statistics-and-data-manipulation.html#cb395-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(division, year),</span>
<span id="cb395-10"><a href="descriptive-statistics-and-data-manipulation.html#cb395-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> unemployment_rate_in_percent)</span></code></pre></div>
<pre><code>## # A tibble: 48 × 49
##    rowid Bertrange_2013 Bertrange_2014 Bertrange_2015 Differdange_2013
##    &lt;int&gt;          &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;
##  1     1           5.69          NA             NA                NA  
##  2     2          NA              5.65          NA                NA  
##  3     3          NA             NA              5.35             NA  
##  4     4          NA             NA             NA                13.2
##  5     5          NA             NA             NA                NA  
##  6     6          NA             NA             NA                NA  
##  7     7          NA             NA             NA                NA  
##  8     8          NA             NA             NA                NA  
##  9     9          NA             NA             NA                NA  
## 10    10          NA             NA             NA                NA  
## # … with 38 more rows, and 44 more variables: Differdange_2014 &lt;dbl&gt;,
## #   Differdange_2015 &lt;dbl&gt;, Dudelange_2013 &lt;dbl&gt;, Dudelange_2014 &lt;dbl&gt;,
## #   Dudelange_2015 &lt;dbl&gt;, Frisange_2013 &lt;dbl&gt;, Frisange_2014 &lt;dbl&gt;,
## #   Frisange_2015 &lt;dbl&gt;, Hesperange_2013 &lt;dbl&gt;, Hesperange_2014 &lt;dbl&gt;,
## #   Hesperange_2015 &lt;dbl&gt;, Leudelange_2013 &lt;dbl&gt;, Leudelange_2014 &lt;dbl&gt;,
## #   Leudelange_2015 &lt;dbl&gt;, Mondercange_2013 &lt;dbl&gt;, Mondercange_2014 &lt;dbl&gt;,
## #   Mondercange_2015 &lt;dbl&gt;, Pétange_2013 &lt;dbl&gt;, Pétange_2014 &lt;dbl&gt;, …</code></pre>
<p>In the <code>filter()</code> statement, I only kept data from 2013 to 2017, “division”s ending with the string
“ange” (“division” can be a canton or a commune, for example “Canton Redange”, a canton, or
“Hesperange” a commune), and removed the cantons as I’m only interested in communes. If you don’t
understand this <code>filter()</code> statement, don’t fret; this is not important for what follows. I then
only kept the columns I’m interested in and pivoted the data to a wide format. Also, I needed to
add a unique identifier to the data frame. For this, I used <code>rowid_to_column()</code> function, from the
<code>{tibble}</code> package, which adds a new column to the data frame with an id, going from 1 to the
number of rows in the data frame. If I did not add this identifier, the statement would work still:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="descriptive-statistics-and-data-manipulation.html#cb397-1" aria-hidden="true" tabindex="-1"></a>unemp_lux_data3 <span class="ot">&lt;-</span> unemp_lux_data <span class="sc">%&gt;%</span> </span>
<span id="cb397-2"><a href="descriptive-statistics-and-data-manipulation.html#cb397-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">2013</span>, <span class="dv">2017</span>), <span class="fu">str_detect</span>(division, <span class="st">&quot;.*ange$&quot;</span>), <span class="sc">!</span><span class="fu">str_detect</span>(division, <span class="st">&quot;.*Canton.*&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb397-3"><a href="descriptive-statistics-and-data-manipulation.html#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(division, year, unemployment_rate_in_percent)</span>
<span id="cb397-4"><a href="descriptive-statistics-and-data-manipulation.html#cb397-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-5"><a href="descriptive-statistics-and-data-manipulation.html#cb397-5" aria-hidden="true" tabindex="-1"></a>unemp_lux_data3 <span class="sc">%&gt;%</span> </span>
<span id="cb397-6"><a href="descriptive-statistics-and-data-manipulation.html#cb397-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(division, year), <span class="at">values_from =</span> unemployment_rate_in_percent)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 48
##   Bertrange_2013 Bertrange_2014 Bertrange_2015 Differdange_2013 Differdange_2014
##            &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1           5.69           5.65           5.35             13.2             12.6
## # … with 43 more variables: Differdange_2015 &lt;dbl&gt;, Dudelange_2013 &lt;dbl&gt;,
## #   Dudelange_2014 &lt;dbl&gt;, Dudelange_2015 &lt;dbl&gt;, Frisange_2013 &lt;dbl&gt;,
## #   Frisange_2014 &lt;dbl&gt;, Frisange_2015 &lt;dbl&gt;, Hesperange_2013 &lt;dbl&gt;,
## #   Hesperange_2014 &lt;dbl&gt;, Hesperange_2015 &lt;dbl&gt;, Leudelange_2013 &lt;dbl&gt;,
## #   Leudelange_2014 &lt;dbl&gt;, Leudelange_2015 &lt;dbl&gt;, Mondercange_2013 &lt;dbl&gt;,
## #   Mondercange_2014 &lt;dbl&gt;, Mondercange_2015 &lt;dbl&gt;, Pétange_2013 &lt;dbl&gt;,
## #   Pétange_2014 &lt;dbl&gt;, Pétange_2015 &lt;dbl&gt;, Rumelange_2013 &lt;dbl&gt;, …</code></pre>
<p>and actually look even better, but only because there are no repeated values; there is only one
unemployment rate for each “commune times year”. I will come back to this later on, with another
example that might be clearer. These last two code blocks are intense; make sure you go through
each lien step by step and understand what is going on.</p>
<p>You might have noticed that because there is no data for the years 2016 and 2017, these columns do
not appear in the data. But suppose that we need to have these columns, so that a colleague from
another department can fill in the values. This is possible by providing a data frame with the
detailed specifications of the result data frame. This optional data frame must have at least two
columns, <code>.name</code>, which are the column names you want, and <code>.value</code> which contains the values.
Also, the function that uses this spec is a <code>pivot_wider_spec()</code>, and not <code>pivot_wider()</code>.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="descriptive-statistics-and-data-manipulation.html#cb399-1" aria-hidden="true" tabindex="-1"></a>unemp_spec <span class="ot">&lt;-</span> unemp_lux_data <span class="sc">%&gt;%</span> </span>
<span id="cb399-2"><a href="descriptive-statistics-and-data-manipulation.html#cb399-2" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(division,</span>
<span id="cb399-3"><a href="descriptive-statistics-and-data-manipulation.html#cb399-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">c</span>(year, <span class="dv">2016</span>, <span class="dv">2017</span>),</span>
<span id="cb399-4"><a href="descriptive-statistics-and-data-manipulation.html#cb399-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.value =</span> <span class="st">&quot;unemployment_rate_in_percent&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb399-5"><a href="descriptive-statistics-and-data-manipulation.html#cb399-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">&quot;.name&quot;</span>, division, year, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb399-6"><a href="descriptive-statistics-and-data-manipulation.html#cb399-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-7"><a href="descriptive-statistics-and-data-manipulation.html#cb399-7" aria-hidden="true" tabindex="-1"></a>unemp_spec</span></code></pre></div>
<p>Here, I use another function, <code>tidyr::expand()</code>, which returns every combinations (cartesian product)
of every variable from a dataset.</p>
<p>To make it work, we still need to create a column that uniquely identifies each row in the data:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="descriptive-statistics-and-data-manipulation.html#cb400-1" aria-hidden="true" tabindex="-1"></a>unemp_lux_data4 <span class="ot">&lt;-</span> unemp_lux_data <span class="sc">%&gt;%</span> </span>
<span id="cb400-2"><a href="descriptive-statistics-and-data-manipulation.html#cb400-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(division, year, unemployment_rate_in_percent) <span class="sc">%&gt;%</span> </span>
<span id="cb400-3"><a href="descriptive-statistics-and-data-manipulation.html#cb400-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb400-4"><a href="descriptive-statistics-and-data-manipulation.html#cb400-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider_spec</span>(<span class="at">spec =</span> unemp_spec) </span>
<span id="cb400-5"><a href="descriptive-statistics-and-data-manipulation.html#cb400-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-6"><a href="descriptive-statistics-and-data-manipulation.html#cb400-6" aria-hidden="true" tabindex="-1"></a>unemp_lux_data4</span></code></pre></div>
<pre><code>## # A tibble: 1,770 × 2,007
##    rowid Beaufort_2001 Beaufort_2002 Beaufort_2003 Beaufort_2004 Beaufort_2005
##    &lt;int&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
##  1     1          5.09          NA           NA            NA            NA   
##  2     2         NA              3.5         NA            NA            NA   
##  3     3         NA             NA            5.17         NA            NA   
##  4     4         NA             NA           NA             5.07         NA   
##  5     5         NA             NA           NA            NA             5.89
##  6     6         NA             NA           NA            NA            NA   
##  7     7         NA             NA           NA            NA            NA   
##  8     8         NA             NA           NA            NA            NA   
##  9     9         NA             NA           NA            NA            NA   
## 10    10         NA             NA           NA            NA            NA   
## # … with 1,760 more rows, and 2,001 more variables: Beaufort_2006 &lt;dbl&gt;,
## #   Beaufort_2007 &lt;dbl&gt;, Beaufort_2008 &lt;dbl&gt;, Beaufort_2009 &lt;dbl&gt;,
## #   Beaufort_2010 &lt;dbl&gt;, Beaufort_2011 &lt;dbl&gt;, Beaufort_2012 &lt;dbl&gt;,
## #   Beaufort_2013 &lt;dbl&gt;, Beaufort_2014 &lt;dbl&gt;, Beaufort_2015 &lt;dbl&gt;,
## #   Beaufort_2016 &lt;dbl&gt;, Beaufort_2017 &lt;dbl&gt;, Bech_2001 &lt;dbl&gt;, Bech_2002 &lt;dbl&gt;,
## #   Bech_2003 &lt;dbl&gt;, Bech_2004 &lt;dbl&gt;, Bech_2005 &lt;dbl&gt;, Bech_2006 &lt;dbl&gt;,
## #   Bech_2007 &lt;dbl&gt;, Bech_2008 &lt;dbl&gt;, Bech_2009 &lt;dbl&gt;, Bech_2010 &lt;dbl&gt;, …</code></pre>
<p>You can notice that now we have columns for 2016 and 2017 too. Let’s clean the data a little bit more:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="descriptive-statistics-and-data-manipulation.html#cb402-1" aria-hidden="true" tabindex="-1"></a>unemp_lux_data4 <span class="sc">%&gt;%</span> </span>
<span id="cb402-2"><a href="descriptive-statistics-and-data-manipulation.html#cb402-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>rowid) <span class="sc">%&gt;%</span> </span>
<span id="cb402-3"><a href="descriptive-statistics-and-data-manipulation.html#cb402-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(<span class="fu">matches</span>(<span class="st">&quot;.*&quot;</span>), <span class="at">.direction =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb402-4"><a href="descriptive-statistics-and-data-manipulation.html#cb402-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2,006
##   Beaufort_2001 Beaufort_2002 Beaufort_2003 Beaufort_2004 Beaufort_2005
##           &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1          5.09           3.5          5.17          5.07          5.89
## # … with 2,001 more variables: Beaufort_2006 &lt;dbl&gt;, Beaufort_2007 &lt;dbl&gt;,
## #   Beaufort_2008 &lt;dbl&gt;, Beaufort_2009 &lt;dbl&gt;, Beaufort_2010 &lt;dbl&gt;,
## #   Beaufort_2011 &lt;dbl&gt;, Beaufort_2012 &lt;dbl&gt;, Beaufort_2013 &lt;dbl&gt;,
## #   Beaufort_2014 &lt;dbl&gt;, Beaufort_2015 &lt;dbl&gt;, Beaufort_2016 &lt;dbl&gt;,
## #   Beaufort_2017 &lt;dbl&gt;, Bech_2001 &lt;dbl&gt;, Bech_2002 &lt;dbl&gt;, Bech_2003 &lt;dbl&gt;,
## #   Bech_2004 &lt;dbl&gt;, Bech_2005 &lt;dbl&gt;, Bech_2006 &lt;dbl&gt;, Bech_2007 &lt;dbl&gt;,
## #   Bech_2008 &lt;dbl&gt;, Bech_2009 &lt;dbl&gt;, Bech_2010 &lt;dbl&gt;, Bech_2011 &lt;dbl&gt;, …</code></pre>
<p>We will learn about <code>fill()</code>, anoher <code>{tidyr}</code> function a bit later in this chapter, but its basic
purpose is to fill rows with whatever value comes before or after the missing values. <code>slice(n())</code>
then only keeps the last row of the data frame, which is the row that contains all the values (expect
for 2016 and 2017, which has missing values, as we wanted).</p>
<p>Here is another example of the importance of having an identifier column when using a spec:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="descriptive-statistics-and-data-manipulation.html#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb404-2"><a href="descriptive-statistics-and-data-manipulation.html#cb404-2" aria-hidden="true" tabindex="-1"></a>mtcars_spec <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb404-3"><a href="descriptive-statistics-and-data-manipulation.html#cb404-3" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">expand</span>(am, cyl, <span class="at">.value =</span> <span class="st">&quot;mpg&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb404-4"><a href="descriptive-statistics-and-data-manipulation.html#cb404-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(<span class="st">&quot;.name&quot;</span>, am, cyl, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb404-5"><a href="descriptive-statistics-and-data-manipulation.html#cb404-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-6"><a href="descriptive-statistics-and-data-manipulation.html#cb404-6" aria-hidden="true" tabindex="-1"></a>mtcars_spec</span></code></pre></div>
<p>We can now transform the data:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="descriptive-statistics-and-data-manipulation.html#cb405-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb405-2"><a href="descriptive-statistics-and-data-manipulation.html#cb405-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider_spec</span>(<span class="at">spec =</span> mtcars_spec)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 14
##     disp    hp  drat    wt  qsec    vs  gear  carb `0_4` `0_6` `0_8` `1_4` `1_6`
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  160    110  3.9   2.62  16.5     0     4     4  NA    NA    NA    NA      21
##  2  160    110  3.9   2.88  17.0     0     4     4  NA    NA    NA    NA      21
##  3  108     93  3.85  2.32  18.6     1     4     1  NA    NA    NA    22.8    NA
##  4  258    110  3.08  3.22  19.4     1     3     1  NA    21.4  NA    NA      NA
##  5  360    175  3.15  3.44  17.0     0     3     2  NA    NA    18.7  NA      NA
##  6  225    105  2.76  3.46  20.2     1     3     1  NA    18.1  NA    NA      NA
##  7  360    245  3.21  3.57  15.8     0     3     4  NA    NA    14.3  NA      NA
##  8  147.    62  3.69  3.19  20       1     4     2  24.4  NA    NA    NA      NA
##  9  141.    95  3.92  3.15  22.9     1     4     2  22.8  NA    NA    NA      NA
## 10  168.   123  3.92  3.44  18.3     1     4     4  NA    19.2  NA    NA      NA
## # … with 22 more rows, and 1 more variable: `1_8` &lt;dbl&gt;</code></pre>
<p>As you can see, there are several values of “mpg” for some combinations of “am” times “cyl”. If
we remove the other columns, each row will not be uniquely identified anymore. This results in a
warning message, and a tibble that contains list-columns:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="descriptive-statistics-and-data-manipulation.html#cb407-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb407-2"><a href="descriptive-statistics-and-data-manipulation.html#cb407-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(am, cyl, mpg) <span class="sc">%&gt;%</span> </span>
<span id="cb407-3"><a href="descriptive-statistics-and-data-manipulation.html#cb407-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider_spec</span>(<span class="at">spec =</span> mtcars_spec)</span></code></pre></div>
<pre><code>## Warning: Values from `mpg` are not uniquely identified; output will contain list-cols.
## * Use `values_fn = list` to suppress this warning.
## * Use `values_fn = {summary_fun}` to summarise duplicates.
## * Use the following dplyr code to identify duplicates.
##   {data} %&gt;%
##     dplyr::group_by(am, cyl) %&gt;%
##     dplyr::summarise(n = dplyr::n(), .groups = &quot;drop&quot;) %&gt;%
##     dplyr::filter(n &gt; 1L)</code></pre>
<pre><code>## # A tibble: 1 × 6
##   `0_4`     `0_6`     `0_8`      `1_4`     `1_6`     `1_8`    
##   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;     &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
## 1 &lt;dbl [3]&gt; &lt;dbl [4]&gt; &lt;dbl [12]&gt; &lt;dbl [8]&gt; &lt;dbl [3]&gt; &lt;dbl [2]&gt;</code></pre>
<p>We are going to learn about list-columns in the next section. List-columns are very powerful, and
mastering them will be important. But generally speaking, when reshaping data, if you get list-columns
back it often means that something went wrong.</p>
<p>So you have to be careful with this.</p>
<p><code>pivot_longer()</code> is used when you need to go from a wide to a long dataset, meaning, a dataset
where there are some columns that should not be columns, but rather, the levels of a factor
variable. Let’s suppose that the “am” column is split into two columns, <code>1</code> for automatic and <code>0</code>
for manual transmissions, and that the values filling these colums are miles per gallon, “mpg”:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="descriptive-statistics-and-data-manipulation.html#cb410-1" aria-hidden="true" tabindex="-1"></a>mtcars_wide_am <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb410-2"><a href="descriptive-statistics-and-data-manipulation.html#cb410-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> am, <span class="at">values_from =</span> mpg)</span>
<span id="cb410-3"><a href="descriptive-statistics-and-data-manipulation.html#cb410-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-4"><a href="descriptive-statistics-and-data-manipulation.html#cb410-4" aria-hidden="true" tabindex="-1"></a>mtcars_wide_am <span class="sc">%&gt;%</span> </span>
<span id="cb410-5"><a href="descriptive-statistics-and-data-manipulation.html#cb410-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span>, <span class="st">`</span><span class="at">1</span><span class="st">`</span>, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 32 × 11
##      `0`   `1`   cyl  disp    hp  drat    wt  qsec    vs  gear  carb
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  NA    21       6  160    110  3.9   2.62  16.5     0     4     4
##  2  NA    21       6  160    110  3.9   2.88  17.0     0     4     4
##  3  NA    22.8     4  108     93  3.85  2.32  18.6     1     4     1
##  4  21.4  NA       6  258    110  3.08  3.22  19.4     1     3     1
##  5  18.7  NA       8  360    175  3.15  3.44  17.0     0     3     2
##  6  18.1  NA       6  225    105  2.76  3.46  20.2     1     3     1
##  7  14.3  NA       8  360    245  3.21  3.57  15.8     0     3     4
##  8  24.4  NA       4  147.    62  3.69  3.19  20       1     4     2
##  9  22.8  NA       4  141.    95  3.92  3.15  22.9     1     4     2
## 10  19.2  NA       6  168.   123  3.92  3.44  18.3     1     4     4
## # … with 22 more rows</code></pre>
<p>As you can see, the “0” and “1” columns should not be their own columns, unless there is a very
specific and good reason they should… but rather, they should be the levels of another column (in
our case, “am”).</p>
<p>We can go back to a long dataset like so:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="descriptive-statistics-and-data-manipulation.html#cb412-1" aria-hidden="true" tabindex="-1"></a>mtcars_wide_am <span class="sc">%&gt;%</span> </span>
<span id="cb412-2"><a href="descriptive-statistics-and-data-manipulation.html#cb412-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span>, <span class="st">`</span><span class="at">0</span><span class="st">`</span>), <span class="at">names_to =</span> <span class="st">&quot;am&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;mpg&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb412-3"><a href="descriptive-statistics-and-data-manipulation.html#cb412-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(am, mpg, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 64 × 11
##    am      mpg   cyl  disp    hp  drat    wt  qsec    vs  gear  carb
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1      21       6   160   110  3.9   2.62  16.5     0     4     4
##  2 0      NA       6   160   110  3.9   2.62  16.5     0     4     4
##  3 1      21       6   160   110  3.9   2.88  17.0     0     4     4
##  4 0      NA       6   160   110  3.9   2.88  17.0     0     4     4
##  5 1      22.8     4   108    93  3.85  2.32  18.6     1     4     1
##  6 0      NA       4   108    93  3.85  2.32  18.6     1     4     1
##  7 1      NA       6   258   110  3.08  3.22  19.4     1     3     1
##  8 0      21.4     6   258   110  3.08  3.22  19.4     1     3     1
##  9 1      NA       8   360   175  3.15  3.44  17.0     0     3     2
## 10 0      18.7     8   360   175  3.15  3.44  17.0     0     3     2
## # … with 54 more rows</code></pre>
<p>In the cols argument, you need to list all the variables that need to be transformed. Only <code>1</code> and
<code>0</code> must be pivoted, so I list them. Just for illustration purposes, imagine that we would need
to pivot 50 columns. It would be faster to list the columns that do not need to be pivoted. This
can be achieved by listing the columns that must be excluded with <code>-</code> in front, and maybe using
<code>match()</code> with a regular expression:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="descriptive-statistics-and-data-manipulation.html#cb414-1" aria-hidden="true" tabindex="-1"></a>mtcars_wide_am <span class="sc">%&gt;%</span> </span>
<span id="cb414-2"><a href="descriptive-statistics-and-data-manipulation.html#cb414-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">matches</span>(<span class="st">&quot;^[[:alpha:]]&quot;</span>),</span>
<span id="cb414-3"><a href="descriptive-statistics-and-data-manipulation.html#cb414-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;am&quot;</span>,</span>
<span id="cb414-4"><a href="descriptive-statistics-and-data-manipulation.html#cb414-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;mpg&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb414-5"><a href="descriptive-statistics-and-data-manipulation.html#cb414-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(am, mpg, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 64 × 11
##    am      mpg   cyl  disp    hp  drat    wt  qsec    vs  gear  carb
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1      21       6   160   110  3.9   2.62  16.5     0     4     4
##  2 0      NA       6   160   110  3.9   2.62  16.5     0     4     4
##  3 1      21       6   160   110  3.9   2.88  17.0     0     4     4
##  4 0      NA       6   160   110  3.9   2.88  17.0     0     4     4
##  5 1      22.8     4   108    93  3.85  2.32  18.6     1     4     1
##  6 0      NA       4   108    93  3.85  2.32  18.6     1     4     1
##  7 1      NA       6   258   110  3.08  3.22  19.4     1     3     1
##  8 0      21.4     6   258   110  3.08  3.22  19.4     1     3     1
##  9 1      NA       8   360   175  3.15  3.44  17.0     0     3     2
## 10 0      18.7     8   360   175  3.15  3.44  17.0     0     3     2
## # … with 54 more rows</code></pre>
<p>Every column that starts with a letter is ok, so there is no need to pivot them. I use the <code>match()</code>
function with a regular expression so that I don’t have to type the names of all the columns. <code>select()</code>
is used to re-order the columns, only for viewing purposes</p>
<p><code>names_to =</code> takes a string as argument, which will be the name of the name column containing the
levels <code>0</code> and <code>1</code>, and <code>values_to =</code> also takes a string as argument, which will be the name of
the column containing the values. Finally, you can see that there are a lot of <code>NA</code>s in the
output. These can be removed easily:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="descriptive-statistics-and-data-manipulation.html#cb416-1" aria-hidden="true" tabindex="-1"></a>mtcars_wide_am <span class="sc">%&gt;%</span> </span>
<span id="cb416-2"><a href="descriptive-statistics-and-data-manipulation.html#cb416-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span>, <span class="st">`</span><span class="at">0</span><span class="st">`</span>), <span class="at">names_to =</span> <span class="st">&quot;am&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;mpg&quot;</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb416-3"><a href="descriptive-statistics-and-data-manipulation.html#cb416-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(am, mpg, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 32 × 11
##    am      mpg   cyl  disp    hp  drat    wt  qsec    vs  gear  carb
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1      21       6  160    110  3.9   2.62  16.5     0     4     4
##  2 1      21       6  160    110  3.9   2.88  17.0     0     4     4
##  3 1      22.8     4  108     93  3.85  2.32  18.6     1     4     1
##  4 0      21.4     6  258    110  3.08  3.22  19.4     1     3     1
##  5 0      18.7     8  360    175  3.15  3.44  17.0     0     3     2
##  6 0      18.1     6  225    105  2.76  3.46  20.2     1     3     1
##  7 0      14.3     8  360    245  3.21  3.57  15.8     0     3     4
##  8 0      24.4     4  147.    62  3.69  3.19  20       1     4     2
##  9 0      22.8     4  141.    95  3.92  3.15  22.9     1     4     2
## 10 0      19.2     6  168.   123  3.92  3.44  18.3     1     4     4
## # … with 22 more rows</code></pre>
<p>Now for a more advanced example, let’s suppose that we are dealing with the following wide dataset:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="descriptive-statistics-and-data-manipulation.html#cb418-1" aria-hidden="true" tabindex="-1"></a>mtcars_wide <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb418-2"><a href="descriptive-statistics-and-data-manipulation.html#cb418-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider_spec</span>(<span class="at">spec =</span> mtcars_spec)</span>
<span id="cb418-3"><a href="descriptive-statistics-and-data-manipulation.html#cb418-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-4"><a href="descriptive-statistics-and-data-manipulation.html#cb418-4" aria-hidden="true" tabindex="-1"></a>mtcars_wide</span></code></pre></div>
<pre><code>## # A tibble: 32 × 14
##     disp    hp  drat    wt  qsec    vs  gear  carb `0_4` `0_6` `0_8` `1_4` `1_6`
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  160    110  3.9   2.62  16.5     0     4     4  NA    NA    NA    NA      21
##  2  160    110  3.9   2.88  17.0     0     4     4  NA    NA    NA    NA      21
##  3  108     93  3.85  2.32  18.6     1     4     1  NA    NA    NA    22.8    NA
##  4  258    110  3.08  3.22  19.4     1     3     1  NA    21.4  NA    NA      NA
##  5  360    175  3.15  3.44  17.0     0     3     2  NA    NA    18.7  NA      NA
##  6  225    105  2.76  3.46  20.2     1     3     1  NA    18.1  NA    NA      NA
##  7  360    245  3.21  3.57  15.8     0     3     4  NA    NA    14.3  NA      NA
##  8  147.    62  3.69  3.19  20       1     4     2  24.4  NA    NA    NA      NA
##  9  141.    95  3.92  3.15  22.9     1     4     2  22.8  NA    NA    NA      NA
## 10  168.   123  3.92  3.44  18.3     1     4     4  NA    19.2  NA    NA      NA
## # … with 22 more rows, and 1 more variable: `1_8` &lt;dbl&gt;</code></pre>
<p>The difficulty here is that we have columns with two levels of information. For instance, the
column “0_4” contains the miles per gallon values for manual cars (<code>0</code>) with <code>4</code> cylinders.
The first step is to first pivot the columns:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="descriptive-statistics-and-data-manipulation.html#cb420-1" aria-hidden="true" tabindex="-1"></a>mtcars_wide <span class="sc">%&gt;%</span> </span>
<span id="cb420-2"><a href="descriptive-statistics-and-data-manipulation.html#cb420-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">&quot;0|1&quot;</span>),</span>
<span id="cb420-3"><a href="descriptive-statistics-and-data-manipulation.html#cb420-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;am_cyl&quot;</span>,</span>
<span id="cb420-4"><a href="descriptive-statistics-and-data-manipulation.html#cb420-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb420-5"><a href="descriptive-statistics-and-data-manipulation.html#cb420-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb420-6"><a href="descriptive-statistics-and-data-manipulation.html#cb420-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(am_cyl, mpg, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 32 × 10
##    am_cyl   mpg  disp    hp  drat    wt  qsec    vs  gear  carb
##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1_6     21    160    110  3.9   2.62  16.5     0     4     4
##  2 1_6     21    160    110  3.9   2.88  17.0     0     4     4
##  3 1_4     22.8  108     93  3.85  2.32  18.6     1     4     1
##  4 0_6     21.4  258    110  3.08  3.22  19.4     1     3     1
##  5 0_8     18.7  360    175  3.15  3.44  17.0     0     3     2
##  6 0_6     18.1  225    105  2.76  3.46  20.2     1     3     1
##  7 0_8     14.3  360    245  3.21  3.57  15.8     0     3     4
##  8 0_4     24.4  147.    62  3.69  3.19  20       1     4     2
##  9 0_4     22.8  141.    95  3.92  3.15  22.9     1     4     2
## 10 0_6     19.2  168.   123  3.92  3.44  18.3     1     4     4
## # … with 22 more rows</code></pre>
<p>Now we only need to separate the “am_cyl” column into two new columns, “am” and “cyl”:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="descriptive-statistics-and-data-manipulation.html#cb422-1" aria-hidden="true" tabindex="-1"></a>mtcars_wide <span class="sc">%&gt;%</span> </span>
<span id="cb422-2"><a href="descriptive-statistics-and-data-manipulation.html#cb422-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">&quot;0|1&quot;</span>),</span>
<span id="cb422-3"><a href="descriptive-statistics-and-data-manipulation.html#cb422-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;am_cyl&quot;</span>,</span>
<span id="cb422-4"><a href="descriptive-statistics-and-data-manipulation.html#cb422-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb422-5"><a href="descriptive-statistics-and-data-manipulation.html#cb422-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb422-6"><a href="descriptive-statistics-and-data-manipulation.html#cb422-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(am_cyl, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;am&quot;</span>, <span class="st">&quot;cyl&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb422-7"><a href="descriptive-statistics-and-data-manipulation.html#cb422-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(am, cyl, mpg, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 32 × 11
##    am    cyl     mpg  disp    hp  drat    wt  qsec    vs  gear  carb
##    &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1     6      21    160    110  3.9   2.62  16.5     0     4     4
##  2 1     6      21    160    110  3.9   2.88  17.0     0     4     4
##  3 1     4      22.8  108     93  3.85  2.32  18.6     1     4     1
##  4 0     6      21.4  258    110  3.08  3.22  19.4     1     3     1
##  5 0     8      18.7  360    175  3.15  3.44  17.0     0     3     2
##  6 0     6      18.1  225    105  2.76  3.46  20.2     1     3     1
##  7 0     8      14.3  360    245  3.21  3.57  15.8     0     3     4
##  8 0     4      24.4  147.    62  3.69  3.19  20       1     4     2
##  9 0     4      22.8  141.    95  3.92  3.15  22.9     1     4     2
## 10 0     6      19.2  168.   123  3.92  3.44  18.3     1     4     4
## # … with 22 more rows</code></pre>
<p>It is also possible to construct a specification data frame, just like for <code>pivot_wider_spec()</code>.
This time, I’m using the <code>build_longer_spec()</code> function that makes it easy to build specifications:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="descriptive-statistics-and-data-manipulation.html#cb424-1" aria-hidden="true" tabindex="-1"></a>mtcars_spec_long <span class="ot">&lt;-</span> mtcars_wide <span class="sc">%&gt;%</span></span>
<span id="cb424-2"><a href="descriptive-statistics-and-data-manipulation.html#cb424-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build_longer_spec</span>(<span class="fu">matches</span>(<span class="st">&quot;0|1&quot;</span>),</span>
<span id="cb424-3"><a href="descriptive-statistics-and-data-manipulation.html#cb424-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values_to =</span> <span class="st">&quot;mpg&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb424-4"><a href="descriptive-statistics-and-data-manipulation.html#cb424-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="fu">c</span>(<span class="st">&quot;am&quot;</span>, <span class="st">&quot;cyl&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb424-5"><a href="descriptive-statistics-and-data-manipulation.html#cb424-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-6"><a href="descriptive-statistics-and-data-manipulation.html#cb424-6" aria-hidden="true" tabindex="-1"></a>mtcars_spec_long</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   .name .value am    cyl  
##   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;
## 1 0_4   mpg    0     4    
## 2 0_6   mpg    0     6    
## 3 0_8   mpg    0     8    
## 4 1_4   mpg    1     4    
## 5 1_6   mpg    1     6    
## 6 1_8   mpg    1     8</code></pre>
<p>This spec can now be specified to <code>pivot_longer()</code>:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="descriptive-statistics-and-data-manipulation.html#cb426-1" aria-hidden="true" tabindex="-1"></a>mtcars_wide <span class="sc">%&gt;%</span></span>
<span id="cb426-2"><a href="descriptive-statistics-and-data-manipulation.html#cb426-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer_spec</span>(<span class="at">spec =</span> mtcars_spec_long,</span>
<span id="cb426-3"><a href="descriptive-statistics-and-data-manipulation.html#cb426-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb426-4"><a href="descriptive-statistics-and-data-manipulation.html#cb426-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(am, cyl, mpg, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 32 × 11
##    am    cyl     mpg  disp    hp  drat    wt  qsec    vs  gear  carb
##    &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1     6      21    160    110  3.9   2.62  16.5     0     4     4
##  2 1     6      21    160    110  3.9   2.88  17.0     0     4     4
##  3 1     4      22.8  108     93  3.85  2.32  18.6     1     4     1
##  4 0     6      21.4  258    110  3.08  3.22  19.4     1     3     1
##  5 0     8      18.7  360    175  3.15  3.44  17.0     0     3     2
##  6 0     6      18.1  225    105  2.76  3.46  20.2     1     3     1
##  7 0     8      14.3  360    245  3.21  3.57  15.8     0     3     4
##  8 0     4      24.4  147.    62  3.69  3.19  20       1     4     2
##  9 0     4      22.8  141.    95  3.92  3.15  22.9     1     4     2
## 10 0     6      19.2  168.   123  3.92  3.44  18.3     1     4     4
## # … with 22 more rows</code></pre>
<p>Defining specifications give a lot of flexibility and in some complicated cases are the way to go.</p>
</div>
<div id="fill-and-full_seq" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> <code>fill()</code> and <code>full_seq()</code><a href="descriptive-statistics-and-data-manipulation.html#fill-and-full_seq" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>fill()</code> is pretty useful to… fill in missing values. For instance, in <code>survey_data</code>, some “id”s
are missing:</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="descriptive-statistics-and-data-manipulation.html#cb428-1" aria-hidden="true" tabindex="-1"></a>survey_data</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##       id variable value
##    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
##  1     1 var1       1  
##  2     1 var2       0.2
##  3    NA var3       0.3
##  4     2 var1       1.4
##  5     2 var2       1.9
##  6     2 var3       4.1
##  7     3 var1       0.1
##  8     3 var2       2.8
##  9     3 var3       8.9
## 10     4 var1       1.7
## 11    NA var2       1.9
## 12     4 var3       7.6</code></pre>
<p>It seems pretty obvious that the first <code>NA</code> is supposed to be <code>1</code> and the second missing is supposed
to be <code>4</code>. With <code>fill()</code>, this is pretty easy to achieve:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="descriptive-statistics-and-data-manipulation.html#cb430-1" aria-hidden="true" tabindex="-1"></a>survey_data <span class="sc">%&gt;%</span></span>
<span id="cb430-2"><a href="descriptive-statistics-and-data-manipulation.html#cb430-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fill</span>(<span class="at">.direction =</span> <span class="st">&quot;down&quot;</span>, id)</span></code></pre></div>
<p><code>full_seq()</code> is similar:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="descriptive-statistics-and-data-manipulation.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_seq</span>(<span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2018-08-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2018-08-03&quot;</span>)), <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2018-08-01&quot; &quot;2018-08-02&quot; &quot;2018-08-03&quot;</code></pre>
<p>We can add this as the date column to our survey data:</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="descriptive-statistics-and-data-manipulation.html#cb433-1" aria-hidden="true" tabindex="-1"></a>survey_data <span class="sc">%&gt;%</span></span>
<span id="cb433-2"><a href="descriptive-statistics-and-data-manipulation.html#cb433-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">rep</span>(<span class="fu">full_seq</span>(<span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2018-08-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2018-08-03&quot;</span>)), <span class="dv">1</span>), <span class="dv">4</span>))</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##       id variable value date      
##    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;date&gt;    
##  1     1 var1       1   2018-08-01
##  2     1 var2       0.2 2018-08-02
##  3    NA var3       0.3 2018-08-03
##  4     2 var1       1.4 2018-08-01
##  5     2 var2       1.9 2018-08-02
##  6     2 var3       4.1 2018-08-03
##  7     3 var1       0.1 2018-08-01
##  8     3 var2       2.8 2018-08-02
##  9     3 var3       8.9 2018-08-03
## 10     4 var1       1.7 2018-08-01
## 11    NA var2       1.9 2018-08-02
## 12     4 var3       7.6 2018-08-03</code></pre>
<p>I use the base <code>rep()</code> function to repeat the date 4 times and then using <code>mutate()</code> I have added
it the data frame.</p>
<p>Putting all these operations together:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="descriptive-statistics-and-data-manipulation.html#cb435-1" aria-hidden="true" tabindex="-1"></a>survey_data <span class="sc">%&gt;%</span></span>
<span id="cb435-2"><a href="descriptive-statistics-and-data-manipulation.html#cb435-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fill</span>(<span class="at">.direction =</span> <span class="st">&quot;down&quot;</span>, id) <span class="sc">%&gt;%</span></span>
<span id="cb435-3"><a href="descriptive-statistics-and-data-manipulation.html#cb435-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">rep</span>(<span class="fu">full_seq</span>(<span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2018-08-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2018-08-03&quot;</span>)), <span class="dv">1</span>), <span class="dv">4</span>))</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##       id variable value date      
##    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;date&gt;    
##  1     1 var1       1   2018-08-01
##  2     1 var2       0.2 2018-08-02
##  3     1 var3       0.3 2018-08-03
##  4     2 var1       1.4 2018-08-01
##  5     2 var2       1.9 2018-08-02
##  6     2 var3       4.1 2018-08-03
##  7     3 var1       0.1 2018-08-01
##  8     3 var2       2.8 2018-08-02
##  9     3 var3       8.9 2018-08-03
## 10     4 var1       1.7 2018-08-01
## 11     4 var2       1.9 2018-08-02
## 12     4 var3       7.6 2018-08-03</code></pre>
<p>You should be careful when imputing missing values though. The method described above is called
<code>Last Observation Carried Forward</code>, and sometimes it makes sense, like here, but sometimes it doesn’t and
doing this will introduce bias in your analysis. Discussing how to handle missing values in your analysis
is outside of the scope of this book, but there are many resources available. You may want to check
out the vignettes of the <code>{mice}</code> <a href="https://amices.org/mice/articles/overview.html">package</a>, which
lists many resources to get you started.</p>
</div>
<div id="put-order-in-your-columns-with-separate-unite-and-in-your-rows-with-separate_rows" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Put order in your columns with <code>separate()</code>, <code>unite()</code>, and in your rows with <code>separate_rows()</code><a href="descriptive-statistics-and-data-manipulation.html#put-order-in-your-columns-with-separate-unite-and-in-your-rows-with-separate_rows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes, data can be in a format that makes working with it needlessly painful. For example, you
get this:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="descriptive-statistics-and-data-manipulation.html#cb437-1" aria-hidden="true" tabindex="-1"></a>survey_data_not_tidy</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##       id variable_date   value
##    &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
##  1     1 var1/2018-08-01   1  
##  2     1 var2/2018-08-02   0.2
##  3     1 var3/2018-08-03   0.3
##  4     2 var1/2018-08-01   1.4
##  5     2 var2/2018-08-02   1.9
##  6     2 var3/2018-08-03   4.1
##  7     3 var1/2018-08-01   0.1
##  8     3 var2/2018-08-02   2.8
##  9     3 var3/2018-08-03   8.9
## 10     4 var1/2018-08-01   1.7
## 11     4 var2/2018-08-02   1.9
## 12     4 var3/2018-08-03   7.6</code></pre>
<p>Dealing with this is simple, thanks to <code>separate()</code>:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="descriptive-statistics-and-data-manipulation.html#cb439-1" aria-hidden="true" tabindex="-1"></a>survey_data_not_tidy <span class="sc">%&gt;%</span></span>
<span id="cb439-2"><a href="descriptive-statistics-and-data-manipulation.html#cb439-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(variable_date, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;date&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##       id variable date       value
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;
##  1     1 var1     2018-08-01   1  
##  2     1 var2     2018-08-02   0.2
##  3     1 var3     2018-08-03   0.3
##  4     2 var1     2018-08-01   1.4
##  5     2 var2     2018-08-02   1.9
##  6     2 var3     2018-08-03   4.1
##  7     3 var1     2018-08-01   0.1
##  8     3 var2     2018-08-02   2.8
##  9     3 var3     2018-08-03   8.9
## 10     4 var1     2018-08-01   1.7
## 11     4 var2     2018-08-02   1.9
## 12     4 var3     2018-08-03   7.6</code></pre>
<p>The <code>variable_date</code> column gets separated into two columns, <code>variable</code> and <code>date</code>. One also needs
to specify the separator, in this case “/”.</p>
<p><code>unite()</code> is the reverse operation, which can be useful when you are confronted to this situation:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="descriptive-statistics-and-data-manipulation.html#cb441-1" aria-hidden="true" tabindex="-1"></a>survey_data2</span></code></pre></div>
<pre><code>## # A tibble: 12 × 6
##       id variable year  month day   value
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
##  1     1 var1     2018  08    01      1  
##  2     1 var2     2018  08    02      0.2
##  3     1 var3     2018  08    03      0.3
##  4     2 var1     2018  08    01      1.4
##  5     2 var2     2018  08    02      1.9
##  6     2 var3     2018  08    03      4.1
##  7     3 var1     2018  08    01      0.1
##  8     3 var2     2018  08    02      2.8
##  9     3 var3     2018  08    03      8.9
## 10     4 var1     2018  08    01      1.7
## 11     4 var2     2018  08    02      1.9
## 12     4 var3     2018  08    03      7.6</code></pre>
<p>In some situation, it is better to have the date as a single column:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="descriptive-statistics-and-data-manipulation.html#cb443-1" aria-hidden="true" tabindex="-1"></a>survey_data2 <span class="sc">%&gt;%</span></span>
<span id="cb443-2"><a href="descriptive-statistics-and-data-manipulation.html#cb443-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(date, year, month, day, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##       id variable date       value
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;
##  1     1 var1     2018-08-01   1  
##  2     1 var2     2018-08-02   0.2
##  3     1 var3     2018-08-03   0.3
##  4     2 var1     2018-08-01   1.4
##  5     2 var2     2018-08-02   1.9
##  6     2 var3     2018-08-03   4.1
##  7     3 var1     2018-08-01   0.1
##  8     3 var2     2018-08-02   2.8
##  9     3 var3     2018-08-03   8.9
## 10     4 var1     2018-08-01   1.7
## 11     4 var2     2018-08-02   1.9
## 12     4 var3     2018-08-03   7.6</code></pre>
<p>Another awful situation is the following:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="descriptive-statistics-and-data-manipulation.html#cb445-1" aria-hidden="true" tabindex="-1"></a>survey_data_from_hell</span></code></pre></div>
<pre><code>##   id         variable         value
## 1  1             var1             1
## 2  1             var2           0.2
## 3 NA             var3           0.3
## 4  2 var1, var2, var3 1.4, 1.9, 4.1
## 5  3       var1, var2      0.1, 2.8
## 6  3             var3           8.9
## 7  4             var1           1.7
## 8 NA             var2           1.9
## 9  4             var3           7.6</code></pre>
<p><code>separate_rows()</code> saves the day:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="descriptive-statistics-and-data-manipulation.html#cb447-1" aria-hidden="true" tabindex="-1"></a>survey_data_from_hell <span class="sc">%&gt;%</span></span>
<span id="cb447-2"><a href="descriptive-statistics-and-data-manipulation.html#cb447-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_rows</span>(variable, value)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##       id variable value
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;
##  1     1 var1     1    
##  2     1 var2     0.2  
##  3    NA var3     0.3  
##  4     2 var1     1.4  
##  5     2 var2     1.9  
##  6     2 var3     4.1  
##  7     3 var1     0.1  
##  8     3 var2     2.8  
##  9     3 var3     8.9  
## 10     4 var1     1.7  
## 11    NA var2     1.9  
## 12     4 var3     7.6</code></pre>
<p>So to summarise… you can go from this:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="descriptive-statistics-and-data-manipulation.html#cb449-1" aria-hidden="true" tabindex="-1"></a>survey_data_from_hell</span></code></pre></div>
<pre><code>##   id         variable         value
## 1  1             var1             1
## 2  1             var2           0.2
## 3 NA             var3           0.3
## 4  2 var1, var2, var3 1.4, 1.9, 4.1
## 5  3       var1, var2      0.1, 2.8
## 6  3             var3           8.9
## 7  4             var1           1.7
## 8 NA             var2           1.9
## 9  4             var3           7.6</code></pre>
<p>to this:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="descriptive-statistics-and-data-manipulation.html#cb451-1" aria-hidden="true" tabindex="-1"></a>survey_data_clean</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##       id variable date       value
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;
##  1     1 var1     2018-08-01   1  
##  2     1 var2     2018-08-02   0.2
##  3     1 var3     2018-08-03   0.3
##  4     2 var1     2018-08-01   1.4
##  5     2 var2     2018-08-02   1.9
##  6     2 var3     2018-08-03   4.1
##  7     3 var1     2018-08-01   0.1
##  8     3 var2     2018-08-02   2.8
##  9     3 var3     2018-08-03   8.9
## 10     4 var1     2018-08-01   1.7
## 11     4 var2     2018-08-02   1.9
## 12     4 var3     2018-08-03   7.6</code></pre>
<p>quite easily:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="descriptive-statistics-and-data-manipulation.html#cb453-1" aria-hidden="true" tabindex="-1"></a>survey_data_from_hell <span class="sc">%&gt;%</span></span>
<span id="cb453-2"><a href="descriptive-statistics-and-data-manipulation.html#cb453-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_rows</span>(variable, value, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb453-3"><a href="descriptive-statistics-and-data-manipulation.html#cb453-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fill</span>(<span class="at">.direction =</span> <span class="st">&quot;down&quot;</span>, id) <span class="sc">%&gt;%</span></span>
<span id="cb453-4"><a href="descriptive-statistics-and-data-manipulation.html#cb453-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">rep</span>(<span class="fu">full_seq</span>(<span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2018-08-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2018-08-03&quot;</span>)), <span class="dv">1</span>), <span class="dv">4</span>))</span></code></pre></div>
</div>
</div>
<div id="working-on-many-columns-with-across" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Working on many columns with <code>across()</code><a href="descriptive-statistics-and-data-manipulation.html#working-on-many-columns-with-across" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s start with the most complicated cases, using <code>across()</code> with <code>filter()</code>.</p>
<div id="filter-and-across" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> <code>filter()</code> and <code>across()</code><a href="descriptive-statistics-and-data-manipulation.html#filter-and-across" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s go back to the <code>gasoline</code> data from the <code>{Ecdat}</code> package.</p>
<p><code>filter()</code> is not the only <em>filtering</em> verb there is. Suppose that we have a condition that we want
to use to filter out a lot of columns at once. For example, for every column that is of type
<code>numeric</code>, keep only the lines where the condition <em>value &gt; -8</em> is satisfied. The next line does
that:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="descriptive-statistics-and-data-manipulation.html#cb454-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb454-2"><a href="descriptive-statistics-and-data-manipulation.html#cb454-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">across</span>(is.numeric, <span class="sc">~</span><span class="st">`</span><span class="at">&gt;</span><span class="st">`</span>(., <span class="sc">-</span><span class="dv">8</span>)))</span></code></pre></div>
<pre><code>## Warning: Predicate functions must be wrapped in `where()`.
## 
##   # Bad
##   data %&gt;% select(is.numeric)
## 
##   # Good
##   data %&gt;% select(where(is.numeric))
## 
## ℹ Please update your code.
## This message is displayed once per session.</code></pre>
<pre><code>## Warning: Using `across()` in `filter()` is deprecated, use `if_any()` or
## `if_all()`.</code></pre>
<pre><code>## # A tibble: 30 × 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 canada   1972     4.89    -5.44 -1.10     -7.99
##  2 canada   1973     4.90    -5.41 -1.13     -7.94
##  3 canada   1974     4.89    -5.42 -1.12     -7.90
##  4 canada   1975     4.89    -5.38 -1.19     -7.87
##  5 canada   1976     4.84    -5.36 -1.06     -7.81
##  6 canada   1977     4.81    -5.34 -1.07     -7.77
##  7 canada   1978     4.86    -5.31 -1.07     -7.79
##  8 germany  1978     3.88    -5.56 -0.628    -7.95
##  9 sweden   1975     3.97    -7.68 -2.77     -7.99
## 10 sweden   1976     3.98    -7.67 -2.82     -7.96
## # … with 20 more rows</code></pre>
<p>The above code is using the <code>across()</code> function, which is included since <code>{dplyr}</code> version 1.0. You
can think of <code>across()</code> as a function that helps you select the columns to which to apply the
verb. You can read the code above like this:</p>
<p><em>Start with the gasoline data, then filter rows that are greater than -8 across the columns
which are numeric</em></p>
<p>or similar. <code>across()</code> makes operations like these very easy to achieve.</p>
<p>Sometimes, you’d want to filter rows from columns that end their labels with a letter, for instance
<code>"p"</code>. This can again be achieved using <code>across()</code>:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="descriptive-statistics-and-data-manipulation.html#cb458-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb458-2"><a href="descriptive-statistics-and-data-manipulation.html#cb458-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">across</span>(<span class="fu">ends_with</span>(<span class="st">&quot;p&quot;</span>), <span class="sc">~</span><span class="st">`</span><span class="at">&gt;</span><span class="st">`</span>(., <span class="sc">-</span><span class="dv">8</span>)))</span></code></pre></div>
<pre><code>## Warning: Using `across()` in `filter()` is deprecated, use `if_any()` or
## `if_all()`.</code></pre>
<pre><code>## # A tibble: 30 × 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 canada   1972     4.89    -5.44 -1.10     -7.99
##  2 canada   1973     4.90    -5.41 -1.13     -7.94
##  3 canada   1974     4.89    -5.42 -1.12     -7.90
##  4 canada   1975     4.89    -5.38 -1.19     -7.87
##  5 canada   1976     4.84    -5.36 -1.06     -7.81
##  6 canada   1977     4.81    -5.34 -1.07     -7.77
##  7 canada   1978     4.86    -5.31 -1.07     -7.79
##  8 germany  1978     3.88    -5.56 -0.628    -7.95
##  9 sweden   1975     3.97    -7.68 -2.77     -7.99
## 10 sweden   1976     3.98    -7.67 -2.82     -7.96
## # … with 20 more rows</code></pre>
<p>We already know about <code>ends_with()</code> and <code>starts_with()</code>. So the above line means “for the columns
whose name end with a ‘p’ only keep the lines where, for all the selected columns, the values are
strictly superior to <code>-8</code>”. You can use any of these helper functions inside <code>across()</code>:</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="descriptive-statistics-and-data-manipulation.html#cb461-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb461-2"><a href="descriptive-statistics-and-data-manipulation.html#cb461-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(is.numeric) <span class="sc">%&gt;%</span>  </span>
<span id="cb461-3"><a href="descriptive-statistics-and-data-manipulation.html#cb461-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="st">`</span><span class="at">!=</span><span class="st">`</span>(., <span class="dv">0</span>)))</span></code></pre></div>
<pre><code>## Warning: Using `across()` in `filter()` is deprecated, use `if_any()` or
## `if_all()`.</code></pre>
<pre><code>## # A tibble: 342 × 5
##     year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1  1960     4.17    -6.47 -0.335    -9.77
##  2  1961     4.10    -6.43 -0.351    -9.61
##  3  1962     4.07    -6.41 -0.380    -9.46
##  4  1963     4.06    -6.37 -0.414    -9.34
##  5  1964     4.04    -6.32 -0.445    -9.24
##  6  1965     4.03    -6.29 -0.497    -9.12
##  7  1966     4.05    -6.25 -0.467    -9.02
##  8  1967     4.05    -6.23 -0.506    -8.93
##  9  1968     4.05    -6.21 -0.522    -8.85
## 10  1969     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p>This would get you every row where the values are different from 0 for all columns at the
same time (but first I need to select only columns of type <code>numeric</code>; this will be discussed
in the next section).</p>
<p>That’s basically all there is to it. I think that <code>across()</code> is quite intuitive, and by trying out
a few examples, I feel confident that you will think the same.</p>
</div>
<div id="selecting-and-renaming-with-across" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Selecting and renaming with <code>across()</code><a href="descriptive-statistics-and-data-manipulation.html#selecting-and-renaming-with-across" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the previous section, the very last example used the following bit of code <code>select(is.numeric)</code>.
Unlike <code>filter()</code>, <code>select()</code> does not need the help of <code>across()</code>:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="descriptive-statistics-and-data-manipulation.html#cb464-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb464-2"><a href="descriptive-statistics-and-data-manipulation.html#cb464-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(is.numeric)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 5
##     year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1  1960     4.17    -6.47 -0.335    -9.77
##  2  1961     4.10    -6.43 -0.351    -9.61
##  3  1962     4.07    -6.41 -0.380    -9.46
##  4  1963     4.06    -6.37 -0.414    -9.34
##  5  1964     4.04    -6.32 -0.445    -9.24
##  6  1965     4.03    -6.29 -0.497    -9.12
##  7  1966     4.05    -6.25 -0.467    -9.02
##  8  1967     4.05    -6.23 -0.506    -8.93
##  9  1968     4.05    -6.21 -0.522    -8.85
## 10  1969     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p>Selecting by column position is also possible:</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="descriptive-statistics-and-data-manipulation.html#cb466-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb466-2"><a href="descriptive-statistics-and-data-manipulation.html#cb466-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>))</span></code></pre></div>
<pre><code>## # A tibble: 342 × 3
##    country  year  lrpmg
##    &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1 austria  1960 -0.335
##  2 austria  1961 -0.351
##  3 austria  1962 -0.380
##  4 austria  1963 -0.414
##  5 austria  1964 -0.445
##  6 austria  1965 -0.497
##  7 austria  1966 -0.467
##  8 austria  1967 -0.506
##  9 austria  1968 -0.522
## 10 austria  1969 -0.559
## # … with 332 more rows</code></pre>
<p>As is selecting columns starting or ending with a certain string of characters:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="descriptive-statistics-and-data-manipulation.html#cb468-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb468-2"><a href="descriptive-statistics-and-data-manipulation.html#cb468-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;l&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 342 × 4
##    lgaspcar lincomep  lrpmg lcarpcap
##       &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1     4.17    -6.47 -0.335    -9.77
##  2     4.10    -6.43 -0.351    -9.61
##  3     4.07    -6.41 -0.380    -9.46
##  4     4.06    -6.37 -0.414    -9.34
##  5     4.04    -6.32 -0.445    -9.24
##  6     4.03    -6.29 -0.497    -9.12
##  7     4.05    -6.25 -0.467    -9.02
##  8     4.05    -6.23 -0.506    -8.93
##  9     4.05    -6.21 -0.522    -8.85
## 10     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p>Another very neat trick is selecting columns that may or may not exist in your data frame. For this quick examples
let’s use the <code>mtcars</code> dataset:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="descriptive-statistics-and-data-manipulation.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">colnames</span>(mtcars))</span></code></pre></div>
<pre><code>##  [1] &quot;am&quot;   &quot;carb&quot; &quot;cyl&quot;  &quot;disp&quot; &quot;drat&quot; &quot;gear&quot; &quot;hp&quot;   &quot;mpg&quot;  &quot;qsec&quot; &quot;vs&quot;  
## [11] &quot;wt&quot;</code></pre>
<p>Let’s create a vector with some column names:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="descriptive-statistics-and-data-manipulation.html#cb472-1" aria-hidden="true" tabindex="-1"></a>cols_to_select <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;cyl&quot;</span>, <span class="st">&quot;am&quot;</span>, <span class="st">&quot;nonsense&quot;</span>)</span></code></pre></div>
<p>The following selects the columns that exist
in the data frame but shows a warning for the column that does not exist:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="descriptive-statistics-and-data-manipulation.html#cb473-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb473-2"><a href="descriptive-statistics-and-data-manipulation.html#cb473-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(cols_to_select))</span></code></pre></div>
<pre><code>##                      mpg cyl am
## Mazda RX4           21.0   6  1
## Mazda RX4 Wag       21.0   6  1
## Datsun 710          22.8   4  1
## Hornet 4 Drive      21.4   6  0
## Hornet Sportabout   18.7   8  0
## Valiant             18.1   6  0
## Duster 360          14.3   8  0
## Merc 240D           24.4   4  0
## Merc 230            22.8   4  0
## Merc 280            19.2   6  0
## Merc 280C           17.8   6  0
## Merc 450SE          16.4   8  0
## Merc 450SL          17.3   8  0
## Merc 450SLC         15.2   8  0
## Cadillac Fleetwood  10.4   8  0
## Lincoln Continental 10.4   8  0
## Chrysler Imperial   14.7   8  0
## Fiat 128            32.4   4  1
## Honda Civic         30.4   4  1
## Toyota Corolla      33.9   4  1
## Toyota Corona       21.5   4  0
## Dodge Challenger    15.5   8  0
## AMC Javelin         15.2   8  0
## Camaro Z28          13.3   8  0
## Pontiac Firebird    19.2   8  0
## Fiat X1-9           27.3   4  1
## Porsche 914-2       26.0   4  1
## Lotus Europa        30.4   4  1
## Ford Pantera L      15.8   8  1
## Ferrari Dino        19.7   6  1
## Maserati Bora       15.0   8  1
## Volvo 142E          21.4   4  1</code></pre>
<p>and finally, if you want it to fail, don’t use any helper:</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="descriptive-statistics-and-data-manipulation.html#cb475-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb475-2"><a href="descriptive-statistics-and-data-manipulation.html#cb475-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cols_to_select)</span></code></pre></div>
<pre><code>Error: Can&#39;t subset columns that don&#39;t exist.
The column `nonsense` doesn&#39;t exist.</code></pre>
<p>or use <code>all_of()</code>:</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="descriptive-statistics-and-data-manipulation.html#cb477-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb477-2"><a href="descriptive-statistics-and-data-manipulation.html#cb477-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(cols_to_select))</span></code></pre></div>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="descriptive-statistics-and-data-manipulation.html#cb478-1" aria-hidden="true" tabindex="-1"></a>✖ Column <span class="st">`</span><span class="at">nonsense</span><span class="st">`</span> doesn<span class="st">&#39;t exist.</span></span></code></pre></div>
<p>Bulk-renaming can be achieved using <code>rename_with()</code></p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="descriptive-statistics-and-data-manipulation.html#cb479-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb479-2"><a href="descriptive-statistics-and-data-manipulation.html#cb479-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(toupper, is.numeric)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
##    country  YEAR LGASPCAR LINCOMEP  LRPMG LCARPCAP
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77
##  2 austria  1961     4.10    -6.43 -0.351    -9.61
##  3 austria  1962     4.07    -6.41 -0.380    -9.46
##  4 austria  1963     4.06    -6.37 -0.414    -9.34
##  5 austria  1964     4.04    -6.32 -0.445    -9.24
##  6 austria  1965     4.03    -6.29 -0.497    -9.12
##  7 austria  1966     4.05    -6.25 -0.467    -9.02
##  8 austria  1967     4.05    -6.23 -0.506    -8.93
##  9 austria  1968     4.05    -6.21 -0.522    -8.85
## 10 austria  1969     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p>you can also pass formulas to <code>rename_with()</code>:</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="descriptive-statistics-and-data-manipulation.html#cb481-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span>  </span>
<span id="cb481-2"><a href="descriptive-statistics-and-data-manipulation.html#cb481-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;new_&quot;</span>, .))</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
##    new_country new_year new_lgaspcar new_lincomep new_lrpmg new_lcarpcap
##    &lt;chr&gt;          &lt;int&gt;        &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 austria         1960         4.17        -6.47    -0.335        -9.77
##  2 austria         1961         4.10        -6.43    -0.351        -9.61
##  3 austria         1962         4.07        -6.41    -0.380        -9.46
##  4 austria         1963         4.06        -6.37    -0.414        -9.34
##  5 austria         1964         4.04        -6.32    -0.445        -9.24
##  6 austria         1965         4.03        -6.29    -0.497        -9.12
##  7 austria         1966         4.05        -6.25    -0.467        -9.02
##  8 austria         1967         4.05        -6.23    -0.506        -8.93
##  9 austria         1968         4.05        -6.21    -0.522        -8.85
## 10 austria         1969         4.05        -6.15    -0.559        -8.79
## # … with 332 more rows</code></pre>
<p>In the above formula I did not select any columns, so every columns gets renamed.</p>
</div>
<div id="group_by-and-across" class="section level3 hasAnchor" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> <code>group_by()</code> and <code>across()</code><a href="descriptive-statistics-and-data-manipulation.html#group_by-and-across" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To illustrate how <code>group_by()</code> works with <code>across()</code> I have to first modify the
<code>gasoline</code> data a little bit. As you can see below, the <code>year</code> column is of type integer:</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="descriptive-statistics-and-data-manipulation.html#cb483-1" aria-hidden="true" tabindex="-1"></a>gasoline</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77
##  2 austria  1961     4.10    -6.43 -0.351    -9.61
##  3 austria  1962     4.07    -6.41 -0.380    -9.46
##  4 austria  1963     4.06    -6.37 -0.414    -9.34
##  5 austria  1964     4.04    -6.32 -0.445    -9.24
##  6 austria  1965     4.03    -6.29 -0.497    -9.12
##  7 austria  1966     4.05    -6.25 -0.467    -9.02
##  8 austria  1967     4.05    -6.23 -0.506    -8.93
##  9 austria  1968     4.05    -6.21 -0.522    -8.85
## 10 austria  1969     4.05    -6.15 -0.559    -8.79
## # … with 332 more rows</code></pre>
<p>Let’s change that to character:</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="descriptive-statistics-and-data-manipulation.html#cb485-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb485-2"><a href="descriptive-statistics-and-data-manipulation.html#cb485-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.character</span>(year),</span>
<span id="cb485-3"><a href="descriptive-statistics-and-data-manipulation.html#cb485-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">country =</span> <span class="fu">as.character</span>(country))</span></code></pre></div>
<p>This now allows me to group by type of columns for instance:</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="descriptive-statistics-and-data-manipulation.html#cb486-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb486-2"><a href="descriptive-statistics-and-data-manipulation.html#cb486-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(is.character)) <span class="sc">%&gt;%</span></span>
<span id="cb486-3"><a href="descriptive-statistics-and-data-manipulation.html#cb486-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(lincomep))</span></code></pre></div>
<pre><code>## Warning: Predicate functions must be wrapped in `where()`.
## 
##   # Bad
##   data %&gt;% select(is.character)
## 
##   # Good
##   data %&gt;% select(where(is.character))
## 
## ℹ Please update your code.
## This message is displayed once per session.</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;country&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 342 × 3
## # Groups:   country [18]
##    country year  `mean(lincomep)`
##    &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;
##  1 austria 1960             -6.47
##  2 austria 1961             -6.43
##  3 austria 1962             -6.41
##  4 austria 1963             -6.37
##  5 austria 1964             -6.32
##  6 austria 1965             -6.29
##  7 austria 1966             -6.25
##  8 austria 1967             -6.23
##  9 austria 1968             -6.21
## 10 austria 1969             -6.15
## # … with 332 more rows</code></pre>
<p>This is faster than having to write:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="descriptive-statistics-and-data-manipulation.html#cb490-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb490-2"><a href="descriptive-statistics-and-data-manipulation.html#cb490-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span></span>
<span id="cb490-3"><a href="descriptive-statistics-and-data-manipulation.html#cb490-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">mean</span>(lincomep))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;country&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 342 × 3
## # Groups:   country [18]
##    country year  `mean(lincomep)`
##    &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;
##  1 austria 1960             -6.47
##  2 austria 1961             -6.43
##  3 austria 1962             -6.41
##  4 austria 1963             -6.37
##  5 austria 1964             -6.32
##  6 austria 1965             -6.29
##  7 austria 1966             -6.25
##  8 austria 1967             -6.23
##  9 austria 1968             -6.21
## 10 austria 1969             -6.15
## # … with 332 more rows</code></pre>
<p>You may think that having two write the name of two variables is not a huge hassle, which is true.
But imagine that you have dozens of character columns that you want to group by. Using <code>across()</code>
makes this very quick. It is also possible to <code>group_by()</code> position:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="descriptive-statistics-and-data-manipulation.html#cb493-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb493-2"><a href="descriptive-statistics-and-data-manipulation.html#cb493-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb493-3"><a href="descriptive-statistics-and-data-manipulation.html#cb493-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">mean</span>(lincomep))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;country&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 342 × 3
## # Groups:   country [18]
##    country year  `mean(lincomep)`
##    &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;
##  1 austria 1960             -6.47
##  2 austria 1961             -6.43
##  3 austria 1962             -6.41
##  4 austria 1963             -6.37
##  5 austria 1964             -6.32
##  6 austria 1965             -6.29
##  7 austria 1966             -6.25
##  8 austria 1967             -6.23
##  9 austria 1968             -6.21
## 10 austria 1969             -6.15
## # … with 332 more rows</code></pre>
<p>Using a sequence is also possible:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="descriptive-statistics-and-data-manipulation.html#cb496-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb496-2"><a href="descriptive-statistics-and-data-manipulation.html#cb496-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb496-3"><a href="descriptive-statistics-and-data-manipulation.html#cb496-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(lincomep))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;country&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 342 × 3
## # Groups:   country [18]
##    country year  `mean(lincomep)`
##    &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;
##  1 austria 1960             -6.47
##  2 austria 1961             -6.43
##  3 austria 1962             -6.41
##  4 austria 1963             -6.37
##  5 austria 1964             -6.32
##  6 austria 1965             -6.29
##  7 austria 1966             -6.25
##  8 austria 1967             -6.23
##  9 austria 1968             -6.21
## 10 austria 1969             -6.15
## # … with 332 more rows</code></pre>
<p>it is especially useful if you need to group by the first <code>N</code> columns for instance.</p>
</div>
<div id="summarise-across-many-columns" class="section level3 hasAnchor" number="4.5.4">
<h3><span class="header-section-number">4.5.4</span> <code>summarise()</code> across many columns<a href="descriptive-statistics-and-data-manipulation.html#summarise-across-many-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Just like for <code>filter()</code>, and <code>group_by()</code>, <code>summarise()</code> supports <code>across()</code>:</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="descriptive-statistics-and-data-manipulation.html#cb499-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb499-2"><a href="descriptive-statistics-and-data-manipulation.html#cb499-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb499-3"><a href="descriptive-statistics-and-data-manipulation.html#cb499-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;l&quot;</span>), mean))</span></code></pre></div>
<pre><code>## # A tibble: 18 × 5
##    country  lgaspcar lincomep   lrpmg lcarpcap
##    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria      4.06    -6.12 -0.486     -8.85
##  2 belgium      3.92    -5.85 -0.326     -8.63
##  3 canada       4.86    -5.58 -1.05      -8.08
##  4 denmark      4.19    -5.76 -0.358     -8.58
##  5 france       3.82    -5.87 -0.253     -8.45
##  6 germany      3.89    -5.85 -0.517     -8.51
##  7 greece       4.88    -6.61 -0.0339   -10.8 
##  8 ireland      4.23    -6.44 -0.348     -9.04
##  9 italy        3.73    -6.35 -0.152     -8.83
## 10 japan        4.70    -6.25 -0.287     -9.95
## 11 netherla     4.08    -5.92 -0.370     -8.82
## 12 norway       4.11    -5.75 -0.278     -8.77
## 13 spain        4.06    -5.63  0.739     -9.90
## 14 sweden       4.01    -7.82 -2.71      -8.25
## 15 switzerl     4.24    -5.93 -0.902     -8.54
## 16 turkey       5.77    -7.34 -0.422    -12.5 
## 17 u.k.         3.98    -6.02 -0.459     -8.55
## 18 u.s.a.       4.82    -5.45 -1.21      -7.78</code></pre>
<p>But where <code>summarise()</code> and <code>across()</code> really shine is when you want to apply several functions
to many columns at once:</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="descriptive-statistics-and-data-manipulation.html#cb501-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb501-2"><a href="descriptive-statistics-and-data-manipulation.html#cb501-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb501-3"><a href="descriptive-statistics-and-data-manipulation.html#cb501-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;l&quot;</span>), tibble<span class="sc">::</span><span class="fu">lst</span>(mean, sd, max, min), <span class="at">.names =</span> <span class="st">&quot;{fn}_{col}&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 18 × 17
##    country  mean_lgaspcar sd_lgaspcar max_lgaspcar min_lgaspcar mean_lincomep
##    &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
##  1 austria           4.06      0.0693         4.20         3.92         -6.12
##  2 belgium           3.92      0.103          4.16         3.82         -5.85
##  3 canada            4.86      0.0262         4.90         4.81         -5.58
##  4 denmark           4.19      0.158          4.50         4.00         -5.76
##  5 france            3.82      0.0499         3.91         3.75         -5.87
##  6 germany           3.89      0.0239         3.93         3.85         -5.85
##  7 greece            4.88      0.255          5.38         4.48         -6.61
##  8 ireland           4.23      0.0437         4.33         4.16         -6.44
##  9 italy             3.73      0.220          4.05         3.38         -6.35
## 10 japan             4.70      0.684          6.00         3.95         -6.25
## 11 netherla          4.08      0.286          4.65         3.71         -5.92
## 12 norway            4.11      0.123          4.44         3.96         -5.75
## 13 spain             4.06      0.317          4.75         3.62         -5.63
## 14 sweden            4.01      0.0364         4.07         3.91         -7.82
## 15 switzerl          4.24      0.102          4.44         4.05         -5.93
## 16 turkey            5.77      0.329          6.16         5.14         -7.34
## 17 u.k.              3.98      0.0479         4.10         3.91         -6.02
## 18 u.s.a.            4.82      0.0219         4.86         4.79         -5.45
## # … with 11 more variables: sd_lincomep &lt;dbl&gt;, max_lincomep &lt;dbl&gt;,
## #   min_lincomep &lt;dbl&gt;, mean_lrpmg &lt;dbl&gt;, sd_lrpmg &lt;dbl&gt;, max_lrpmg &lt;dbl&gt;,
## #   min_lrpmg &lt;dbl&gt;, mean_lcarpcap &lt;dbl&gt;, sd_lcarpcap &lt;dbl&gt;,
## #   max_lcarpcap &lt;dbl&gt;, min_lcarpcap &lt;dbl&gt;</code></pre>
<p>Here, I first started by grouping by <code>country</code>, then I applied the <code>mean()</code>, <code>sd()</code>, <code>max()</code> and
<code>min()</code> functions to every column starting with the character <code>"l"</code>. <code>tibble::lst()</code> allows you to
create a list just like with <code>list()</code> but names its arguments automatically. So the <code>mean()</code> function
gets name <code>"mean"</code>, and so on. Finally, I use the <code>.names =</code> argument to create the template for
the new column names. <code>{fn}_{col}</code> creates new column names of the form <em>function name _ column name</em>.</p>
<p>As mentioned before, <code>across()</code> works with other helper functions:</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="descriptive-statistics-and-data-manipulation.html#cb503-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb503-2"><a href="descriptive-statistics-and-data-manipulation.html#cb503-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb503-3"><a href="descriptive-statistics-and-data-manipulation.html#cb503-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;car&quot;</span>), tibble<span class="sc">::</span><span class="fu">lst</span>(mean, sd, max, min), <span class="at">.names =</span> <span class="st">&quot;{fn}_{col}&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 18 × 9
##    country  mean_lgaspcar sd_lgaspcar max_lgaspcar min_lgaspcar mean_lcarpcap
##    &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
##  1 austria           4.06      0.0693         4.20         3.92         -8.85
##  2 belgium           3.92      0.103          4.16         3.82         -8.63
##  3 canada            4.86      0.0262         4.90         4.81         -8.08
##  4 denmark           4.19      0.158          4.50         4.00         -8.58
##  5 france            3.82      0.0499         3.91         3.75         -8.45
##  6 germany           3.89      0.0239         3.93         3.85         -8.51
##  7 greece            4.88      0.255          5.38         4.48        -10.8 
##  8 ireland           4.23      0.0437         4.33         4.16         -9.04
##  9 italy             3.73      0.220          4.05         3.38         -8.83
## 10 japan             4.70      0.684          6.00         3.95         -9.95
## 11 netherla          4.08      0.286          4.65         3.71         -8.82
## 12 norway            4.11      0.123          4.44         3.96         -8.77
## 13 spain             4.06      0.317          4.75         3.62         -9.90
## 14 sweden            4.01      0.0364         4.07         3.91         -8.25
## 15 switzerl          4.24      0.102          4.44         4.05         -8.54
## 16 turkey            5.77      0.329          6.16         5.14        -12.5 
## 17 u.k.              3.98      0.0479         4.10         3.91         -8.55
## 18 u.s.a.            4.82      0.0219         4.86         4.79         -7.78
## # … with 3 more variables: sd_lcarpcap &lt;dbl&gt;, max_lcarpcap &lt;dbl&gt;,
## #   min_lcarpcap &lt;dbl&gt;</code></pre>
<p>I write <code>dplyr::contains()</code> instead of simply <code>contains()</code> because there’s also a
<code>purrr::contains()</code>. If you load <code>purrr</code> after <code>dplyr</code>, <code>contains()</code> will actually be
<code>purrr::contains()</code> and not <code>dplyr::contains()</code> which causes the above code to fail.</p>
<p>There’s also a way to <em>summarise if</em>:</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="descriptive-statistics-and-data-manipulation.html#cb505-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb505-2"><a href="descriptive-statistics-and-data-manipulation.html#cb505-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb505-3"><a href="descriptive-statistics-and-data-manipulation.html#cb505-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(is.numeric, tibble<span class="sc">::</span><span class="fu">lst</span>(mean, sd, min, max), <span class="at">.names =</span> <span class="st">&quot;{fn}_{col}&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 18 × 17
##    country  mean_lgaspcar sd_lgaspcar min_lgaspcar max_lgaspcar mean_lincomep
##    &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
##  1 austria           4.06      0.0693         3.92         4.20         -6.12
##  2 belgium           3.92      0.103          3.82         4.16         -5.85
##  3 canada            4.86      0.0262         4.81         4.90         -5.58
##  4 denmark           4.19      0.158          4.00         4.50         -5.76
##  5 france            3.82      0.0499         3.75         3.91         -5.87
##  6 germany           3.89      0.0239         3.85         3.93         -5.85
##  7 greece            4.88      0.255          4.48         5.38         -6.61
##  8 ireland           4.23      0.0437         4.16         4.33         -6.44
##  9 italy             3.73      0.220          3.38         4.05         -6.35
## 10 japan             4.70      0.684          3.95         6.00         -6.25
## 11 netherla          4.08      0.286          3.71         4.65         -5.92
## 12 norway            4.11      0.123          3.96         4.44         -5.75
## 13 spain             4.06      0.317          3.62         4.75         -5.63
## 14 sweden            4.01      0.0364         3.91         4.07         -7.82
## 15 switzerl          4.24      0.102          4.05         4.44         -5.93
## 16 turkey            5.77      0.329          5.14         6.16         -7.34
## 17 u.k.              3.98      0.0479         3.91         4.10         -6.02
## 18 u.s.a.            4.82      0.0219         4.79         4.86         -5.45
## # … with 11 more variables: sd_lincomep &lt;dbl&gt;, min_lincomep &lt;dbl&gt;,
## #   max_lincomep &lt;dbl&gt;, mean_lrpmg &lt;dbl&gt;, sd_lrpmg &lt;dbl&gt;, min_lrpmg &lt;dbl&gt;,
## #   max_lrpmg &lt;dbl&gt;, mean_lcarpcap &lt;dbl&gt;, sd_lcarpcap &lt;dbl&gt;,
## #   min_lcarpcap &lt;dbl&gt;, max_lcarpcap &lt;dbl&gt;</code></pre>
<p>This allows you to summarise every column that contain real numbers. The difference between
<code>is.double()</code> and <code>is.numeric()</code> is that <code>is.numeric()</code> returns <code>TRUE</code> for integers too, whereas
<code>is.double()</code> returns <code>TRUE</code> for real numbers only (integers are real numbers too, but you know
what I mean). It is also possible to summarise every column at once:</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="descriptive-statistics-and-data-manipulation.html#cb507-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb507-2"><a href="descriptive-statistics-and-data-manipulation.html#cb507-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>year) <span class="sc">%&gt;%</span></span>
<span id="cb507-3"><a href="descriptive-statistics-and-data-manipulation.html#cb507-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb507-4"><a href="descriptive-statistics-and-data-manipulation.html#cb507-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), tibble<span class="sc">::</span><span class="fu">lst</span>(mean, sd, min, max), <span class="at">.names =</span> <span class="st">&quot;{fn}_{col}&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 18 × 17
##    country  mean_lgaspcar sd_lgaspcar min_lgaspcar max_lgaspcar mean_lincomep
##    &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
##  1 austria           4.06      0.0693         3.92         4.20         -6.12
##  2 belgium           3.92      0.103          3.82         4.16         -5.85
##  3 canada            4.86      0.0262         4.81         4.90         -5.58
##  4 denmark           4.19      0.158          4.00         4.50         -5.76
##  5 france            3.82      0.0499         3.75         3.91         -5.87
##  6 germany           3.89      0.0239         3.85         3.93         -5.85
##  7 greece            4.88      0.255          4.48         5.38         -6.61
##  8 ireland           4.23      0.0437         4.16         4.33         -6.44
##  9 italy             3.73      0.220          3.38         4.05         -6.35
## 10 japan             4.70      0.684          3.95         6.00         -6.25
## 11 netherla          4.08      0.286          3.71         4.65         -5.92
## 12 norway            4.11      0.123          3.96         4.44         -5.75
## 13 spain             4.06      0.317          3.62         4.75         -5.63
## 14 sweden            4.01      0.0364         3.91         4.07         -7.82
## 15 switzerl          4.24      0.102          4.05         4.44         -5.93
## 16 turkey            5.77      0.329          5.14         6.16         -7.34
## 17 u.k.              3.98      0.0479         3.91         4.10         -6.02
## 18 u.s.a.            4.82      0.0219         4.79         4.86         -5.45
## # … with 11 more variables: sd_lincomep &lt;dbl&gt;, min_lincomep &lt;dbl&gt;,
## #   max_lincomep &lt;dbl&gt;, mean_lrpmg &lt;dbl&gt;, sd_lrpmg &lt;dbl&gt;, min_lrpmg &lt;dbl&gt;,
## #   max_lrpmg &lt;dbl&gt;, mean_lcarpcap &lt;dbl&gt;, sd_lcarpcap &lt;dbl&gt;,
## #   min_lcarpcap &lt;dbl&gt;, max_lcarpcap &lt;dbl&gt;</code></pre>
<p>I removed the <code>year</code> variable because it’s not a variable for which we want to have descriptive
statistics.</p>
</div>
</div>
<div id="other-useful-tidyverse-functions" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Other useful <code>{tidyverse}</code> functions<a href="descriptive-statistics-and-data-manipulation.html#other-useful-tidyverse-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="if_else-case_when-and-recode" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> <code>if_else()</code>, <code>case_when()</code> and <code>recode()</code><a href="descriptive-statistics-and-data-manipulation.html#if_else-case_when-and-recode" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some other very useful <code>{tidyverse}</code> functions are <code>if_else()</code> and <code>case_when</code>. These two
functions, combined with <code>mutate()</code> make it easy to create a new variable whose values must
respect certain conditions. For instance, we might want to have a dummy that equals <code>1</code> if a country
in the European Union (to simplify, say as of 2017) and <code>0</code> if not. First let’s create a list of
countries that are in the EU:</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="descriptive-statistics-and-data-manipulation.html#cb509-1" aria-hidden="true" tabindex="-1"></a>eu_countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;austria&quot;</span>, <span class="st">&quot;belgium&quot;</span>, <span class="st">&quot;bulgaria&quot;</span>, <span class="st">&quot;croatia&quot;</span>, <span class="st">&quot;republic of cyprus&quot;</span>,</span>
<span id="cb509-2"><a href="descriptive-statistics-and-data-manipulation.html#cb509-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;czech republic&quot;</span>, <span class="st">&quot;denmark&quot;</span>, <span class="st">&quot;estonia&quot;</span>, <span class="st">&quot;finland&quot;</span>, <span class="st">&quot;france&quot;</span>, <span class="st">&quot;germany&quot;</span>,</span>
<span id="cb509-3"><a href="descriptive-statistics-and-data-manipulation.html#cb509-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;greece&quot;</span>, <span class="st">&quot;hungary&quot;</span>, <span class="st">&quot;ireland&quot;</span>, <span class="st">&quot;italy&quot;</span>, <span class="st">&quot;latvia&quot;</span>, <span class="st">&quot;lithuania&quot;</span>, <span class="st">&quot;luxembourg&quot;</span>,</span>
<span id="cb509-4"><a href="descriptive-statistics-and-data-manipulation.html#cb509-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;malta&quot;</span>, <span class="st">&quot;netherla&quot;</span>, <span class="st">&quot;poland&quot;</span>, <span class="st">&quot;portugal&quot;</span>, <span class="st">&quot;romania&quot;</span>, <span class="st">&quot;slovakia&quot;</span>, <span class="st">&quot;slovenia&quot;</span>,</span>
<span id="cb509-5"><a href="descriptive-statistics-and-data-manipulation.html#cb509-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;spain&quot;</span>, <span class="st">&quot;sweden&quot;</span>, <span class="st">&quot;u.k.&quot;</span>)</span></code></pre></div>
<p>I’ve had to change “netherlands” to “netherla” because that’s how the country is called in the
<code>gasoline</code> data. Now let’s create a dummy variable that equals <code>1</code> for EU countries, and <code>0</code> for the others:</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="descriptive-statistics-and-data-manipulation.html#cb510-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb510-2"><a href="descriptive-statistics-and-data-manipulation.html#cb510-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">tolower</span>(country)) <span class="sc">%&gt;%</span></span>
<span id="cb510-3"><a href="descriptive-statistics-and-data-manipulation.html#cb510-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_eu =</span> <span class="fu">if_else</span>(country <span class="sc">%in%</span> eu_countries, <span class="dv">1</span>, <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## # A tibble: 342 × 7
##    country  year lgaspcar lincomep  lrpmg lcarpcap in_eu
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77     1
##  2 austria  1961     4.10    -6.43 -0.351    -9.61     1
##  3 austria  1962     4.07    -6.41 -0.380    -9.46     1
##  4 austria  1963     4.06    -6.37 -0.414    -9.34     1
##  5 austria  1964     4.04    -6.32 -0.445    -9.24     1
##  6 austria  1965     4.03    -6.29 -0.497    -9.12     1
##  7 austria  1966     4.05    -6.25 -0.467    -9.02     1
##  8 austria  1967     4.05    -6.23 -0.506    -8.93     1
##  9 austria  1968     4.05    -6.21 -0.522    -8.85     1
## 10 austria  1969     4.05    -6.15 -0.559    -8.79     1
## # … with 332 more rows</code></pre>
<p>Instead of <code>1</code> and <code>0</code>, we can of course use strings (I add <code>filter(year == 1960)</code> at the end to
have a better view of what happened):</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="descriptive-statistics-and-data-manipulation.html#cb512-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb512-2"><a href="descriptive-statistics-and-data-manipulation.html#cb512-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">tolower</span>(country)) <span class="sc">%&gt;%</span></span>
<span id="cb512-3"><a href="descriptive-statistics-and-data-manipulation.html#cb512-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_eu =</span> <span class="fu">if_else</span>(country <span class="sc">%in%</span> eu_countries, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb512-4"><a href="descriptive-statistics-and-data-manipulation.html#cb512-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1960</span>)</span></code></pre></div>
<pre><code>## # A tibble: 18 × 7
##    country   year lgaspcar lincomep   lrpmg lcarpcap in_eu
##    &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;
##  1 austria   1960     4.17    -6.47 -0.335     -9.77 yes  
##  2 belgium   1960     4.16    -6.22 -0.166     -9.41 yes  
##  3 canada    1960     4.86    -5.89 -0.972     -8.38 no   
##  4 denmark   1960     4.50    -6.06 -0.196     -9.33 yes  
##  5 france    1960     3.91    -6.26 -0.0196    -9.15 yes  
##  6 germany   1960     3.92    -6.16 -0.186     -9.34 yes  
##  7 greece    1960     5.04    -7.16 -0.0835   -12.2  yes  
##  8 ireland   1960     4.27    -6.72 -0.0765    -9.70 yes  
##  9 italy     1960     4.05    -6.73  0.165    -10.1  yes  
## 10 japan     1960     6.00    -6.99 -0.145    -12.2  no   
## 11 netherla  1960     4.65    -6.22 -0.201    -10.0  yes  
## 12 norway    1960     4.44    -6.09 -0.140     -9.68 no   
## 13 spain     1960     4.75    -6.17  1.13     -11.6  yes  
## 14 sweden    1960     4.06    -8.07 -2.52      -8.74 yes  
## 15 switzerl  1960     4.40    -6.16 -0.823     -9.26 no   
## 16 turkey    1960     6.13    -7.80 -0.253    -13.5  no   
## 17 u.k.      1960     4.10    -6.19 -0.391     -9.12 yes  
## 18 u.s.a.    1960     4.82    -5.70 -1.12      -8.02 no</code></pre>
<p>I think that <code>if_else()</code> is fairly straightforward, especially if you know <code>ifelse()</code> already. You
might be wondering what is the difference between these two. <code>if_else()</code> is stricter than
<code>ifelse()</code> and does not do type conversion. Compare the two next lines:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="descriptive-statistics-and-data-manipulation.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="dv">1</span> <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;0&quot;</span>, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;0&quot;</code></pre>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="descriptive-statistics-and-data-manipulation.html#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="dv">1</span> <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;0&quot;</span>, <span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="descriptive-statistics-and-data-manipulation.html#cb517-1" aria-hidden="true" tabindex="-1"></a>Error<span class="sc">:</span> <span class="st">`</span><span class="at">false</span><span class="st">`</span> must be type string, not double</span></code></pre></div>
<p>Type conversion, especially without a warning is very dangerous. <code>if_else()</code>’s behaviour which
consists in failing as soon as possble avoids a lot of pain and suffering, especially when
programming non-interactively.</p>
<p><code>if_else()</code> also accepts an optional argument, that allows you to specify what should be returned
in case of <code>NA</code>:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="descriptive-statistics-and-data-manipulation.html#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="dv">1</span> <span class="sc">&lt;=</span> <span class="cn">NA</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">999</span>)</span></code></pre></div>
<pre><code>## [1] 999</code></pre>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="descriptive-statistics-and-data-manipulation.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Or</span></span>
<span id="cb520-2"><a href="descriptive-statistics-and-data-manipulation.html#cb520-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(<span class="dv">1</span> <span class="sc">&lt;=</span> <span class="cn">NA</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="cn">NA_real_</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p><code>case_when()</code> can be seen as a generalization of <code>if_else()</code>. Whenever you want to use multiple
<code>if_else()</code>s, that’s when you know you should use <code>case_when()</code> (I’m adding the filter at the end
for the same reason as before, to see the output better):</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="descriptive-statistics-and-data-manipulation.html#cb522-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb522-2"><a href="descriptive-statistics-and-data-manipulation.html#cb522-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">tolower</span>(country)) <span class="sc">%&gt;%</span></span>
<span id="cb522-3"><a href="descriptive-statistics-and-data-manipulation.html#cb522-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb522-4"><a href="descriptive-statistics-and-data-manipulation.html#cb522-4" aria-hidden="true" tabindex="-1"></a>           country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;france&quot;</span>, <span class="st">&quot;italy&quot;</span>, <span class="st">&quot;turkey&quot;</span>, <span class="st">&quot;greece&quot;</span>, <span class="st">&quot;spain&quot;</span>) <span class="sc">~</span> <span class="st">&quot;mediterranean&quot;</span>,</span>
<span id="cb522-5"><a href="descriptive-statistics-and-data-manipulation.html#cb522-5" aria-hidden="true" tabindex="-1"></a>           country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;germany&quot;</span>, <span class="st">&quot;austria&quot;</span>, <span class="st">&quot;switzerl&quot;</span>, <span class="st">&quot;belgium&quot;</span>, <span class="st">&quot;netherla&quot;</span>) <span class="sc">~</span> <span class="st">&quot;central europe&quot;</span>,</span>
<span id="cb522-6"><a href="descriptive-statistics-and-data-manipulation.html#cb522-6" aria-hidden="true" tabindex="-1"></a>           country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;canada&quot;</span>, <span class="st">&quot;u.s.a.&quot;</span>, <span class="st">&quot;u.k.&quot;</span>, <span class="st">&quot;ireland&quot;</span>) <span class="sc">~</span> <span class="st">&quot;anglosphere&quot;</span>,</span>
<span id="cb522-7"><a href="descriptive-statistics-and-data-manipulation.html#cb522-7" aria-hidden="true" tabindex="-1"></a>           country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;denmark&quot;</span>, <span class="st">&quot;norway&quot;</span>, <span class="st">&quot;sweden&quot;</span>) <span class="sc">~</span> <span class="st">&quot;nordic&quot;</span>,</span>
<span id="cb522-8"><a href="descriptive-statistics-and-data-manipulation.html#cb522-8" aria-hidden="true" tabindex="-1"></a>           country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;japan&quot;</span>) <span class="sc">~</span> <span class="st">&quot;asia&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb522-9"><a href="descriptive-statistics-and-data-manipulation.html#cb522-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1960</span>)</span></code></pre></div>
<pre><code>## # A tibble: 18 × 7
##    country   year lgaspcar lincomep   lrpmg lcarpcap region        
##    &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         
##  1 austria   1960     4.17    -6.47 -0.335     -9.77 central europe
##  2 belgium   1960     4.16    -6.22 -0.166     -9.41 central europe
##  3 canada    1960     4.86    -5.89 -0.972     -8.38 anglosphere   
##  4 denmark   1960     4.50    -6.06 -0.196     -9.33 nordic        
##  5 france    1960     3.91    -6.26 -0.0196    -9.15 mediterranean 
##  6 germany   1960     3.92    -6.16 -0.186     -9.34 central europe
##  7 greece    1960     5.04    -7.16 -0.0835   -12.2  mediterranean 
##  8 ireland   1960     4.27    -6.72 -0.0765    -9.70 anglosphere   
##  9 italy     1960     4.05    -6.73  0.165    -10.1  mediterranean 
## 10 japan     1960     6.00    -6.99 -0.145    -12.2  asia          
## 11 netherla  1960     4.65    -6.22 -0.201    -10.0  central europe
## 12 norway    1960     4.44    -6.09 -0.140     -9.68 nordic        
## 13 spain     1960     4.75    -6.17  1.13     -11.6  mediterranean 
## 14 sweden    1960     4.06    -8.07 -2.52      -8.74 nordic        
## 15 switzerl  1960     4.40    -6.16 -0.823     -9.26 central europe
## 16 turkey    1960     6.13    -7.80 -0.253    -13.5  mediterranean 
## 17 u.k.      1960     4.10    -6.19 -0.391     -9.12 anglosphere   
## 18 u.s.a.    1960     4.82    -5.70 -1.12      -8.02 anglosphere</code></pre>
<p>If all you want is to recode values, you can use <code>recode()</code>. For example, the Netherlands is
written as “NETHERLA” in the <code>gasoline</code> data, which is quite ugly. Same for Switzerland:</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="descriptive-statistics-and-data-manipulation.html#cb524-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb524-2"><a href="descriptive-statistics-and-data-manipulation.html#cb524-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">tolower</span>(country)) <span class="sc">%&gt;%</span></span>
<span id="cb524-3"><a href="descriptive-statistics-and-data-manipulation.html#cb524-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">recode</span>(country, <span class="st">&quot;netherla&quot;</span> <span class="ot">=</span> <span class="st">&quot;netherlands&quot;</span>, <span class="st">&quot;switzerl&quot;</span> <span class="ot">=</span> <span class="st">&quot;switzerland&quot;</span>))</span></code></pre></div>
<p>I saved the data with these changes as they will become useful in the future. Let’s take a look at
the data:</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="descriptive-statistics-and-data-manipulation.html#cb525-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb525-2"><a href="descriptive-statistics-and-data-manipulation.html#cb525-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;netherlands&quot;</span>, <span class="st">&quot;switzerland&quot;</span>), year <span class="sc">==</span> <span class="dv">1960</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   country      year lgaspcar lincomep  lrpmg lcarpcap
##   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
## 1 netherlands  1960     4.65    -6.22 -0.201   -10.0 
## 2 switzerland  1960     4.40    -6.16 -0.823    -9.26</code></pre>
</div>
<div id="lead-and-lag" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> <code>lead()</code> and <code>lag()</code><a href="descriptive-statistics-and-data-manipulation.html#lead-and-lag" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>lead()</code> and <code>lag()</code> are especially useful in econometrics. When I was doing my masters, in 4 B.d.
(<em>Before dplyr</em>) lagging variables in panel data was quite tricky. Now, with <code>dplyr</code> it’s really
very easy:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="descriptive-statistics-and-data-manipulation.html#cb527-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb527-2"><a href="descriptive-statistics-and-data-manipulation.html#cb527-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb527-3"><a href="descriptive-statistics-and-data-manipulation.html#cb527-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lag_lgaspcar =</span> <span class="fu">lag</span>(lgaspcar)) <span class="sc">%&gt;%</span></span>
<span id="cb527-4"><a href="descriptive-statistics-and-data-manipulation.html#cb527-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lead_lgaspcar =</span> <span class="fu">lead</span>(lgaspcar)) <span class="sc">%&gt;%</span></span>
<span id="cb527-5"><a href="descriptive-statistics-and-data-manipulation.html#cb527-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1960</span>, <span class="dv">1963</span>))</span></code></pre></div>
<pre><code>## # A tibble: 72 × 8
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap lag_lgaspcar lead_lgaspcar
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77        NA             4.10
##  2 austria  1961     4.10    -6.43 -0.351    -9.61         4.17          4.07
##  3 austria  1962     4.07    -6.41 -0.380    -9.46         4.10          4.06
##  4 austria  1963     4.06    -6.37 -0.414    -9.34         4.07          4.04
##  5 belgium  1960     4.16    -6.22 -0.166    -9.41        NA             4.12
##  6 belgium  1961     4.12    -6.18 -0.172    -9.30         4.16          4.08
##  7 belgium  1962     4.08    -6.13 -0.222    -9.22         4.12          4.00
##  8 belgium  1963     4.00    -6.09 -0.250    -9.11         4.08          3.99
##  9 canada   1960     4.86    -5.89 -0.972    -8.38        NA             4.83
## 10 canada   1961     4.83    -5.88 -0.972    -8.35         4.86          4.85
## # … with 62 more rows</code></pre>
<p>To lag every variable, remember that you can use <code>mutate_if()</code>:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="descriptive-statistics-and-data-manipulation.html#cb529-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb529-2"><a href="descriptive-statistics-and-data-manipulation.html#cb529-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb529-3"><a href="descriptive-statistics-and-data-manipulation.html#cb529-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, lag) <span class="sc">%&gt;%</span></span>
<span id="cb529-4"><a href="descriptive-statistics-and-data-manipulation.html#cb529-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1960</span>, <span class="dv">1963</span>))</span></code></pre></div>
<pre><code>## `mutate_if()` ignored the following grouping variables:
## • Column `country`</code></pre>
<pre><code>## # A tibble: 72 × 6
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77
##  2 austria  1961     4.10    -6.43 -0.351    -9.61
##  3 austria  1962     4.07    -6.41 -0.380    -9.46
##  4 austria  1963     4.06    -6.37 -0.414    -9.34
##  5 belgium  1960     4.16    -6.22 -0.166    -9.41
##  6 belgium  1961     4.12    -6.18 -0.172    -9.30
##  7 belgium  1962     4.08    -6.13 -0.222    -9.22
##  8 belgium  1963     4.00    -6.09 -0.250    -9.11
##  9 canada   1960     4.86    -5.89 -0.972    -8.38
## 10 canada   1961     4.83    -5.88 -0.972    -8.35
## # … with 62 more rows</code></pre>
<p>you can replace <code>lag()</code> with <code>lead()</code>, but just keep in mind that the columns get transformed in
place.</p>
</div>
<div id="ntile" class="section level3 hasAnchor" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> <code>ntile()</code><a href="descriptive-statistics-and-data-manipulation.html#ntile" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The last helper function I will discuss is <code>ntile()</code>. There are some other, so do read <code>mutate()</code>’s
documentation with <code>help(mutate)</code>!</p>
<p>If you need quantiles, you need <code>ntile()</code>. Let’s see how it works:</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="descriptive-statistics-and-data-manipulation.html#cb532-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb532-2"><a href="descriptive-statistics-and-data-manipulation.html#cb532-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quintile =</span> <span class="fu">ntile</span>(lgaspcar, <span class="dv">5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb532-3"><a href="descriptive-statistics-and-data-manipulation.html#cb532-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decile =</span> <span class="fu">ntile</span>(lgaspcar, <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb532-4"><a href="descriptive-statistics-and-data-manipulation.html#cb532-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, lgaspcar, quintile, decile)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 5
##    country  year lgaspcar quintile decile
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;int&gt;  &lt;int&gt;
##  1 austria  1960     4.17        3      6
##  2 austria  1961     4.10        3      6
##  3 austria  1962     4.07        3      5
##  4 austria  1963     4.06        3      5
##  5 austria  1964     4.04        3      5
##  6 austria  1965     4.03        3      5
##  7 austria  1966     4.05        3      5
##  8 austria  1967     4.05        3      5
##  9 austria  1968     4.05        3      5
## 10 austria  1969     4.05        3      5
## # … with 332 more rows</code></pre>
<p><code>quintile</code> and <code>decile</code> do not hold the values but the quantile the value lies in. If you want to
have a column that contains the median for instance, you can use good ol’ <code>quantile()</code>:</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="descriptive-statistics-and-data-manipulation.html#cb534-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb534-2"><a href="descriptive-statistics-and-data-manipulation.html#cb534-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb534-3"><a href="descriptive-statistics-and-data-manipulation.html#cb534-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median =</span> <span class="fu">quantile</span>(lgaspcar, <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> <span class="co"># quantile(x, 0.5) is equivalent to median(x)</span></span>
<span id="cb534-4"><a href="descriptive-statistics-and-data-manipulation.html#cb534-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1960</span>) <span class="sc">%&gt;%</span></span>
<span id="cb534-5"><a href="descriptive-statistics-and-data-manipulation.html#cb534-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, median)</span></code></pre></div>
<pre><code>## # A tibble: 18 × 3
## # Groups:   country [18]
##    country      year median
##    &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;
##  1 austria      1960   4.05
##  2 belgium      1960   3.88
##  3 canada       1960   4.86
##  4 denmark      1960   4.16
##  5 france       1960   3.81
##  6 germany      1960   3.89
##  7 greece       1960   4.89
##  8 ireland      1960   4.22
##  9 italy        1960   3.74
## 10 japan        1960   4.52
## 11 netherlands  1960   3.99
## 12 norway       1960   4.08
## 13 spain        1960   3.99
## 14 sweden       1960   4.00
## 15 switzerland  1960   4.26
## 16 turkey       1960   5.72
## 17 u.k.         1960   3.98
## 18 u.s.a.       1960   4.81</code></pre>
</div>
<div id="arrange" class="section level3 hasAnchor" number="4.6.4">
<h3><span class="header-section-number">4.6.4</span> <code>arrange()</code><a href="descriptive-statistics-and-data-manipulation.html#arrange" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>arrange()</code> re-orders the whole <code>tibble</code> according to values of the supplied variable:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="descriptive-statistics-and-data-manipulation.html#cb536-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb536-2"><a href="descriptive-statistics-and-data-manipulation.html#cb536-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lgaspcar)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
##    country  year lgaspcar lincomep   lrpmg lcarpcap
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 italy    1977     3.38    -6.10  0.164     -8.15
##  2 italy    1978     3.39    -6.08  0.0348    -8.11
##  3 italy    1976     3.43    -6.12  0.103     -8.17
##  4 italy    1974     3.50    -6.13 -0.223     -8.26
##  5 italy    1975     3.52    -6.17 -0.0327    -8.22
##  6 spain    1978     3.62    -5.29  0.621     -8.63
##  7 italy    1972     3.63    -6.21 -0.215     -8.38
##  8 italy    1971     3.65    -6.22 -0.148     -8.47
##  9 spain    1977     3.65    -5.30  0.526     -8.73
## 10 italy    1973     3.65    -6.16 -0.325     -8.32
## # … with 332 more rows</code></pre>
<p>If you want to re-order the <code>tibble</code> in descending order of the variable:</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="descriptive-statistics-and-data-manipulation.html#cb538-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb538-2"><a href="descriptive-statistics-and-data-manipulation.html#cb538-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lgaspcar))</span></code></pre></div>
<pre><code>## # A tibble: 342 × 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 turkey   1966     6.16    -7.51 -0.356    -13.0
##  2 turkey   1960     6.13    -7.80 -0.253    -13.5
##  3 turkey   1961     6.11    -7.79 -0.343    -13.4
##  4 turkey   1962     6.08    -7.84 -0.408    -13.2
##  5 turkey   1968     6.08    -7.42 -0.365    -12.8
##  6 turkey   1963     6.08    -7.63 -0.225    -13.3
##  7 turkey   1964     6.06    -7.63 -0.252    -13.2
##  8 turkey   1967     6.04    -7.46 -0.335    -12.8
##  9 japan    1960     6.00    -6.99 -0.145    -12.2
## 10 turkey   1965     5.82    -7.62 -0.293    -12.9
## # … with 332 more rows</code></pre>
<p><code>arrange</code>’s documentation alerts the user that re-ording by group is only possible by explicitely
specifying an option:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="descriptive-statistics-and-data-manipulation.html#cb540-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb540-2"><a href="descriptive-statistics-and-data-manipulation.html#cb540-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1960</span>, <span class="dv">1963</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb540-3"><a href="descriptive-statistics-and-data-manipulation.html#cb540-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb540-4"><a href="descriptive-statistics-and-data-manipulation.html#cb540-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lgaspcar), <span class="at">.by_group =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 72 × 6
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77
##  2 austria  1961     4.10    -6.43 -0.351    -9.61
##  3 austria  1962     4.07    -6.41 -0.380    -9.46
##  4 austria  1963     4.06    -6.37 -0.414    -9.34
##  5 belgium  1960     4.16    -6.22 -0.166    -9.41
##  6 belgium  1961     4.12    -6.18 -0.172    -9.30
##  7 belgium  1962     4.08    -6.13 -0.222    -9.22
##  8 belgium  1963     4.00    -6.09 -0.250    -9.11
##  9 canada   1960     4.86    -5.89 -0.972    -8.38
## 10 canada   1962     4.85    -5.84 -0.979    -8.32
## # … with 62 more rows</code></pre>
<p>This is especially useful for plotting. We’ll see this in Chapter 6.</p>
</div>
<div id="tally-and-count" class="section level3 hasAnchor" number="4.6.5">
<h3><span class="header-section-number">4.6.5</span> <code>tally()</code> and <code>count()</code><a href="descriptive-statistics-and-data-manipulation.html#tally-and-count" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>tally()</code> and <code>count()</code> count the number of observations in your data. I believe <code>count()</code> is the
more useful of the two, as it counts the number of observations within a group that you can provide:</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="descriptive-statistics-and-data-manipulation.html#cb542-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb542-2"><a href="descriptive-statistics-and-data-manipulation.html#cb542-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(country)</span></code></pre></div>
<pre><code>## # A tibble: 18 × 2
##    country         n
##    &lt;chr&gt;       &lt;int&gt;
##  1 austria        19
##  2 belgium        19
##  3 canada         19
##  4 denmark        19
##  5 france         19
##  6 germany        19
##  7 greece         19
##  8 ireland        19
##  9 italy          19
## 10 japan          19
## 11 netherlands    19
## 12 norway         19
## 13 spain          19
## 14 sweden         19
## 15 switzerland    19
## 16 turkey         19
## 17 u.k.           19
## 18 u.s.a.         19</code></pre>
<p>There’s also <code>add_count()</code> which adds the column to the data:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="descriptive-statistics-and-data-manipulation.html#cb544-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb544-2"><a href="descriptive-statistics-and-data-manipulation.html#cb544-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(country)</span></code></pre></div>
<pre><code>## # A tibble: 342 × 7
##    country  year lgaspcar lincomep  lrpmg lcarpcap     n
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77    19
##  2 austria  1961     4.10    -6.43 -0.351    -9.61    19
##  3 austria  1962     4.07    -6.41 -0.380    -9.46    19
##  4 austria  1963     4.06    -6.37 -0.414    -9.34    19
##  5 austria  1964     4.04    -6.32 -0.445    -9.24    19
##  6 austria  1965     4.03    -6.29 -0.497    -9.12    19
##  7 austria  1966     4.05    -6.25 -0.467    -9.02    19
##  8 austria  1967     4.05    -6.23 -0.506    -8.93    19
##  9 austria  1968     4.05    -6.21 -0.522    -8.85    19
## 10 austria  1969     4.05    -6.15 -0.559    -8.79    19
## # … with 332 more rows</code></pre>
<p><code>add_count()</code> is a shortcut for the following code:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="descriptive-statistics-and-data-manipulation.html#cb546-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="sc">%&gt;%</span></span>
<span id="cb546-2"><a href="descriptive-statistics-and-data-manipulation.html#cb546-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb546-3"><a href="descriptive-statistics-and-data-manipulation.html#cb546-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 342 × 7
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap     n
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77    19
##  2 austria  1961     4.10    -6.43 -0.351    -9.61    19
##  3 austria  1962     4.07    -6.41 -0.380    -9.46    19
##  4 austria  1963     4.06    -6.37 -0.414    -9.34    19
##  5 austria  1964     4.04    -6.32 -0.445    -9.24    19
##  6 austria  1965     4.03    -6.29 -0.497    -9.12    19
##  7 austria  1966     4.05    -6.25 -0.467    -9.02    19
##  8 austria  1967     4.05    -6.23 -0.506    -8.93    19
##  9 austria  1968     4.05    -6.21 -0.522    -8.85    19
## 10 austria  1969     4.05    -6.15 -0.559    -8.79    19
## # … with 332 more rows</code></pre>
<p>where <code>n()</code> is a <code>dplyr</code> function that can only be used within <code>summarise()</code>, <code>mutate()</code> and
<code>filter()</code>.</p>
</div>
</div>
<div id="special-packages-for-special-kinds-of-data-forcats-lubridate-and-stringr" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Special packages for special kinds of data: <code>{forcats}</code>, <code>{lubridate}</code>, and <code>{stringr}</code><a href="descriptive-statistics-and-data-manipulation.html#special-packages-for-special-kinds-of-data-forcats-lubridate-and-stringr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="section" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> 🐱🐱🐱🐱<a href="descriptive-statistics-and-data-manipulation.html#section" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Factor variables are very useful but not very easy to manipulate. <code>forcats</code> contains very useful
functions that make working on factor variables painless. In my opinion, the four following functions, <code>fct_recode()</code>, <code>fct_relevel()</code>, <code>fct_reorder()</code> and <code>fct_relabel()</code>, are the ones you must
know, so that’s what I’ll be showing.</p>
<p>Remember in chapter 3 when I very quickly explained what were <code>factor</code> variables? In this section,
we are going to work a little bit with these type of variable. <code>factor</code>s are very useful, and the
<code>forcats</code> package includes some handy functions to work with them. First, let’s load the <code>forcats</code> package:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="descriptive-statistics-and-data-manipulation.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span></code></pre></div>
<p>as an example, we are going to work with the <code>gss_cat</code> dataset that is included in <code>forcats</code>. Let’s
load the data:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="descriptive-statistics-and-data-manipulation.html#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(gss_cat)</span>
<span id="cb549-2"><a href="descriptive-statistics-and-data-manipulation.html#cb549-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-3"><a href="descriptive-statistics-and-data-manipulation.html#cb549-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gss_cat)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 9
##    year marital         age race  rincome        partyid     relig denom tvhours
##   &lt;int&gt; &lt;fct&gt;         &lt;int&gt; &lt;fct&gt; &lt;fct&gt;          &lt;fct&gt;       &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;
## 1  2000 Never married    26 White $8000 to 9999  Ind,near r… Prot… Sout…      12
## 2  2000 Divorced         48 White $8000 to 9999  Not str re… Prot… Bapt…      NA
## 3  2000 Widowed          67 White Not applicable Independent Prot… No d…       2
## 4  2000 Never married    39 White Not applicable Ind,near r… Orth… Not …       4
## 5  2000 Divorced         25 White Not applicable Not str de… None  Not …       1
## 6  2000 Married          25 White $20000 - 24999 Strong dem… Prot… Sout…      NA</code></pre>
<p>as you can see, <code>marital</code>, <code>race</code>, <code>rincome</code> and <code>partyid</code> are all factor variables. Let’s take a closer
look at <code>marital</code>:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="descriptive-statistics-and-data-manipulation.html#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gss_cat<span class="sc">$</span>marital)</span></code></pre></div>
<pre><code>##  Factor w/ 6 levels &quot;No answer&quot;,&quot;Never married&quot;,..: 2 4 5 2 4 6 2 4 6 6 ...</code></pre>
<p>and let’s see <code>rincome</code>:</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="descriptive-statistics-and-data-manipulation.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gss_cat<span class="sc">$</span>rincome)</span></code></pre></div>
<pre><code>##  Factor w/ 16 levels &quot;No answer&quot;,&quot;Don&#39;t know&quot;,..: 8 8 16 16 16 5 4 9 4 4 ...</code></pre>
<p><code>factor</code> variables have different levels and the <code>forcats</code> package includes functions that allow
you to recode, collapse and do all sorts of things on these levels. For example , using
<code>forcats::fct_recode()</code> you can recode levels:</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="descriptive-statistics-and-data-manipulation.html#cb555-1" aria-hidden="true" tabindex="-1"></a>gss_cat <span class="ot">&lt;-</span> gss_cat <span class="sc">%&gt;%</span></span>
<span id="cb555-2"><a href="descriptive-statistics-and-data-manipulation.html#cb555-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">marital =</span> <span class="fu">fct_recode</span>(marital,</span>
<span id="cb555-3"><a href="descriptive-statistics-and-data-manipulation.html#cb555-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">refuse =</span> <span class="st">&quot;No answer&quot;</span>,</span>
<span id="cb555-4"><a href="descriptive-statistics-and-data-manipulation.html#cb555-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">never_married =</span> <span class="st">&quot;Never married&quot;</span>,</span>
<span id="cb555-5"><a href="descriptive-statistics-and-data-manipulation.html#cb555-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">divorced =</span> <span class="st">&quot;Separated&quot;</span>,</span>
<span id="cb555-6"><a href="descriptive-statistics-and-data-manipulation.html#cb555-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">divorced =</span> <span class="st">&quot;Divorced&quot;</span>,</span>
<span id="cb555-7"><a href="descriptive-statistics-and-data-manipulation.html#cb555-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">widowed =</span> <span class="st">&quot;Widowed&quot;</span>,</span>
<span id="cb555-8"><a href="descriptive-statistics-and-data-manipulation.html#cb555-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">married =</span> <span class="st">&quot;Married&quot;</span>))</span>
<span id="cb555-9"><a href="descriptive-statistics-and-data-manipulation.html#cb555-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb555-10"><a href="descriptive-statistics-and-data-manipulation.html#cb555-10" aria-hidden="true" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span></span>
<span id="cb555-11"><a href="descriptive-statistics-and-data-manipulation.html#cb555-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(marital)</span></code></pre></div>
<pre><code>##        marital     n      percent
##         refuse    17 0.0007913234
##  never_married  5416 0.2521063166
##       divorced  4126 0.1920588372
##        widowed  1807 0.0841130196
##        married 10117 0.4709305032</code></pre>
<p>Using <code>fct_recode()</code>, I was able to recode the levels and collapse <code>Separated</code> and <code>Divorced</code> to
a single category called <code>divorced</code>. As you can see, <code>refuse</code> and <code>widowed</code> are less than 10%, so
maybe you’d want to lump these categories together:</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="descriptive-statistics-and-data-manipulation.html#cb557-1" aria-hidden="true" tabindex="-1"></a>gss_cat <span class="ot">&lt;-</span> gss_cat <span class="sc">%&gt;%</span></span>
<span id="cb557-2"><a href="descriptive-statistics-and-data-manipulation.html#cb557-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">marital =</span> <span class="fu">fct_lump</span>(marital, <span class="at">prop =</span> <span class="fl">0.10</span>, <span class="at">other_level =</span> <span class="st">&quot;other&quot;</span>))</span>
<span id="cb557-3"><a href="descriptive-statistics-and-data-manipulation.html#cb557-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb557-4"><a href="descriptive-statistics-and-data-manipulation.html#cb557-4" aria-hidden="true" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span></span>
<span id="cb557-5"><a href="descriptive-statistics-and-data-manipulation.html#cb557-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(marital)</span></code></pre></div>
<pre><code>##        marital     n    percent
##  never_married  5416 0.25210632
##       divorced  4126 0.19205884
##        married 10117 0.47093050
##          other  1824 0.08490434</code></pre>
<p><code>fct_reorder()</code> is especially useful for plotting. We will explore plotting in the next chapter,
but to show you why <code>fct_reorder()</code> is so useful, I will create a barplot, first without
using <code>fct_reorder()</code> to re-order the factors, then with reordering. Do not worry if you don’t
understand all the code for now:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="descriptive-statistics-and-data-manipulation.html#cb559-1" aria-hidden="true" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span></span>
<span id="cb559-2"><a href="descriptive-statistics-and-data-manipulation.html#cb559-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tabyl</span>(marital) <span class="sc">%&gt;%</span></span>
<span id="cb559-3"><a href="descriptive-statistics-and-data-manipulation.html#cb559-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb559-4"><a href="descriptive-statistics-and-data-manipulation.html#cb559-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">x =</span> marital)) <span class="sc">+</span></span>
<span id="cb559-5"><a href="descriptive-statistics-and-data-manipulation.html#cb559-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-326-1.png" width="672" /></p>
<p>It would be much better if the categories were ordered by frequency. This is easy to do with
<code>fct_reorder()</code>:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="descriptive-statistics-and-data-manipulation.html#cb560-1" aria-hidden="true" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span></span>
<span id="cb560-2"><a href="descriptive-statistics-and-data-manipulation.html#cb560-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tabyl</span>(marital) <span class="sc">%&gt;%</span></span>
<span id="cb560-3"><a href="descriptive-statistics-and-data-manipulation.html#cb560-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">marital =</span> <span class="fu">fct_reorder</span>(marital, n, <span class="at">.desc =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb560-4"><a href="descriptive-statistics-and-data-manipulation.html#cb560-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb560-5"><a href="descriptive-statistics-and-data-manipulation.html#cb560-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">x =</span> marital)) <span class="sc">+</span></span>
<span id="cb560-6"><a href="descriptive-statistics-and-data-manipulation.html#cb560-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-327-1.png" width="672" /></p>
<p>Much better! In Chapter 6, we are going to learn about <code>{ggplot2}</code>.</p>
<p>The last family of function I’d like to mention are the <code>fct_lump*()</code> functions. These make it possible
to lump several levels of a factor into a new <em>other</em> level:</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="descriptive-statistics-and-data-manipulation.html#cb561-1" aria-hidden="true" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span></span>
<span id="cb561-2"><a href="descriptive-statistics-and-data-manipulation.html#cb561-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb561-3"><a href="descriptive-statistics-and-data-manipulation.html#cb561-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Description of the different functions taken from help(fct_lump)</span></span>
<span id="cb561-4"><a href="descriptive-statistics-and-data-manipulation.html#cb561-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">denom_lowfreq =</span> <span class="fu">fct_lump_lowfreq</span>(denom), <span class="co"># lumps together the least frequent levels, ensuring that &quot;other&quot; is still the smallest level.</span></span>
<span id="cb561-5"><a href="descriptive-statistics-and-data-manipulation.html#cb561-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">denom_min =</span> <span class="fu">fct_lump_min</span>(denom, <span class="at">min =</span> <span class="dv">10</span>), <span class="co"># lumps levels that appear fewer than min times.</span></span>
<span id="cb561-6"><a href="descriptive-statistics-and-data-manipulation.html#cb561-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">denom_n =</span> <span class="fu">fct_lump_n</span>(denom, <span class="at">n =</span> <span class="dv">3</span>), <span class="co"># lumps all levels except for the n most frequent (or least frequent if n &lt; 0)</span></span>
<span id="cb561-7"><a href="descriptive-statistics-and-data-manipulation.html#cb561-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">denom_prop =</span> <span class="fu">fct_lump_prop</span>(denom, <span class="at">prop =</span> <span class="fl">0.10</span>) <span class="co"># lumps levels that appear in fewer prop * n times.</span></span>
<span id="cb561-8"><a href="descriptive-statistics-and-data-manipulation.html#cb561-8" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<pre><code>## # A tibble: 21,483 × 13
##     year marital     age race  rincome partyid relig denom tvhours denom_lowfreq
##    &lt;int&gt; &lt;fct&gt;     &lt;int&gt; &lt;fct&gt; &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;   &lt;int&gt; &lt;fct&gt;        
##  1  2000 never_ma…    26 White $8000 … Ind,ne… Prot… Sout…      12 Southern bap…
##  2  2000 divorced     48 White $8000 … Not st… Prot… Bapt…      NA Baptist-dk w…
##  3  2000 other        67 White Not ap… Indepe… Prot… No d…       2 No denominat…
##  4  2000 never_ma…    39 White Not ap… Ind,ne… Orth… Not …       4 Not applicab…
##  5  2000 divorced     25 White Not ap… Not st… None  Not …       1 Not applicab…
##  6  2000 married      25 White $20000… Strong… Prot… Sout…      NA Southern bap…
##  7  2000 never_ma…    36 White $25000… Not st… Chri… Not …       3 Not applicab…
##  8  2000 divorced     44 White $7000 … Ind,ne… Prot… Luth…      NA Lutheran-mo …
##  9  2000 married      44 White $25000… Not st… Prot… Other       0 Other        
## 10  2000 married      47 White $25000… Strong… Prot… Sout…       3 Southern bap…
## # … with 21,473 more rows, and 3 more variables: denom_min &lt;fct&gt;,
## #   denom_n &lt;fct&gt;, denom_prop &lt;fct&gt;</code></pre>
<p>There’s many other, so I’d advise you go through the package’s function <a href="https://forcats.tidyverse.org/reference/index.html">reference</a>.</p>
</div>
<div id="get-your-dates-right-with-lubridate" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Get your dates right with <code>{lubridate}</code><a href="descriptive-statistics-and-data-manipulation.html#get-your-dates-right-with-lubridate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>{lubridate}</code> is yet another tidyverse package, that makes dealing with dates or durations (and intervals) as
painless as possible. I do not use every function contained in the package daily, and as such will
only focus on some of the functions. However, if you have to deal with dates often,
you might want to explore the package thouroughly.</p>
<div id="defining-dates-the-tidy-way" class="section level4 hasAnchor" number="4.7.2.1">
<h4><span class="header-section-number">4.7.2.1</span> Defining dates, the tidy way<a href="descriptive-statistics-and-data-manipulation.html#defining-dates-the-tidy-way" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s load new dataset, called <em>independence</em> from the datasets folder:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="descriptive-statistics-and-data-manipulation.html#cb563-1" aria-hidden="true" tabindex="-1"></a>independence <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;datasets/independence.rds&quot;</span>)</span></code></pre></div>
<p>This dataset was scraped from the following Wikipedia <a href="https://en.wikipedia.org/wiki/Decolonisation_of_Africa#Timeline">page</a>.
It shows when African countries gained independence and from which colonial powers. In Chapter 10, I
will show you how to scrape Wikipedia pages using R. For now, let’s take a look at the contents
of the dataset:</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="descriptive-statistics-and-data-manipulation.html#cb564-1" aria-hidden="true" tabindex="-1"></a>independence</span></code></pre></div>
<pre><code>## # A tibble: 54 × 6
##    country      colonial_name   colonial_power independence_da… first_head_of_s…
##    &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;          &lt;chr&gt;            &lt;chr&gt;           
##  1 Liberia      Liberia         United States  26 July 1847     Joseph Jenkins …
##  2 South Africa Cape Colony  C… United Kingdom 31 May 1910      Louis Botha     
##  3 Egypt        Sultanate of E… United Kingdom 28 February 1922 Fuad I          
##  4 Eritrea      Italian Eritrea Italy          10 February 1947 Haile Selassie  
##  5 Libya        British Milita… United Kingdo… 24 December 1951 Idris           
##  6 Sudan        Anglo-Egyptian… United Kingdo… 1 January 1956   Ismail al-Azhari
##  7 Tunisia      French Protect… France         20 March 1956    Muhammad VIII a…
##  8 Morocco      French Protect… France Spain   2 March 19567 A… Mohammed V      
##  9 Ghana        Gold Coast      United Kingdom 6 March 1957     Kwame Nkrumah   
## 10 Guinea       French West Af… France         2 October 1958   Ahmed Sékou Tou…
## # … with 44 more rows, and 1 more variable: independence_won_through &lt;chr&gt;</code></pre>
<p>as you can see, the date of independence is in a format that might make it difficult to answer questions
such as <em>Which African countries gained independence before 1960 ?</em> for two reasons. First of all,
the date uses the name of the month instead of the number of the month, and second of all the type of
the independence day column is <em>character</em> and not “date”. So our first task is to correctly define the column
as being of type date, while making sure that R understands that <em>January</em> is supposed to be “01”, and so
on. There are several helpful functions included in <code>{lubridate}</code> to convert columns to dates. For instance
if the column you want to convert is of the form “2012-11-21”, then you would use the function <code>ymd()</code>,
for “year-month-day”. If, however the column is “2012-21-11”, then you would use <code>ydm()</code>. There’s
a few of these helper functions, and they can handle a lot of different formats for dates. In our case,
having the name of the month instead of the number might seem quite problematic, but it turns out
that this is a case that <code>{lubridate}</code> handles painfully:</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="descriptive-statistics-and-data-manipulation.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="descriptive-statistics-and-data-manipulation.html#cb569-1" aria-hidden="true" tabindex="-1"></a>independence <span class="ot">&lt;-</span> independence <span class="sc">%&gt;%</span></span>
<span id="cb569-2"><a href="descriptive-statistics-and-data-manipulation.html#cb569-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">independence_date =</span> <span class="fu">dmy</span>(independence_date))</span></code></pre></div>
<pre><code>## Warning: 5 failed to parse.</code></pre>
<p>Some dates failed to parse, for instance for Morocco. This is because these countries have several
independence dates; this means that the string to convert looks like:</p>
<pre><code>&quot;2 March 1956
7 April 1956
10 April 1958
4 January 1969&quot;</code></pre>
<p>which obviously cannot be converted by <code>{lubridate}</code> without further manipulation. I ignore these cases for
simplicity’s sake.</p>
</div>
<div id="data-manipulation-with-dates" class="section level4 hasAnchor" number="4.7.2.2">
<h4><span class="header-section-number">4.7.2.2</span> Data manipulation with dates<a href="descriptive-statistics-and-data-manipulation.html#data-manipulation-with-dates" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s take a look at the data now:</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="descriptive-statistics-and-data-manipulation.html#cb572-1" aria-hidden="true" tabindex="-1"></a>independence</span></code></pre></div>
<pre><code>## # A tibble: 54 × 6
##    country      colonial_name   colonial_power independence_da… first_head_of_s…
##    &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;          &lt;date&gt;           &lt;chr&gt;           
##  1 Liberia      Liberia         United States  1847-07-26       Joseph Jenkins …
##  2 South Africa Cape Colony  C… United Kingdom 1910-05-31       Louis Botha     
##  3 Egypt        Sultanate of E… United Kingdom 1922-02-28       Fuad I          
##  4 Eritrea      Italian Eritrea Italy          1947-02-10       Haile Selassie  
##  5 Libya        British Milita… United Kingdo… 1951-12-24       Idris           
##  6 Sudan        Anglo-Egyptian… United Kingdo… 1956-01-01       Ismail al-Azhari
##  7 Tunisia      French Protect… France         1956-03-20       Muhammad VIII a…
##  8 Morocco      French Protect… France Spain   NA               Mohammed V      
##  9 Ghana        Gold Coast      United Kingdom 1957-03-06       Kwame Nkrumah   
## 10 Guinea       French West Af… France         1958-10-02       Ahmed Sékou Tou…
## # … with 44 more rows, and 1 more variable: independence_won_through &lt;chr&gt;</code></pre>
<p>As you can see, we now have a date column in the right format. We can now answer questions such as
<em>Which countries gained independence before 1960?</em> quite easily, by using the functions <code>year()</code>,
<code>month()</code> and <code>day()</code>. Let’s see which countries gained independence before 1960:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="descriptive-statistics-and-data-manipulation.html#cb574-1" aria-hidden="true" tabindex="-1"></a>independence <span class="sc">%&gt;%</span></span>
<span id="cb574-2"><a href="descriptive-statistics-and-data-manipulation.html#cb574-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(independence_date) <span class="sc">&lt;=</span> <span class="dv">1960</span>) <span class="sc">%&gt;%</span></span>
<span id="cb574-3"><a href="descriptive-statistics-and-data-manipulation.html#cb574-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(country)</span></code></pre></div>
<pre><code>##  [1] &quot;Liberia&quot;                          &quot;South Africa&quot;                    
##  [3] &quot;Egypt&quot;                            &quot;Eritrea&quot;                         
##  [5] &quot;Libya&quot;                            &quot;Sudan&quot;                           
##  [7] &quot;Tunisia&quot;                          &quot;Ghana&quot;                           
##  [9] &quot;Guinea&quot;                           &quot;Cameroon&quot;                        
## [11] &quot;Togo&quot;                             &quot;Mali&quot;                            
## [13] &quot;Madagascar&quot;                       &quot;Democratic Republic of the Congo&quot;
## [15] &quot;Benin&quot;                            &quot;Niger&quot;                           
## [17] &quot;Burkina Faso&quot;                     &quot;Ivory Coast&quot;                     
## [19] &quot;Chad&quot;                             &quot;Central African Republic&quot;        
## [21] &quot;Republic of the Congo&quot;            &quot;Gabon&quot;                           
## [23] &quot;Mauritania&quot;</code></pre>
<p>You guessed it, <code>year()</code> extracts the year of the date column and converts it as a <em>numeric</em> so that we can work
on it. This is the same for <code>month()</code> or <code>day()</code>. Let’s try to see if countries gained their independence on
Christmas Eve:</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="descriptive-statistics-and-data-manipulation.html#cb576-1" aria-hidden="true" tabindex="-1"></a>independence <span class="sc">%&gt;%</span></span>
<span id="cb576-2"><a href="descriptive-statistics-and-data-manipulation.html#cb576-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">month</span>(independence_date) <span class="sc">==</span> <span class="dv">12</span>,</span>
<span id="cb576-3"><a href="descriptive-statistics-and-data-manipulation.html#cb576-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">day</span>(independence_date) <span class="sc">==</span> <span class="dv">24</span>) <span class="sc">%&gt;%</span></span>
<span id="cb576-4"><a href="descriptive-statistics-and-data-manipulation.html#cb576-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(country)</span></code></pre></div>
<pre><code>## [1] &quot;Libya&quot;</code></pre>
<p>Seems like Libya was the only one! You can also operate on dates. For instance, let’s compute the difference between
two dates, using the <code>interval()</code> column:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="descriptive-statistics-and-data-manipulation.html#cb578-1" aria-hidden="true" tabindex="-1"></a>independence <span class="sc">%&gt;%</span></span>
<span id="cb578-2"><a href="descriptive-statistics-and-data-manipulation.html#cb578-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">today =</span> lubridate<span class="sc">::</span><span class="fu">today</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb578-3"><a href="descriptive-statistics-and-data-manipulation.html#cb578-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">independent_since =</span> <span class="fu">interval</span>(independence_date, today)) <span class="sc">%&gt;%</span></span>
<span id="cb578-4"><a href="descriptive-statistics-and-data-manipulation.html#cb578-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, independent_since)</span></code></pre></div>
<pre><code>## # A tibble: 54 × 2
##    country      independent_since             
##    &lt;chr&gt;        &lt;Interval&gt;                    
##  1 Liberia      1847-07-26 UTC--2022-06-11 UTC
##  2 South Africa 1910-05-31 UTC--2022-06-11 UTC
##  3 Egypt        1922-02-28 UTC--2022-06-11 UTC
##  4 Eritrea      1947-02-10 UTC--2022-06-11 UTC
##  5 Libya        1951-12-24 UTC--2022-06-11 UTC
##  6 Sudan        1956-01-01 UTC--2022-06-11 UTC
##  7 Tunisia      1956-03-20 UTC--2022-06-11 UTC
##  8 Morocco      NA--NA                        
##  9 Ghana        1957-03-06 UTC--2022-06-11 UTC
## 10 Guinea       1958-10-02 UTC--2022-06-11 UTC
## # … with 44 more rows</code></pre>
<p>The <code>independent_since</code> column now contains an <em>interval</em> object that we can convert to years:</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="descriptive-statistics-and-data-manipulation.html#cb580-1" aria-hidden="true" tabindex="-1"></a>independence <span class="sc">%&gt;%</span></span>
<span id="cb580-2"><a href="descriptive-statistics-and-data-manipulation.html#cb580-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">today =</span> lubridate<span class="sc">::</span><span class="fu">today</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb580-3"><a href="descriptive-statistics-and-data-manipulation.html#cb580-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">independent_since =</span> <span class="fu">interval</span>(independence_date, today)) <span class="sc">%&gt;%</span></span>
<span id="cb580-4"><a href="descriptive-statistics-and-data-manipulation.html#cb580-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, independent_since) <span class="sc">%&gt;%</span></span>
<span id="cb580-5"><a href="descriptive-statistics-and-data-manipulation.html#cb580-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">years_independent =</span> <span class="fu">as.numeric</span>(independent_since, <span class="st">&quot;years&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 54 × 3
##    country      independent_since              years_independent
##    &lt;chr&gt;        &lt;Interval&gt;                                 &lt;dbl&gt;
##  1 Liberia      1847-07-26 UTC--2022-06-11 UTC             175. 
##  2 South Africa 1910-05-31 UTC--2022-06-11 UTC             112. 
##  3 Egypt        1922-02-28 UTC--2022-06-11 UTC             100. 
##  4 Eritrea      1947-02-10 UTC--2022-06-11 UTC              75.3
##  5 Libya        1951-12-24 UTC--2022-06-11 UTC              70.5
##  6 Sudan        1956-01-01 UTC--2022-06-11 UTC              66.4
##  7 Tunisia      1956-03-20 UTC--2022-06-11 UTC              66.2
##  8 Morocco      NA--NA                                      NA  
##  9 Ghana        1957-03-06 UTC--2022-06-11 UTC              65.3
## 10 Guinea       1958-10-02 UTC--2022-06-11 UTC              63.7
## # … with 44 more rows</code></pre>
<p>We can now see for how long the last country to gain independence has been independent.
Because the data is not tidy (in some cases, an African country was colonized by two powers,
see Libya), I will only focus on 4 European colonial powers: Belgium, France, Portugal and the United Kingdom:</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="descriptive-statistics-and-data-manipulation.html#cb582-1" aria-hidden="true" tabindex="-1"></a>independence <span class="sc">%&gt;%</span></span>
<span id="cb582-2"><a href="descriptive-statistics-and-data-manipulation.html#cb582-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(colonial_power <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Belgium&quot;</span>, <span class="st">&quot;France&quot;</span>, <span class="st">&quot;Portugal&quot;</span>, <span class="st">&quot;United Kingdom&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb582-3"><a href="descriptive-statistics-and-data-manipulation.html#cb582-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">today =</span> lubridate<span class="sc">::</span><span class="fu">today</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb582-4"><a href="descriptive-statistics-and-data-manipulation.html#cb582-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">independent_since =</span> <span class="fu">interval</span>(independence_date, today)) <span class="sc">%&gt;%</span></span>
<span id="cb582-5"><a href="descriptive-statistics-and-data-manipulation.html#cb582-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">years_independent =</span> <span class="fu">as.numeric</span>(independent_since, <span class="st">&quot;years&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb582-6"><a href="descriptive-statistics-and-data-manipulation.html#cb582-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(colonial_power) <span class="sc">%&gt;%</span></span>
<span id="cb582-7"><a href="descriptive-statistics-and-data-manipulation.html#cb582-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">last_colony_independent_for =</span> <span class="fu">min</span>(years_independent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   colonial_power last_colony_independent_for
##   &lt;chr&gt;                                &lt;dbl&gt;
## 1 Belgium                               59.9
## 2 France                                45.0
## 3 Portugal                              46.6
## 4 United Kingdom                        45.9</code></pre>
</div>
<div id="arithmetic-with-dates" class="section level4 hasAnchor" number="4.7.2.3">
<h4><span class="header-section-number">4.7.2.3</span> Arithmetic with dates<a href="descriptive-statistics-and-data-manipulation.html#arithmetic-with-dates" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Adding or substracting days to dates is quite easy:</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="descriptive-statistics-and-data-manipulation.html#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2018-12-31&quot;</span>) <span class="sc">+</span> <span class="dv">16</span></span></code></pre></div>
<pre><code>## [1] &quot;2019-01-16&quot;</code></pre>
<p>It is also possible to be more explicit and use <code>days()</code>:</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="descriptive-statistics-and-data-manipulation.html#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2018-12-31&quot;</span>) <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">16</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2019-01-16&quot;</code></pre>
<p>To add years, you can use <code>years()</code>:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="descriptive-statistics-and-data-manipulation.html#cb588-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2018-12-31&quot;</span>) <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2019-12-31&quot;</code></pre>
<p>But you have to be careful with leap years:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="descriptive-statistics-and-data-manipulation.html#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2016-02-29&quot;</span>) <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Because 2017 is not a leap year, the above computation returns <code>NA</code>. The same goes for months with
a different number of days:</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="descriptive-statistics-and-data-manipulation.html#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2018-12-31&quot;</span>) <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>The way to solve these issues is to use the special <code>%m+%</code> infix operator:</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="descriptive-statistics-and-data-manipulation.html#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2016-02-29&quot;</span>) <span class="sc">%m+%</span> <span class="fu">years</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2017-02-28&quot;</code></pre>
<p>and for months:</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="descriptive-statistics-and-data-manipulation.html#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2018-12-31&quot;</span>) <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2019-02-28&quot;</code></pre>
<p><code>{lubridate}</code> contains many more functions. If you often work with dates, duration or interval
data, <code>{lubridate}</code> is a package that you have to add to your toolbox.</p>
</div>
</div>
<div id="manipulate-strings-with-stringr" class="section level3 hasAnchor" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> Manipulate strings with <code>{stringr}</code><a href="descriptive-statistics-and-data-manipulation.html#manipulate-strings-with-stringr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>{stringr}</code> contains functions to manipulate strings. In Chapter 10, I will teach you about regular
expressions, but the functions contained in <code>{stringr}</code> allow you to already do a lot of work on
strings, without needing to be a regular expression expert.</p>
<p>I will discuss the most common string operations: detecting, locating, matching, searching and
replacing, and exctracting/removing strings.</p>
<p>To introduce these operations, let us use an ALTO file of an issue of <em>The Winchester News</em> from
October 31, 1910, which you can find on this
<a href="https://gist.githubusercontent.com/b-rodrigues/5139560e7d0f2ecebe5da1df3629e015/raw/e3031d894ffb97217ddbad1ade1b307c9937d2c8/gistfile1.txt">link</a> (to see
how the newspaper looked like,
<a href="https://chroniclingamerica.loc.gov/lccn/sn86069133/1910-10-31/ed-1/seq-1/">click here</a>). I re-hosted
the file on a public gist for archiving purposes. While working on the book, the original site went
down several times…</p>
<p>ALTO is an XML schema for the description of text OCR and layout information of pages for digitzed
material, such as newspapers (source: <a href="https://en.wikipedia.org/wiki/ALTO_(XML)">ALTO Wikipedia page</a>).
For more details, you can read my
<a href="https://www.brodrigues.co/blog/2019-01-13-newspapers_mets_alto/">blogpost</a>
on the matter, but for our current purposes, it is enough to know that the file contains the text
of newspaper articles. The file looks like this:</p>
<pre><code>&lt;TextLine HEIGHT=&quot;138.0&quot; WIDTH=&quot;2434.0&quot; HPOS=&quot;4056.0&quot; VPOS=&quot;5814.0&quot;&gt;
&lt;String STYLEREFS=&quot;ID7&quot; HEIGHT=&quot;108.0&quot; WIDTH=&quot;393.0&quot; HPOS=&quot;4056.0&quot; VPOS=&quot;5838.0&quot; CONTENT=&quot;timore&quot; WC=&quot;0.82539684&quot;&gt;
&lt;ALTERNATIVE&gt;timole&lt;/ALTERNATIVE&gt;
&lt;ALTERNATIVE&gt;tlnldre&lt;/ALTERNATIVE&gt;
&lt;ALTERNATIVE&gt;timor&lt;/ALTERNATIVE&gt;
&lt;ALTERNATIVE&gt;insole&lt;/ALTERNATIVE&gt;
&lt;ALTERNATIVE&gt;landed&lt;/ALTERNATIVE&gt;
&lt;/String&gt;
&lt;SP WIDTH=&quot;74.0&quot; HPOS=&quot;4449.0&quot; VPOS=&quot;5838.0&quot;/&gt;
&lt;String STYLEREFS=&quot;ID7&quot; HEIGHT=&quot;105.0&quot; WIDTH=&quot;432.0&quot; HPOS=&quot;4524.0&quot; VPOS=&quot;5847.0&quot; CONTENT=&quot;market&quot; WC=&quot;0.95238096&quot;/&gt;
&lt;SP WIDTH=&quot;116.0&quot; HPOS=&quot;4956.0&quot; VPOS=&quot;5847.0&quot;/&gt;
&lt;String STYLEREFS=&quot;ID7&quot; HEIGHT=&quot;69.0&quot; WIDTH=&quot;138.0&quot; HPOS=&quot;5073.0&quot; VPOS=&quot;5883.0&quot; CONTENT=&quot;as&quot; WC=&quot;0.96825397&quot;/&gt;
&lt;SP WIDTH=&quot;74.0&quot; HPOS=&quot;5211.0&quot; VPOS=&quot;5883.0&quot;/&gt;
&lt;String STYLEREFS=&quot;ID7&quot; HEIGHT=&quot;69.0&quot; WIDTH=&quot;285.0&quot; HPOS=&quot;5286.0&quot; VPOS=&quot;5877.0&quot; CONTENT=&quot;were&quot; WC=&quot;1.0&quot;&gt;
&lt;ALTERNATIVE&gt;verc&lt;/ALTERNATIVE&gt;
&lt;ALTERNATIVE&gt;veer&lt;/ALTERNATIVE&gt;
&lt;/String&gt;
&lt;SP WIDTH=&quot;68.0&quot; HPOS=&quot;5571.0&quot; VPOS=&quot;5877.0&quot;/&gt;
&lt;String STYLEREFS=&quot;ID7&quot; HEIGHT=&quot;111.0&quot; WIDTH=&quot;147.0&quot; HPOS=&quot;5640.0&quot; VPOS=&quot;5838.0&quot; CONTENT=&quot;all&quot; WC=&quot;1.0&quot;/&gt;
&lt;SP WIDTH=&quot;83.0&quot; HPOS=&quot;5787.0&quot; VPOS=&quot;5838.0&quot;/&gt;
&lt;String STYLEREFS=&quot;ID7&quot; HEIGHT=&quot;111.0&quot; WIDTH=&quot;183.0&quot; HPOS=&quot;5871.0&quot; VPOS=&quot;5835.0&quot; CONTENT=&quot;the&quot; WC=&quot;0.95238096&quot;&gt;
&lt;ALTERNATIVE&gt;tll&lt;/ALTERNATIVE&gt;
&lt;ALTERNATIVE&gt;Cu&lt;/ALTERNATIVE&gt;
&lt;ALTERNATIVE&gt;tall&lt;/ALTERNATIVE&gt;
&lt;/String&gt;
&lt;SP WIDTH=&quot;75.0&quot; HPOS=&quot;6054.0&quot; VPOS=&quot;5835.0&quot;/&gt;
&lt;String STYLEREFS=&quot;ID3&quot; HEIGHT=&quot;132.0&quot; WIDTH=&quot;351.0&quot; HPOS=&quot;6129.0&quot; VPOS=&quot;5814.0&quot; CONTENT=&quot;cattle&quot; WC=&quot;0.95238096&quot;/&gt;
&lt;/TextLine&gt;</code></pre>
<p>We are interested in the strings after <code>CONTENT=</code>. We are going to use functions from the <code>{stringr}</code>
package to get the strings after <code>CONTENT=</code>. In Chapter 10, we are going to explore this file
again, but using complex regular expressions to get all the content in one go.</p>
<div id="getting-text-data-into-rstudio" class="section level4 hasAnchor" number="4.7.3.1">
<h4><span class="header-section-number">4.7.3.1</span> Getting text data into Rstudio<a href="descriptive-statistics-and-data-manipulation.html#getting-text-data-into-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First of all, let us read in the file:</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="descriptive-statistics-and-data-manipulation.html#cb599-1" aria-hidden="true" tabindex="-1"></a>winchester <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(<span class="st">&quot;https://gist.githubusercontent.com/b-rodrigues/5139560e7d0f2ecebe5da1df3629e015/raw/e3031d894ffb97217ddbad1ade1b307c9937d2c8/gistfile1.txt&quot;</span>)</span></code></pre></div>
<p>Even though the file is an XML file, I still read it in using <code>read_lines()</code> and not <code>read_xml()</code>
from the <code>{xml2}</code> package. This is for the purposes of the current exercise, and also because I
always have trouble with XML files, and prefer to treat them as simple text files, and use regular
expressions to get what I need.</p>
<p>Now that the ALTO file is read in and saved in the <code>winchester</code> variable, you might want to print
the whole thing in the console. Before that, take a look at the structure:</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="descriptive-statistics-and-data-manipulation.html#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(winchester)</span></code></pre></div>
<pre><code>##  chr [1:43] &quot;&quot; ...</code></pre>
<p>So the <code>winchester</code> variable is a character atomic vector with 43 elements. So first, we need to
understand what these elements are. Let’s start with the first one:</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="descriptive-statistics-and-data-manipulation.html#cb602-1" aria-hidden="true" tabindex="-1"></a>winchester[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;&quot;</code></pre>
<p>Ok, so it seems like the first element is part of the header of the file. What about the second one?</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="descriptive-statistics-and-data-manipulation.html#cb604-1" aria-hidden="true" tabindex="-1"></a>winchester[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] &quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=UTF-8\&quot;&gt;&lt;base href=\&quot;https://chroniclingamerica.loc.gov/lccn/sn86069133/1910-10-31/ed-1/seq-1/ocr.xml\&quot;&gt;&lt;style&gt;body{margin-left:0;margin-right:0;margin-top:0}#bN015htcoyT__google-cache-hdr{background:#f5f5f5;font:13px arial,sans-serif;text-align:left;color:#202020;border:0;margin:0;border-bottom:1px solid #cecece;line-height:16px;padding:16px 28px 24px 28px}#bN015htcoyT__google-cache-hdr *{display:inline;font:inherit;text-align:inherit;color:inherit;line-height:inherit;background:none;border:0;margin:0;padding:0;letter-spacing:0}#bN015htcoyT__google-cache-hdr a{text-decoration:none;color:#1a0dab}#bN015htcoyT__google-cache-hdr a:hover{text-decoration:underline}#bN015htcoyT__google-cache-hdr a:visited{color:#609}#bN015htcoyT__google-cache-hdr div{display:block;margin-top:4px}#bN015htcoyT__google-cache-hdr b{font-weight:bold;display:inline-block;direction:ltr}&lt;/style&gt;&lt;div id=\&quot;bN015htcoyT__google-cache-hdr\&quot;&gt;&lt;div&gt;&lt;span&gt;This is Google&#39;s cache of &lt;a href=\&quot;https://chroniclingamerica.loc.gov/lccn/sn86069133/1910-10-31/ed-1/seq-1/ocr.xml\&quot;&gt;https://chroniclingamerica.loc.gov/lccn/sn86069133/1910-10-31/ed-1/seq-1/ocr.xml&lt;/a&gt;.&lt;/span&gt;&amp;nbsp;&lt;span&gt;It is a snapshot of the page as it appeared on 21 Jan 2019 05:18:18 GMT.&lt;/span&gt;&amp;nbsp;&lt;span&gt;The &lt;a href=\&quot;https://chroniclingamerica.loc.gov/lccn/sn86069133/1910-10-31/ed-1/seq-1/ocr.xml\&quot;&gt;current page&lt;/a&gt; could have changed in the meantime.&lt;/span&gt;&amp;nbsp;&lt;a href=\&quot;http://support.google.com/websearch/bin/answer.py?hl=en&amp;amp;p=cached&amp;amp;answer=1687222\&quot;&gt;&lt;span&gt;Learn more&lt;/span&gt;.&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=\&quot;display:inline-block;margin-top:8px;margin-right:104px;white-space:nowrap\&quot;&gt;&lt;span style=\&quot;margin-right:28px\&quot;&gt;&lt;span style=\&quot;font-weight:bold\&quot;&gt;Full version&lt;/span&gt;&lt;/span&gt;&lt;span style=\&quot;margin-right:28px\&quot;&gt;&lt;a href=\&quot;http://webcache.googleusercontent.com/search?q=cache:2BVPV8QGj3oJ:https://chroniclingamerica.loc.gov/lccn/sn86069133/1910-10-31/ed-1/seq-1/ocr.xml&amp;amp;hl=en&amp;amp;gl=lu&amp;amp;strip=1&amp;amp;vwsrc=0\&quot;&gt;&lt;span&gt;Text-only version&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;span style=\&quot;margin-right:28px\&quot;&gt;&lt;a href=\&quot;http://webcache.googleusercontent.com/search?q=cache:2BVPV8QGj3oJ:https://chroniclingamerica.loc.gov/lccn/sn86069133/1910-10-31/ed-1/seq-1/ocr.xml&amp;amp;hl=en&amp;amp;gl=lu&amp;amp;strip=0&amp;amp;vwsrc=1\&quot;&gt;&lt;span&gt;View source&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;span style=\&quot;display:inline-block;margin-top:8px;color:#717171\&quot;&gt;&lt;span&gt;Tip: To quickly find your search term on this page, press &lt;b&gt;Ctrl+F&lt;/b&gt; or &lt;b&gt;⌘-F&lt;/b&gt; (Mac) and use the find bar.&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=\&quot;position:relative;\&quot;&gt;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&quot;</code></pre>
<p>Same. So where is the content? The file is very large, so if you print it in the console, it will
take quite some time to print, and you will not really be able to make out anything. The best
way would be to try to detect the string <code>CONTENT</code> and work from there.</p>
</div>
<div id="detecting-getting-the-position-and-locating-strings" class="section level4 hasAnchor" number="4.7.3.2">
<h4><span class="header-section-number">4.7.3.2</span> Detecting, getting the position and locating strings<a href="descriptive-statistics-and-data-manipulation.html#detecting-getting-the-position-and-locating-strings" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When confronted to an atomic vector of strings, you might want to know inside which elements you
can find certain strings. For example, to know which elements of <code>winchester</code> contain the string
<code>CONTENT</code>, use <code>str_detect()</code>:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="descriptive-statistics-and-data-manipulation.html#cb606-1" aria-hidden="true" tabindex="-1"></a>winchester <span class="sc">%&gt;%</span></span>
<span id="cb606-2"><a href="descriptive-statistics-and-data-manipulation.html#cb606-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(<span class="st">&quot;CONTENT&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [37] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE</code></pre>
<p>This returns a boolean atomic vector of the same length as <code>winchester</code>. If the string <code>CONTENT</code> is
nowhere to be found, the result will equal <code>FALSE</code>, if not it will equal <code>TRUE</code>. Here it is easy to
see that the last element contains the string <code>CONTENT</code>. But what if instead of having 43 elements,
the vector had 24192 elements? And hundreds would contain the string <code>CONTENT</code>? It would be easier
to instead have the indices of the vector where one can find the word <code>CONTENT</code>. This is possible
with <code>str_which()</code>:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="descriptive-statistics-and-data-manipulation.html#cb608-1" aria-hidden="true" tabindex="-1"></a>winchester <span class="sc">%&gt;%</span></span>
<span id="cb608-2"><a href="descriptive-statistics-and-data-manipulation.html#cb608-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_which</span>(<span class="st">&quot;CONTENT&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 43</code></pre>
<p>Here, the result is 43, meaning that the 43rd element of <code>winchester</code> contains the string <code>CONTENT</code>
somewhere. If we need more precision, we can use <code>str_locate()</code> and <code>str_locate_all()</code>. To explain
how both these functions work, let’s create a very small example:</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="descriptive-statistics-and-data-manipulation.html#cb610-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;aristotle&quot;</span>, <span class="st">&quot;plato&quot;</span>, <span class="st">&quot;epictetus&quot;</span>, <span class="st">&quot;seneca the younger&quot;</span>, <span class="st">&quot;epicurus&quot;</span>, <span class="st">&quot;marcus aurelius&quot;</span>)</span></code></pre></div>
<p>Now suppose I am interested in philosophers whose name ends in <code>us</code>. Let us use <code>str_locate()</code> first:</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="descriptive-statistics-and-data-manipulation.html#cb611-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb611-2"><a href="descriptive-statistics-and-data-manipulation.html#cb611-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_locate</span>(<span class="st">&quot;us&quot;</span>)</span></code></pre></div>
<pre><code>##      start end
## [1,]    NA  NA
## [2,]    NA  NA
## [3,]     8   9
## [4,]    NA  NA
## [5,]     7   8
## [6,]     5   6</code></pre>
<p>You can interpret the result as follows: in the rows, the index of the vector where the
string <code>us</code> is found. So the 3rd, 5th and 6th philosopher have <code>us</code> somewhere in their name.
The result also has two columns: <code>start</code> and <code>end</code>. These give the position of the string. So the
string <code>us</code> can be found starting at position 8 of the 3rd element of the vector, and ends at position
9. Same goes for the other philisophers. However, consider Marcus Aurelius. He has two names, both
ending with <code>us</code>. However, <code>str_locate()</code> only shows the position of the <code>us</code> in <code>Marcus</code>.</p>
<p>To get both <code>us</code> strings, you need to use <code>str_locate_all()</code>:</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="descriptive-statistics-and-data-manipulation.html#cb613-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb613-2"><a href="descriptive-statistics-and-data-manipulation.html#cb613-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_locate_all</span>(<span class="st">&quot;us&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
##      start end
## 
## [[2]]
##      start end
## 
## [[3]]
##      start end
## [1,]     8   9
## 
## [[4]]
##      start end
## 
## [[5]]
##      start end
## [1,]     7   8
## 
## [[6]]
##      start end
## [1,]     5   6
## [2,]    14  15</code></pre>
<p>Now we get the position of the two <code>us</code> in Marcus Aurelius. Doing this on the <code>winchester</code> vector
will give use the position of the <code>CONTENT</code> string, but this is not really important right now. What
matters is that you know how <code>str_locate()</code> and <code>str_locate_all()</code> work.</p>
<p>So now that we know what interests us in the 43nd element of <code>winchester</code>, let’s take a closer
look at it:</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="descriptive-statistics-and-data-manipulation.html#cb615-1" aria-hidden="true" tabindex="-1"></a>winchester[<span class="dv">43</span>]</span></code></pre></div>
<p>As you can see, it’s a mess:</p>
<pre><code>&lt;TextLine HEIGHT=\&quot;126.0\&quot; WIDTH=\&quot;1731.0\&quot; HPOS=\&quot;17160.0\&quot; VPOS=\&quot;21252.0\&quot;&gt;&lt;String HEIGHT=\&quot;114.0\&quot; WIDTH=\&quot;354.0\&quot; HPOS=\&quot;17160.0\&quot; VPOS=\&quot;21264.0\&quot; CONTENT=\&quot;0tV\&quot; WC=\&quot;0.8095238\&quot;/&gt;&lt;SP WIDTH=\&quot;131.0\&quot; HPOS=\&quot;17514.0\&quot; VPOS=\&quot;21264.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;111.0\&quot; WIDTH=\&quot;474.0\&quot; HPOS=\&quot;17646.0\&quot; VPOS=\&quot;21258.0\&quot; CONTENT=\&quot;BATES\&quot; WC=\&quot;1.0\&quot;/&gt;&lt;SP WIDTH=\&quot;140.0\&quot; HPOS=\&quot;18120.0\&quot; VPOS=\&quot;21258.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;114.0\&quot; WIDTH=\&quot;630.0\&quot; HPOS=\&quot;18261.0\&quot; VPOS=\&quot;21252.0\&quot; CONTENT=\&quot;President\&quot; WC=\&quot;1.0\&quot;&gt;&lt;ALTERNATIVE&gt;Prcideht&lt;/ALTERNATIVE&gt;&lt;ALTERNATIVE&gt;Pride&lt;/ALTERNATIVE&gt;&lt;/String&gt;&lt;/TextLine&gt;&lt;TextLine HEIGHT=\&quot;153.0\&quot; WIDTH=\&quot;1689.0\&quot; HPOS=\&quot;17145.0\&quot; VPOS=\&quot;21417.0\&quot;&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;105.0\&quot; WIDTH=\&quot;258.0\&quot; HPOS=\&quot;17145.0\&quot; VPOS=\&quot;21439.0\&quot; CONTENT=\&quot;WM\&quot; WC=\&quot;0.82539684\&quot;&gt;&lt;TextLine HEIGHT=\&quot;120.0\&quot; WIDTH=\&quot;2211.0\&quot; HPOS=\&quot;16788.0\&quot; VPOS=\&quot;21870.0\&quot;&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;96.0\&quot; WIDTH=\&quot;102.0\&quot; HPOS=\&quot;16788.0\&quot; VPOS=\&quot;21894.0\&quot; CONTENT=\&quot;It\&quot; WC=\&quot;1.0\&quot;/&gt;&lt;SP WIDTH=\&quot;72.0\&quot; HPOS=\&quot;16890.0\&quot; VPOS=\&quot;21894.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;96.0\&quot; WIDTH=\&quot;93.0\&quot; HPOS=\&quot;16962.0\&quot; VPOS=\&quot;21885.0\&quot; CONTENT=\&quot;is\&quot; WC=\&quot;1.0\&quot;/&gt;&lt;SP WIDTH=\&quot;80.0\&quot; HPOS=\&quot;17055.0\&quot; VPOS=\&quot;21885.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;102.0\&quot; WIDTH=\&quot;417.0\&quot; HPOS=\&quot;17136.0\&quot; VPOS=\&quot;21879.0\&quot; CONTENT=\&quot;seldom\&quot; WC=\&quot;1.0\&quot;/&gt;&lt;SP WIDTH=\&quot;80.0\&quot; HPOS=\&quot;17553.0\&quot; VPOS=\&quot;21879.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;96.0\&quot; WIDTH=\&quot;267.0\&quot; HPOS=\&quot;17634.0\&quot; VPOS=\&quot;21873.0\&quot; CONTENT=\&quot;hard\&quot; WC=\&quot;1.0\&quot;/&gt;&lt;SP WIDTH=\&quot;81.0\&quot; HPOS=\&quot;17901.0\&quot; VPOS=\&quot;21873.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;87.0\&quot; WIDTH=\&quot;111.0\&quot; HPOS=\&quot;17982.0\&quot; VPOS=\&quot;21879.0\&quot; CONTENT=\&quot;to\&quot; WC=\&quot;1.0\&quot;/&gt;&lt;SP WIDTH=\&quot;81.0\&quot; HPOS=\&quot;18093.0\&quot; VPOS=\&quot;21879.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;96.0\&quot; WIDTH=\&quot;219.0\&quot; HPOS=\&quot;18174.0\&quot; VPOS=\&quot;21870.0\&quot; CONTENT=\&quot;find\&quot; WC=\&quot;1.0\&quot;/&gt;&lt;SP WIDTH=\&quot;77.0\&quot; HPOS=\&quot;18393.0\&quot; VPOS=\&quot;21870.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;69.0\&quot; WIDTH=\&quot;66.0\&quot; HPOS=\&quot;18471.0\&quot; VPOS=\&quot;21894.0\&quot; CONTENT=\&quot;a\&quot; WC=\&quot;1.0\&quot;/&gt;&lt;SP WIDTH=\&quot;77.0\&quot; HPOS=\&quot;18537.0\&quot; VPOS=\&quot;21894.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;78.0\&quot; WIDTH=\&quot;384.0\&quot; HPOS=\&quot;18615.0\&quot; VPOS=\&quot;21888.0\&quot; CONTENT=\&quot;succes\&quot; WC=\&quot;0.82539684\&quot;&gt;&lt;ALTERNATIVE&gt;success&lt;/ALTERNATIVE&gt;&lt;/String&gt;&lt;/TextLine&gt;&lt;TextLine HEIGHT=\&quot;126.0\&quot; WIDTH=\&quot;2316.0\&quot; HPOS=\&quot;16662.0\&quot; VPOS=\&quot;22008.0\&quot;&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;75.0\&quot; WIDTH=\&quot;183.0\&quot; HPOS=\&quot;16662.0\&quot; VPOS=\&quot;22059.0\&quot; CONTENT=\&quot;sor\&quot; WC=\&quot;1.0\&quot;&gt;&lt;ALTERNATIVE&gt;soar&lt;/ALTERNATIVE&gt;&lt;/String&gt;&lt;SP WIDTH=\&quot;72.0\&quot; HPOS=\&quot;16845.0\&quot; VPOS=\&quot;22059.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;90.0\&quot; WIDTH=\&quot;168.0\&quot; HPOS=\&quot;16917.0\&quot; VPOS=\&quot;22035.0\&quot; CONTENT=\&quot;for\&quot; WC=\&quot;1.0\&quot;/&gt;&lt;SP WIDTH=\&quot;72.0\&quot; HPOS=\&quot;17085.0\&quot; VPOS=\&quot;22035.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;69.0\&quot; WIDTH=\&quot;267.0\&quot; HPOS=\&quot;17157.0\&quot; VPOS=\&quot;22050.0\&quot; CONTENT=\&quot;even\&quot; WC=\&quot;1.0\&quot;&gt;&lt;ALTERNATIVE&gt;cen&lt;/ALTERNATIVE&gt;&lt;ALTERNATIVE&gt;cent&lt;/ALTERNATIVE&gt;&lt;/String&gt;&lt;SP WIDTH=\&quot;77.0\&quot; HPOS=\&quot;17434.0\&quot; VPOS=\&quot;22050.0\&quot;/&gt;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;66.0\&quot; WIDTH=\&quot;63.0\&quot; HPOS=\&quot;17502.0\&quot; VPOS=\&quot;22044.0\&quot;</code></pre>
<p>The file was imported without any newlines. So we need to insert them ourselves, by splitting the
string in a clever way.</p>
</div>
<div id="splitting-strings" class="section level4 hasAnchor" number="4.7.3.3">
<h4><span class="header-section-number">4.7.3.3</span> Splitting strings<a href="descriptive-statistics-and-data-manipulation.html#splitting-strings" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are two functions included in <code>{stringr}</code> to split strings, <code>str_split()</code> and <code>str_split_fixed()</code>.
Let’s go back to our ancient philosophers. Two of them, Seneca the Younger and Marcus Aurelius have
something else in common than both being Roman Stoic philosophers. Their names are composed of several
words. If we want to split their names at the space character, we can use <code>str_split()</code> like this:</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="descriptive-statistics-and-data-manipulation.html#cb617-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb617-2"><a href="descriptive-statistics-and-data-manipulation.html#cb617-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_split</span>(<span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;aristotle&quot;
## 
## [[2]]
## [1] &quot;plato&quot;
## 
## [[3]]
## [1] &quot;epictetus&quot;
## 
## [[4]]
## [1] &quot;seneca&quot;  &quot;the&quot;     &quot;younger&quot;
## 
## [[5]]
## [1] &quot;epicurus&quot;
## 
## [[6]]
## [1] &quot;marcus&quot;   &quot;aurelius&quot;</code></pre>
<p><code>str_split()</code> also has a <code>simplify = TRUE</code> option:</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="descriptive-statistics-and-data-manipulation.html#cb619-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb619-2"><a href="descriptive-statistics-and-data-manipulation.html#cb619-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_split</span>(<span class="st">&quot; &quot;</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##      [,1]        [,2]       [,3]     
## [1,] &quot;aristotle&quot; &quot;&quot;         &quot;&quot;       
## [2,] &quot;plato&quot;     &quot;&quot;         &quot;&quot;       
## [3,] &quot;epictetus&quot; &quot;&quot;         &quot;&quot;       
## [4,] &quot;seneca&quot;    &quot;the&quot;      &quot;younger&quot;
## [5,] &quot;epicurus&quot;  &quot;&quot;         &quot;&quot;       
## [6,] &quot;marcus&quot;    &quot;aurelius&quot; &quot;&quot;</code></pre>
<p>This time, the returned object is a matrix.</p>
<p>What about <code>str_split_fixed()</code>? The difference is that here you can specify the number of pieces
to return. For example, you could consider the name “Aurelius” to be the middle name of Marcus Aurelius,
and the “the younger” to be the middle name of Seneca the younger. This means that you would want
to split the name only at the first space character, and not at all of them. This is easily achieved
with <code>str_split_fixed()</code>:</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="descriptive-statistics-and-data-manipulation.html#cb621-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb621-2"><a href="descriptive-statistics-and-data-manipulation.html#cb621-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_split_fixed</span>(<span class="st">&quot; &quot;</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      [,1]        [,2]         
## [1,] &quot;aristotle&quot; &quot;&quot;           
## [2,] &quot;plato&quot;     &quot;&quot;           
## [3,] &quot;epictetus&quot; &quot;&quot;           
## [4,] &quot;seneca&quot;    &quot;the younger&quot;
## [5,] &quot;epicurus&quot;  &quot;&quot;           
## [6,] &quot;marcus&quot;    &quot;aurelius&quot;</code></pre>
<p>This gives the expected result.</p>
<p>So how does this help in our case? Well, if you look at how the ALTO file looks like, at the beginning
of this section, you will notice that every line ends with the “&gt;” character. So let’s split at
that character!</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="descriptive-statistics-and-data-manipulation.html#cb623-1" aria-hidden="true" tabindex="-1"></a>winchester_text <span class="ot">&lt;-</span> winchester[<span class="dv">43</span>] <span class="sc">%&gt;%</span></span>
<span id="cb623-2"><a href="descriptive-statistics-and-data-manipulation.html#cb623-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_split</span>(<span class="st">&quot;&gt;&quot;</span>)</span></code></pre></div>
<p>Let’s take a closer look at <code>winchester_text</code>:</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="descriptive-statistics-and-data-manipulation.html#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(winchester_text)</span></code></pre></div>
<pre><code>## List of 1
##  $ : chr [1:19706] &quot;&lt;/processingStepSettings&quot; &quot;&lt;processingSoftware&quot; &quot;&lt;softwareCreator&quot; &quot;iArchives&lt;/softwareCreator&quot; ...</code></pre>
<p>So this is a list of length one, and the first, and only, element of that list is an atomic vector
with 19706 elements. Since this is a list of only one element, we can simplify it by saving the
atomic vector in a variable:</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="descriptive-statistics-and-data-manipulation.html#cb626-1" aria-hidden="true" tabindex="-1"></a>winchester_text <span class="ot">&lt;-</span> winchester_text[[<span class="dv">1</span>]]</span></code></pre></div>
<p>Let’s now look at some lines:</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="descriptive-statistics-and-data-manipulation.html#cb627-1" aria-hidden="true" tabindex="-1"></a>winchester_text[<span class="dv">1232</span><span class="sc">:</span><span class="dv">1245</span>]</span></code></pre></div>
<pre><code>##  [1] &quot;&lt;SP WIDTH=\&quot;66.0\&quot; HPOS=\&quot;5763.0\&quot; VPOS=\&quot;9696.0\&quot;/&quot;                                                                         
##  [2] &quot;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;108.0\&quot; WIDTH=\&quot;612.0\&quot; HPOS=\&quot;5829.0\&quot; VPOS=\&quot;9693.0\&quot; CONTENT=\&quot;Louisville\&quot; WC=\&quot;1.0\&quot;&quot;
##  [3] &quot;&lt;ALTERNATIVE&quot;                                                                                                                
##  [4] &quot;Loniile&lt;/ALTERNATIVE&quot;                                                                                                        
##  [5] &quot;&lt;ALTERNATIVE&quot;                                                                                                                
##  [6] &quot;Lenities&lt;/ALTERNATIVE&quot;                                                                                                       
##  [7] &quot;&lt;/String&quot;                                                                                                                    
##  [8] &quot;&lt;/TextLine&quot;                                                                                                                  
##  [9] &quot;&lt;TextLine HEIGHT=\&quot;150.0\&quot; WIDTH=\&quot;2520.0\&quot; HPOS=\&quot;4032.0\&quot; VPOS=\&quot;9849.0\&quot;&quot;                                                 
## [10] &quot;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;108.0\&quot; WIDTH=\&quot;510.0\&quot; HPOS=\&quot;4032.0\&quot; VPOS=\&quot;9861.0\&quot; CONTENT=\&quot;Tobacco\&quot; WC=\&quot;1.0\&quot;/&quot;  
## [11] &quot;&lt;SP WIDTH=\&quot;113.0\&quot; HPOS=\&quot;4542.0\&quot; VPOS=\&quot;9861.0\&quot;/&quot;                                                                        
## [12] &quot;&lt;String STYLEREFS=\&quot;ID7\&quot; HEIGHT=\&quot;105.0\&quot; WIDTH=\&quot;696.0\&quot; HPOS=\&quot;4656.0\&quot; VPOS=\&quot;9861.0\&quot; CONTENT=\&quot;Warehouse\&quot; WC=\&quot;1.0\&quot;&quot; 
## [13] &quot;&lt;ALTERNATIVE&quot;                                                                                                                
## [14] &quot;WHrchons&lt;/ALTERNATIVE&quot;</code></pre>
<p>This now looks easier to handle. We can narrow it down to the lines that only contain the string
we are interested in, “CONTENT”. First, let’s get the indices:</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="descriptive-statistics-and-data-manipulation.html#cb629-1" aria-hidden="true" tabindex="-1"></a>content_winchester_index <span class="ot">&lt;-</span> winchester_text <span class="sc">%&gt;%</span></span>
<span id="cb629-2"><a href="descriptive-statistics-and-data-manipulation.html#cb629-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_which</span>(<span class="st">&quot;CONTENT&quot;</span>)</span></code></pre></div>
<p>How many lines contain the string “CONTENT”?</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="descriptive-statistics-and-data-manipulation.html#cb630-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(content_winchester_index)</span></code></pre></div>
<pre><code>## [1] 4462</code></pre>
<p>As you can see, this reduces the amount of data we have to work with. Let us save this is a new
variable:</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="descriptive-statistics-and-data-manipulation.html#cb632-1" aria-hidden="true" tabindex="-1"></a>content_winchester <span class="ot">&lt;-</span> winchester_text[content_winchester_index]</span></code></pre></div>
</div>
<div id="matching-strings" class="section level4 hasAnchor" number="4.7.3.4">
<h4><span class="header-section-number">4.7.3.4</span> Matching strings<a href="descriptive-statistics-and-data-manipulation.html#matching-strings" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Matching strings is useful, but only in combination with regular expressions. As stated at the
beginning of this section, we are going to learn about regular expressions in Chapter 10, but in
order to make this section useful, we are going to learn the easiest, but perhaps the most useful
regular expression: <code>.*</code>.</p>
<p>Let’s go back to our ancient philosophers, and use <code>str_match()</code> and see what happens. Let’s match
the “us” string:</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="descriptive-statistics-and-data-manipulation.html#cb633-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb633-2"><a href="descriptive-statistics-and-data-manipulation.html#cb633-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_match</span>(<span class="st">&quot;us&quot;</span>)</span></code></pre></div>
<pre><code>##      [,1]
## [1,] NA  
## [2,] NA  
## [3,] &quot;us&quot;
## [4,] NA  
## [5,] &quot;us&quot;
## [6,] &quot;us&quot;</code></pre>
<p>Not very useful, but what about the regular expression <code>.*</code>? How could it help?</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="descriptive-statistics-and-data-manipulation.html#cb635-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb635-2"><a href="descriptive-statistics-and-data-manipulation.html#cb635-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_match</span>(<span class="st">&quot;.*us&quot;</span>)</span></code></pre></div>
<pre><code>##      [,1]             
## [1,] NA               
## [2,] NA               
## [3,] &quot;epictetus&quot;      
## [4,] NA               
## [5,] &quot;epicurus&quot;       
## [6,] &quot;marcus aurelius&quot;</code></pre>
<p>That’s already very interesting! So how does <code>.*</code> work? To understand, let’s first start by using
<code>.</code> alone:</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="descriptive-statistics-and-data-manipulation.html#cb637-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb637-2"><a href="descriptive-statistics-and-data-manipulation.html#cb637-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_match</span>(<span class="st">&quot;.us&quot;</span>)</span></code></pre></div>
<pre><code>##      [,1] 
## [1,] NA   
## [2,] NA   
## [3,] &quot;tus&quot;
## [4,] NA   
## [5,] &quot;rus&quot;
## [6,] &quot;cus&quot;</code></pre>
<p>This also matched whatever symbol comes just before the “u” from “us”. What if we use two <code>.</code> instead?</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="descriptive-statistics-and-data-manipulation.html#cb639-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb639-2"><a href="descriptive-statistics-and-data-manipulation.html#cb639-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_match</span>(<span class="st">&quot;..us&quot;</span>)</span></code></pre></div>
<pre><code>##      [,1]  
## [1,] NA    
## [2,] NA    
## [3,] &quot;etus&quot;
## [4,] NA    
## [5,] &quot;urus&quot;
## [6,] &quot;rcus&quot;</code></pre>
<p>This time, we get the two symbols that immediately precede “us”. Instead of continuing like this
we now use the <code>*</code>, which matches zero or more of <code>.</code>. So by combining <code>*</code> and <code>.</code>, we can match
any symbol repeatedly, until there is nothing more to match. Note that there is also <code>+</code>, which works
similarly to <code>*</code>, but it matches one or more symbols.</p>
<p>There is also a <code>str_match_all()</code>:</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="descriptive-statistics-and-data-manipulation.html#cb641-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb641-2"><a href="descriptive-statistics-and-data-manipulation.html#cb641-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_match_all</span>(<span class="st">&quot;.*us&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
##      [,1]
## 
## [[2]]
##      [,1]
## 
## [[3]]
##      [,1]       
## [1,] &quot;epictetus&quot;
## 
## [[4]]
##      [,1]
## 
## [[5]]
##      [,1]      
## [1,] &quot;epicurus&quot;
## 
## [[6]]
##      [,1]             
## [1,] &quot;marcus aurelius&quot;</code></pre>
<p>In this particular case it does not change the end result, but keep it in mind for cases like this one:</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="descriptive-statistics-and-data-manipulation.html#cb643-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;haha&quot;</span>, <span class="st">&quot;huhu&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb643-2"><a href="descriptive-statistics-and-data-manipulation.html#cb643-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_match</span>(<span class="st">&quot;ha&quot;</span>)</span></code></pre></div>
<pre><code>##      [,1]
## [1,] &quot;ha&quot;
## [2,] NA</code></pre>
<p>and:</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="descriptive-statistics-and-data-manipulation.html#cb645-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;haha&quot;</span>, <span class="st">&quot;huhu&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb645-2"><a href="descriptive-statistics-and-data-manipulation.html#cb645-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_match_all</span>(<span class="st">&quot;ha&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
##      [,1]
## [1,] &quot;ha&quot;
## [2,] &quot;ha&quot;
## 
## [[2]]
##      [,1]</code></pre>
<p>What if we want to match names containing the letter “t”? Easy:</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="descriptive-statistics-and-data-manipulation.html#cb647-1" aria-hidden="true" tabindex="-1"></a>ancient_philosophers <span class="sc">%&gt;%</span></span>
<span id="cb647-2"><a href="descriptive-statistics-and-data-manipulation.html#cb647-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_match</span>(<span class="st">&quot;.*t.*&quot;</span>)</span></code></pre></div>
<pre><code>##      [,1]                
## [1,] &quot;aristotle&quot;         
## [2,] &quot;plato&quot;             
## [3,] &quot;epictetus&quot;         
## [4,] &quot;seneca the younger&quot;
## [5,] NA                  
## [6,] NA</code></pre>
<p>So how does this help us with our historical newspaper? Let’s try to get the strings that come
after “CONTENT”:</p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="descriptive-statistics-and-data-manipulation.html#cb649-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_text <span class="sc">%&gt;%</span></span>
<span id="cb649-2"><a href="descriptive-statistics-and-data-manipulation.html#cb649-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_match</span>(<span class="st">&quot;CONTENT.*&quot;</span>)</span></code></pre></div>
<p>Let’s use our faithful <code>str()</code> function to take a look:</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="descriptive-statistics-and-data-manipulation.html#cb650-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="sc">%&gt;%</span></span>
<span id="cb650-2"><a href="descriptive-statistics-and-data-manipulation.html#cb650-2" aria-hidden="true" tabindex="-1"></a>  str</span></code></pre></div>
<pre><code>##  chr [1:19706, 1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA ...</code></pre>
<p>Hum, there’s a lot of <code>NA</code> values! This is because a lot of the lines from the file did not have the
string “CONTENT”, so there is no match possible. Let’s us remove all these <code>NA</code>s. Because the
result is a matrix, we cannot use the <code>filter()</code> function from <code>{dplyr}</code>. So we need to convert it
to a tibble first:</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="descriptive-statistics-and-data-manipulation.html#cb652-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_content <span class="sc">%&gt;%</span></span>
<span id="cb652-2"><a href="descriptive-statistics-and-data-manipulation.html#cb652-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb652-3"><a href="descriptive-statistics-and-data-manipulation.html#cb652-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(V1))</span></code></pre></div>
<pre><code>## Warning: `as.tibble()` was deprecated in tibble 2.0.0.
## Please use `as_tibble()` instead.
## The signature and semantics have changed, see `?as_tibble`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<p>Because matrix columns do not have names, when a matrix gets converted into a tibble, the firt column
gets automatically called <code>V1</code>. This is why I filter on this column. Let’s take a look at the data:</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="descriptive-statistics-and-data-manipulation.html#cb655-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(winchester_content)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   V1                                  
##   &lt;chr&gt;                               
## 1 &quot;CONTENT=\&quot;J\&quot; WC=\&quot;0.8095238\&quot;/&quot;   
## 2 &quot;CONTENT=\&quot;a\&quot; WC=\&quot;0.8095238\&quot;/&quot;   
## 3 &quot;CONTENT=\&quot;Ira\&quot; WC=\&quot;0.95238096\&quot;/&quot;
## 4 &quot;CONTENT=\&quot;mj\&quot; WC=\&quot;0.8095238\&quot;/&quot;  
## 5 &quot;CONTENT=\&quot;iI\&quot; WC=\&quot;0.8095238\&quot;/&quot;  
## 6 &quot;CONTENT=\&quot;tE1r\&quot; WC=\&quot;0.8095238\&quot;/&quot;</code></pre>
</div>
<div id="searching-and-replacing-strings" class="section level4 hasAnchor" number="4.7.3.5">
<h4><span class="header-section-number">4.7.3.5</span> Searching and replacing strings<a href="descriptive-statistics-and-data-manipulation.html#searching-and-replacing-strings" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We are getting close to the final result. We still need to do some cleaning however. Since our data
is inside a nice tibble, we might as well stick with it. So let’s first rename the column and
change all the strings to lowercase:</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="descriptive-statistics-and-data-manipulation.html#cb657-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb657-2"><a href="descriptive-statistics-and-data-manipulation.html#cb657-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">content =</span> <span class="fu">tolower</span>(V1)) <span class="sc">%&gt;%</span> </span>
<span id="cb657-3"><a href="descriptive-statistics-and-data-manipulation.html#cb657-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>V1)</span></code></pre></div>
<p>Let’s take a look at the result:</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="descriptive-statistics-and-data-manipulation.html#cb658-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(winchester_content)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   content                             
##   &lt;chr&gt;                               
## 1 &quot;content=\&quot;j\&quot; wc=\&quot;0.8095238\&quot;/&quot;   
## 2 &quot;content=\&quot;a\&quot; wc=\&quot;0.8095238\&quot;/&quot;   
## 3 &quot;content=\&quot;ira\&quot; wc=\&quot;0.95238096\&quot;/&quot;
## 4 &quot;content=\&quot;mj\&quot; wc=\&quot;0.8095238\&quot;/&quot;  
## 5 &quot;content=\&quot;ii\&quot; wc=\&quot;0.8095238\&quot;/&quot;  
## 6 &quot;content=\&quot;te1r\&quot; wc=\&quot;0.8095238\&quot;/&quot;</code></pre>
<p>The second part of the string, “wc=….” is not really interesting. Let’s search and replace this
with an empty string, using <code>str_replace()</code>:</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="descriptive-statistics-and-data-manipulation.html#cb660-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb660-2"><a href="descriptive-statistics-and-data-manipulation.html#cb660-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">content =</span> <span class="fu">str_replace</span>(content, <span class="st">&quot;wc.*&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb660-3"><a href="descriptive-statistics-and-data-manipulation.html#cb660-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-4"><a href="descriptive-statistics-and-data-manipulation.html#cb660-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(winchester_content)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   content            
##   &lt;chr&gt;              
## 1 &quot;content=\&quot;j\&quot; &quot;   
## 2 &quot;content=\&quot;a\&quot; &quot;   
## 3 &quot;content=\&quot;ira\&quot; &quot; 
## 4 &quot;content=\&quot;mj\&quot; &quot;  
## 5 &quot;content=\&quot;ii\&quot; &quot;  
## 6 &quot;content=\&quot;te1r\&quot; &quot;</code></pre>
<p>We need to use the regular expression from before to replace “wc” and every character that follows.
The same can be use to remove “content=”:</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="descriptive-statistics-and-data-manipulation.html#cb662-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb662-2"><a href="descriptive-statistics-and-data-manipulation.html#cb662-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">content =</span> <span class="fu">str_replace</span>(content, <span class="st">&quot;content=&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb662-3"><a href="descriptive-statistics-and-data-manipulation.html#cb662-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb662-4"><a href="descriptive-statistics-and-data-manipulation.html#cb662-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(winchester_content)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   content    
##   &lt;chr&gt;      
## 1 &quot;\&quot;j\&quot; &quot;   
## 2 &quot;\&quot;a\&quot; &quot;   
## 3 &quot;\&quot;ira\&quot; &quot; 
## 4 &quot;\&quot;mj\&quot; &quot;  
## 5 &quot;\&quot;ii\&quot; &quot;  
## 6 &quot;\&quot;te1r\&quot; &quot;</code></pre>
<p>We are almost done, but some cleaning is still necessary:</p>
</div>
<div id="exctracting-or-removing-strings" class="section level4 hasAnchor" number="4.7.3.6">
<h4><span class="header-section-number">4.7.3.6</span> Exctracting or removing strings<a href="descriptive-statistics-and-data-manipulation.html#exctracting-or-removing-strings" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now, because I now the ALTO spec, I know how to find words that are split between two sentences:</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="descriptive-statistics-and-data-manipulation.html#cb664-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb664-2"><a href="descriptive-statistics-and-data-manipulation.html#cb664-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(content, <span class="st">&quot;hyppart&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 64 × 1
##    content                                                               
##    &lt;chr&gt;                                                                 
##  1 &quot;\&quot;aver\&quot; subs_type=\&quot;hyppart1\&quot; subs_content=\&quot;average\&quot; &quot;           
##  2 &quot;\&quot;age\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;average\&quot; &quot;            
##  3 &quot;\&quot;considera\&quot; subs_type=\&quot;hyppart1\&quot; subs_content=\&quot;consideration\&quot; &quot;
##  4 &quot;\&quot;tion\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;consideration\&quot; &quot;     
##  5 &quot;\&quot;re\&quot; subs_type=\&quot;hyppart1\&quot; subs_content=\&quot;resigned\&quot; &quot;            
##  6 &quot;\&quot;signed\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;resigned\&quot; &quot;        
##  7 &quot;\&quot;install\&quot; subs_type=\&quot;hyppart1\&quot; subs_content=\&quot;installed\&quot; &quot;      
##  8 &quot;\&quot;ed\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;installed\&quot; &quot;           
##  9 &quot;\&quot;be\&quot; subs_type=\&quot;hyppart1\&quot; subs_content=\&quot;before\&quot; &quot;              
## 10 &quot;\&quot;fore\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;before\&quot; &quot;            
## # … with 54 more rows</code></pre>
<p>For instance, the word “average” was split over two lines, the first part of the word, “aver” on the
first line, and the second part of the word, “age”, on the second line. We want to keep what comes
after “subs_content”. Let’s extract the word “average” using <code>str_extract()</code>. However, because only
some words were split between two lines, we first need to detect where the string “hyppart1” is
located, and only then can we extract what comes after “subs_content”. Thus, we need to combine
<code>str_detect()</code> to first detect the string, and then <code>str_extract()</code> to extract what comes after
“subs_content”:</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="descriptive-statistics-and-data-manipulation.html#cb666-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb666-2"><a href="descriptive-statistics-and-data-manipulation.html#cb666-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">content =</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(content, <span class="st">&quot;hyppart1&quot;</span>), </span>
<span id="cb666-3"><a href="descriptive-statistics-and-data-manipulation.html#cb666-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_extract_all</span>(content, <span class="st">&quot;content=.*&quot;</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>), </span>
<span id="cb666-4"><a href="descriptive-statistics-and-data-manipulation.html#cb666-4" aria-hidden="true" tabindex="-1"></a>                           content))</span></code></pre></div>
<p>Let’s take a look at the result:</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="descriptive-statistics-and-data-manipulation.html#cb667-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb667-2"><a href="descriptive-statistics-and-data-manipulation.html#cb667-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(content, <span class="st">&quot;content&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 64 × 1
##    content                                                          
##    &lt;chr&gt;                                                            
##  1 &quot;content=\&quot;average\&quot; &quot;                                           
##  2 &quot;\&quot;age\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;average\&quot; &quot;       
##  3 &quot;content=\&quot;consideration\&quot; &quot;                                     
##  4 &quot;\&quot;tion\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;consideration\&quot; &quot;
##  5 &quot;content=\&quot;resigned\&quot; &quot;                                          
##  6 &quot;\&quot;signed\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;resigned\&quot; &quot;   
##  7 &quot;content=\&quot;installed\&quot; &quot;                                         
##  8 &quot;\&quot;ed\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;installed\&quot; &quot;      
##  9 &quot;content=\&quot;before\&quot; &quot;                                            
## 10 &quot;\&quot;fore\&quot; subs_type=\&quot;hyppart2\&quot; subs_content=\&quot;before\&quot; &quot;       
## # … with 54 more rows</code></pre>
<p>We still need to get rid of the string “content=” and then of all the strings that contain “hyppart2”,
which are not needed now:</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="descriptive-statistics-and-data-manipulation.html#cb669-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb669-2"><a href="descriptive-statistics-and-data-manipulation.html#cb669-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">content =</span> <span class="fu">str_replace</span>(content, <span class="st">&quot;content=&quot;</span>, <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb669-3"><a href="descriptive-statistics-and-data-manipulation.html#cb669-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">content =</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(content, <span class="st">&quot;hyppart2&quot;</span>), <span class="cn">NA_character_</span>, content))</span>
<span id="cb669-4"><a href="descriptive-statistics-and-data-manipulation.html#cb669-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-5"><a href="descriptive-statistics-and-data-manipulation.html#cb669-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(winchester_content)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   content    
##   &lt;chr&gt;      
## 1 &quot;\&quot;j\&quot; &quot;   
## 2 &quot;\&quot;a\&quot; &quot;   
## 3 &quot;\&quot;ira\&quot; &quot; 
## 4 &quot;\&quot;mj\&quot; &quot;  
## 5 &quot;\&quot;ii\&quot; &quot;  
## 6 &quot;\&quot;te1r\&quot; &quot;</code></pre>
<p>Almost done! We only need to remove the <code>"</code> characters:</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="descriptive-statistics-and-data-manipulation.html#cb671-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb671-2"><a href="descriptive-statistics-and-data-manipulation.html#cb671-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">content =</span> <span class="fu">str_replace_all</span>(content, <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>)) </span>
<span id="cb671-3"><a href="descriptive-statistics-and-data-manipulation.html#cb671-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb671-4"><a href="descriptive-statistics-and-data-manipulation.html#cb671-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(winchester_content)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   content
##   &lt;chr&gt;  
## 1 &quot;j &quot;   
## 2 &quot;a &quot;   
## 3 &quot;ira &quot; 
## 4 &quot;mj &quot;  
## 5 &quot;ii &quot;  
## 6 &quot;te1r &quot;</code></pre>
<p>Let’s remove space characters with <code>str_trim()</code>:</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="descriptive-statistics-and-data-manipulation.html#cb673-1" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb673-2"><a href="descriptive-statistics-and-data-manipulation.html#cb673-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">content =</span> <span class="fu">str_trim</span>(content)) </span>
<span id="cb673-3"><a href="descriptive-statistics-and-data-manipulation.html#cb673-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb673-4"><a href="descriptive-statistics-and-data-manipulation.html#cb673-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(winchester_content)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   content
##   &lt;chr&gt;  
## 1 j      
## 2 a      
## 3 ira    
## 4 mj     
## 5 ii     
## 6 te1r</code></pre>
<p>To finish off this section, let’s remove stop words (words that do not add any meaning to a sentence,
such as “as”, “and”…) and words that are composed of less than 3 characters. You can find a dataset
with stopwords inside the <code>{stopwords}</code> package:</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="descriptive-statistics-and-data-manipulation.html#cb675-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stopwords)</span>
<span id="cb675-2"><a href="descriptive-statistics-and-data-manipulation.html#cb675-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-3"><a href="descriptive-statistics-and-data-manipulation.html#cb675-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(data_stopwords_stopwordsiso)</span>
<span id="cb675-4"><a href="descriptive-statistics-and-data-manipulation.html#cb675-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-5"><a href="descriptive-statistics-and-data-manipulation.html#cb675-5" aria-hidden="true" tabindex="-1"></a>eng_stopwords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">&quot;content&quot;</span> <span class="ot">=</span> data_stopwords_stopwordsiso<span class="sc">$</span>en)</span>
<span id="cb675-6"><a href="descriptive-statistics-and-data-manipulation.html#cb675-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-7"><a href="descriptive-statistics-and-data-manipulation.html#cb675-7" aria-hidden="true" tabindex="-1"></a>winchester_content <span class="ot">&lt;-</span> winchester_content <span class="sc">%&gt;%</span> </span>
<span id="cb675-8"><a href="descriptive-statistics-and-data-manipulation.html#cb675-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(eng_stopwords) <span class="sc">%&gt;%</span> </span>
<span id="cb675-9"><a href="descriptive-statistics-and-data-manipulation.html#cb675-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;content&quot;</code></pre>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="descriptive-statistics-and-data-manipulation.html#cb677-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(winchester_content)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   content   
##   &lt;chr&gt;     
## 1 te1r      
## 2 jilas     
## 3 edition   
## 4 winchester
## 5 news      
## 6 injuries</code></pre>
<p>That’s it for this section! You now know how to work with strings, but in Chapter 10 we are going
one step further by learning about regular expressions, which offer much more power.</p>
</div>
</div>
<div id="tidy-data-frames-with-tibble" class="section level3 hasAnchor" number="4.7.4">
<h3><span class="header-section-number">4.7.4</span> Tidy data frames with <code>{tibble}</code><a href="descriptive-statistics-and-data-manipulation.html#tidy-data-frames-with-tibble" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We have already seen and used several functions from the <code>{tibble}</code> package. Let’s now go through
some more useful functions.</p>
<div id="creating-tibbles" class="section level4 hasAnchor" number="4.7.4.1">
<h4><span class="header-section-number">4.7.4.1</span> Creating tibbles<a href="descriptive-statistics-and-data-manipulation.html#creating-tibbles" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>tribble()</code> makes it easy to create tibble row by row, manually:</p>
<p>It is also possible to create a tibble from a named list:</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="descriptive-statistics-and-data-manipulation.html#cb679-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(<span class="fu">list</span>(<span class="st">&quot;combustion&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;oil&quot;</span>, <span class="st">&quot;diesel&quot;</span>, <span class="st">&quot;oil&quot;</span>, <span class="st">&quot;electric&quot;</span>),</span>
<span id="cb679-2"><a href="descriptive-statistics-and-data-manipulation.html#cb679-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;doors&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   combustion doors
##   &lt;chr&gt;      &lt;dbl&gt;
## 1 oil            3
## 2 diesel         5
## 3 oil            5
## 4 electric       5</code></pre>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="descriptive-statistics-and-data-manipulation.html#cb681-1" aria-hidden="true" tabindex="-1"></a><span class="fu">enframe</span>(<span class="fu">list</span>(<span class="st">&quot;combustion&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="st">&quot;doors&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>), <span class="st">&quot;cylinders&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   name       value    
##   &lt;chr&gt;      &lt;list&gt;   
## 1 combustion &lt;dbl [2]&gt;
## 2 doors      &lt;dbl [3]&gt;
## 3 cylinders  &lt;dbl [4]&gt;</code></pre>
</div>
</div>
</div>
<div id="list-columns" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> List-columns<a href="descriptive-statistics-and-data-manipulation.html#list-columns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To learn about list-columns, let’s first focus on a single character of the <code>starwars</code> dataset:</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="descriptive-statistics-and-data-manipulation.html#cb683-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(starwars)</span></code></pre></div>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="descriptive-statistics-and-data-manipulation.html#cb684-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb684-2"><a href="descriptive-statistics-and-data-manipulation.html#cb684-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Luke Skywalker&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb684-3"><a href="descriptive-statistics-and-data-manipulation.html#cb684-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 14
## $ name       &lt;chr&gt; &quot;Luke Skywalker&quot;
## $ height     &lt;int&gt; 172
## $ mass       &lt;dbl&gt; 77
## $ hair_color &lt;chr&gt; &quot;blond&quot;
## $ skin_color &lt;chr&gt; &quot;fair&quot;
## $ eye_color  &lt;chr&gt; &quot;blue&quot;
## $ birth_year &lt;dbl&gt; 19
## $ sex        &lt;chr&gt; &quot;male&quot;
## $ gender     &lt;chr&gt; &quot;masculine&quot;
## $ homeworld  &lt;chr&gt; &quot;Tatooine&quot;
## $ species    &lt;chr&gt; &quot;Human&quot;
## $ films      &lt;list&gt; &lt;&quot;The Empire Strikes Back&quot;, &quot;Revenge of the Sith&quot;, &quot;Return …
## $ vehicles   &lt;list&gt; &lt;&quot;Snowspeeder&quot;, &quot;Imperial Speeder Bike&quot;&gt;
## $ starships  &lt;list&gt; &lt;&quot;X-wing&quot;, &quot;Imperial shuttle&quot;&gt;</code></pre>
<p>We see that the columns <code>films</code>, <code>vehicles</code> and <code>starships</code> (at the bottom) are all lists, and in
the case of <code>films</code>, it lists all the films where Luke Skywalker has appeared. What if you want to
take a closer look at films where Luke Skywalker appeared?</p>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="descriptive-statistics-and-data-manipulation.html#cb686-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb686-2"><a href="descriptive-statistics-and-data-manipulation.html#cb686-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Luke Skywalker&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb686-3"><a href="descriptive-statistics-and-data-manipulation.html#cb686-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(films)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;The Empire Strikes Back&quot; &quot;Revenge of the Sith&quot;    
## [3] &quot;Return of the Jedi&quot;      &quot;A New Hope&quot;             
## [5] &quot;The Force Awakens&quot;</code></pre>
<p><code>pull()</code> is a <code>{dplyr}</code> function that extract (pulls) the column you’re interested in. It is quite
useful when you want to inspect a column. Instead of just looking at Luke Skywalker’s films,
let’s pull the complete <code>films</code> column instead:</p>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb688-1"><a href="descriptive-statistics-and-data-manipulation.html#cb688-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb688-2"><a href="descriptive-statistics-and-data-manipulation.html#cb688-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span>  <span class="co"># let&#39;s just look at the first six rows</span></span>
<span id="cb688-3"><a href="descriptive-statistics-and-data-manipulation.html#cb688-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(films) </span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;The Empire Strikes Back&quot; &quot;Revenge of the Sith&quot;    
## [3] &quot;Return of the Jedi&quot;      &quot;A New Hope&quot;             
## [5] &quot;The Force Awakens&quot;      
## 
## [[2]]
## [1] &quot;The Empire Strikes Back&quot; &quot;Attack of the Clones&quot;   
## [3] &quot;The Phantom Menace&quot;      &quot;Revenge of the Sith&quot;    
## [5] &quot;Return of the Jedi&quot;      &quot;A New Hope&quot;             
## 
## [[3]]
## [1] &quot;The Empire Strikes Back&quot; &quot;Attack of the Clones&quot;   
## [3] &quot;The Phantom Menace&quot;      &quot;Revenge of the Sith&quot;    
## [5] &quot;Return of the Jedi&quot;      &quot;A New Hope&quot;             
## [7] &quot;The Force Awakens&quot;      
## 
## [[4]]
## [1] &quot;The Empire Strikes Back&quot; &quot;Revenge of the Sith&quot;    
## [3] &quot;Return of the Jedi&quot;      &quot;A New Hope&quot;             
## 
## [[5]]
## [1] &quot;The Empire Strikes Back&quot; &quot;Revenge of the Sith&quot;    
## [3] &quot;Return of the Jedi&quot;      &quot;A New Hope&quot;             
## [5] &quot;The Force Awakens&quot;      
## 
## [[6]]
## [1] &quot;Attack of the Clones&quot; &quot;Revenge of the Sith&quot;  &quot;A New Hope&quot;</code></pre>
<p>Let’s stop here a moment. As you see, the <code>films</code> column contains several items in it. How is it
possible that a single <em>cell</em> contains more than one film? This is because what is actually
contained in the cell is not the seven films, as seven separate characters, but an atomic vector
that happens to have seven elements. But it is still only one vector. <em>Zooming</em> in into the data
frame helps understand:</p>
<p><img src="assets/zoom_list_columns.png" width="622" /></p>
<p>In the picture above we see three columns. The first two, <code>name</code> and <code>sex</code> are what you’re used
to see, just one element defining the characters <code>name</code> and <code>sex</code> respectively. The last one
also contains only one element for each character, it just so happens to be a complete
vector of characters. Because what is inside the <em>cells</em> of a list-column can be very different
things (as list can contain anything), you have to think a bit about it in order to extract
insights from such columns. List-columns may seem arcane, but they are extremely powerful
once you master them.</p>
<p>As an example, suppose we want to create a numerical variable which counts the number of movies
in which the characters have appeared. For this we need to compute the length of the list, or count
the number of elements this list has. Let’s try with <code>length()</code> a base R function:</p>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="descriptive-statistics-and-data-manipulation.html#cb690-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb690-2"><a href="descriptive-statistics-and-data-manipulation.html#cb690-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Luke Skywalker&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb690-3"><a href="descriptive-statistics-and-data-manipulation.html#cb690-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(films) <span class="sc">%&gt;%</span></span>
<span id="cb690-4"><a href="descriptive-statistics-and-data-manipulation.html#cb690-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>()</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>This might be surprising, but remember that a list with only one element, has a length of 1:</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="descriptive-statistics-and-data-manipulation.html#cb692-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(</span>
<span id="cb692-2"><a href="descriptive-statistics-and-data-manipulation.html#cb692-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(words) <span class="co"># this creates a list which one element. This element is a list of 980 words.</span></span>
<span id="cb692-3"><a href="descriptive-statistics-and-data-manipulation.html#cb692-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Even though <code>words</code> contain a vector of 980 words, if we put this very long vector inside the
first element of list, <code>length(list(words))</code> will this compute the length of the list. Let’s
see what happens if we create a more complex list:</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="descriptive-statistics-and-data-manipulation.html#cb694-1" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb694-2"><a href="descriptive-statistics-and-data-manipulation.html#cb694-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-3"><a href="descriptive-statistics-and-data-manipulation.html#cb694-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(</span>
<span id="cb694-4"><a href="descriptive-statistics-and-data-manipulation.html#cb694-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(words, <span class="co"># this creates a list which one element. This element is a list of 980 words.</span></span>
<span id="cb694-5"><a href="descriptive-statistics-and-data-manipulation.html#cb694-5" aria-hidden="true" tabindex="-1"></a>       numbers) <span class="co"># numbers contains numbers 1 through 5</span></span>
<span id="cb694-6"><a href="descriptive-statistics-and-data-manipulation.html#cb694-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p><code>list(words, numbers)</code> is now a list of two elements, <code>words</code> and <code>numbers</code>. If we want to compute
the length of <code>words</code> and <code>numbers</code>, we need to learn about another powerful concept called
<em>higher-order functions</em>. We are going to learn about this in greater detail in Chapter 8. For now,
let’s use the fact that our list <code>films</code> is contained inside of a data frame, and use a convenience
function included in <code>{dplyr}</code> to handle situations like this:</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="descriptive-statistics-and-data-manipulation.html#cb696-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span></span>
<span id="cb696-2"><a href="descriptive-statistics-and-data-manipulation.html#cb696-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="co"># &lt;- Apply the next steps for each row individually</span></span>
<span id="cb696-3"><a href="descriptive-statistics-and-data-manipulation.html#cb696-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_films =</span> <span class="fu">length</span>(films))</span></code></pre></div>
<p><code>dplyr::rowwise()</code> is useful when working with list-columns because whatever instructions follow
get run on the single element contained in the list. The picture below illustrates this:</p>
<p><img src="assets/rowwise.png" width="528" /></p>
<p>Let’s take a look at the characters and the number of films they have appeared in:</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="descriptive-statistics-and-data-manipulation.html#cb697-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb697-2"><a href="descriptive-statistics-and-data-manipulation.html#cb697-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, films, n_films)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
## # Rowwise: 
##    name               films     n_films
##    &lt;chr&gt;              &lt;list&gt;      &lt;int&gt;
##  1 Luke Skywalker     &lt;chr [5]&gt;       5
##  2 C-3PO              &lt;chr [6]&gt;       6
##  3 R2-D2              &lt;chr [7]&gt;       7
##  4 Darth Vader        &lt;chr [4]&gt;       4
##  5 Leia Organa        &lt;chr [5]&gt;       5
##  6 Owen Lars          &lt;chr [3]&gt;       3
##  7 Beru Whitesun lars &lt;chr [3]&gt;       3
##  8 R5-D4              &lt;chr [1]&gt;       1
##  9 Biggs Darklighter  &lt;chr [1]&gt;       1
## 10 Obi-Wan Kenobi     &lt;chr [6]&gt;       6
## # … with 77 more rows</code></pre>
<p>Now we can, for example, create a factor variable that groups characters by asking whether they appeared only in
1 movie, or more:</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="descriptive-statistics-and-data-manipulation.html#cb699-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span></span>
<span id="cb699-2"><a href="descriptive-statistics-and-data-manipulation.html#cb699-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">more_1 =</span> <span class="fu">case_when</span>(n_films <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Exactly one movie&quot;</span>,</span>
<span id="cb699-3"><a href="descriptive-statistics-and-data-manipulation.html#cb699-3" aria-hidden="true" tabindex="-1"></a>                            n_films <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;More than 1 movie&quot;</span>))</span></code></pre></div>
<p>You can also create list-columns with your own datasets, by using <code>tidyr::nest()</code>. Remember the
fake <code>survey_data</code> I created to illustrate <code>pivot_longer()</code> and <code>pivot_wider()</code>? Let’s go back to that dataset
again:</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="descriptive-statistics-and-data-manipulation.html#cb700-1" aria-hidden="true" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb700-2"><a href="descriptive-statistics-and-data-manipulation.html#cb700-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id, <span class="sc">~</span>variable, <span class="sc">~</span>value,</span>
<span id="cb700-3"><a href="descriptive-statistics-and-data-manipulation.html#cb700-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&quot;var1&quot;</span>, <span class="dv">1</span>,</span>
<span id="cb700-4"><a href="descriptive-statistics-and-data-manipulation.html#cb700-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">0.2</span>,</span>
<span id="cb700-5"><a href="descriptive-statistics-and-data-manipulation.html#cb700-5" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>, <span class="st">&quot;var3&quot;</span>, <span class="fl">0.3</span>,</span>
<span id="cb700-6"><a href="descriptive-statistics-and-data-manipulation.html#cb700-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;var1&quot;</span>, <span class="fl">1.4</span>,</span>
<span id="cb700-7"><a href="descriptive-statistics-and-data-manipulation.html#cb700-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">1.9</span>,</span>
<span id="cb700-8"><a href="descriptive-statistics-and-data-manipulation.html#cb700-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;var3&quot;</span>, <span class="fl">4.1</span>,</span>
<span id="cb700-9"><a href="descriptive-statistics-and-data-manipulation.html#cb700-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">&quot;var1&quot;</span>, <span class="fl">0.1</span>,</span>
<span id="cb700-10"><a href="descriptive-statistics-and-data-manipulation.html#cb700-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">2.8</span>,</span>
<span id="cb700-11"><a href="descriptive-statistics-and-data-manipulation.html#cb700-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">&quot;var3&quot;</span>, <span class="fl">8.9</span>,</span>
<span id="cb700-12"><a href="descriptive-statistics-and-data-manipulation.html#cb700-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="st">&quot;var1&quot;</span>, <span class="fl">1.7</span>,</span>
<span id="cb700-13"><a href="descriptive-statistics-and-data-manipulation.html#cb700-13" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">1.9</span>,</span>
<span id="cb700-14"><a href="descriptive-statistics-and-data-manipulation.html#cb700-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="st">&quot;var3&quot;</span>, <span class="fl">7.6</span></span>
<span id="cb700-15"><a href="descriptive-statistics-and-data-manipulation.html#cb700-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb700-16"><a href="descriptive-statistics-and-data-manipulation.html#cb700-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb700-17"><a href="descriptive-statistics-and-data-manipulation.html#cb700-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(survey_data)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##       id variable value
##    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
##  1     1 var1       1  
##  2     1 var2       0.2
##  3    NA var3       0.3
##  4     2 var1       1.4
##  5     2 var2       1.9
##  6     2 var3       4.1
##  7     3 var1       0.1
##  8     3 var2       2.8
##  9     3 var3       8.9
## 10     4 var1       1.7
## 11    NA var2       1.9
## 12     4 var3       7.6</code></pre>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb702-1"><a href="descriptive-statistics-and-data-manipulation.html#cb702-1" aria-hidden="true" tabindex="-1"></a>nested_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb702-2"><a href="descriptive-statistics-and-data-manipulation.html#cb702-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span>  </span>
<span id="cb702-3"><a href="descriptive-statistics-and-data-manipulation.html#cb702-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb702-4"><a href="descriptive-statistics-and-data-manipulation.html#cb702-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb702-5"><a href="descriptive-statistics-and-data-manipulation.html#cb702-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nested_data)</span></code></pre></div>
<pre><code>## Rows: 5
## Columns: 2
## Groups: id [5]
## $ id   &lt;dbl&gt; 1, NA, 2, 3, 4
## $ data &lt;list&gt; [&lt;tbl_df[2 x 2]&gt;], [&lt;tbl_df[2 x 2]&gt;], [&lt;tbl_df[3 x 2]&gt;], [&lt;tbl_df…</code></pre>
<p>This creates a new tibble, with columns <code>id</code> and <code>data</code>. <code>data</code> is a list-column that contains
tibbles; each tibble is the <code>variable</code> and <code>value</code> for each individual:</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="descriptive-statistics-and-data-manipulation.html#cb704-1" aria-hidden="true" tabindex="-1"></a>nested_data <span class="sc">%&gt;%</span></span>
<span id="cb704-2"><a href="descriptive-statistics-and-data-manipulation.html#cb704-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">==</span> <span class="st">&quot;1&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb704-3"><a href="descriptive-statistics-and-data-manipulation.html#cb704-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(data)</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 2 × 2
##   variable value
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 var1       1  
## 2 var2       0.2</code></pre>
<p>As you can see, for individual 1, the column data contains a 2x2 tibble with columns <code>variable</code> and
<code>value</code>. Because <code>group_by()</code> followed by <code>nest()</code> is so useful, there is a wrapper around these two functions
called <code>group_nest()</code>:</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb706-1"><a href="descriptive-statistics-and-data-manipulation.html#cb706-1" aria-hidden="true" tabindex="-1"></a>survey_data <span class="sc">%&gt;%</span></span>
<span id="cb706-2"><a href="descriptive-statistics-and-data-manipulation.html#cb706-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_nest</span>(id)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##      id               data
##   &lt;dbl&gt; &lt;list&lt;tibble[,2]&gt;&gt;
## 1     1            [2 × 2]
## 2     2            [3 × 2]
## 3     3            [3 × 2]
## 4     4            [2 × 2]
## 5    NA            [2 × 2]</code></pre>
<p>You might be wondering why this is useful, because this seems to introduce an unnecessary
layer of complexity. The usefulness of list-columns will become apparent in the next chapters,
where we are going to learn how to repeat actions over, say, individuals. So if you’ve reached
the end of this section and still didn’t really grok list-columns, go take some fresh air and
come back to this section again later on.</p>
</div>
<div id="going-beyond-descriptive-statistics-and-data-manipulation" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> Going beyond descriptive statistics and data manipulation<a href="descriptive-statistics-and-data-manipulation.html#going-beyond-descriptive-statistics-and-data-manipulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>{tidyverse}</code> collection of packages can do much more than simply data manipulation and
descriptive statisics. You can use the principles we have covered and the functions you now know
to do much more. For instance, you can use a few <code>{tidyverse}</code> functions to do Monte Carlo simulations,
for example to estimate <span class="math inline">\(\pi\)</span>.</p>
<p>Draw the unit circle inside the unit square, the ratio of the area of the circle to the area of the
square will be <span class="math inline">\(\pi/4\)</span>. Then shot K arrows at the square; roughly <span class="math inline">\(K*\pi/4\)</span> should have fallen
inside the circle. So if now you shoot N arrows at the square, and M fall inside the circle, you have
the following relationship <span class="math inline">\(M = N*\pi/4\)</span>. You can thus compute <span class="math inline">\(\pi\)</span> like so: <span class="math inline">\(\pi = 4*M/N\)</span>.</p>
<p>The more arrows N you throw at the square, the better approximation of <span class="math inline">\(\pi\)</span> you’ll have. Let’s
try to do this with a tidy Monte Carlo simulation. First, let’s randomly pick some points inside
the unit square:</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="descriptive-statistics-and-data-manipulation.html#cb708-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb708-2"><a href="descriptive-statistics-and-data-manipulation.html#cb708-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb708-3"><a href="descriptive-statistics-and-data-manipulation.html#cb708-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb708-4"><a href="descriptive-statistics-and-data-manipulation.html#cb708-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb708-5"><a href="descriptive-statistics-and-data-manipulation.html#cb708-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2019</span>)</span>
<span id="cb708-6"><a href="descriptive-statistics-and-data-manipulation.html#cb708-6" aria-hidden="true" tabindex="-1"></a>points <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">&quot;x&quot;</span> <span class="ot">=</span> <span class="fu">runif</span>(n), <span class="st">&quot;y&quot;</span> <span class="ot">=</span> <span class="fu">runif</span>(n))</span></code></pre></div>
<p>Now, to know if a point is inside the unit circle, we need to check wether <span class="math inline">\(x^2 + y^2 &lt; 1\)</span>. Let’s
add a new column to the <code>points</code> tibble, called <code>inside</code> equal to 1 if the point is inside the
unit circle and 0 if not:</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="descriptive-statistics-and-data-manipulation.html#cb709-1" aria-hidden="true" tabindex="-1"></a>points <span class="ot">&lt;-</span> points <span class="sc">%&gt;%</span></span>
<span id="cb709-2"><a href="descriptive-statistics-and-data-manipulation.html#cb709-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">inside =</span> <span class="fu">map2_dbl</span>(<span class="at">.x =</span> x, <span class="at">.y =</span> y, <span class="sc">~</span><span class="fu">ifelse</span>(.x<span class="sc">**</span><span class="dv">2</span> <span class="sc">+</span> .y<span class="sc">**</span><span class="dv">2</span> <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb709-3"><a href="descriptive-statistics-and-data-manipulation.html#cb709-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowid_to_column</span>(<span class="st">&quot;N&quot;</span>)</span></code></pre></div>
<p>Let’s take a look at <code>points</code>:</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="descriptive-statistics-and-data-manipulation.html#cb710-1" aria-hidden="true" tabindex="-1"></a>points</span></code></pre></div>
<pre><code>## # A tibble: 5,000 × 4
##        N       x      y inside
##    &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1     1 0.770   0.984       0
##  2     2 0.713   0.0107      1
##  3     3 0.303   0.133       1
##  4     4 0.618   0.0378      1
##  5     5 0.0505  0.677       1
##  6     6 0.0432  0.0846      1
##  7     7 0.820   0.727       0
##  8     8 0.00961 0.0758      1
##  9     9 0.102   0.373       1
## 10    10 0.609   0.676       1
## # … with 4,990 more rows</code></pre>
<p>Now, I can compute the estimation
of <span class="math inline">\(\pi\)</span> at each row, by computing the cumulative sum of the 1’s in the <code>inside</code> column and dividing
that by the current value of <code>N</code> column:</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="descriptive-statistics-and-data-manipulation.html#cb712-1" aria-hidden="true" tabindex="-1"></a>points <span class="ot">&lt;-</span> points <span class="sc">%&gt;%</span></span>
<span id="cb712-2"><a href="descriptive-statistics-and-data-manipulation.html#cb712-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">estimate =</span> <span class="dv">4</span><span class="sc">*</span><span class="fu">cumsum</span>(inside)<span class="sc">/</span>N)</span></code></pre></div>
<p><code>cumsum(inside)</code> is the <code>M</code> from the formula. Now, we can finish by plotting the result:</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="descriptive-statistics-and-data-manipulation.html#cb713-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(points) <span class="sc">+</span></span>
<span id="cb713-2"><a href="descriptive-statistics-and-data-manipulation.html#cb713-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> estimate, <span class="at">x =</span> N)) <span class="sc">+</span></span>
<span id="cb713-3"><a href="descriptive-statistics-and-data-manipulation.html#cb713-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> pi)</span></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-412-1.png" width="672" /></p>
<p>In the next chapter, we are going to learn all about <code>{ggplot2}</code>, the package I used in the lines
above to create this plot.</p>
<p>As the number of tries grows, the estimation of <span class="math inline">\(\pi\)</span> gets better.</p>
<p>Using a data frame as a structure to hold our simulated points and the results makes it very easy
to avoid loops, and thus write code that is more concise and easier to follow.
If you studied a quantitative field in university, you might have done a similar exercise at the
time, very likely by defining a matrix to hold your points, and an empty vector to hold whether a
particular point was inside the unit circle. Then you wrote a loop to compute whether
a point was inside the unit circle, save this result in the before-defined empty vector and then
compute the estimation of <span class="math inline">\(\pi\)</span>. Again, I take this opportunity here to stress that there is nothing
wrong with this approach per se, but R is better suited for a workflow where lists or data frames
are the central objects and where the analyst operates over them with functional programming techniques.</p>
</div>
<div id="exercises-2" class="section level2 hasAnchor" number="4.10">
<h2><span class="header-section-number">4.10</span> Exercises<a href="descriptive-statistics-and-data-manipulation.html#exercises-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="exercise-1-2" class="section level3 unnumbered hasAnchor">
<h3>Exercise 1<a href="descriptive-statistics-and-data-manipulation.html#exercise-1-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Combine <code>mutate()</code> with <code>across()</code> to exponentiate every column of type <code>double</code> of the <code>gasoline</code> dataset.</li>
</ul>
<p>To obtain the <code>gasoline</code> dataset, run the following lines:</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="descriptive-statistics-and-data-manipulation.html#cb714-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Gasoline, <span class="at">package =</span> <span class="st">&quot;plm&quot;</span>)</span>
<span id="cb714-2"><a href="descriptive-statistics-and-data-manipulation.html#cb714-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb714-3"><a href="descriptive-statistics-and-data-manipulation.html#cb714-3" aria-hidden="true" tabindex="-1"></a>gasoline <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Gasoline)</span>
<span id="cb714-4"><a href="descriptive-statistics-and-data-manipulation.html#cb714-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb714-5"><a href="descriptive-statistics-and-data-manipulation.html#cb714-5" aria-hidden="true" tabindex="-1"></a>gasoline <span class="ot">&lt;-</span> gasoline <span class="sc">%&gt;%</span></span>
<span id="cb714-6"><a href="descriptive-statistics-and-data-manipulation.html#cb714-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">tolower</span>(country))</span></code></pre></div>
<ul>
<li><p>Exponeniate columns starting with the character <code>"l"</code> of the <code>gasoline</code> dataset.</p></li>
<li><p>Convert all columns’ classes into the character class.</p></li>
</ul>
</div>
<div id="exercise-2-1" class="section level3 unnumbered hasAnchor">
<h3>Exercise 2<a href="descriptive-statistics-and-data-manipulation.html#exercise-2-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Load the <code>LaborSupply</code> dataset from the <code>{Ecdat}</code> package and answer the following questions:</p>
<ul>
<li>Compute the average annual hours worked by year (plus standard deviation)</li>
<li>What age group worked the most hours in the year 1982?</li>
<li>Create a variable, <code>n_years</code> that equals the number of years an individual stays in the panel. Is the panel balanced?</li>
<li>Which are the individuals that do not have any kids during the whole period? Create a variable, <code>no_kids</code>, that flags these individuals (1 = no kids, 0 = kids)</li>
<li>Using the <code>no_kids</code> variable from before compute the average wage, standard deviation and number of observations in each group for the year 1980 (no kids group vs kids group).</li>
<li>Create the lagged logarithm of hours worked and wages. Remember that this is a panel.</li>
</ul>
</div>
<div id="exercise-3-1" class="section level3 unnumbered hasAnchor">
<h3>Exercise 3<a href="descriptive-statistics-and-data-manipulation.html#exercise-3-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>What does the following code do? Copy and paste it in an R interpreter to find out!</li>
</ul>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="descriptive-statistics-and-data-manipulation.html#cb715-1" aria-hidden="true" tabindex="-1"></a>LaborSupply <span class="sc">%&gt;%</span></span>
<span id="cb715-2"><a href="descriptive-statistics-and-data-manipulation.html#cb715-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb715-3"><a href="descriptive-statistics-and-data-manipulation.html#cb715-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;l&quot;</span>), tibble<span class="sc">::</span><span class="fu">lst</span>(lag, lead)))</span></code></pre></div>
<ul>
<li>Using <code>summarise()</code> and <code>across()</code>, compute the mean, standard deviation and number of individuals of <code>lnhr</code> and <code>lnwg</code> for each individual.</li>
</ul>
</div>
<div id="exercise-4-1" class="section level3 unnumbered hasAnchor">
<h3>Exercise 4<a href="descriptive-statistics-and-data-manipulation.html#exercise-4-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>In the dataset folder you downloaded at the beginning of the chapter, there is a folder called
“unemployment”. I used the data in the section about working with lists of datasets. Using
<code>rio::import_list()</code>, read the 4 datasets into R.</p></li>
<li><p>Using <code>map()</code>, map the <code>janitor::clean_names()</code> function to each dataset (just like in the example
in the section on working with lists of datasets). Then, still with <code>map()</code> and <code>mutate()</code> convert
all commune names in the <code>commune</code> column with the function <code>tolower()</code>, in a new column called <code>lcommune</code>.
This is not an easy exercise; so here are some hints:</p>
<ul>
<li>Remember that <code>all_datasets</code> is a list of datasets. Which function do you use when you want to map a function to each element of a list?</li>
<li>Each element of <code>all_datasets</code> are <code>data.frame</code> objects. Which function do you use to add a column to a <code>data.frame</code>?</li>
<li>What symbol can you use to access a column of a <code>data.frame</code>?</li>
</ul></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reading-and-writing-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="graphs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
