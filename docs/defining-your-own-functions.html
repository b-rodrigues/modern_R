<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Defining your own functions | Modern R with the tidyverse</title>
  <meta name="description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Defining your own functions | Modern R with the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Defining your own functions | Modern R with the tidyverse" />
  
  <meta name="twitter:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

<meta name="author" content="Bruno Rodrigues" />


<meta name="date" content="2020-06-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistical-models.html"/>
<link rel="next" href="package-development.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern R with the tidyverse</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#note-to-the-reader"><i class="fa fa-check"></i>Note to the reader</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-r"><i class="fa fa-check"></i>What is R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-is-this-book-for"><i class="fa fa-check"></i>Who is this book for?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this-book"><i class="fa fa-check"></i>Why this book?</a></li>
<li><a href="index.html#why-modern-r">Why <em>modern</em> R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-rstudio"><i class="fa fa-check"></i>What is RStudio?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect-from-this-book"><i class="fa fa-check"></i>What to expect from this book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-are-packages"><i class="fa fa-check"></i>What are packages?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-author"><i class="fa fa-check"></i>The author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting to know RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#panes"><i class="fa fa-check"></i><b>1.1</b> Panes</a></li>
<li class="chapter" data-level="1.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#console"><i class="fa fa-check"></i><b>1.2</b> Console</a></li>
<li class="chapter" data-level="1.3" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#scripts"><i class="fa fa-check"></i><b>1.3</b> Scripts</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-help-pane"><i class="fa fa-check"></i><b>1.3.1</b> The help pane</a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-environment-pane"><i class="fa fa-check"></i><b>1.3.2</b> The Environment pane</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#options"><i class="fa fa-check"></i><b>1.4</b> Options</a></li>
<li class="chapter" data-level="1.5" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>1.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="1.6" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#projects"><i class="fa fa-check"></i><b>1.6</b> Projects</a></li>
<li class="chapter" data-level="1.7" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#history"><i class="fa fa-check"></i><b>1.7</b> History</a></li>
<li class="chapter" data-level="1.8" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#plots"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
<li class="chapter" data-level="1.9" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#addins"><i class="fa fa-check"></i><b>1.9</b> Addins</a></li>
<li class="chapter" data-level="1.10" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#packages"><i class="fa fa-check"></i><b>1.10</b> Packages</a></li>
<li class="chapter" data-level="1.11" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercises"><i class="fa fa-check"></i><b>1.11</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html"><i class="fa fa-check"></i><b>2</b> Objects, types and useful R functions to get started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-numeric-class"><i class="fa fa-check"></i><b>2.1</b> The <code>numeric</code> class</a></li>
<li class="chapter" data-level="2.2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-character-class"><i class="fa fa-check"></i><b>2.2</b> The <code>character</code> class</a></li>
<li class="chapter" data-level="2.3" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-factor-class"><i class="fa fa-check"></i><b>2.3</b> The <code>factor</code> class</a></li>
<li class="chapter" data-level="2.4" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-date-class"><i class="fa fa-check"></i><b>2.4</b> The <code>Date</code> class</a></li>
<li class="chapter" data-level="2.5" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-logical-class"><i class="fa fa-check"></i><b>2.5</b> The <code>logical</code> class</a></li>
<li class="chapter" data-level="2.6" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#vectors-and-matrices"><i class="fa fa-check"></i><b>2.6</b> Vectors and matrices</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-c-function"><i class="fa fa-check"></i><b>2.6.1</b> The <code>c()</code> function</a></li>
<li class="chapter" data-level="2.6.2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#cbind-and-rbind"><i class="fa fa-check"></i><b>2.6.2</b> <code>cbind()</code> and <code>rbind()</code></a></li>
<li class="chapter" data-level="2.6.3" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-matrix-class"><i class="fa fa-check"></i><b>2.6.3</b> The <code>matrix</code> class</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-list-class"><i class="fa fa-check"></i><b>2.7</b> The <code>list</code> class</a></li>
<li class="chapter" data-level="2.8" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-data.frame-and-tibble-classes"><i class="fa fa-check"></i><b>2.8</b> The <code>data.frame</code> and <code>tibble</code> classes</a></li>
<li class="chapter" data-level="2.9" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#formulas"><i class="fa fa-check"></i><b>2.9</b> Formulas</a></li>
<li class="chapter" data-level="2.10" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#models"><i class="fa fa-check"></i><b>2.10</b> Models</a></li>
<li class="chapter" data-level="2.11" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#null-na-and-nan"><i class="fa fa-check"></i><b>2.11</b> NULL, NA and NaN</a></li>
<li class="chapter" data-level="2.12" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#useful-functions-to-get-you-started"><i class="fa fa-check"></i><b>2.12</b> Useful functions to get you started</a>
<ul>
<li class="chapter" data-level="2.12.1" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#sequences"><i class="fa fa-check"></i><b>2.12.1</b> Sequences</a></li>
<li class="chapter" data-level="2.12.2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#basic-string-manipulation"><i class="fa fa-check"></i><b>2.12.2</b> Basic string manipulation</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercises-1"><i class="fa fa-check"></i><b>2.13</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-1-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-5"><i class="fa fa-check"></i>Exercise 5</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-6"><i class="fa fa-check"></i>Exercise 6</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-7"><i class="fa fa-check"></i>Exercise 7</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-8"><i class="fa fa-check"></i>Exercise 8</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>3</b> Reading and writing data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#the-swiss-army-knife-of-data-import-and-export-rio"><i class="fa fa-check"></i><b>3.1</b> The swiss army knife of data import and export: <code>{rio}</code></a></li>
<li class="chapter" data-level="3.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-any-object-to-disk"><i class="fa fa-check"></i><b>3.2</b> Writing any object to disk</a></li>
<li class="chapter" data-level="3.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#using-rstudio-projects-to-manage-paths"><i class="fa fa-check"></i><b>3.3</b> Using RStudio projects to manage paths</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html"><i class="fa fa-check"></i><b>4</b> Descriptive statistics and data manipulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-data-exploration-exercice-using-base-r"><i class="fa fa-check"></i><b>4.1</b> A data exploration exercice using <em>base</em> R</a></li>
<li class="chapter" data-level="4.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#smoking-is-bad-for-you-but-pipes-are-your-friend"><i class="fa fa-check"></i><b>4.2</b> Smoking is bad for you, but pipes are your friend</a></li>
<li class="chapter" data-level="4.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#the-tidyverses-enfant-prodige-dplyr"><i class="fa fa-check"></i><b>4.3</b> The <code>{tidyverse}</code>‚Äôs <em>enfant prodige</em>: <code>{dplyr}</code></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-first-taste-of-data-manipulation-with-dplyr"><i class="fa fa-check"></i><b>4.3.1</b> A first taste of data manipulation with <code>{dplyr}</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter-the-rows-of-a-dataset-with-filter"><i class="fa fa-check"></i><b>4.3.2</b> Filter the rows of a dataset with <code>filter()</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#select-columns-with-select"><i class="fa fa-check"></i><b>4.3.3</b> Select columns with <code>select()</code></a></li>
<li class="chapter" data-level="4.3.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group-the-observations-of-your-dataset-with-group_by"><i class="fa fa-check"></i><b>4.3.4</b> Group the observations of your dataset with <code>group_by()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#get-summary-statistics-with-summarise"><i class="fa fa-check"></i><b>4.3.5</b> Get summary statistics with <code>summarise()</code></a></li>
<li class="chapter" data-level="4.3.6" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#adding-columns-with-mutate-and-transmute"><i class="fa fa-check"></i><b>4.3.6</b> Adding columns with <code>mutate()</code> and <code>transmute()</code></a></li>
<li class="chapter" data-level="4.3.7" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#joining-tibbles-with-full_join-left_join-right_join-and-all-the-others"><i class="fa fa-check"></i><b>4.3.7</b> Joining <code>tibble</code>s with <code>full_join()</code>, <code>left_join()</code>, <code>right_join()</code> and all the others</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#reshaping-data-with-tidyr"><i class="fa fa-check"></i><b>4.4</b> Reshaping data with <code>tidyr</code></a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#pivot_wider-and-pivot_longer"><i class="fa fa-check"></i><b>4.4.1</b> <code>pivot_wider()</code> and <code>pivot_longer()</code></a></li>
<li class="chapter" data-level="4.4.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#spread-and-gather"><i class="fa fa-check"></i><b>4.4.2</b> <code>spread()</code> and <code>gather()</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#fill-and-full_seq"><i class="fa fa-check"></i><b>4.4.3</b> <code>fill()</code> and <code>full_seq()</code></a></li>
<li class="chapter" data-level="4.4.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#put-order-in-your-columns-with-separate-unite-and-in-your-rows-with-separate_rows"><i class="fa fa-check"></i><b>4.4.4</b> Put order in your columns with <code>separate()</code>, <code>unite()</code>, and in your rows with <code>separate_rows()</code></a></li>
<li class="chapter" data-level="4.4.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-sneak-peek-to-chapter-8-nest"><i class="fa fa-check"></i><b>4.4.5</b> A sneak peek to Chapter 8; <code>nest()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#working-on-many-columns-with-across"><i class="fa fa-check"></i><b>4.5</b> Working on many columns with <code>across()</code></a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter-and-across"><i class="fa fa-check"></i><b>4.5.1</b> <code>filter()</code> and <code>across()</code></a></li>
<li class="chapter" data-level="4.5.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#selecting-and-renaming-with-across"><i class="fa fa-check"></i><b>4.5.2</b> Selecting and renaming with <code>across()</code></a></li>
<li class="chapter" data-level="4.5.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group_by-and-across"><i class="fa fa-check"></i><b>4.5.3</b> <code>group_by()</code> and <code>across()</code></a></li>
<li class="chapter" data-level="4.5.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#summarise-across-many-columns"><i class="fa fa-check"></i><b>4.5.4</b> <code>summarise()</code> across many columns</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#other-useful-tidyverse-functions"><i class="fa fa-check"></i><b>4.6</b> Other useful <code>{tidyverse}</code> functions</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#if_else-case_when-and-recode"><i class="fa fa-check"></i><b>4.6.1</b> <code>if_else()</code>, <code>case_when()</code> and <code>recode()</code></a></li>
<li class="chapter" data-level="4.6.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#lead-and-lag"><i class="fa fa-check"></i><b>4.6.2</b> <code>lead()</code> and <code>lag()</code></a></li>
<li class="chapter" data-level="4.6.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#ntile"><i class="fa fa-check"></i><b>4.6.3</b> <code>ntile()</code></a></li>
<li class="chapter" data-level="4.6.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#arrange"><i class="fa fa-check"></i><b>4.6.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.6.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#tally-and-count"><i class="fa fa-check"></i><b>4.6.5</b> <code>tally()</code> and <code>count()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#special-packages-for-special-kinds-of-data-forcats-lubridate-and-stringr"><i class="fa fa-check"></i><b>4.7</b> Special packages for special kinds of data: <code>{forcats}</code>, <code>{lubridate}</code>, and <code>{stringr}</code></a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#section"><i class="fa fa-check"></i><b>4.7.1</b> üêàüêàüêàüêà</a></li>
<li class="chapter" data-level="4.7.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#get-your-dates-right-with-lubridate"><i class="fa fa-check"></i><b>4.7.2</b> Get your dates right with <code>{lubridate}</code></a></li>
<li class="chapter" data-level="4.7.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#manipulate-strings-with-stringr"><i class="fa fa-check"></i><b>4.7.3</b> Manipulate strings with <code>{stringr}</code></a></li>
<li class="chapter" data-level="4.7.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#tidy-data-frames-with-tibble"><i class="fa fa-check"></i><b>4.7.4</b> Tidy data frames with <code>{tibble}</code></a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#list-columns"><i class="fa fa-check"></i><b>4.8</b> List-columns</a></li>
<li class="chapter" data-level="4.9" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#going-beyond-descriptive-statistics-and-data-manipulation"><i class="fa fa-check"></i><b>4.9</b> Going beyond descriptive statistics and data manipulation</a></li>
<li class="chapter" data-level="4.10" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercises-2"><i class="fa fa-check"></i><b>4.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-1-2"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-2-1"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-3-1"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-4-1"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>5</b> Graphs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="graphs.html"><a href="graphs.html#resources"><i class="fa fa-check"></i><b>5.1</b> Resources</a></li>
<li class="chapter" data-level="5.2" data-path="graphs.html"><a href="graphs.html#examples"><i class="fa fa-check"></i><b>5.2</b> Examples</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="graphs.html"><a href="graphs.html#barplots"><i class="fa fa-check"></i><b>5.2.1</b> Barplots</a></li>
<li class="chapter" data-level="5.2.2" data-path="graphs.html"><a href="graphs.html#scatter-plots"><i class="fa fa-check"></i><b>5.2.2</b> Scatter plots</a></li>
<li class="chapter" data-level="5.2.3" data-path="graphs.html"><a href="graphs.html#density"><i class="fa fa-check"></i><b>5.2.3</b> Density</a></li>
<li class="chapter" data-level="5.2.4" data-path="graphs.html"><a href="graphs.html#line-plots"><i class="fa fa-check"></i><b>5.2.4</b> Line plots</a></li>
<li class="chapter" data-level="5.2.5" data-path="graphs.html"><a href="graphs.html#facets"><i class="fa fa-check"></i><b>5.2.5</b> Facets</a></li>
<li class="chapter" data-level="5.2.6" data-path="graphs.html"><a href="graphs.html#pie-charts"><i class="fa fa-check"></i><b>5.2.6</b> Pie Charts</a></li>
<li class="chapter" data-level="5.2.7" data-path="graphs.html"><a href="graphs.html#adding-text-to-plots"><i class="fa fa-check"></i><b>5.2.7</b> Adding text to plots</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="graphs.html"><a href="graphs.html#customization"><i class="fa fa-check"></i><b>5.3</b> Customization</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="graphs.html"><a href="graphs.html#changing-titles-axes-labels-options-mixing-geoms-and-changing-themes"><i class="fa fa-check"></i><b>5.3.1</b> Changing titles, axes labels, options, mixing geoms and changing themes</a></li>
<li class="chapter" data-level="5.3.2" data-path="graphs.html"><a href="graphs.html#colour-schemes"><i class="fa fa-check"></i><b>5.3.2</b> Colour schemes</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="graphs.html"><a href="graphs.html#saving-plots-to-disk"><i class="fa fa-check"></i><b>5.4</b> Saving plots to disk</a></li>
<li class="chapter" data-level="5.5" data-path="graphs.html"><a href="graphs.html#exercises-3"><i class="fa fa-check"></i><b>5.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="graphs.html"><a href="graphs.html#exercise-1-3"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>6</b> Statistical models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="statistical-models.html"><a href="statistical-models.html#terminology"><i class="fa fa-check"></i><b>6.1</b> Terminology</a></li>
<li class="chapter" data-level="6.2" data-path="statistical-models.html"><a href="statistical-models.html#fitting-a-model-to-data"><i class="fa fa-check"></i><b>6.2</b> Fitting a model to data</a></li>
<li class="chapter" data-level="6.3" data-path="statistical-models.html"><a href="statistical-models.html#diagnostics"><i class="fa fa-check"></i><b>6.3</b> Diagnostics</a></li>
<li class="chapter" data-level="6.4" data-path="statistical-models.html"><a href="statistical-models.html#interpreting-models"><i class="fa fa-check"></i><b>6.4</b> Interpreting models</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="statistical-models.html"><a href="statistical-models.html#marginal-effects"><i class="fa fa-check"></i><b>6.4.1</b> Marginal effects</a></li>
<li class="chapter" data-level="6.4.2" data-path="statistical-models.html"><a href="statistical-models.html#explainability-of-black-box-models"><i class="fa fa-check"></i><b>6.4.2</b> Explainability of <em>black-box</em> models</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="statistical-models.html"><a href="statistical-models.html#comparing-models"><i class="fa fa-check"></i><b>6.5</b> Comparing models</a></li>
<li class="chapter" data-level="6.6" data-path="statistical-models.html"><a href="statistical-models.html#using-a-model-for-prediction"><i class="fa fa-check"></i><b>6.6</b> Using a model for prediction</a></li>
<li class="chapter" data-level="6.7" data-path="statistical-models.html"><a href="statistical-models.html#beyond-linear-regression"><i class="fa fa-check"></i><b>6.7</b> Beyond linear regression</a></li>
<li class="chapter" data-level="6.8" data-path="statistical-models.html"><a href="statistical-models.html#hyper-parameters"><i class="fa fa-check"></i><b>6.8</b> Hyper-parameters</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="statistical-models.html"><a href="statistical-models.html#ridge-regression"><i class="fa fa-check"></i><b>6.8.1</b> Ridge regression</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="statistical-models.html"><a href="statistical-models.html#training-validating-and-testing-models"><i class="fa fa-check"></i><b>6.9</b> Training, validating, and testing models</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="statistical-models.html"><a href="statistical-models.html#set-up"><i class="fa fa-check"></i><b>6.9.1</b> Set up</a></li>
<li class="chapter" data-level="6.9.2" data-path="statistical-models.html"><a href="statistical-models.html#bayesian-hyperparameter-optimization"><i class="fa fa-check"></i><b>6.9.2</b> Bayesian hyperparameter optimization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html"><i class="fa fa-check"></i><b>7</b> Defining your own functions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#control-flow"><i class="fa fa-check"></i><b>7.1</b> Control flow</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#if-else"><i class="fa fa-check"></i><b>7.1.1</b> If-else</a></li>
<li class="chapter" data-level="7.1.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#for-loops"><i class="fa fa-check"></i><b>7.1.2</b> For loops</a></li>
<li class="chapter" data-level="7.1.3" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#while-loops"><i class="fa fa-check"></i><b>7.1.3</b> While loops</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#writing-your-own-functions"><i class="fa fa-check"></i><b>7.2</b> Writing your own functions</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#declaring-functions-in-r"><i class="fa fa-check"></i><b>7.2.1</b> Declaring functions in R</a></li>
<li class="chapter" data-level="7.2.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#fibonacci-numbers"><i class="fa fa-check"></i><b>7.2.2</b> Fibonacci numbers</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercises-4"><i class="fa fa-check"></i><b>7.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-1-4"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-2-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-3-2"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-take-functions-as-arguments-writing-your-own-higher-order-functions"><i class="fa fa-check"></i><b>7.4</b> Functions that take functions as arguments: writing your own higher-order functions</a></li>
<li class="chapter" data-level="7.5" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-take-columns-of-data-as-arguments"><i class="fa fa-check"></i><b>7.5</b> Functions that take columns of data as arguments</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#the-enquo---approach"><i class="fa fa-check"></i><b>7.5.1</b> The <code>enquo() - !!()</code> approach</a></li>
<li class="chapter" data-level="7.5.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#curly-curly-a-simplified-approach-to-the-enquo-and-framework"><i class="fa fa-check"></i><b>7.5.2</b> Curly Curly, a simplified approach to the <code>enquo()</code> and <code>!!()</code> framework</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-use-loops"><i class="fa fa-check"></i><b>7.6</b> Functions that use loops</a></li>
<li class="chapter" data-level="7.7" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#anonymous-functions"><i class="fa fa-check"></i><b>7.7</b> Anonymous functions</a></li>
<li class="chapter" data-level="7.8" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercises-5"><i class="fa fa-check"></i><b>7.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-1-5"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-2-3"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-3-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-4-2"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#function-definitions"><i class="fa fa-check"></i><b>7.9</b> Function definitions</a></li>
<li class="chapter" data-level="7.10" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#properties-of-functions"><i class="fa fa-check"></i><b>7.10</b> Properties of functions</a></li>
<li class="chapter" data-level="7.11" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functional-programming-with-purrr"><i class="fa fa-check"></i><b>7.11</b> Functional programming with <code>{purrr}</code></a>
<ul>
<li class="chapter" data-level="7.11.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#doing-away-with-loops-the-map-family-of-functions"><i class="fa fa-check"></i><b>7.11.1</b> Doing away with loops: the <code>map*()</code> family of functions</a></li>
<li class="chapter" data-level="7.11.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#reducing-with-purrr"><i class="fa fa-check"></i><b>7.11.2</b> Reducing with <code>purrr</code></a></li>
<li class="chapter" data-level="7.11.3" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#error-handling-with-safely-and-possibly"><i class="fa fa-check"></i><b>7.11.3</b> Error handling with <code>safely()</code> and <code>possibly()</code></a></li>
<li class="chapter" data-level="7.11.4" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#partial-applications-with-partial"><i class="fa fa-check"></i><b>7.11.4</b> Partial applications with <code>partial()</code></a></li>
<li class="chapter" data-level="7.11.5" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#function-composition-using-compose"><i class="fa fa-check"></i><b>7.11.5</b> Function composition using <code>compose</code></a></li>
<li class="chapter" data-level="7.11.6" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#transposing-lists"><i class="fa fa-check"></i><b>7.11.6</b> ¬´Transposing lists¬ª</a></li>
</ul></li>
<li class="chapter" data-level="7.12" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#list-based-workflows-for-efficiency"><i class="fa fa-check"></i><b>7.12</b> List-based workflows for efficiency</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functional-programming-and-plotting"><i class="fa fa-check"></i><b>7.12.1</b> Functional programming and plotting</a></li>
<li class="chapter" data-level="7.12.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#modeling-with-functional-programming"><i class="fa fa-check"></i><b>7.12.2</b> Modeling with functional programming</a></li>
</ul></li>
<li class="chapter" data-level="7.13" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercises-6"><i class="fa fa-check"></i><b>7.13</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-1-6"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-2-4"><i class="fa fa-check"></i>Exercise 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="package-development.html"><a href="package-development.html"><i class="fa fa-check"></i><b>8</b> Package development</a>
<ul>
<li class="chapter" data-level="8.1" data-path="package-development.html"><a href="package-development.html#why-you-need-to-write-your-own-package"><i class="fa fa-check"></i><b>8.1</b> Why you need to write your own package</a></li>
<li class="chapter" data-level="8.2" data-path="package-development.html"><a href="package-development.html#starting-easy-creating-a-package-to-share-data"><i class="fa fa-check"></i><b>8.2</b> Starting easy: creating a package to share data</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="package-development.html"><a href="package-development.html#setting-up-a-github-account"><i class="fa fa-check"></i><b>8.2.1</b> Setting up a Github account</a></li>
<li class="chapter" data-level="8.2.2" data-path="package-development.html"><a href="package-development.html#starting-your-package"><i class="fa fa-check"></i><b>8.2.2</b> Starting your package</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="package-development.html"><a href="package-development.html#including-data-inside-the-package"><i class="fa fa-check"></i><b>8.3</b> Including data inside the package</a></li>
<li class="chapter" data-level="8.4" data-path="package-development.html"><a href="package-development.html#adding-functions-to-your-package"><i class="fa fa-check"></i><b>8.4</b> Adding functions to your package</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="package-development.html"><a href="package-development.html#one-function-inside-one-script"><i class="fa fa-check"></i><b>8.4.1</b> One function inside one script</a></li>
<li class="chapter" data-level="8.4.2" data-path="package-development.html"><a href="package-development.html#many-functions-inside-a-script"><i class="fa fa-check"></i><b>8.4.2</b> Many functions inside a script</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="package-development.html"><a href="package-development.html#documenting-your-package"><i class="fa fa-check"></i><b>8.5</b> Documenting your package</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="package-development.html"><a href="package-development.html#description"><i class="fa fa-check"></i><b>8.5.1</b> Description</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="package-development.html"><a href="package-development.html#unit-testing-your-package"><i class="fa fa-check"></i><b>8.6</b> Unit testing your package</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="further-topics.html"><a href="further-topics.html"><i class="fa fa-check"></i><b>9</b> Further topics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="further-topics.html"><a href="further-topics.html#using-python-from-r-with-reticulate"><i class="fa fa-check"></i><b>9.1</b> Using Python from R with <code>{reticulate}</code></a></li>
<li class="chapter" data-level="9.2" data-path="further-topics.html"><a href="further-topics.html#generating-pdf-or-word-reports-with-r"><i class="fa fa-check"></i><b>9.2</b> Generating Pdf or Word reports with R</a></li>
<li class="chapter" data-level="9.3" data-path="further-topics.html"><a href="further-topics.html#scraping-the-internet"><i class="fa fa-check"></i><b>9.3</b> Scraping the internet</a></li>
<li class="chapter" data-level="9.4" data-path="further-topics.html"><a href="further-topics.html#regular-expressions"><i class="fa fa-check"></i><b>9.4</b> Regular expressions</a></li>
<li class="chapter" data-level="9.5" data-path="further-topics.html"><a href="further-topics.html#setting-up-a-blog-with-blogdown"><i class="fa fa-check"></i><b>9.5</b> Setting up a blog with <code>{blogdown}</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern R with the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="defining-your-own-functions" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Defining your own functions</h1>
<p>In this section we are going to learn some advanced concepts that are going to make you into a
full-fledged R programmer. Before this chapter you only used whatever R came with, as well as the
functions contained in packages. We did define some functions ourselves in Chapter 6 already, but
without going into many details. In this chapter, we will learn about building functions ourselves,
and do so in greater detail than what we did before.</p>
<div id="control-flow" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Control flow</h2>
<p>Knowing about control flow is essential to build your own functions. Without control flow statements,
such as if-else statements or loops (or, in the case of pure functional programming languages, recursion),
programming languages would be very limited.</p>
<div id="if-else" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> If-else</h3>
<p>Imagine you want a variable to be equal to a certain value if a condition is met. This is a typical
problem that requires the <code>if ... else ...</code> construct. For instance:</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb911-1"><a href="defining-your-own-functions.html#cb911-1"></a>a &lt;-<span class="st"> </span><span class="dv">4</span></span>
<span id="cb911-2"><a href="defining-your-own-functions.html#cb911-2"></a>b &lt;-<span class="st"> </span><span class="dv">5</span></span></code></pre></div>
<p>Suppose that if <code>a &gt; b</code> then <code>f</code> should be equal to 20, else <code>f</code> should be equal to 10. Using <code>if ... else ...</code> you can achieve this like so:</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="defining-your-own-functions.html#cb912-1"></a><span class="cf">if</span> (a <span class="op">&gt;</span><span class="st"> </span>b) {</span>
<span id="cb912-2"><a href="defining-your-own-functions.html#cb912-2"></a>  f &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb912-3"><a href="defining-your-own-functions.html#cb912-3"></a>    } <span class="cf">else</span> {</span>
<span id="cb912-4"><a href="defining-your-own-functions.html#cb912-4"></a>  f &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb912-5"><a href="defining-your-own-functions.html#cb912-5"></a>}</span></code></pre></div>
<p>Obviously, here <code>f = 10</code>. Another way to achieve this is by using the <code>ifelse()</code> function:</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="defining-your-own-functions.html#cb913-1"></a>f &lt;-<span class="st"> </span><span class="kw">ifelse</span>(a <span class="op">&gt;</span><span class="st"> </span>b, <span class="dv">20</span>, <span class="dv">10</span>)</span></code></pre></div>
<p><code>if...else...</code> and <code>ifelse()</code> might seem interchangeable, but they‚Äôre not. <code>ifelse()</code> is vectorized, while
<code>if...else..</code> is not. Let‚Äôs try the following:</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="defining-your-own-functions.html#cb914-1"></a><span class="kw">ifelse</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>) <span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;no&quot;  &quot;yes&quot; &quot;yes&quot;</code></pre>
<p>The result is a vector. Now, let‚Äôs see what happens if we use <code>if...else...</code> instead of <code>ifelse()</code>:</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb916-1"><a href="defining-your-own-functions.html#cb916-1"></a><span class="cf">if</span> (<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>) <span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="kw">print</span>(<span class="st">&quot;yes&quot;</span>) <span class="cf">else</span> <span class="kw">print</span>(<span class="st">&quot;no&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in if (c(1, 2, 4) &gt; c(3, 1, 0)) print(&quot;yes&quot;) else print(&quot;no&quot;): the
## condition has length &gt; 1 and only the first element will be used</code></pre>
<pre><code>## [1] &quot;no&quot;</code></pre>
<p>Only the first element of my atomic vector is used for the comparison. This is very important to keep in mind.
Suppose that you want an expression to be evaluated, only if every element is <code>TRUE</code>. In this case, you should
use the <code>all()</code> function, as seen previously in Chapter 2:</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="defining-your-own-functions.html#cb919-1"></a><span class="kw">ifelse</span>(<span class="kw">all</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>) <span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)), <span class="st">&quot;all elements are greater&quot;</span>, <span class="st">&quot;not all elements are greater&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;not all elements are greater&quot;</code></pre>
<p>You also remember the <code>any()</code> function:</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="defining-your-own-functions.html#cb921-1"></a><span class="kw">ifelse</span>(<span class="kw">any</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>) <span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)), <span class="st">&quot;at least one element is greater&quot;</span>, <span class="st">&quot;no element greater&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;at least one element is greater&quot;</code></pre>
<p>These are the basics. But sometimes, you might need to test for more complex conditions, which can
lead to using nested <code>if...else...</code> constructs. These, however, can get messy:</p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb923-1"><a href="defining-your-own-functions.html#cb923-1"></a><span class="cf">if</span> (<span class="dv">10</span> <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb923-2"><a href="defining-your-own-functions.html#cb923-2"></a>  <span class="kw">print</span>(<span class="st">&quot;10 is divisible by 3&quot;</span>)</span>
<span id="cb923-3"><a href="defining-your-own-functions.html#cb923-3"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="dv">10</span> <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb923-4"><a href="defining-your-own-functions.html#cb923-4"></a>    <span class="kw">print</span>(<span class="st">&quot;10 is divisible by 2&quot;</span>)</span>
<span id="cb923-5"><a href="defining-your-own-functions.html#cb923-5"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;10 is divisible by 2&quot;</code></pre>
<p>10 being obviously divisible by 2 and not 3, it is the second phrase that will be printed. The
<code>%%</code> operator is the modulus operator, which gives the rest of the division of 10 by 2.
It is easier to use <code>dplyr::case_when()</code>:</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb925-1"><a href="defining-your-own-functions.html#cb925-1"></a><span class="kw">case_when</span>(<span class="dv">10</span> <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;10 is divisible by 3&quot;</span>,</span>
<span id="cb925-2"><a href="defining-your-own-functions.html#cb925-2"></a>          <span class="dv">10</span> <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;10 is divisible by 2&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;10 is divisible by 2&quot;</code></pre>
<p>We have already encountered this function in Chapter 4, inside a <code>dplyr::mutate()</code> call to create a new column.</p>
<p>Let‚Äôs now discuss loops.</p>
</div>
<div id="for-loops" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> For loops</h3>
<p>For loops make it possible to repeat a set of instructions <code>i</code> times. For example, try the following:</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="defining-your-own-functions.html#cb927-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){</span>
<span id="cb927-2"><a href="defining-your-own-functions.html#cb927-2"></a>  <span class="kw">print</span>(<span class="st">&quot;hello&quot;</span>)</span>
<span id="cb927-3"><a href="defining-your-own-functions.html#cb927-3"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;</code></pre>
<p>It is also possible to do computations using for loops. Let‚Äôs compute the sum of the first
100 integers:</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb929-1"><a href="defining-your-own-functions.html#cb929-1"></a>result &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb929-2"><a href="defining-your-own-functions.html#cb929-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>){</span>
<span id="cb929-3"><a href="defining-your-own-functions.html#cb929-3"></a>  result &lt;-<span class="st"> </span>result <span class="op">+</span><span class="st"> </span>i</span>
<span id="cb929-4"><a href="defining-your-own-functions.html#cb929-4"></a>}</span>
<span id="cb929-5"><a href="defining-your-own-functions.html#cb929-5"></a></span>
<span id="cb929-6"><a href="defining-your-own-functions.html#cb929-6"></a><span class="kw">print</span>(result)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p><code>result</code> is equal to 5050, the expected result. What happened in that loop? First, we defined a
variable called <code>result</code> and set it to 0. Then, when the loops starts, <code>i</code> equals 1, so we add
<code>result</code> to <code>1</code>, which is 1. Then, <code>i</code> equals 2, and again, we add <code>result</code> to <code>i</code>. But this time,
<code>result</code> equals 1 and <code>i</code> equals 2, so now <code>result</code> equals 3, and we repeat this until <code>i</code>
equals 100. As explained in the introduction, this is not my preferred way of doing something like
that. I actually use loops very rarely. I would solve the above problem using <code>purrr::reduce()</code>:</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="defining-your-own-functions.html#cb931-1"></a><span class="kw">reduce</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">100</span>), <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>This might look more complex, but once you‚Äôre used to it, you will not use many loops again.
You might wonder then, why use loops at all in this case? I refer you to the following
<a href="http://adv-r.had.co.nz/Functionals.html#functionals-not">section</a> of Hadley Wickham‚Äôs <em>Advanced R</em>
for an in-depth discussion on situations where loops make more sense than higher-order functions
such as <code>purrr::map()</code> or <code>purrr::reduce()</code>.</p>
</div>
<div id="while-loops" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> While loops</h3>
<p>While loops are very similar to for loops. The instructions inside a while loop are repeated while a
certain condition holds true. Let‚Äôs consider the sum of the first 100 integers again:</p>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb933-1"><a href="defining-your-own-functions.html#cb933-1"></a>result &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb933-2"><a href="defining-your-own-functions.html#cb933-2"></a>i &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb933-3"><a href="defining-your-own-functions.html#cb933-3"></a><span class="cf">while</span> (i<span class="op">&lt;=</span><span class="dv">100</span>){</span>
<span id="cb933-4"><a href="defining-your-own-functions.html#cb933-4"></a>  result =<span class="st"> </span>result <span class="op">+</span><span class="st"> </span>i</span>
<span id="cb933-5"><a href="defining-your-own-functions.html#cb933-5"></a>  i =<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb933-6"><a href="defining-your-own-functions.html#cb933-6"></a>}</span>
<span id="cb933-7"><a href="defining-your-own-functions.html#cb933-7"></a></span>
<span id="cb933-8"><a href="defining-your-own-functions.html#cb933-8"></a><span class="kw">print</span>(result)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>Here, we first set <code>result</code> and <code>i</code> to 0. Then, while <code>i</code> is less than, or equal to 100, we add <code>i</code>
to <code>result</code>. Notice that there is one more line than in the for loop: we need to increment the value
of <code>i</code>, if not, <code>i</code> would stay equal to 1, and the condition would always be fulfilled, and
the loop would run forever (not really, only until your computer runs out of memory, or until the
heat death of the universe, whichever comes first).</p>
<p>Now that we know how to write loops, and know about <code>if...else...</code> constructs, we have (almost) all
the ingredients to write our own functions.</p>
</div>
</div>
<div id="writing-your-own-functions" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Writing your own functions</h2>
<p>As you have seen by now, R includes a very large amount of preprogrammed functions, but also many
more functions are available in packages. However, there will be a lot of situations where you will
need to write your own. In this section we are going to learn how to write our own functions.</p>
<div id="declaring-functions-in-r" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Declaring functions in R</h3>
<p>Suppose you want to create the following function: <span class="math inline">\(f(x) = \dfrac{1}{\sqrt{x}}\)</span>.
Writing this in R is quite simple:</p>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb935-1"><a href="defining-your-own-functions.html#cb935-1"></a>my_function &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb935-2"><a href="defining-your-own-functions.html#cb935-2"></a>  <span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(x)</span>
<span id="cb935-3"><a href="defining-your-own-functions.html#cb935-3"></a>}</span></code></pre></div>
<p>The argument of the function, <code>x</code>, gets passed to the <code>function()</code> function and the <em>body</em> of
the function (more on that in the next Chapter) contains the function definition. Of course,
you could define functions that use more than one input:</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="defining-your-own-functions.html#cb936-1"></a>my_function &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){</span>
<span id="cb936-2"><a href="defining-your-own-functions.html#cb936-2"></a>  <span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(x <span class="op">+</span><span class="st"> </span>y)</span>
<span id="cb936-3"><a href="defining-your-own-functions.html#cb936-3"></a>}</span></code></pre></div>
<p>or inputs with names longer than one character:</p>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb937-1"><a href="defining-your-own-functions.html#cb937-1"></a>my_function &lt;-<span class="st"> </span><span class="cf">function</span>(argument1, argument2){</span>
<span id="cb937-2"><a href="defining-your-own-functions.html#cb937-2"></a>  <span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(argument1 <span class="op">+</span><span class="st"> </span>argument2)</span>
<span id="cb937-3"><a href="defining-your-own-functions.html#cb937-3"></a>}</span></code></pre></div>
<p>Functions written by the user get called just the same way as functions included in R:</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="defining-your-own-functions.html#cb938-1"></a><span class="kw">my_function</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 0.3015113</code></pre>
<p>It is also possible to provide default values to the function‚Äôs arguments, which are values that are used
if the user omits them:</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="defining-your-own-functions.html#cb940-1"></a>my_function &lt;-<span class="st"> </span><span class="cf">function</span>(argument1, <span class="dt">argument2 =</span> <span class="dv">10</span>){</span>
<span id="cb940-2"><a href="defining-your-own-functions.html#cb940-2"></a><span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(argument1 <span class="op">+</span><span class="st"> </span>argument2)</span>
<span id="cb940-3"><a href="defining-your-own-functions.html#cb940-3"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb941"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb941-1"><a href="defining-your-own-functions.html#cb941-1"></a><span class="kw">my_function</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.3015113</code></pre>
<p>This is especially useful for functions with many arguments. Consider also the following, example,
where the function has a default method:</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb943-1"><a href="defining-your-own-functions.html#cb943-1"></a>my_function &lt;-<span class="st"> </span><span class="cf">function</span>(argument1, argument2, <span class="dt">method =</span> <span class="st">&quot;foo&quot;</span>){</span>
<span id="cb943-2"><a href="defining-your-own-functions.html#cb943-2"></a>  </span>
<span id="cb943-3"><a href="defining-your-own-functions.html#cb943-3"></a>  x &lt;-<span class="st"> </span>argument1 <span class="op">+</span><span class="st"> </span>argument2</span>
<span id="cb943-4"><a href="defining-your-own-functions.html#cb943-4"></a>  </span>
<span id="cb943-5"><a href="defining-your-own-functions.html#cb943-5"></a>  <span class="cf">if</span>(method <span class="op">==</span><span class="st"> &quot;foo&quot;</span>){</span>
<span id="cb943-6"><a href="defining-your-own-functions.html#cb943-6"></a>    <span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(x)</span>
<span id="cb943-7"><a href="defining-your-own-functions.html#cb943-7"></a>  } <span class="cf">else</span> <span class="cf">if</span> (method <span class="op">==</span><span class="st"> &quot;bar&quot;</span>){</span>
<span id="cb943-8"><a href="defining-your-own-functions.html#cb943-8"></a>    <span class="st">&quot;this is a string&quot;</span></span>
<span id="cb943-9"><a href="defining-your-own-functions.html#cb943-9"></a>    }</span>
<span id="cb943-10"><a href="defining-your-own-functions.html#cb943-10"></a>}</span>
<span id="cb943-11"><a href="defining-your-own-functions.html#cb943-11"></a></span>
<span id="cb943-12"><a href="defining-your-own-functions.html#cb943-12"></a><span class="kw">my_function</span>(<span class="dv">10</span>, <span class="dv">11</span>)</span></code></pre></div>
<pre><code>## [1] 0.2182179</code></pre>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="defining-your-own-functions.html#cb945-1"></a><span class="kw">my_function</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="st">&quot;bar&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;this is a string&quot;</code></pre>
<p>As you see, depending on the ‚Äúmethod‚Äù chosen, the returned result is either a numeric, or a string.
What happens if the user provides a ‚Äúmethod‚Äù that is neither ‚Äúfoo‚Äù nor ‚Äúbar‚Äù?</p>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb947-1"><a href="defining-your-own-functions.html#cb947-1"></a><span class="kw">my_function</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="st">&quot;spam&quot;</span>)</span></code></pre></div>
<p>As you can see nothing happens. It is possible to add safeguards to your function to avoid such
situations:</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="defining-your-own-functions.html#cb948-1"></a>my_function &lt;-<span class="st"> </span><span class="cf">function</span>(argument1, argument2, <span class="dt">method =</span> <span class="st">&quot;foo&quot;</span>){</span>
<span id="cb948-2"><a href="defining-your-own-functions.html#cb948-2"></a>  </span>
<span id="cb948-3"><a href="defining-your-own-functions.html#cb948-3"></a>  <span class="cf">if</span>(<span class="op">!</span>(method <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>))){</span>
<span id="cb948-4"><a href="defining-your-own-functions.html#cb948-4"></a>    <span class="kw">return</span>(<span class="st">&quot;Method must be either &#39;foo&#39; or &#39;bar&#39;&quot;</span>)</span>
<span id="cb948-5"><a href="defining-your-own-functions.html#cb948-5"></a>  }</span>
<span id="cb948-6"><a href="defining-your-own-functions.html#cb948-6"></a>  </span>
<span id="cb948-7"><a href="defining-your-own-functions.html#cb948-7"></a>  x &lt;-<span class="st"> </span>argument1 <span class="op">+</span><span class="st"> </span>argument2</span>
<span id="cb948-8"><a href="defining-your-own-functions.html#cb948-8"></a>  </span>
<span id="cb948-9"><a href="defining-your-own-functions.html#cb948-9"></a>  <span class="cf">if</span>(method <span class="op">==</span><span class="st"> &quot;foo&quot;</span>){</span>
<span id="cb948-10"><a href="defining-your-own-functions.html#cb948-10"></a>    <span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(x)</span>
<span id="cb948-11"><a href="defining-your-own-functions.html#cb948-11"></a>  } <span class="cf">else</span> <span class="cf">if</span> (method <span class="op">==</span><span class="st"> &quot;bar&quot;</span>){</span>
<span id="cb948-12"><a href="defining-your-own-functions.html#cb948-12"></a>    <span class="st">&quot;this is a string&quot;</span></span>
<span id="cb948-13"><a href="defining-your-own-functions.html#cb948-13"></a>    }</span>
<span id="cb948-14"><a href="defining-your-own-functions.html#cb948-14"></a>}</span>
<span id="cb948-15"><a href="defining-your-own-functions.html#cb948-15"></a></span>
<span id="cb948-16"><a href="defining-your-own-functions.html#cb948-16"></a><span class="kw">my_function</span>(<span class="dv">10</span>, <span class="dv">11</span>)</span></code></pre></div>
<pre><code>## [1] 0.2182179</code></pre>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="defining-your-own-functions.html#cb950-1"></a><span class="kw">my_function</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="st">&quot;bar&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;this is a string&quot;</code></pre>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb952-1"><a href="defining-your-own-functions.html#cb952-1"></a><span class="kw">my_function</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="st">&quot;foobar&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Method must be either &#39;foo&#39; or &#39;bar&#39;&quot;</code></pre>
<p>Notice that I have used <code>return()</code> inside my first <code>if</code> statement. This is to immediately stop
evaluation of the function and return a value. If I had omitted it, evaluation would have
continued, as it is always the last expression that gets evaluated. Remove <code>return()</code> and run the
function again, and see what happens. Later, we are going to learn how to add better safeguards to
your functions and to avoid runtime errors.</p>
<p>While in general, it is a good idea to add comments to your functions to explain what they do, I
would avoid adding comments to functions that do things that are very obvious, such as with this
one. Function names should be of the form: <code>function_name()</code>. Always give your function very
explicit names! In mathematics it is standard to give functions just one letter as a name, but I
would advise against doing that in your code. Functions that you write are not special in any way;
this means that R will treat them the same way, and they will work in conjunction with any other
function just as if it was built-in into R.</p>
<p>They have one limitation though (which is shared with R‚Äôs native function): just like in math,
they can only return one value. However, sometimes, you may need to return more than one value.
To be able to do this, you must put your values in a list, and return the list of values. For example:</p>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb954-1"><a href="defining-your-own-functions.html#cb954-1"></a>average_and_sd &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb954-2"><a href="defining-your-own-functions.html#cb954-2"></a><span class="kw">c</span>(<span class="kw">mean</span>(x), <span class="kw">sd</span>(x))</span>
<span id="cb954-3"><a href="defining-your-own-functions.html#cb954-3"></a>}</span>
<span id="cb954-4"><a href="defining-your-own-functions.html#cb954-4"></a></span>
<span id="cb954-5"><a href="defining-your-own-functions.html#cb954-5"></a><span class="kw">average_and_sd</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>))</span></code></pre></div>
<pre><code>## [1] 7.166667 4.262237</code></pre>
<p>You‚Äôre still returning a single object, but it‚Äôs a vector. You can also return a named list:</p>
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb956-1"><a href="defining-your-own-functions.html#cb956-1"></a>average_and_sd &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb956-2"><a href="defining-your-own-functions.html#cb956-2"></a><span class="kw">list</span>(<span class="st">&quot;mean_x&quot;</span> =<span class="st">  </span><span class="kw">mean</span>(x), <span class="st">&quot;sd_x&quot;</span> =<span class="st"> </span><span class="kw">sd</span>(x))</span>
<span id="cb956-3"><a href="defining-your-own-functions.html#cb956-3"></a>}</span>
<span id="cb956-4"><a href="defining-your-own-functions.html#cb956-4"></a></span>
<span id="cb956-5"><a href="defining-your-own-functions.html#cb956-5"></a><span class="kw">average_and_sd</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>))</span></code></pre></div>
<pre><code>## $mean_x
## [1] 7.166667
## 
## $sd_x
## [1] 4.262237</code></pre>
<p>As described before, you can use <code>return()</code> at the end of your functions:</p>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb958-1"><a href="defining-your-own-functions.html#cb958-1"></a>average_and_sd &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb958-2"><a href="defining-your-own-functions.html#cb958-2"></a>  result &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">mean</span>(x), <span class="kw">sd</span>(x))</span>
<span id="cb958-3"><a href="defining-your-own-functions.html#cb958-3"></a><span class="kw">return</span>(result)</span>
<span id="cb958-4"><a href="defining-your-own-functions.html#cb958-4"></a>}</span>
<span id="cb958-5"><a href="defining-your-own-functions.html#cb958-5"></a></span>
<span id="cb958-6"><a href="defining-your-own-functions.html#cb958-6"></a><span class="kw">average_and_sd</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>))</span></code></pre></div>
<pre><code>## [1] 7.166667 4.262237</code></pre>
<p>But this is only needed if you need to return a value early:</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb960-1"><a href="defining-your-own-functions.html#cb960-1"></a>average_and_sd &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb960-2"><a href="defining-your-own-functions.html#cb960-2"></a><span class="cf">if</span>(<span class="kw">any</span>(<span class="kw">is.na</span>(x))){</span>
<span id="cb960-3"><a href="defining-your-own-functions.html#cb960-3"></a>    <span class="kw">return</span>(<span class="ot">NA</span>)</span>
<span id="cb960-4"><a href="defining-your-own-functions.html#cb960-4"></a>  } <span class="cf">else</span> {</span>
<span id="cb960-5"><a href="defining-your-own-functions.html#cb960-5"></a>    <span class="kw">c</span>(<span class="kw">mean</span>(x), <span class="kw">sd</span>(x))</span>
<span id="cb960-6"><a href="defining-your-own-functions.html#cb960-6"></a>    }</span>
<span id="cb960-7"><a href="defining-your-own-functions.html#cb960-7"></a>}</span>
<span id="cb960-8"><a href="defining-your-own-functions.html#cb960-8"></a></span>
<span id="cb960-9"><a href="defining-your-own-functions.html#cb960-9"></a><span class="kw">average_and_sd</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>))</span></code></pre></div>
<pre><code>## [1] 7.166667 4.262237</code></pre>
<div class="sourceCode" id="cb962"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb962-1"><a href="defining-your-own-functions.html#cb962-1"></a><span class="kw">average_and_sd</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="ot">NA</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>))</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>If you need to use a function from a package inside your function use <code>::</code>:</p>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb964-1"><a href="defining-your-own-functions.html#cb964-1"></a>my_sum &lt;-<span class="st"> </span><span class="cf">function</span>(a_vector){</span>
<span id="cb964-2"><a href="defining-your-own-functions.html#cb964-2"></a>  purrr<span class="op">::</span><span class="kw">reduce</span>(a_vector, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</span>
<span id="cb964-3"><a href="defining-your-own-functions.html#cb964-3"></a>}</span></code></pre></div>
<p>However, if you need to use more than one function, this can become tedious. A quick and dirty
way of doing that, is to use <code>library(package_name)</code>, inside the function:</p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="defining-your-own-functions.html#cb965-1"></a>my_sum &lt;-<span class="st"> </span><span class="cf">function</span>(a_vector){</span>
<span id="cb965-2"><a href="defining-your-own-functions.html#cb965-2"></a>  <span class="kw">library</span>(purrr)</span>
<span id="cb965-3"><a href="defining-your-own-functions.html#cb965-3"></a>  <span class="kw">reduce</span>(a_vector, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</span>
<span id="cb965-4"><a href="defining-your-own-functions.html#cb965-4"></a>}</span></code></pre></div>
<p>Loading the library inside the function has the advantage that you will be sure that the package
upon which your function depends will be loaded. If the package is already loaded, it will not be
loaded again, thus not impact performance, but if you forgot to load it at the beginning of your
script, then, no worries, your function will load it the first time you use it! However, the very
best way would be to write your own package and declare the packages upon which your functions
depend as dependencies. This is something we are going to explore in Chapter 11.</p>
<p>You can put a lot of instructions inside a function, such as loops. Let‚Äôs create the function that
returns Fionacci numbers.</p>
</div>
<div id="fibonacci-numbers" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Fibonacci numbers</h3>
<p>The Fibonacci sequence is the following:</p>
<p><span class="math display">\[1, 1, 2, 3, 5, 8, 13, 21, 34, 55, ...\]</span></p>
<p>Each subsequent number is composed of the sum of the two preceding ones. In R, it is possible to define a function that returns the <span class="math inline">\(n^{th}\)</span> fibonacci number:</p>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb966-1"><a href="defining-your-own-functions.html#cb966-1"></a>my_fibo &lt;-<span class="st"> </span><span class="cf">function</span>(n){</span>
<span id="cb966-2"><a href="defining-your-own-functions.html#cb966-2"></a> a &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb966-3"><a href="defining-your-own-functions.html#cb966-3"></a> b &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb966-4"><a href="defining-your-own-functions.html#cb966-4"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n){</span>
<span id="cb966-5"><a href="defining-your-own-functions.html#cb966-5"></a>  temp &lt;-<span class="st"> </span>b</span>
<span id="cb966-6"><a href="defining-your-own-functions.html#cb966-6"></a>  b &lt;-<span class="st"> </span>a</span>
<span id="cb966-7"><a href="defining-your-own-functions.html#cb966-7"></a>  a &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>temp</span>
<span id="cb966-8"><a href="defining-your-own-functions.html#cb966-8"></a> }</span>
<span id="cb966-9"><a href="defining-your-own-functions.html#cb966-9"></a> a</span>
<span id="cb966-10"><a href="defining-your-own-functions.html#cb966-10"></a>}</span></code></pre></div>
<p>Inside the loop, we defined a variable called <code>temp</code>. Defining temporary variables is usually very
useful. Let‚Äôs try to understand what happens inside this loop:</p>
<ul>
<li>First, we assign the value 0 to variable <code>a</code> and value 1 to variable <code>b</code>.</li>
<li>We start a loop, that goes from 1 to <code>n</code>.</li>
<li>We assign the value inside of <code>b</code> to a temporary variable, called <code>temp</code>.</li>
<li><code>b</code> becomes <code>a</code>.</li>
<li>We assign the sum of <code>a</code> and <code>temp</code> to <code>a</code>.</li>
<li>When the loop is finished, we return <code>a</code>.</li>
</ul>
<p>What happens if we want the 3rd fibonacci number? At <code>n = 1</code> we have first <code>a = 0</code> and <code>b = 1</code>,
then <code>temp = 1</code>, <code>b = 0</code> and <code>a = 0 + 1</code>. Then <code>n = 2</code>. Now <code>b = 0</code> and <code>temp = 0</code>. The previous
result, <code>a = 0 + 1</code> is now assigned to <code>b</code>, so <code>b = 1</code>. Then, <code>a = 1 + 0</code>. Finally, <code>n = 3</code>. <code>temp = 1</code> (because <code>b = 1</code>), the previous result <code>a = 1</code> is assigned to <code>b</code> and finally, <code>a = 1 + 1</code>. So
the third fibonacci number equals 2. Reading this might be a bit confusing; I strongly advise you
to run the algorithm on a sheet of paper, step by step.</p>
<p>The above algorithm is called an iterative algorithm, because it uses a loop to compute the result.
Let‚Äôs look at another way to think about the problem, with a so-called recursive function:</p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="defining-your-own-functions.html#cb967-1"></a>fibo_recur &lt;-<span class="st"> </span><span class="cf">function</span>(n){</span>
<span id="cb967-2"><a href="defining-your-own-functions.html#cb967-2"></a> <span class="cf">if</span> (n <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>n <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb967-3"><a href="defining-your-own-functions.html#cb967-3"></a>   <span class="kw">return</span>(n)</span>
<span id="cb967-4"><a href="defining-your-own-functions.html#cb967-4"></a>   } <span class="cf">else</span> {</span>
<span id="cb967-5"><a href="defining-your-own-functions.html#cb967-5"></a>   <span class="kw">fibo_recur</span>(n<span class="dv">-1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">fibo_recur</span>(n<span class="dv">-2</span>)</span>
<span id="cb967-6"><a href="defining-your-own-functions.html#cb967-6"></a>   }</span>
<span id="cb967-7"><a href="defining-your-own-functions.html#cb967-7"></a>}</span></code></pre></div>
<p>This algorithm should be easier to understand: if <code>n = 0</code> or <code>n = 1</code> the function should return <code>n</code>
(0 or 1). If <code>n</code> is strictly bigger than <code>1</code>, <code>fibo_recur()</code> should return the sum of
<code>fibo_recur(n-1)</code> and <code>fibo_recur(n-2)</code>. This version of the function is very much the same as the
mathematical definition of the fibonacci sequence. So why not use only recursive algorithms
then? Try to run the following:</p>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb968-1"><a href="defining-your-own-functions.html#cb968-1"></a><span class="kw">system.time</span>(<span class="kw">my_fibo</span>(<span class="dv">30</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.005   0.000   0.005</code></pre>
<p>The result should be printed very fast (the <code>system.time()</code> function returns the time that it took
to execute <code>my_fibo(30)</code>). Let‚Äôs try with the recursive version:</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="defining-your-own-functions.html#cb970-1"></a><span class="kw">system.time</span>(<span class="kw">fibo_recur</span>(<span class="dv">30</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   1.179   0.000   1.180</code></pre>
<p>It takes much longer to execute! Recursive algorithms are very CPU demanding, so if speed is
critical, it‚Äôs best to avoid recursive algorithms. Also, in <code>fibo_recur()</code> try to remove this line:
<code>if (n == 0 || n == 1)</code> and try to run <code>fibo_recur(5)</code> and see what happens. You should
get an error: this is because for recursive algorithms you need a stopping condition, or else,
it would run forever. This is not the case for iterative algorithms, because the stopping
condition is the last step of the loop.</p>
<p>So as you can see, for recursive relationships, for or while loops are the way to go in R, whether
you‚Äôre writing these loops inside functions or not.</p>
</div>
</div>
<div id="exercises-4" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Exercises</h2>
<div id="exercise-1-4" class="section level3 unnumbered" number="">
<h3>Exercise 1</h3>
<p>In this exercise, you will write a function to compute the sum of the n first integers. Combine the
algorithm we saw in section about while loops and what you learned about functions
in this section.</p>
</div>
<div id="exercise-2-2" class="section level3 unnumbered" number="">
<h3>Exercise 2</h3>
<p>Write a function called <code>my_fact()</code> that computes the factorial of a number <code>n</code>. Do it using a
loop, using a recursive function, and using a functional:</p>
</div>
<div id="exercise-3-2" class="section level3 unnumbered" number="">
<h3>Exercise 3</h3>
<p>Write a function to find the roots of quadratic functions. Your function should take 3 arguments,
<code>a</code>, <code>b</code> and <code>c</code> and return the two roots. Only consider the case where there are two real roots
(delta &gt; 0).</p>
</div>
</div>
<div id="functions-that-take-functions-as-arguments-writing-your-own-higher-order-functions" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Functions that take functions as arguments: writing your own higher-order functions</h2>
<p>Functions that take functions as arguments are very powerful and useful tools. You already know a
couple, <code>purrr::map()</code> and <code>purrr::reduce()</code>, discussed briefly in Chapter 4.
But you can also write your own! A very simple example would be the following:</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="defining-your-own-functions.html#cb972-1"></a>my_func &lt;-<span class="st"> </span><span class="cf">function</span>(x, func){</span>
<span id="cb972-2"><a href="defining-your-own-functions.html#cb972-2"></a>  <span class="kw">func</span>(x)</span>
<span id="cb972-3"><a href="defining-your-own-functions.html#cb972-3"></a>}</span></code></pre></div>
<p><code>my_func()</code> is a very simple function that takes <code>x</code> and <code>func()</code> as arguments and that simply
executes <code>func(x)</code>. This might not seem very useful (after all, you could simply use <code>func(x)!</code>) but
this is just for illustration purposes, in practice, your functions would be more useful than that!
Let‚Äôs try to use <code>my_func()</code>:</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="defining-your-own-functions.html#cb973-1"></a><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">8</span>), mean)</span></code></pre></div>
<pre><code>## [1] 3.6</code></pre>
<p>As expected, this returns the mean of the given vector. But now suppose the following:</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="defining-your-own-functions.html#cb975-1"></a><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Because one element of the list is <code>NA</code>, the whole mean is <code>NA</code>. <code>mean()</code> has a <code>na.rm</code> argument
that you can set to <code>TRUE</code> to ignore the <code>NA</code>s in the vector. However, here, there is no way to
provide this argument to the function <code>mean()</code>! Let‚Äôs see what happens when we try to:</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="defining-your-own-functions.html#cb977-1"></a><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>Error in my_func(c(1, 8, 1, NA, 8), mean, na.rm = TRUE) :
  unused argument (na.rm = TRUE)</code></pre>
<p>So what you could do is pass the value <code>TRUE</code> to the <code>na.rm</code> argument of <code>mean()</code> from your own
function:</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb979-1"><a href="defining-your-own-functions.html#cb979-1"></a>my_func &lt;-<span class="st"> </span><span class="cf">function</span>(x, func, remove_na){</span>
<span id="cb979-2"><a href="defining-your-own-functions.html#cb979-2"></a>  <span class="kw">func</span>(x, <span class="dt">na.rm =</span> remove_na)</span>
<span id="cb979-3"><a href="defining-your-own-functions.html#cb979-3"></a>}</span>
<span id="cb979-4"><a href="defining-your-own-functions.html#cb979-4"></a></span>
<span id="cb979-5"><a href="defining-your-own-functions.html#cb979-5"></a><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean, <span class="dt">remove_na =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 4.5</code></pre>
<p>This is one solution, but <code>mean()</code> also has another argument called <code>trim</code>. What if some other
user needs this argument? Should you also add it to your function? Surely there‚Äôs a way to avoid
this problem? Yes, there is, and it by using the <em>dots</em>. The <code>...</code> simply mean ‚Äúany other
argument as needed‚Äù, and it‚Äôs very easy to use:</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="defining-your-own-functions.html#cb981-1"></a>my_func &lt;-<span class="st"> </span><span class="cf">function</span>(x, func, ...){</span>
<span id="cb981-2"><a href="defining-your-own-functions.html#cb981-2"></a>  <span class="kw">func</span>(x, ...)</span>
<span id="cb981-3"><a href="defining-your-own-functions.html#cb981-3"></a>}</span>
<span id="cb981-4"><a href="defining-your-own-functions.html#cb981-4"></a></span>
<span id="cb981-5"><a href="defining-your-own-functions.html#cb981-5"></a><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 4.5</code></pre>
<p>or, now, if you need the <code>trim</code> argument:</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb983-1"><a href="defining-your-own-functions.html#cb983-1"></a><span class="kw">my_func</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">8</span>), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">trim =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<pre><code>## [1] 4.5</code></pre>
<p>The <code>...</code> are very useful when writing wrappers such as <code>my_func()</code>.</p>
</div>
<div id="functions-that-take-columns-of-data-as-arguments" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Functions that take columns of data as arguments</h2>
<div id="the-enquo---approach" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> The <code>enquo() - !!()</code> approach</h3>
<p>In many situations, you will want to write functions that look similar to this:</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="defining-your-own-functions.html#cb985-1"></a><span class="kw">my_function</span>(my_data, one_column_inside_data)</span></code></pre></div>
<p>Such a function would be useful in situation where you have to apply a certain number of operations
to columns for different data frames. For example if you need to create tables of descriptive
statistics or graphs periodically, it might be very interesting to put these operations inside a
function and then call the function whenever you need it, on the fresh batch of data.</p>
<p>However, if you try to write something like that, something that might seem unexpected, at first,
will happen:</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="defining-your-own-functions.html#cb986-1"></a><span class="kw">data</span>(mtcars)</span>
<span id="cb986-2"><a href="defining-your-own-functions.html#cb986-2"></a></span>
<span id="cb986-3"><a href="defining-your-own-functions.html#cb986-3"></a>simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, col_name){</span>
<span id="cb986-4"><a href="defining-your-own-functions.html#cb986-4"></a>  dataset <span class="op">%&gt;%</span></span>
<span id="cb986-5"><a href="defining-your-own-functions.html#cb986-5"></a><span class="st">    </span><span class="kw">group_by</span>(col_name) <span class="op">%&gt;%</span></span>
<span id="cb986-6"><a href="defining-your-own-functions.html#cb986-6"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_speed =</span> <span class="kw">mean</span>(speed))</span>
<span id="cb986-7"><a href="defining-your-own-functions.html#cb986-7"></a>}</span>
<span id="cb986-8"><a href="defining-your-own-functions.html#cb986-8"></a></span>
<span id="cb986-9"><a href="defining-your-own-functions.html#cb986-9"></a></span>
<span id="cb986-10"><a href="defining-your-own-functions.html#cb986-10"></a><span class="kw">simple_function</span>(cars, <span class="st">&quot;dist&quot;</span>)</span></code></pre></div>
<pre><code>Error: unknown variable to group by : col_name</code></pre>
<p>The variable <code>col_name</code> is passed to <code>simple_function()</code> as a string, but <code>group_by()</code> requires a
variable name. So why not try to convert <code>col_name</code> to a name?</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="defining-your-own-functions.html#cb988-1"></a>simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, col_name){</span>
<span id="cb988-2"><a href="defining-your-own-functions.html#cb988-2"></a>  col_name &lt;-<span class="st"> </span><span class="kw">as.name</span>(col_name)</span>
<span id="cb988-3"><a href="defining-your-own-functions.html#cb988-3"></a>  dataset <span class="op">%&gt;%</span></span>
<span id="cb988-4"><a href="defining-your-own-functions.html#cb988-4"></a><span class="st">    </span><span class="kw">group_by</span>(col_name) <span class="op">%&gt;%</span></span>
<span id="cb988-5"><a href="defining-your-own-functions.html#cb988-5"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_speed =</span> <span class="kw">mean</span>(speed))</span>
<span id="cb988-6"><a href="defining-your-own-functions.html#cb988-6"></a>}</span>
<span id="cb988-7"><a href="defining-your-own-functions.html#cb988-7"></a></span>
<span id="cb988-8"><a href="defining-your-own-functions.html#cb988-8"></a></span>
<span id="cb988-9"><a href="defining-your-own-functions.html#cb988-9"></a><span class="kw">simple_function</span>(cars, <span class="st">&quot;dist&quot;</span>)</span></code></pre></div>
<pre><code>Error: unknown variable to group by : col_name</code></pre>
<p>This is because R is literally looking for the variable <code>"dist"</code> somewhere in the global
environment, and not as a column of the data. R does not understand that you are refering to the
column <code>"dist"</code> that is inside the dataset. So how can we make R understands what you mean?</p>
<p>To be able to do that, we need to use a framework that was introduced in the <code>{tidyverse}</code>,
called <code>{tidyeval}</code>. This discussion can get very technical, so I will spare you the details.
However, you can read about it <a href="http://dplyr.tidyverse.org/articles/programming.html">here</a> and
<a href="https://cran.r-project.org/web/packages/rlang/vignettes/tidy-evaluation.html">here</a>. The
discussion can get complicated, but using <code>{tidyeval}</code> is actually quite easy, and you can have a
cookbook approach to it. Take a look at the code below:</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="defining-your-own-functions.html#cb990-1"></a>simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, col_name){</span>
<span id="cb990-2"><a href="defining-your-own-functions.html#cb990-2"></a>  col_name &lt;-<span class="st"> </span><span class="kw">enquo</span>(col_name)</span>
<span id="cb990-3"><a href="defining-your-own-functions.html#cb990-3"></a>  dataset <span class="op">%&gt;%</span></span>
<span id="cb990-4"><a href="defining-your-own-functions.html#cb990-4"></a><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!</span>col_name) <span class="op">%&gt;%</span></span>
<span id="cb990-5"><a href="defining-your-own-functions.html#cb990-5"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_mpg =</span> <span class="kw">mean</span>(mpg))</span>
<span id="cb990-6"><a href="defining-your-own-functions.html#cb990-6"></a>}</span>
<span id="cb990-7"><a href="defining-your-own-functions.html#cb990-7"></a></span>
<span id="cb990-8"><a href="defining-your-own-functions.html#cb990-8"></a></span>
<span id="cb990-9"><a href="defining-your-own-functions.html#cb990-9"></a><span class="kw">simple_function</span>(mtcars, cyl)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 3 x 2
##     cyl mean_mpg
##   &lt;dbl&gt;    &lt;dbl&gt;
## 1     4     26.7
## 2     6     19.7
## 3     8     15.1</code></pre>
<p>As you can see, the previous idea we had, which was using <code>as.name()</code> was not very far away from
the solution. The solution, with <code>tidyeval</code>, consists in using <code>enquo()</code>, which (for our purposes),
does something similar to <code>as.name()</code>. Now that
<code>col_name</code> is (R programmers call it) quoted, we need to tell <code>group_by()</code> to evaluate the input as
is. This is done with <code>!!()</code>, which is another <code>{tidyeval}</code> function. I say it again;
don‚Äôt worry if you don‚Äôt understand everything. Just remember to use <code>enquo()</code> on your column names
and then <code>!!()</code> inside the <code>{dplyr}</code> function you want to use.</p>
<p>Let‚Äôs see some other examples:</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="defining-your-own-functions.html#cb993-1"></a>simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, col_name, value){</span>
<span id="cb993-2"><a href="defining-your-own-functions.html#cb993-2"></a>  col_name &lt;-<span class="st"> </span><span class="kw">enquo</span>(col_name)</span>
<span id="cb993-3"><a href="defining-your-own-functions.html#cb993-3"></a>  dataset <span class="op">%&gt;%</span></span>
<span id="cb993-4"><a href="defining-your-own-functions.html#cb993-4"></a><span class="st">    </span><span class="kw">filter</span>((<span class="op">!!</span>col_name) <span class="op">==</span><span class="st"> </span>value) <span class="op">%&gt;%</span></span>
<span id="cb993-5"><a href="defining-your-own-functions.html#cb993-5"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_cyl =</span> <span class="kw">mean</span>(cyl))</span>
<span id="cb993-6"><a href="defining-your-own-functions.html#cb993-6"></a>}</span>
<span id="cb993-7"><a href="defining-your-own-functions.html#cb993-7"></a></span>
<span id="cb993-8"><a href="defining-your-own-functions.html#cb993-8"></a></span>
<span id="cb993-9"><a href="defining-your-own-functions.html#cb993-9"></a><span class="kw">simple_function</span>(mtcars, am, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##   mean_cyl
## 1 5.076923</code></pre>
<p>Notice that I‚Äôve written:</p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb995-1"><a href="defining-your-own-functions.html#cb995-1"></a><span class="kw">filter</span>((<span class="op">!!</span>col_name) <span class="op">==</span><span class="st"> </span>value)</span></code></pre></div>
<p>and not:</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="defining-your-own-functions.html#cb996-1"></a><span class="kw">filter</span>(<span class="op">!!</span>col_name <span class="op">==</span><span class="st"> </span>value)</span></code></pre></div>
<p>I have enclosed <code>!!col_name</code> inside parentheses. This is because operators such as <code>==</code> have
precedence over <code>!!</code>, so you have to be explicit. Also, notice that I didn‚Äôt have to quote <code>1</code>.
This is because it‚Äôs <em>standard</em> variable, not a column inside the dataset. Let‚Äôs make this function
a bit more general. I hard-coded the variable cyl inside the body of the function, but maybe you‚Äôd
like the mean of another variable?</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="defining-your-own-functions.html#cb997-1"></a>simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, filter_col, mean_col, value){</span>
<span id="cb997-2"><a href="defining-your-own-functions.html#cb997-2"></a>  filter_col &lt;-<span class="st"> </span><span class="kw">enquo</span>(filter_col)</span>
<span id="cb997-3"><a href="defining-your-own-functions.html#cb997-3"></a>  mean_col &lt;-<span class="st"> </span><span class="kw">enquo</span>(mean_col)</span>
<span id="cb997-4"><a href="defining-your-own-functions.html#cb997-4"></a>  dataset <span class="op">%&gt;%</span></span>
<span id="cb997-5"><a href="defining-your-own-functions.html#cb997-5"></a><span class="st">    </span><span class="kw">filter</span>((<span class="op">!!</span>filter_col) <span class="op">==</span><span class="st"> </span>value) <span class="op">%&gt;%</span></span>
<span id="cb997-6"><a href="defining-your-own-functions.html#cb997-6"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="kw">mean</span>((<span class="op">!!</span>mean_col)))</span>
<span id="cb997-7"><a href="defining-your-own-functions.html#cb997-7"></a>}</span>
<span id="cb997-8"><a href="defining-your-own-functions.html#cb997-8"></a></span>
<span id="cb997-9"><a href="defining-your-own-functions.html#cb997-9"></a></span>
<span id="cb997-10"><a href="defining-your-own-functions.html#cb997-10"></a><span class="kw">simple_function</span>(mtcars, am, cyl, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##   mean(cyl)
## 1  5.076923</code></pre>
<p>Notice that I had to quote <code>mean_col</code> too.</p>
<p>Using the <code>...</code> that we discovered in the previous section, we can pass more than one column:</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="defining-your-own-functions.html#cb999-1"></a>simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, ...){</span>
<span id="cb999-2"><a href="defining-your-own-functions.html#cb999-2"></a>  col_vars &lt;-<span class="st"> </span><span class="kw">quos</span>(...)</span>
<span id="cb999-3"><a href="defining-your-own-functions.html#cb999-3"></a>  dataset <span class="op">%&gt;%</span></span>
<span id="cb999-4"><a href="defining-your-own-functions.html#cb999-4"></a><span class="st">    </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(<span class="op">!!!</span>col_vars), <span class="kw">funs</span>(mean, sd))</span>
<span id="cb999-5"><a href="defining-your-own-functions.html#cb999-5"></a>}</span></code></pre></div>
<p>Because these <em>dots</em> contain more than one variable, you have to use <code>quos()</code> instead of <code>enquo()</code>.
This will put the arguments provided via the dots in a list. Then, because we have a list of
columns, we have to use <code>summarise_at()</code>, which you should know if you did the exercices of
Chapter 4. So if you didn‚Äôt do them, go back to them and finish them first. Doing the exercise will
also teach you what <code>vars()</code> and <code>funs()</code> are. The last thing you have to pay attention to is to
use <code>!!!()</code> if you used <code>quos()</code>. So 3 <code>!</code> instead of only 2. This allows you to then do things
like this:</p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="defining-your-own-functions.html#cb1000-1"></a><span class="kw">simple_function</span>(mtcars, am, cyl, mpg)</span></code></pre></div>
<pre><code>## Warning: `funs()` is deprecated as of dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>##   am_mean cyl_mean mpg_mean     am_sd   cyl_sd   mpg_sd
## 1 0.40625   6.1875 20.09062 0.4989909 1.785922 6.026948</code></pre>
<p>Using <code>...</code> with <code>!!!()</code> allows you to write very flexible functions.</p>
<p>If you need to be even more general, you can also provide the summary functions as arguments of
your function, but you have to rewrite your function a little bit:</p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="defining-your-own-functions.html#cb1003-1"></a>simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, cols, funcs){</span>
<span id="cb1003-2"><a href="defining-your-own-functions.html#cb1003-2"></a>  dataset <span class="op">%&gt;%</span></span>
<span id="cb1003-3"><a href="defining-your-own-functions.html#cb1003-3"></a><span class="st">    </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(<span class="op">!!!</span>cols), <span class="kw">funs</span>(<span class="op">!!!</span>funcs))</span>
<span id="cb1003-4"><a href="defining-your-own-functions.html#cb1003-4"></a>}</span></code></pre></div>
<p>You might be wondering where the <code>quos()</code> went? Well because now we are passing two lists, a list of
columns that we have to quote, and a list of functions, that we also have to quote, we need to use <code>quos()</code>
when calling the function:</p>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="defining-your-own-functions.html#cb1004-1"></a><span class="kw">simple_function</span>(mtcars, <span class="kw">quos</span>(am, cyl, mpg), <span class="kw">quos</span>(mean, sd, sum))</span></code></pre></div>
<pre><code>##   am_mean cyl_mean mpg_mean     am_sd   cyl_sd   mpg_sd am_sum cyl_sum mpg_sum
## 1 0.40625   6.1875 20.09062 0.4989909 1.785922 6.026948     13     198   642.9</code></pre>
<p>This works, but I don‚Äôt think you‚Äôll need to have that much flexibility; either the columns
are variables, or the functions, but rarely both at the same time.</p>
<p>To conclude this function, I should also talk about <code>as_label()</code> which allows you to change the
name of a variable, for instance if you want to call the resulting column <code>mean_mpg</code> when you
compute the mean of the <code>mpg</code> column:</p>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="defining-your-own-functions.html#cb1006-1"></a>simple_function &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, filter_col, mean_col, value){</span>
<span id="cb1006-2"><a href="defining-your-own-functions.html#cb1006-2"></a></span>
<span id="cb1006-3"><a href="defining-your-own-functions.html#cb1006-3"></a>  filter_col &lt;-<span class="st"> </span><span class="kw">enquo</span>(filter_col)</span>
<span id="cb1006-4"><a href="defining-your-own-functions.html#cb1006-4"></a>  mean_col &lt;-<span class="st"> </span><span class="kw">enquo</span>(mean_col)</span>
<span id="cb1006-5"><a href="defining-your-own-functions.html#cb1006-5"></a>  mean_name &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;mean_&quot;</span>, <span class="kw">as_label</span>(mean_col))</span>
<span id="cb1006-6"><a href="defining-your-own-functions.html#cb1006-6"></a>  </span>
<span id="cb1006-7"><a href="defining-your-own-functions.html#cb1006-7"></a>  dataset <span class="op">%&gt;%</span></span>
<span id="cb1006-8"><a href="defining-your-own-functions.html#cb1006-8"></a><span class="st">    </span><span class="kw">filter</span>((<span class="op">!!</span>filter_col) <span class="op">==</span><span class="st"> </span>value) <span class="op">%&gt;%</span></span>
<span id="cb1006-9"><a href="defining-your-own-functions.html#cb1006-9"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="op">!!</span>(mean_name) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">mean</span>((<span class="op">!!</span>mean_col)))</span>
<span id="cb1006-10"><a href="defining-your-own-functions.html#cb1006-10"></a>}</span></code></pre></div>
<p>Pay attention to the <code>:=</code> operator in the last line. This is needed when using <code>as_label()</code>.</p>
</div>
<div id="curly-curly-a-simplified-approach-to-the-enquo-and-framework" class="section level3" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Curly Curly, a simplified approach to the <code>enquo()</code> and <code>!!()</code> framework</h3>
<p>The previous section might have been a bit difficult to grasp, but there is a simplified way of doing it,
which consists in using <code>{{}}</code>, introduced in <code>{rlang}</code> version 0.4.0.
The suggested pronunciation of <code>{{}}</code> is <em>curly-curly</em>, but there is no
<a href="https://twitter.com/JonTheGeek/status/1144815369766547456">consensus yet</a>.</p>
<p>Let‚Äôs suppose that I need to write a function that takes a data frame, as well as a column from
this data frame as arguments, just like before:</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="defining-your-own-functions.html#cb1007-1"></a>how_many_na &lt;-<span class="st"> </span><span class="cf">function</span>(dataframe, column_name){</span>
<span id="cb1007-2"><a href="defining-your-own-functions.html#cb1007-2"></a>  dataframe <span class="op">%&gt;%</span></span>
<span id="cb1007-3"><a href="defining-your-own-functions.html#cb1007-3"></a><span class="st">    </span><span class="kw">filter</span>(<span class="kw">is.na</span>(column_name)) <span class="op">%&gt;%</span></span>
<span id="cb1007-4"><a href="defining-your-own-functions.html#cb1007-4"></a><span class="st">    </span><span class="kw">count</span>()</span>
<span id="cb1007-5"><a href="defining-your-own-functions.html#cb1007-5"></a>}</span></code></pre></div>
<p>Let‚Äôs try this function out on the <code>starwars</code> data:</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="defining-your-own-functions.html#cb1008-1"></a><span class="kw">data</span>(starwars)</span>
<span id="cb1008-2"><a href="defining-your-own-functions.html#cb1008-2"></a></span>
<span id="cb1008-3"><a href="defining-your-own-functions.html#cb1008-3"></a><span class="kw">head</span>(starwars)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 14
##   name  height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke‚Ä¶    172    77 blond      fair       blue            19   male  mascu‚Ä¶
## 2 C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   none  mascu‚Ä¶
## 3 R2-D2     96    32 &lt;NA&gt;       white, bl‚Ä¶ red             33   none  mascu‚Ä¶
## 4 Dart‚Ä¶    202   136 none       white      yellow          41.9 male  mascu‚Ä¶
## 5 Leia‚Ä¶    150    49 brown      light      brown           19   fema‚Ä¶ femin‚Ä¶
## 6 Owen‚Ä¶    178   120 brown, gr‚Ä¶ light      blue            52   male  mascu‚Ä¶
## # ‚Ä¶ with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>As you can see, there are missing values in the <code>hair_color</code> column. Let‚Äôs try to count how many
missing values are in this column:</p>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="defining-your-own-functions.html#cb1010-1"></a><span class="kw">how_many_na</span>(starwars, hair_color)</span></code></pre></div>
<pre><code>Error: object &#39;hair_color&#39; not found</code></pre>
<p>Just as expected, this does not work. The issue is that the column is inside the dataframe,
but when calling the function with <code>hair_color</code> as the second argument, R is looking for a
variable called <code>hair_color</code> that does not exist. What about trying with <code>"hair_color"</code>?</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="defining-your-own-functions.html#cb1012-1"></a><span class="kw">how_many_na</span>(starwars, <span class="st">&quot;hair_color&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1     0</code></pre>
<p>Now we get something, but something wrong!</p>
<p>One way to solve this issue, is to not use the <code>filter()</code> function, and instead rely on base R:</p>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="defining-your-own-functions.html#cb1014-1"></a>how_many_na_base &lt;-<span class="st"> </span><span class="cf">function</span>(dataframe, column_name){</span>
<span id="cb1014-2"><a href="defining-your-own-functions.html#cb1014-2"></a>  na_index &lt;-<span class="st"> </span><span class="kw">is.na</span>(dataframe[, column_name])</span>
<span id="cb1014-3"><a href="defining-your-own-functions.html#cb1014-3"></a>  <span class="kw">nrow</span>(dataframe[na_index, column_name])</span>
<span id="cb1014-4"><a href="defining-your-own-functions.html#cb1014-4"></a>}</span>
<span id="cb1014-5"><a href="defining-your-own-functions.html#cb1014-5"></a></span>
<span id="cb1014-6"><a href="defining-your-own-functions.html#cb1014-6"></a><span class="kw">how_many_na_base</span>(starwars, <span class="st">&quot;hair_color&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: The `i` argument of ``[`()` can&#39;t be a matrix as of tibble 3.0.0.
## Convert to a vector.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## [1] 5</code></pre>
<p>This works, but not using the <code>{tidyverse}</code> at all is not always an option. For instance,
the next function, which uses a grouping variable, would be difficult to implement without the
<code>{tidyverse}</code>:</p>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="defining-your-own-functions.html#cb1017-1"></a>summarise_groups &lt;-<span class="st"> </span><span class="cf">function</span>(dataframe, grouping_var, column_name){</span>
<span id="cb1017-2"><a href="defining-your-own-functions.html#cb1017-2"></a>  dataframe <span class="op">%&gt;%</span></span>
<span id="cb1017-3"><a href="defining-your-own-functions.html#cb1017-3"></a><span class="st">    </span><span class="kw">group_by</span>(grouping_var) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1017-4"><a href="defining-your-own-functions.html#cb1017-4"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="kw">mean</span>(column_name, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1017-5"><a href="defining-your-own-functions.html#cb1017-5"></a>}</span></code></pre></div>
<p>Calling this function results in the following error message, as expected:</p>
<pre><code>Error: Column `grouping_var` is unknown</code></pre>
<p>In the previous section, we solved the issue like so:</p>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="defining-your-own-functions.html#cb1019-1"></a>summarise_groups &lt;-<span class="st"> </span><span class="cf">function</span>(dataframe, grouping_var, column_name){</span>
<span id="cb1019-2"><a href="defining-your-own-functions.html#cb1019-2"></a></span>
<span id="cb1019-3"><a href="defining-your-own-functions.html#cb1019-3"></a>  grouping_var &lt;-<span class="st"> </span><span class="kw">enquo</span>(grouping_var)</span>
<span id="cb1019-4"><a href="defining-your-own-functions.html#cb1019-4"></a>  column_name &lt;-<span class="st"> </span><span class="kw">enquo</span>(column_name)</span>
<span id="cb1019-5"><a href="defining-your-own-functions.html#cb1019-5"></a>  mean_name &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;mean_&quot;</span>, <span class="kw">as_label</span>(column_name))</span>
<span id="cb1019-6"><a href="defining-your-own-functions.html#cb1019-6"></a></span>
<span id="cb1019-7"><a href="defining-your-own-functions.html#cb1019-7"></a>  dataframe <span class="op">%&gt;%</span></span>
<span id="cb1019-8"><a href="defining-your-own-functions.html#cb1019-8"></a><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!</span>grouping_var) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1019-9"><a href="defining-your-own-functions.html#cb1019-9"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="op">!!</span>(mean_name) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">mean</span>(<span class="op">!!</span>column_name, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1019-10"><a href="defining-your-own-functions.html#cb1019-10"></a>}</span></code></pre></div>
<p>The core of the function remained very similar to the version from before, but now one has to
use the <code>enquo()</code>-<code>!!</code> syntax.</p>
<p>Now this can be simplified using the new <code>{{}}</code> syntax:</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="defining-your-own-functions.html#cb1020-1"></a>summarise_groups &lt;-<span class="st"> </span><span class="cf">function</span>(dataframe, grouping_var, column_name){</span>
<span id="cb1020-2"><a href="defining-your-own-functions.html#cb1020-2"></a></span>
<span id="cb1020-3"><a href="defining-your-own-functions.html#cb1020-3"></a>  dataframe <span class="op">%&gt;%</span></span>
<span id="cb1020-4"><a href="defining-your-own-functions.html#cb1020-4"></a><span class="st">    </span><span class="kw">group_by</span>({{grouping_var}}) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1020-5"><a href="defining-your-own-functions.html#cb1020-5"></a><span class="st">    </span><span class="kw">summarise</span>({{column_name}} <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">mean</span>({{column_name}}, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1020-6"><a href="defining-your-own-functions.html#cb1020-6"></a>}</span></code></pre></div>
<p>Much easier and cleaner! You still have to use the <code>:=</code> operator instead of <code>=</code> for the column name
however, and if you want to modify the column names, for instance in this
case return <code>"mean_height"</code> instead of <code>height</code> you have to keep using the <code>enquo()</code>-<code>!!</code> syntax.</p>
</div>
</div>
<div id="functions-that-use-loops" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Functions that use loops</h2>
<p>It is entirely possible to put a loop inside a function. For example, consider the following
function that return the square root of a number using Newton‚Äôs algorithm:</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="defining-your-own-functions.html#cb1021-1"></a>sqrt_newton &lt;-<span class="st"> </span><span class="cf">function</span>(a, <span class="dt">init =</span> <span class="dv">1</span>, <span class="dt">eps =</span> <span class="fl">0.01</span>){</span>
<span id="cb1021-2"><a href="defining-your-own-functions.html#cb1021-2"></a>    <span class="kw">stopifnot</span>(a <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1021-3"><a href="defining-your-own-functions.html#cb1021-3"></a>    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</span>
<span id="cb1021-4"><a href="defining-your-own-functions.html#cb1021-4"></a>        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</span>
<span id="cb1021-5"><a href="defining-your-own-functions.html#cb1021-5"></a>    }</span>
<span id="cb1021-6"><a href="defining-your-own-functions.html#cb1021-6"></a>    init</span>
<span id="cb1021-7"><a href="defining-your-own-functions.html#cb1021-7"></a>}</span></code></pre></div>
<p>This functions contains a while loop inside its body. Let‚Äôs see if it works:</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="defining-your-own-functions.html#cb1022-1"></a><span class="kw">sqrt_newton</span>(<span class="dv">16</span>)</span></code></pre></div>
<pre><code>## [1] 4.000001</code></pre>
<p>In the definition of the function, I wrote <code>init = 1</code> and <code>eps = 0.01</code> which means that this
argument can be omitted and will have the provided value (0.01) as the default. You can then use
this function as any other, for example with <code>map()</code>:</p>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="defining-your-own-functions.html#cb1024-1"></a><span class="kw">map</span>(<span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">12</span>), sqrt_newton)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 4.000001
## 
## [[2]]
## [1] 2.645767
## 
## [[3]]
## [1] 2.828469
## 
## [[4]]
## [1] 3.000092
## 
## [[5]]
## [1] 3.464616</code></pre>
<p>This is what I meant before with ‚Äúyour functions are nothing special‚Äù. Once the function is
defined, you can use it like any other base R function.</p>
<p>Notice the use of <code>stopifnot()</code> inside the body of the function. This is a way to return an error
in case a condition is not fulfilled. We are going to learn more about this type of functions
in the next chapter.</p>
</div>
<div id="anonymous-functions" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Anonymous functions</h2>
<p>As the name implies, anonymous functions are functions that do not have a name. These are useful inside
functions that have functions as arguments, such as <code>purrr::map()</code> or <code>purrr::reduce()</code>:</p>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1026-1"><a href="defining-your-own-functions.html#cb1026-1"></a><span class="kw">map</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="cf">function</span>(x){<span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(x)})</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 0.7071068
## 
## [[3]]
## [1] 0.5773503
## 
## [[4]]
## [1] 0.5</code></pre>
<p>These anonymous functions get defined in a very similar way to regular functions, you just skip the
name and that‚Äôs it. <code>{tidyverse}</code> functions also support formulas; these get converted to anonymous functions:</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1028-1"><a href="defining-your-own-functions.html#cb1028-1"></a><span class="kw">map</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="op">~</span>{<span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(.)})</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 0.7071068
## 
## [[3]]
## [1] 0.5773503
## 
## [[4]]
## [1] 0.5</code></pre>
<p>Using a formula instead of an anonymous function is less verbose; you use <code>~</code> instead of <code>function(x)</code>
and a single dot <code>.</code> instead of <code>x</code>. What if you need an anonymous function that requires more than
one argument? This is not a problem:</p>
<div class="sourceCode" id="cb1030"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1030-1"><a href="defining-your-own-functions.html#cb1030-1"></a><span class="kw">map2</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">5</span>), <span class="cf">function</span>(x, y){(x<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>y})</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.1111111
## 
## [[2]]
## [1] 0.5
## 
## [[3]]
## [1] 1.285714
## 
## [[4]]
## [1] 2.666667
## 
## [[5]]
## [1] 5</code></pre>
<p>or, using a formula:</p>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1032-1"><a href="defining-your-own-functions.html#cb1032-1"></a><span class="kw">map2</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">5</span>), <span class="op">~</span>{(.x<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>.y})</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.1111111
## 
## [[2]]
## [1] 0.5
## 
## [[3]]
## [1] 1.285714
## 
## [[4]]
## [1] 2.666667
## 
## [[5]]
## [1] 5</code></pre>
<p>Because you have now two arguments, a single dot could not work, so instead you use <code>.x</code> and <code>.y</code> to
avoid confusion.</p>
<p>You now know a lot about writing your own functions. In the next chapter, we are going to learn about
functional programming, the programming paradigm I described in the introduction of this book.</p>
</div>
<div id="exercises-5" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> Exercises</h2>
<div id="exercise-1-5" class="section level3 unnumbered" number="">
<h3>Exercise 1</h3>
<ul>
<li>Create the following vector:</li>
</ul>
<p><span class="math display">\[a = (1,6,7,8,8,9,2)\]</span></p>
<p>Using a for loop and a while loop, compute the sum of its elements. To avoid issues, use <code>i</code>
as the counter inside the for loop, and <code>j</code> as the counter for the while loop.</p>
<ul>
<li>How would you achieve that with a functional (a function that takes a function as an argument)?</li>
</ul>
</div>
<div id="exercise-2-3" class="section level3 unnumbered" number="">
<h3>Exercise 2</h3>
<ul>
<li>Let‚Äôs use a loop to get the matrix product of a matrix A and B. Follow these steps to create the loop:</li>
</ul>
<ol style="list-style-type: decimal">
<li>Create matrix A:</li>
</ol>
<p><span class="math display">\[A = \left(
  \begin{array}{ccc}
   9 &amp; 4 &amp; 12 \\
   5 &amp; 0 &amp; 7 \\
   2 &amp; 6 &amp; 8 \\
   9 &amp; 2 &amp; 9
  \end{array} \right)
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>Create matrix B:</li>
</ol>
<p><span class="math display">\[B = \left(
\begin{array}{cccc}
 5 &amp; 4 &amp; 2 &amp; 5 \\
 2 &amp; 7 &amp; 2 &amp; 1 \\
 8 &amp; 3 &amp; 2 &amp; 6 \\
\end{array} \right)
\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li><p>Create a matrix C, with dimension 4x4 that will hold the result. Use this command: `C = matrix(rep(0,16), nrow = 4)}</p></li>
<li><p>Using a for loop, loop over the rows of A first: `for(i in 1:nrow(A))}</p></li>
<li><p>Inside this loop, loop over the columns of B: `for(j in 1:ncol(B))}</p></li>
<li><p>Again, inside this loop, loop over the rows of B: `for(k in 1:nrow(B))}</p></li>
<li><p>Inside this last loop, compute the result and save it inside C: `C[i,j] = C[i,j] + A[i,k] * B[k,j]}</p></li>
<li><p>Now write a function that takes two matrices as arguments, and returns their product.</p></li>
</ol>
<ul>
<li>R has a built-in function to compute the dot product of 2 matrices. Which is it?</li>
</ul>
</div>
<div id="exercise-3-3" class="section level3 unnumbered" number="">
<h3>Exercise 3</h3>
<ul>
<li><p>Fizz Buzz: Print integers from 1 to 100. If a number is divisible by 3, print the word <code>"Fizz"</code> if
it‚Äôs divisible by 5, print <code>"Buzz"</code>. Use a for loop and if statements.</p></li>
<li><p>Write a function that takes an integer as arguments, and prints <code>"Fizz"</code> or <code>"Buzz"</code> up to that integer.</p></li>
</ul>
</div>
<div id="exercise-4-2" class="section level3 unnumbered" number="">
<h3>Exercise 4</h3>
<ul>
<li><p>Fizz Buzz 2: Same as above, but now add this third condition: if a number is both divisible by 3 and 5, print <code>"FizzBuzz"</code>.</p></li>
<li><p>Write a function that takes an integer as argument, and prints <code>Fizz</code>, <code>Buzz</code> or <code>FizzBuzz</code> up to that integer.</p></li>
</ul>

<p>%&gt;% # Functional programming</p>
<p>Functional programming is a paradigm that I find very suitable for data science. In functional
programming, your code is organised into functions that perform the operations you need. Your scripts
will only be a sequence of calls to these functions, making them easier to understand. R is not a pure
functional programming language, so we need some self-discipline to apply pure functional programming
principles. However, these efforts are worth it, because pure functions are easier to debug, extend
and document. In this chapter, we are going to learn about functional programming principles that you
can adopt and start using to make your code better.</p>
</div>
</div>
<div id="function-definitions" class="section level2" number="7.9">
<h2><span class="header-section-number">7.9</span> Function definitions</h2>
<p>You should now be familiar with function definitions in R. Let‚Äôs suppose you want to write a function
to compute the square root of a number and want to do so using Newton‚Äôs algorithm:</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="defining-your-own-functions.html#cb1034-1"></a>sqrt_newton &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">eps =</span> <span class="fl">0.01</span>){</span>
<span id="cb1034-2"><a href="defining-your-own-functions.html#cb1034-2"></a>    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</span>
<span id="cb1034-3"><a href="defining-your-own-functions.html#cb1034-3"></a>        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</span>
<span id="cb1034-4"><a href="defining-your-own-functions.html#cb1034-4"></a>    }</span>
<span id="cb1034-5"><a href="defining-your-own-functions.html#cb1034-5"></a>    init</span>
<span id="cb1034-6"><a href="defining-your-own-functions.html#cb1034-6"></a>}</span></code></pre></div>
<p>You can then use this function to get the square root of a number:</p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="defining-your-own-functions.html#cb1035-1"></a><span class="kw">sqrt_newton</span>(<span class="dv">16</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 4.00122</code></pre>
<p>We are using a <code>while</code> loop inside the body of the function. The <em>body</em> of a function are the
instructions that define the function. You can get the body of a function with <code>body(some_func)</code>.
In <em>pure</em> functional programming languages, like Haskell, loops do not exist. How can you
program without loops, you may ask? In functional programming, loops are replaced by recursion,
which we already discussed in the previous chapter. Let‚Äôs rewrite our little example above
with recursion:</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="defining-your-own-functions.html#cb1037-1"></a>sqrt_newton_recur &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">eps =</span> <span class="fl">0.01</span>){</span>
<span id="cb1037-2"><a href="defining-your-own-functions.html#cb1037-2"></a>    <span class="cf">if</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&lt;</span><span class="st"> </span>eps){</span>
<span id="cb1037-3"><a href="defining-your-own-functions.html#cb1037-3"></a>        result &lt;-<span class="st"> </span>init</span>
<span id="cb1037-4"><a href="defining-your-own-functions.html#cb1037-4"></a>    } <span class="cf">else</span> {</span>
<span id="cb1037-5"><a href="defining-your-own-functions.html#cb1037-5"></a>        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</span>
<span id="cb1037-6"><a href="defining-your-own-functions.html#cb1037-6"></a>        result &lt;-<span class="st"> </span><span class="kw">sqrt_newton_recur</span>(a, init, eps)</span>
<span id="cb1037-7"><a href="defining-your-own-functions.html#cb1037-7"></a>    }</span>
<span id="cb1037-8"><a href="defining-your-own-functions.html#cb1037-8"></a>    result</span>
<span id="cb1037-9"><a href="defining-your-own-functions.html#cb1037-9"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1038-1"><a href="defining-your-own-functions.html#cb1038-1"></a><span class="kw">sqrt_newton_recur</span>(<span class="dv">16</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 4.00122</code></pre>
<p>R is not a pure functional programming language though, so we can still use loops (be it <code>while</code> or
<code>for</code> loops) in the bodies of our functions. As discussed in the previous chapter, it is actually
better, performance-wise, to use loops instead of recursion, because R is not tail-call optimized.
I won‚Äôt got into the details of what tail-call optimization is but just remember that if
performance is important a loop will be faster. However, sometimes, it is easier to write a
function using recursion. I personally tend to avoid loops if performance is not important,
because I find that code that avoids loops is easier to read and debug. However, knowing that
you can use loops is reassuring, and encapsulating loops inside functions gives you the benefits of
both using functions, and loops. In the coming sections I will show you some built-in functions
that make it possible to avoid writing loops and that don‚Äôt rely on recursion, so performance
won‚Äôt be penalized.</p>
</div>
<div id="properties-of-functions" class="section level2" number="7.10">
<h2><span class="header-section-number">7.10</span> Properties of functions</h2>
<p>Mathematical functions have a nice property: we always get the same output for a given input. This
is called referential transparency and we should aim to write our R functions in such a way.
For example, the following function:</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="defining-your-own-functions.html#cb1040-1"></a>increment &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb1040-2"><a href="defining-your-own-functions.html#cb1040-2"></a>    x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb1040-3"><a href="defining-your-own-functions.html#cb1040-3"></a>}</span></code></pre></div>
<p>Is a referential transparent function. We always get the same result for any <code>x</code> that we give to
this function.</p>
<p>This:</p>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="defining-your-own-functions.html#cb1041-1"></a><span class="kw">increment</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>will always produce <code>11</code>.</p>
<p>However, this one:</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="defining-your-own-functions.html#cb1043-1"></a>increment_opaque &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb1043-2"><a href="defining-your-own-functions.html#cb1043-2"></a>    x <span class="op">+</span><span class="st"> </span>spam</span>
<span id="cb1043-3"><a href="defining-your-own-functions.html#cb1043-3"></a>}</span></code></pre></div>
<p>is not a referential transparent function, because its value depends on the global variable <code>spam</code>.</p>
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="defining-your-own-functions.html#cb1044-1"></a>spam &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb1044-2"><a href="defining-your-own-functions.html#cb1044-2"></a></span>
<span id="cb1044-3"><a href="defining-your-own-functions.html#cb1044-3"></a><span class="kw">increment_opaque</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>will produce <code>11</code> if <code>spam = 1</code>. But what if <code>spam = 19</code>?</p>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="defining-your-own-functions.html#cb1046-1"></a>spam &lt;-<span class="st"> </span><span class="dv">19</span></span>
<span id="cb1046-2"><a href="defining-your-own-functions.html#cb1046-2"></a></span>
<span id="cb1046-3"><a href="defining-your-own-functions.html#cb1046-3"></a><span class="kw">increment_opaque</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 29</code></pre>
<p>To make <code>increment_opaque()</code> a referential transparent function, it is enough to make <code>spam</code> an
argument:</p>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1048-1"><a href="defining-your-own-functions.html#cb1048-1"></a>increment_not_opaque &lt;-<span class="st"> </span><span class="cf">function</span>(x, spam){</span>
<span id="cb1048-2"><a href="defining-your-own-functions.html#cb1048-2"></a>    x <span class="op">+</span><span class="st"> </span>spam</span>
<span id="cb1048-3"><a href="defining-your-own-functions.html#cb1048-3"></a>}</span></code></pre></div>
<p>Now even if there is a global variable called <code>spam</code>, this will not influence our function:</p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="defining-your-own-functions.html#cb1049-1"></a>spam &lt;-<span class="st"> </span><span class="dv">19</span></span>
<span id="cb1049-2"><a href="defining-your-own-functions.html#cb1049-2"></a></span>
<span id="cb1049-3"><a href="defining-your-own-functions.html#cb1049-3"></a><span class="kw">increment_not_opaque</span>(<span class="dv">10</span>, <span class="dv">34</span>)</span></code></pre></div>
<pre><code>## [1] 44</code></pre>
<p>This is because the variable <code>spam</code> defined in the body of the function is a local variable. It
could have been called anything else, really. Avoiding opaque functions makes our life easier.</p>
<p>Another property that adepts of functional programming value is that functions should have no, or
very limited, side-effects. This means that functions should not change the state of your program.</p>
<p>For example this function (which is not a referential transparent function):</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="defining-your-own-functions.html#cb1051-1"></a>count_iter &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb1051-2"><a href="defining-your-own-functions.html#cb1051-2"></a></span>
<span id="cb1051-3"><a href="defining-your-own-functions.html#cb1051-3"></a>sqrt_newton_side_effect &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">eps =</span> <span class="fl">0.01</span>){</span>
<span id="cb1051-4"><a href="defining-your-own-functions.html#cb1051-4"></a>    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</span>
<span id="cb1051-5"><a href="defining-your-own-functions.html#cb1051-5"></a>        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</span>
<span id="cb1051-6"><a href="defining-your-own-functions.html#cb1051-6"></a>        count_iter &lt;&lt;-<span class="st"> </span>count_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="co"># The &quot;&lt;&lt;-&quot; symbol means that we assign the</span></span>
<span id="cb1051-7"><a href="defining-your-own-functions.html#cb1051-7"></a>    }                                 <span class="co"># RHS value in a variable inside the global environment</span></span>
<span id="cb1051-8"><a href="defining-your-own-functions.html#cb1051-8"></a>    init</span>
<span id="cb1051-9"><a href="defining-your-own-functions.html#cb1051-9"></a>}</span></code></pre></div>
<p>If you look in the environment pane, you will see that <code>count_iter</code> equals 0. Now call this
function with the following arguments:</p>
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="defining-your-own-functions.html#cb1052-1"></a><span class="kw">sqrt_newton_side_effect</span>(<span class="dv">16000</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 126.4911</code></pre>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="defining-your-own-functions.html#cb1054-1"></a><span class="kw">print</span>(count_iter)</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>If you check the value of <code>count_iter</code> now, you will see that it increased! This is a side effect,
because the function changed something outside of its scope. It changed a value in the global
environment. In general, it is good practice to avoid side-effects. For example, we could make the
above function not have any side effects like this:</p>
<div class="sourceCode" id="cb1056"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1056-1"><a href="defining-your-own-functions.html#cb1056-1"></a>sqrt_newton_count &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">count_iter =</span> <span class="dv">0</span>, <span class="dt">eps =</span> <span class="fl">0.01</span>){</span>
<span id="cb1056-2"><a href="defining-your-own-functions.html#cb1056-2"></a>    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</span>
<span id="cb1056-3"><a href="defining-your-own-functions.html#cb1056-3"></a>        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</span>
<span id="cb1056-4"><a href="defining-your-own-functions.html#cb1056-4"></a>        count_iter &lt;-<span class="st"> </span>count_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb1056-5"><a href="defining-your-own-functions.html#cb1056-5"></a>    }</span>
<span id="cb1056-6"><a href="defining-your-own-functions.html#cb1056-6"></a>    <span class="kw">c</span>(init, count_iter)</span>
<span id="cb1056-7"><a href="defining-your-own-functions.html#cb1056-7"></a>}</span></code></pre></div>
<p>Now, this function returns a list with two elements, the result, and the number of iterations it
took to get the result:</p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="defining-your-own-functions.html#cb1057-1"></a><span class="kw">sqrt_newton_count</span>(<span class="dv">16000</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 126.4911   9.0000</code></pre>
<p>Writing to disk is also considered a side effect, because the function changes something (a file)
outside its scope. But this cannot be avoided since you <em>want</em> to write to disk.
Just remember: try to avoid having functions changing variables in the global environment unless
you have a very good reason of doing so.</p>
<p>Very long scripts that don‚Äôt use functions and use a lot of global variables with loops changing
the values of global variables are a nightmare to debug. If something goes wrong, it might be very
difficult to pinpoint where the problem is. Is there an error in one of the loops?
Is your code running for a particular value of a particular variable in the global environment, but
not for other values? Which values? And of which variables? It can be very difficult to know what
is wrong with such a script.
With functional programming, you can avoid a lot of this pain for free (well not entirely for free,
it still requires some effort, since R is not a pure functional language). Writing functions also
makes it easier to parallelize your code. We are going to learn about that later in this chapter too.</p>
<p>Finally, another property of mathematical functions, is that they do one single thing. Functional
programming purists also program their functions to do one single task. This has benefits, but
can complicate things. The function we wrote previously does two things: it computes the square
root of a number and also returns the number of iterations it took to compute the result. However,
this is not a bad thing; the function is doing two tasks, but these tasks are related to each other
and it makes sense to have them together. My piece of advice: avoid having functions that do
many <em>unrelated</em> things. This makes debugging harder.</p>
<p>In conclusion: you should strive for referential transparency, try to avoid side effects unless you
have a good reason to have them and try to keep your functions short and do as little tasks as
possible. This makes testing and debugging easier, as you will see in the next chapter, but also
improves readability and maintainability of your code.</p>
</div>
<div id="functional-programming-with-purrr" class="section level2" number="7.11">
<h2><span class="header-section-number">7.11</span> Functional programming with <code>{purrr}</code></h2>
<p>I mentioned it several times already, but R is not a pure functional programming language. It is
possible to write R code using the functional programming paradigm, but some effort is required.
The <code>{purrr}</code> package extends R‚Äôs base functional programming capabilities with some very interesting
functions. We have already seen <code>map()</code> and <code>reduce()</code>, which we are going to see in more detail now.
Then, we are going to learn about some other functions included in <code>{purrr}</code> that make functional
programming easier in R.</p>
<div id="doing-away-with-loops-the-map-family-of-functions" class="section level3" number="7.11.1">
<h3><span class="header-section-number">7.11.1</span> Doing away with loops: the <code>map*()</code> family of functions</h3>
<p>Instead of using loops, pure functional programming languages use functions that achieve
the same result. These functions are often called <code>Map</code> or <code>Reduce</code> (also called <code>Fold</code>). R comes
with the <code>*apply()</code> family of functions (which are implementations of <code>Map</code>),
as well as <code>Reduce()</code> for functional programming.</p>
<p>Within this family, you can find <code>lapply()</code>, <code>sapply()</code>, <code>vapply()</code>, <code>tapply()</code>, <code>mapply()</code>, <code>rapply()</code>,
<code>eapply()</code> and <code>apply()</code> (I might have forgotten one or the other, but that‚Äôs not important).
Each version of an <code>*apply()</code> function has a different purpose, but it is not very easy to
remember which does what exactly. To add even more confusion, the arguments are sometimes different between
each of these.</p>
<p>In the <code>{purrr}</code> package, these functions are replaced by the <code>map*()</code> family of functions. As you will
shortly see, they are very consistent, and thus easier to use.
The first part of these functions‚Äô names all start with <code>map_</code> and the second part tells you what
this function is going to return. For example, if you want <code>double</code>s out, you would use <code>map_dbl()</code>.
If you are working on data frames and want a data frame back, you would use <code>map_df()</code>. Let‚Äôs start
with the basic <code>map()</code> function. The following gif
(source: <a href="https://en.wikipedia.org/wiki/Map_(higher-order_function)">Wikipedia</a>) illustrates
what <code>map()</code> does fairly well:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/0/06/Mapping-steps-loillibe-new.gif" /><!-- --></p>
<p><span class="math inline">\(X\)</span> is a vector composed of the following scalars: <span class="math inline">\((0, 5, 8, 3, 2, 1)\)</span>. The function we want to
map to each element of <span class="math inline">\(X\)</span> is <span class="math inline">\(f(x) = x + 1\)</span>. <span class="math inline">\(X&#39;\)</span> is the result of this operation. Using R, we
would do the following:</p>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1059-1"><a href="defining-your-own-functions.html#cb1059-1"></a><span class="kw">library</span>(<span class="st">&quot;purrr&quot;</span>)</span>
<span id="cb1059-2"><a href="defining-your-own-functions.html#cb1059-2"></a>numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1059-3"><a href="defining-your-own-functions.html#cb1059-3"></a></span>
<span id="cb1059-4"><a href="defining-your-own-functions.html#cb1059-4"></a>plus_one &lt;-<span class="st"> </span><span class="cf">function</span>(x) (x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb1059-5"><a href="defining-your-own-functions.html#cb1059-5"></a></span>
<span id="cb1059-6"><a href="defining-your-own-functions.html#cb1059-6"></a>my_results &lt;-<span class="st"> </span><span class="kw">map</span>(numbers, plus_one)</span>
<span id="cb1059-7"><a href="defining-your-own-functions.html#cb1059-7"></a></span>
<span id="cb1059-8"><a href="defining-your-own-functions.html#cb1059-8"></a>my_results</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 6
## 
## [[3]]
## [1] 9
## 
## [[4]]
## [1] 4
## 
## [[5]]
## [1] 3
## 
## [[6]]
## [1] 2</code></pre>
<p>Using a loop, you would write:</p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1061-1"><a href="defining-your-own-functions.html#cb1061-1"></a>numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1061-2"><a href="defining-your-own-functions.html#cb1061-2"></a></span>
<span id="cb1061-3"><a href="defining-your-own-functions.html#cb1061-3"></a>plus_one &lt;-<span class="st"> </span><span class="cf">function</span>(x) (x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb1061-4"><a href="defining-your-own-functions.html#cb1061-4"></a></span>
<span id="cb1061-5"><a href="defining-your-own-functions.html#cb1061-5"></a>my_results &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dv">6</span>)</span>
<span id="cb1061-6"><a href="defining-your-own-functions.html#cb1061-6"></a></span>
<span id="cb1061-7"><a href="defining-your-own-functions.html#cb1061-7"></a><span class="cf">for</span>(number <span class="cf">in</span> <span class="kw">seq_along</span>(numbers)){</span>
<span id="cb1061-8"><a href="defining-your-own-functions.html#cb1061-8"></a>  my_results[[number]] &lt;-<span class="st"> </span><span class="kw">plus_one</span>(number)</span>
<span id="cb1061-9"><a href="defining-your-own-functions.html#cb1061-9"></a>}</span>
<span id="cb1061-10"><a href="defining-your-own-functions.html#cb1061-10"></a></span>
<span id="cb1061-11"><a href="defining-your-own-functions.html#cb1061-11"></a>my_results</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2
## 
## [[2]]
## [1] 3
## 
## [[3]]
## [1] 4
## 
## [[4]]
## [1] 5
## 
## [[5]]
## [1] 6
## 
## [[6]]
## [1] 7</code></pre>
<p>Now I don‚Äôt know about you, but I prefer the first option. Using functional programming, you don‚Äôt
need to create an empty list to hold your results, and the code is more concise. Plus,
it is less error prone. I had to try several times to get the loop right
(and I‚Äôve using R for almost 10 years now). Why? Well, first of all I used <code>%in%</code> instead of <code>in</code>.
Then, I forgot about <code>seq_along()</code>. After that, I made a typo, <code>plos_one()</code> instead of <code>plus_one()</code>
(ok, that one is unrelated to the loop). Let‚Äôs also see how this works using base R:</p>
<div class="sourceCode" id="cb1063"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1063-1"><a href="defining-your-own-functions.html#cb1063-1"></a>numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1063-2"><a href="defining-your-own-functions.html#cb1063-2"></a></span>
<span id="cb1063-3"><a href="defining-your-own-functions.html#cb1063-3"></a>plus_one &lt;-<span class="st"> </span><span class="cf">function</span>(x) (x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb1063-4"><a href="defining-your-own-functions.html#cb1063-4"></a></span>
<span id="cb1063-5"><a href="defining-your-own-functions.html#cb1063-5"></a>my_results &lt;-<span class="st"> </span><span class="kw">lapply</span>(numbers, plus_one)</span>
<span id="cb1063-6"><a href="defining-your-own-functions.html#cb1063-6"></a></span>
<span id="cb1063-7"><a href="defining-your-own-functions.html#cb1063-7"></a>my_results</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 6
## 
## [[3]]
## [1] 9
## 
## [[4]]
## [1] 4
## 
## [[5]]
## [1] 3
## 
## [[6]]
## [1] 2</code></pre>
<p>So what is the added value of using <code>{purrr}</code>, you might ask. Well, imagine that instead of a list,
I need to an atomic vector of <code>numeric</code>s. This is fairly easy with <code>{purrr}</code>:</p>
<div class="sourceCode" id="cb1065"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1065-1"><a href="defining-your-own-functions.html#cb1065-1"></a><span class="kw">library</span>(<span class="st">&quot;purrr&quot;</span>)</span>
<span id="cb1065-2"><a href="defining-your-own-functions.html#cb1065-2"></a>numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1065-3"><a href="defining-your-own-functions.html#cb1065-3"></a></span>
<span id="cb1065-4"><a href="defining-your-own-functions.html#cb1065-4"></a>plus_one &lt;-<span class="st"> </span><span class="cf">function</span>(x) (x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb1065-5"><a href="defining-your-own-functions.html#cb1065-5"></a></span>
<span id="cb1065-6"><a href="defining-your-own-functions.html#cb1065-6"></a>my_results &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(numbers, plus_one)</span>
<span id="cb1065-7"><a href="defining-your-own-functions.html#cb1065-7"></a></span>
<span id="cb1065-8"><a href="defining-your-own-functions.html#cb1065-8"></a>my_results</span></code></pre></div>
<pre><code>## [1] 1 6 9 4 3 2</code></pre>
<p>We‚Äôre going to discuss these functions below, but know that in base R, outputting something else
involves more effort.</p>
<p>Let‚Äôs go back to our <code>sqrt_newton()</code> function. This function has more than one parameter. Often,
we would like to map functions with more than one parameter to a list, while holding constant
some of the functions parameters. This is easily achieved like so:</p>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1067-1"><a href="defining-your-own-functions.html#cb1067-1"></a><span class="kw">library</span>(<span class="st">&quot;purrr&quot;</span>)</span>
<span id="cb1067-2"><a href="defining-your-own-functions.html#cb1067-2"></a>numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">19</span>, <span class="dv">64</span>)</span>
<span id="cb1067-3"><a href="defining-your-own-functions.html#cb1067-3"></a></span>
<span id="cb1067-4"><a href="defining-your-own-functions.html#cb1067-4"></a><span class="kw">map</span>(numbers, sqrt_newton, <span class="dt">init =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2.645767
## 
## [[2]]
## [1] 2.828469
## 
## [[3]]
## [1] 4.358902
## 
## [[4]]
## [1] 8.000002</code></pre>
<p>It is also possible to use a formula:</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="defining-your-own-functions.html#cb1069-1"></a><span class="kw">library</span>(<span class="st">&quot;purrr&quot;</span>)</span>
<span id="cb1069-2"><a href="defining-your-own-functions.html#cb1069-2"></a>numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">19</span>, <span class="dv">64</span>)</span>
<span id="cb1069-3"><a href="defining-your-own-functions.html#cb1069-3"></a></span>
<span id="cb1069-4"><a href="defining-your-own-functions.html#cb1069-4"></a><span class="kw">map</span>(numbers, <span class="op">~</span><span class="kw">sqrt_newton</span>(., <span class="dt">init =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2.645767
## 
## [[2]]
## [1] 2.828469
## 
## [[3]]
## [1] 4.358902
## 
## [[4]]
## [1] 8.000002</code></pre>
<p>Another function that is similar to <code>map()</code> is <code>rerun()</code>. You guessed it, this one simply
reruns an expression:</p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="defining-your-own-functions.html#cb1071-1"></a><span class="kw">rerun</span>(<span class="dv">10</span>, <span class="st">&quot;hello&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;hello&quot;
## 
## [[2]]
## [1] &quot;hello&quot;
## 
## [[3]]
## [1] &quot;hello&quot;
## 
## [[4]]
## [1] &quot;hello&quot;
## 
## [[5]]
## [1] &quot;hello&quot;
## 
## [[6]]
## [1] &quot;hello&quot;
## 
## [[7]]
## [1] &quot;hello&quot;
## 
## [[8]]
## [1] &quot;hello&quot;
## 
## [[9]]
## [1] &quot;hello&quot;
## 
## [[10]]
## [1] &quot;hello&quot;</code></pre>
<p><code>rerun()</code> simply runs an expression (which can be arbitrarily complex) <code>n</code> times, whereas <code>map()</code>
maps a function to a list of inputs, so to achieve the same with <code>map()</code>, you need to map the <code>print()</code>
function to a vector of characters:</p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="defining-your-own-functions.html#cb1073-1"></a><span class="kw">map</span>(<span class="kw">rep</span>(<span class="st">&quot;hello&quot;</span>, <span class="dv">10</span>), print)</span></code></pre></div>
<pre><code>## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;</code></pre>
<pre><code>## [[1]]
## [1] &quot;hello&quot;
## 
## [[2]]
## [1] &quot;hello&quot;
## 
## [[3]]
## [1] &quot;hello&quot;
## 
## [[4]]
## [1] &quot;hello&quot;
## 
## [[5]]
## [1] &quot;hello&quot;
## 
## [[6]]
## [1] &quot;hello&quot;
## 
## [[7]]
## [1] &quot;hello&quot;
## 
## [[8]]
## [1] &quot;hello&quot;
## 
## [[9]]
## [1] &quot;hello&quot;
## 
## [[10]]
## [1] &quot;hello&quot;</code></pre>
<p><code>rep()</code> is a function that creates a vector by repeating something, in this case the string ‚Äúhello‚Äù,
as many times as needed, here 10. The output here is a bit different that before though, because first
you will see ‚Äúhello‚Äù printed 10 times and then the list where each element is ‚Äúhello‚Äù.
This is because the <code>print()</code> function has a side effect, which is, well printing to the console.
We see this side effect 10 times, plus then the list created with <code>map()</code>.</p>
<p><code>rerun()</code> is useful if you want to run simulation. For instance, let‚Äôs suppose that I perform a simulation
where I throw a die 5 times, and compute the mean of the points obtained, as well as the variance:</p>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1076-1"><a href="defining-your-own-functions.html#cb1076-1"></a>mean_var_throws &lt;-<span class="st"> </span><span class="cf">function</span>(n){</span>
<span id="cb1076-2"><a href="defining-your-own-functions.html#cb1076-2"></a>  throws &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, n, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1076-3"><a href="defining-your-own-functions.html#cb1076-3"></a></span>
<span id="cb1076-4"><a href="defining-your-own-functions.html#cb1076-4"></a>  mean_throws &lt;-<span class="st"> </span><span class="kw">mean</span>(throws)</span>
<span id="cb1076-5"><a href="defining-your-own-functions.html#cb1076-5"></a>  var_throws &lt;-<span class="st"> </span><span class="kw">var</span>(throws)</span>
<span id="cb1076-6"><a href="defining-your-own-functions.html#cb1076-6"></a></span>
<span id="cb1076-7"><a href="defining-your-own-functions.html#cb1076-7"></a>  tibble<span class="op">::</span><span class="kw">tribble</span>(<span class="op">~</span>mean_throws, <span class="op">~</span>var_throws,</span>
<span id="cb1076-8"><a href="defining-your-own-functions.html#cb1076-8"></a>                   mean_throws, var_throws)</span>
<span id="cb1076-9"><a href="defining-your-own-functions.html#cb1076-9"></a>}</span>
<span id="cb1076-10"><a href="defining-your-own-functions.html#cb1076-10"></a></span>
<span id="cb1076-11"><a href="defining-your-own-functions.html#cb1076-11"></a><span class="kw">mean_var_throws</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   mean_throws var_throws
##         &lt;dbl&gt;      &lt;dbl&gt;
## 1         3.2        2.7</code></pre>
<p><code>mean_var_throws()</code> returns a <code>tibble</code> object with mean of points and the variance of the points. Now suppose
I want to compute the expected value of the distribution of throwing dice. We know from theory that it should
be equal to <span class="math inline">\(3.5 (= 1*1/6 + 2*1/6 + 3*1/6 + 4*1/6 + 5*1/6 + 6*1/6)\)</span>.</p>
<p>Let‚Äôs rerun the simulation 50 times:</p>
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1078-1"><a href="defining-your-own-functions.html#cb1078-1"></a>simulations &lt;-<span class="st"> </span><span class="kw">rerun</span>(<span class="dv">50</span>, <span class="kw">mean_var_throws</span>(<span class="dv">5</span>))</span></code></pre></div>
<p>Let‚Äôs see what the <code>simulations</code> object is made of:</p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1079-1"><a href="defining-your-own-functions.html#cb1079-1"></a><span class="kw">str</span>(simulations)</span></code></pre></div>
<pre><code>## List of 50
##  $ :Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    1 obs. of  2 variables:
##   ..$ mean_throws: num 2
##   ..$ var_throws : num 3
##  $ :Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    1 obs. of  2 variables:
##   ..$ mean_throws: num 2.8
##   ..$ var_throws : num 0.2
##  $ :Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    1 obs. of  2 variables:
##   ..$ mean_throws: num 2.8
##   ..$ var_throws : num 0.7
##  $ :Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    1 obs. of  2 variables:
##   ..$ mean_throws: num 2.8
##   ..$ var_throws : num 1.7
.....</code></pre>
<p><code>simulations</code> is a list of 50 data frames. We can easily combine them into a single data frame, and compute the
mean of the means, which should return something close to the expected value of 3.5:</p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1081-1"><a href="defining-your-own-functions.html#cb1081-1"></a><span class="kw">bind_rows</span>(simulations) <span class="op">%&gt;%</span></span>
<span id="cb1081-2"><a href="defining-your-own-functions.html#cb1081-2"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">expected_value =</span> <span class="kw">mean</span>(mean_throws))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   expected_value
##            &lt;dbl&gt;
## 1           3.33</code></pre>
<p>Pretty close! Now of course, one could have simply done something like this:</p>
<div class="sourceCode" id="cb1083"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1083-1"><a href="defining-your-own-functions.html#cb1083-1"></a><span class="kw">mean</span>(<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">1000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] 3.578</code></pre>
<p>but the point was to illustrate that <code>rerun()</code> can run any arbitrarily complex expression, and that it is good
practice to put the result in a data frame or list, for easier further manipulation.</p>
<p>You now know the standard <code>map()</code> function, and also <code>rerun()</code>, which return lists, but there are a
number of variants of this function. <code>map_dbl()</code> returns an atomic vector of doubles, as seen
we‚Äôve seen before. A little reminder below:</p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="defining-your-own-functions.html#cb1085-1"></a><span class="kw">map_dbl</span>(numbers, sqrt_newton, <span class="dt">init =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 2.645767 2.828469 4.358902 8.000002</code></pre>
<p>In a similar fashion, <code>map_chr()</code> returns an atomic vector of strings:</p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="defining-your-own-functions.html#cb1087-1"></a><span class="kw">map_chr</span>(numbers, sqrt_newton, <span class="dt">init =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2.645767&quot; &quot;2.828469&quot; &quot;4.358902&quot; &quot;8.000002&quot;</code></pre>
<p><code>map_lgl()</code> returns an atomic vector of <code>TRUE</code> or <code>FALSE</code>:</p>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="defining-your-own-functions.html#cb1089-1"></a>divisible &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){</span>
<span id="cb1089-2"><a href="defining-your-own-functions.html#cb1089-2"></a>  <span class="kw">if_else</span>(x <span class="op">%%</span><span class="st"> </span>y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</span>
<span id="cb1089-3"><a href="defining-your-own-functions.html#cb1089-3"></a>}</span>
<span id="cb1089-4"><a href="defining-your-own-functions.html#cb1089-4"></a></span>
<span id="cb1089-5"><a href="defining-your-own-functions.html#cb1089-5"></a><span class="kw">map_lgl</span>(<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>), divisible, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   [1] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [13] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [25] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [37] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [49] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [61] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [73] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [85] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [97] FALSE FALSE  TRUE FALSE</code></pre>
<p>There are also other interesting variants, such as <code>map_if()</code>:</p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="defining-your-own-functions.html#cb1091-1"></a>a &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb1091-2"><a href="defining-your-own-functions.html#cb1091-2"></a></span>
<span id="cb1091-3"><a href="defining-your-own-functions.html#cb1091-3"></a><span class="kw">map_if</span>(a, (<span class="cf">function</span>(x) <span class="kw">divisible</span>(x, <span class="dv">2</span>)), sqrt)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 1.414214
## 
## [[3]]
## [1] 3
## 
## [[4]]
## [1] 2
## 
## [[5]]
## [1] 5
## 
## [[6]]
## [1] 2.44949
## 
## [[7]]
## [1] 7
## 
## [[8]]
## [1] 2.828427
## 
## [[9]]
## [1] 9
## 
## [[10]]
## [1] 3.162278</code></pre>
<p>I used <code>map_if()</code> to take the square root of only those numbers in vector <code>a</code> that are divisble by 2,
by using an anonymous function that checks if a number is divisible by 2 (by wrapping <code>divisible()</code>).</p>
<p><code>map_at()</code> is similar to <code>map_if()</code> but maps the function at a position specified by the user:</p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="defining-your-own-functions.html#cb1093-1"></a><span class="kw">map_at</span>(numbers, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), sqrt)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2.645751
## 
## [[2]]
## [1] 8
## 
## [[3]]
## [1] 4.358899
## 
## [[4]]
## [1] 64</code></pre>
<p>or if you have a named list:</p>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="defining-your-own-functions.html#cb1095-1"></a>recipe &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;spam&quot;</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;eggs&quot;</span> =<span class="st"> </span><span class="dv">3</span>, <span class="st">&quot;bacon&quot;</span> =<span class="st"> </span><span class="dv">10</span>)</span>
<span id="cb1095-2"><a href="defining-your-own-functions.html#cb1095-2"></a></span>
<span id="cb1095-3"><a href="defining-your-own-functions.html#cb1095-3"></a><span class="kw">map_at</span>(recipe, <span class="st">&quot;bacon&quot;</span>, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## $spam
## [1] 1
## 
## $eggs
## [1] 3
## 
## $bacon
## [1] 20</code></pre>
<p>I used <code>map_at()</code> to double the quantity of bacon in the recipe (by using the <code>*</code> function, and specifying
its second argument, <code>2</code>. Try the following in the command prompt: <code>`*`(3, 4)</code>).</p>
<p><code>map2()</code> is the equivalent of <code>mapply()</code> and <code>pmap()</code> is the generalisation of <code>map2()</code> for more
than 2 arguments:</p>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="defining-your-own-functions.html#cb1097-1"></a><span class="kw">print</span>(a)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1099-1"><a href="defining-your-own-functions.html#cb1099-1"></a>b &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">10</span>)</span>
<span id="cb1099-2"><a href="defining-your-own-functions.html#cb1099-2"></a></span>
<span id="cb1099-3"><a href="defining-your-own-functions.html#cb1099-3"></a><span class="kw">print</span>(b)</span></code></pre></div>
<pre><code>##  [1] 1.000000 1.111111 1.222222 1.333333 1.444444 1.555556 1.666667 1.777778
##  [9] 1.888889 2.000000</code></pre>
<div class="sourceCode" id="cb1101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1101-1"><a href="defining-your-own-functions.html#cb1101-1"></a><span class="kw">map2</span>(a, b, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2.222222
## 
## [[3]]
## [1] 3.666667
## 
## [[4]]
## [1] 5.333333
## 
## [[5]]
## [1] 7.222222
## 
## [[6]]
## [1] 9.333333
## 
## [[7]]
## [1] 11.66667
## 
## [[8]]
## [1] 14.22222
## 
## [[9]]
## [1] 17
## 
## [[10]]
## [1] 20</code></pre>
<p>Each element of <code>a</code> gets multiplied by the element of <code>b</code> that is in the same position.
Let‚Äôs see what <code>pmap()</code> does. Can you guess from the code below what is going on? I will print
<code>a</code> and <code>b</code> again for clarity:</p>
<div class="sourceCode" id="cb1103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="defining-your-own-functions.html#cb1103-1"></a>a</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb1105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="defining-your-own-functions.html#cb1105-1"></a>b</span></code></pre></div>
<pre><code>##  [1] 1.000000 1.111111 1.222222 1.333333 1.444444 1.555556 1.666667 1.777778
##  [9] 1.888889 2.000000</code></pre>
<div class="sourceCode" id="cb1107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1107-1"><a href="defining-your-own-functions.html#cb1107-1"></a>n &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb1107-2"><a href="defining-your-own-functions.html#cb1107-2"></a></span>
<span id="cb1107-3"><a href="defining-your-own-functions.html#cb1107-3"></a><span class="kw">pmap</span>(<span class="kw">list</span>(a, b, n), rnorm)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.5280967
## 
## [[2]]
## [1] -1.270939  2.311809
## 
## [[3]]
## [1]  1.3947087  5.7967488 -0.3431847
## 
## [[4]]
## [1] 4.84305793 0.08361189 5.88116214 3.25397461
## 
## [[5]]
## [1]  3.770117 11.832005 -3.957980 -1.731193  4.098926
## 
## [[6]]
## [1]  2.1400937  0.1393704 12.1352462 10.2759825  4.4688028 -0.2094596
## 
## [[7]]
## [1]  14.057747   7.430422   6.315045  -1.958189  -4.167744 -10.046114 -11.557698
## 
## [[8]]
## [1] 17.7475507  2.2137185  0.5835247 13.1073284 -3.3987124 -0.8162384  3.8022779
## [8]  2.1491597
## 
## [[9]]
## [1]   9.2225601   0.1596010 -14.6581525   8.2725150 -18.5914485  -2.5777416
## [7]   0.1888828  18.6061008  -1.1331377
## 
## [[10]]
##  [1] -7.792564  1.903289 10.412377 11.689196  9.696147 -1.231598  3.400830
##  [8] -7.615827 11.484893 -3.031786</code></pre>
<p>Let‚Äôs take a closer look at what <code>a</code>, <code>b</code> and <code>n</code> look like, when they are place next to each other:</p>
<div class="sourceCode" id="cb1109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1109-1"><a href="defining-your-own-functions.html#cb1109-1"></a><span class="kw">cbind</span>(a, b, n)</span></code></pre></div>
<pre><code>##        a        b  n
##  [1,]  1 1.000000  1
##  [2,]  2 1.111111  2
##  [3,]  3 1.222222  3
##  [4,]  4 1.333333  4
##  [5,]  5 1.444444  5
##  [6,]  6 1.555556  6
##  [7,]  7 1.666667  7
##  [8,]  8 1.777778  8
##  [9,]  9 1.888889  9
## [10,] 10 2.000000 10</code></pre>
<p><code>rnorm()</code> gets first called with the parameters from the first line, meaning
<code>rnorm(a[1], b[1], n[1])</code>. The second time <code>rnorm()</code> gets called, you guessed it,
it with the parameters on the second line of the array above,
<code>rnorm(a[2], b[2], n[2])</code>, etc.</p>
<p>There are other functions in the <code>map()</code> family of functions, but we will discover them in the
exercises!</p>
<p>The <code>map()</code> family of functions does not have any more secrets for you. Let‚Äôs now take a look at
the <code>reduce()</code> family of functions.</p>
</div>
<div id="reducing-with-purrr" class="section level3" number="7.11.2">
<h3><span class="header-section-number">7.11.2</span> Reducing with <code>purrr</code></h3>
<p>Reducing is another important concept in functional programming. It allows going from a list of
elements, to a single element, by somehow <em>combining</em> the elements into one. For instance, using
the base R <code>Reduce()</code> function, you can sum the elements of a list like so:</p>
<div class="sourceCode" id="cb1111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1111-1"><a href="defining-your-own-functions.html#cb1111-1"></a><span class="kw">Reduce</span>(<span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>))</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>using <code>purrr::reduce()</code>, this becomes:</p>
<div class="sourceCode" id="cb1113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1113-1"><a href="defining-your-own-functions.html#cb1113-1"></a><span class="kw">reduce</span>(<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>), <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>If you don‚Äôt really get what happening, don‚Äôt worry. Things should get clearer once I‚Äôll introduce
another version of <code>reduce()</code>, called <code>accumulate()</code>, which we will see below.</p>
<p>Sometimes, the direction from which we start to reduce is quite important. You can ‚Äústart from the
end‚Äù of the list by using the <code>.dir</code> argument:</p>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="defining-your-own-functions.html#cb1115-1"></a><span class="kw">reduce</span>(<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>), <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dt">.dir =</span> <span class="st">&quot;backward&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>Of course, for commutative operations, direction does not matter. But it does matter for non-commutative
operations:</p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="defining-your-own-functions.html#cb1117-1"></a><span class="kw">reduce</span>(<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>), <span class="st">`</span><span class="dt">-</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] -5048</code></pre>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="defining-your-own-functions.html#cb1119-1"></a><span class="kw">reduce</span>(<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>), <span class="st">`</span><span class="dt">-</span><span class="st">`</span>, <span class="dt">.dir =</span> <span class="st">&quot;backward&quot;</span>)</span></code></pre></div>
<pre><code>## [1] -50</code></pre>
<p>Let‚Äôs now take a look at <code>accumulate()</code>. <code>accumulate()</code> is very similar to <code>map()</code>, but keeps the
intermediary results. Which intermediary results? Let‚Äôs try and see what happens:</p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="defining-your-own-functions.html#cb1121-1"></a>a &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb1121-2"><a href="defining-your-own-functions.html#cb1121-2"></a></span>
<span id="cb1121-3"><a href="defining-your-own-functions.html#cb1121-3"></a><span class="kw">accumulate</span>(a, <span class="st">`</span><span class="dt">-</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>##  [1]   1  -1  -4  -8 -13 -19 -26 -34 -43 -53</code></pre>
<p><code>accumulate()</code> illustrates pretty well what is happening; the first element, <code>1</code>, is simply the
first element of <code>seq(1, 10)</code>. The second element of the result however, is the difference between
<code>1</code> and <code>2</code>, <code>-1</code>. The next element in <code>a</code> is <code>3</code>. Thus the next result is <code>-1-3</code>, <code>-4</code>, and so
on until we run out of elements in <code>a</code>.</p>
<p>The below illustration shows the algorithm step-by-step:</p>
<pre><code>(1-2-3-4-5-6-7-8-9-10)
((1)-2-3-4-5-6-7-8-9-10)
((1-2)-3-4-5-6-7-8-9-10)
((-1-3)-4-5-6-7-8-9-10)
((-4-4)-5-6-7-8-9-10)
((-8-5)-6-7-8-9-10)
((-13-6)-7-8-9-10)
((-19-7)-8-9-10)
((-26-8)-9-10)
((-34-9)-10)
(-43-10)
-53</code></pre>
<p><code>reduce()</code> only shows the final result of all these operations. <code>accumulate()</code> and <code>reduce()</code> also
have an <code>.init</code> argument, that makes it possible to start the reducing procedure from an initial
value that is different from the first element of the vector:</p>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1124-1"><a href="defining-your-own-functions.html#cb1124-1"></a><span class="kw">reduce</span>(a, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dt">.init =</span> <span class="dv">1000</span>)</span>
<span id="cb1124-2"><a href="defining-your-own-functions.html#cb1124-2"></a></span>
<span id="cb1124-3"><a href="defining-your-own-functions.html#cb1124-3"></a><span class="kw">accumulate</span>(a, <span class="st">`</span><span class="dt">-</span><span class="st">`</span>, <span class="dt">.init =</span> <span class="dv">1000</span>, <span class="dt">.dir =</span> <span class="st">&quot;backward&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 1055</code></pre>
<pre><code>##  [1]  995 -994  996 -993  997 -992  998 -991  999 -990 1000</code></pre>
<p><code>map()</code> and <code>reduce()</code> are arguably the most useful higher-order functions, and perhaps also the
most famous one, true ambassadors of functional programming. You might have read about
<a href="https://en.wikipedia.org/wiki/MapReduce">MapReduce</a>, a programming model for processing big
data in parallel. The way MapReduce works is inspired by both these <code>map()</code> and <code>reduce()</code> functions,
which are always included in functional programming languages. This illustrates that the functional
programming paradigm is very well suited to parallel computing. In the next chapter, we are going
to explore parallel computing with the <code>{furrr}</code> package; as you will see, once you know about
functional programming and are familiar with <code>{purrr}</code>, parallelizing your code with <code>{furrr}</code> is
trivial.</p>
<p>Something else that is very important to understand at this point; up until now, we only used these
functions on lists, or atomic vectors, of numbers. However, <code>map()</code> and <code>reduce()</code>, and other
higher-order functions for that matter, do not care about the contents of the list. What these
functions do, is take another functions, and make it do something to the elements of the list.
It does not matter if it‚Äôs a list of numbers, of characters, of data frames, even of models. All that
matters is that the function that will be applied to these elements, can operate on them.
So if you have a list of fitted models, you can map <code>summary()</code> on this list to get the results of
each model. Or if you have a list of data frames, you can map a function that performs several
cleaning steps. This will be explored in a future section, but it is important to keep this in mind.</p>
</div>
<div id="error-handling-with-safely-and-possibly" class="section level3" number="7.11.3">
<h3><span class="header-section-number">7.11.3</span> Error handling with <code>safely()</code> and <code>possibly()</code></h3>
<p><code>safely()</code> and <code>possibly()</code> are very useful functions. Consider the following situation:</p>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="defining-your-own-functions.html#cb1127-1"></a>a &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb1127-2"><a href="defining-your-own-functions.html#cb1127-2"></a></span>
<span id="cb1127-3"><a href="defining-your-own-functions.html#cb1127-3"></a><span class="kw">sqrt</span>(a)</span></code></pre></div>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="defining-your-own-functions.html#cb1128-1"></a>Error <span class="cf">in</span> <span class="kw">sqrt</span>(a) <span class="op">:</span><span class="st"> </span>non<span class="op">-</span>numeric argument to mathematical <span class="cf">function</span></span></code></pre></div>
<p>Using <code>map()</code> or <code>Map()</code> will result in a similar error. <code>safely()</code> is an higher-order function that
takes one function as an argument and executes it‚Ä¶ <em>safely</em>, meaning the execution of the function
will not stop if there is an error. The error message gets captured alongside valid results.</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1129-1"><a href="defining-your-own-functions.html#cb1129-1"></a>a &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb1129-2"><a href="defining-your-own-functions.html#cb1129-2"></a></span>
<span id="cb1129-3"><a href="defining-your-own-functions.html#cb1129-3"></a>safe_sqrt &lt;-<span class="st"> </span><span class="kw">safely</span>(sqrt)</span>
<span id="cb1129-4"><a href="defining-your-own-functions.html#cb1129-4"></a></span>
<span id="cb1129-5"><a href="defining-your-own-functions.html#cb1129-5"></a><span class="kw">map</span>(a, safe_sqrt)</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$result
## NULL
## 
## [[1]]$error
## &lt;simpleError in .Primitive(&quot;sqrt&quot;)(x): non-numeric argument to mathematical function&gt;
## 
## 
## [[2]]
## [[2]]$result
## [1] 2
## 
## [[2]]$error
## NULL
## 
## 
## [[3]]
## [[3]]$result
## [1] 2.236068
## 
## [[3]]$error
## NULL</code></pre>
<p><code>possibly()</code> works similarly, but also allows you to specify a return value in case of an error:</p>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1131-1"><a href="defining-your-own-functions.html#cb1131-1"></a>possible_sqrt &lt;-<span class="st"> </span><span class="kw">possibly</span>(sqrt, <span class="dt">otherwise =</span> <span class="ot">NA_real_</span>)</span>
<span id="cb1131-2"><a href="defining-your-own-functions.html#cb1131-2"></a></span>
<span id="cb1131-3"><a href="defining-your-own-functions.html#cb1131-3"></a><span class="kw">map</span>(a, possible_sqrt)</span></code></pre></div>
<pre><code>## [[1]]
## [1] NA
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 2.236068</code></pre>
<p>Of course, in this particular example, the same effect could be obtained way more easily:</p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="defining-your-own-functions.html#cb1133-1"></a><span class="kw">sqrt</span>(<span class="kw">as.numeric</span>(a))</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>## [1]       NA 2.000000 2.236068</code></pre>
<p>However, in some situations, this trick does not work as intended (or at all). <code>possibly()</code> and
<code>safely()</code> allow the programmer to model errors explicitly, and to then provide a consistent way
of dealing with them. For instance, consider the following example:</p>
<div class="sourceCode" id="cb1136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1136-1"><a href="defining-your-own-functions.html#cb1136-1"></a><span class="kw">data</span>(mtcars)</span>
<span id="cb1136-2"><a href="defining-your-own-functions.html#cb1136-2"></a></span>
<span id="cb1136-3"><a href="defining-your-own-functions.html#cb1136-3"></a><span class="kw">write.csv</span>(mtcars, <span class="st">&quot;my_data/mtcars.csv&quot;</span>)</span></code></pre></div>
<pre><code>Error in file(file, ifelse(append, &quot;a&quot;, &quot;w&quot;)) : 
  cannot open the connection
In addition: Warning message:
In file(file, ifelse(append, &quot;a&quot;, &quot;w&quot;)) :
  cannot open file &#39;my_data/mtcars.csv&#39;: No such file or directory</code></pre>
<p>The folder <code>path/to/save/</code> does not exist, and as such this code produces an error. You might
want to catch this error, and create the directory for instance:</p>
<div class="sourceCode" id="cb1138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1138-1"><a href="defining-your-own-functions.html#cb1138-1"></a>possibly_write.csv &lt;-<span class="st"> </span><span class="kw">possibly</span>(write.csv, <span class="dt">otherwise =</span> <span class="ot">NULL</span>)</span>
<span id="cb1138-2"><a href="defining-your-own-functions.html#cb1138-2"></a></span>
<span id="cb1138-3"><a href="defining-your-own-functions.html#cb1138-3"></a><span class="cf">if</span>(<span class="kw">is.null</span>(<span class="kw">possibly_write.csv</span>(mtcars, <span class="st">&quot;my_data/mtcars.csv&quot;</span>))) {</span>
<span id="cb1138-4"><a href="defining-your-own-functions.html#cb1138-4"></a>  <span class="kw">print</span>(<span class="st">&quot;Creating folder...&quot;</span>)</span>
<span id="cb1138-5"><a href="defining-your-own-functions.html#cb1138-5"></a>  <span class="kw">dir.create</span>(<span class="st">&quot;my_data/&quot;</span>)</span>
<span id="cb1138-6"><a href="defining-your-own-functions.html#cb1138-6"></a>  <span class="kw">print</span>(<span class="st">&quot;Saving file...&quot;</span>)</span>
<span id="cb1138-7"><a href="defining-your-own-functions.html#cb1138-7"></a>  <span class="kw">write.csv</span>(mtcars, <span class="st">&quot;my_data/mtcars.csv&quot;</span>)</span>
<span id="cb1138-8"><a href="defining-your-own-functions.html#cb1138-8"></a>}</span></code></pre></div>
<pre><code>[1] &quot;Creating folder...&quot;
[1] &quot;Saving file...&quot;
Warning message:
In file(file, ifelse(append, &quot;a&quot;, &quot;w&quot;)) :
  cannot open file &#39;my_data/mtcars.csv&#39;: No such file or directory</code></pre>
<p>The warning message comes from the first time we try to write the <code>.csv</code>, inside the <code>if</code>
statement. In the exercises, you‚Äôll discover <code>quietly()</code>, which also captures warnings and messages.</p>
</div>
<div id="partial-applications-with-partial" class="section level3" number="7.11.4">
<h3><span class="header-section-number">7.11.4</span> Partial applications with <code>partial()</code></h3>
<p>Consider the following simple function:</p>
<div class="sourceCode" id="cb1140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1140-1"><a href="defining-your-own-functions.html#cb1140-1"></a>add &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) a<span class="op">+</span>b</span></code></pre></div>
<p>It is possible to create a new function, where one of the parameters is fixed, for instance, where
<code>a = 10</code>:</p>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="defining-your-own-functions.html#cb1141-1"></a>add_to_<span class="dv">10</span> &lt;-<span class="st"> </span><span class="kw">partial</span>(add, <span class="dt">a =</span> <span class="dv">10</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1142-1"><a href="defining-your-own-functions.html#cb1142-1"></a><span class="kw">add_to_10</span>(<span class="dv">12</span>)</span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<p>This is equivalent to the following:</p>
<div class="sourceCode" id="cb1144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1144-1"><a href="defining-your-own-functions.html#cb1144-1"></a>add_to_<span class="dv">10</span>_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(b){</span>
<span id="cb1144-2"><a href="defining-your-own-functions.html#cb1144-2"></a>  <span class="kw">add</span>(<span class="dt">a =</span> <span class="dv">10</span>, b)</span>
<span id="cb1144-3"><a href="defining-your-own-functions.html#cb1144-3"></a>}</span></code></pre></div>
<p>Using <code>partial()</code> is much less verbose however, and allowing you to define new functions very quickly:</p>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="defining-your-own-functions.html#cb1145-1"></a>head10 &lt;-<span class="st"> </span><span class="kw">partial</span>(head, <span class="dt">n =</span> <span class="dv">10</span>)</span>
<span id="cb1145-2"><a href="defining-your-own-functions.html#cb1145-2"></a></span>
<span id="cb1145-3"><a href="defining-your-own-functions.html#cb1145-3"></a><span class="kw">head10</span>(mtcars)</span></code></pre></div>
<pre><code>##                    mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360        14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D         24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230          22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280          19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4</code></pre>
</div>
<div id="function-composition-using-compose" class="section level3" number="7.11.5">
<h3><span class="header-section-number">7.11.5</span> Function composition using <code>compose</code></h3>
<p>Function composition is another handy tool, which makes chaining equation much more elegant:</p>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1147-1"><a href="defining-your-own-functions.html#cb1147-1"></a><span class="kw">compose</span>(sqrt, log10, exp)(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 2.083973</code></pre>
<p>The above expression is equivalent to:</p>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1149-1"><a href="defining-your-own-functions.html#cb1149-1"></a><span class="kw">sqrt</span>(<span class="kw">log10</span>(<span class="kw">exp</span>(<span class="dv">10</span>)))</span></code></pre></div>
<pre><code>## [1] 2.083973</code></pre>
<p>It is also possible to reverse the order the functions get called:</p>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1151-1"><a href="defining-your-own-functions.html#cb1151-1"></a><span class="kw">compose</span>(sqrt, log10, exp)(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 2.083973</code></pre>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="defining-your-own-functions.html#cb1153-1"></a><span class="kw">compose</span>(sqrt, log10, exp, <span class="dt">.dir=</span><span class="st">&quot;forward&quot;</span>)(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 1.648721</code></pre>
<p>One could also use the <code>%&gt;%</code> operator:</p>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1155-1"><a href="defining-your-own-functions.html#cb1155-1"></a><span class="dv">10</span> <span class="op">%&gt;%</span></span>
<span id="cb1155-2"><a href="defining-your-own-functions.html#cb1155-2"></a><span class="st">  </span>sqrt <span class="op">%&gt;%</span></span>
<span id="cb1155-3"><a href="defining-your-own-functions.html#cb1155-3"></a><span class="st">  </span>log10 <span class="op">%&gt;%</span></span>
<span id="cb1155-4"><a href="defining-your-own-functions.html#cb1155-4"></a><span class="st">  </span>exp</span></code></pre></div>
<pre><code>## [1] 1.648721</code></pre>
</div>
<div id="transposing-lists" class="section level3" number="7.11.6">
<h3><span class="header-section-number">7.11.6</span> ¬´Transposing lists¬ª</h3>
<p>Another interesting function is <code>transpose()</code>. It is not an alternative to the function <code>t()</code> from
<code>base</code> but, has a similar effect. <code>transpose()</code> works on lists. Let‚Äôs take a look at the example
from before:</p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="defining-your-own-functions.html#cb1157-1"></a>safe_sqrt &lt;-<span class="st"> </span><span class="kw">safely</span>(sqrt, <span class="dt">otherwise =</span> <span class="ot">NA_real_</span>)</span>
<span id="cb1157-2"><a href="defining-your-own-functions.html#cb1157-2"></a></span>
<span id="cb1157-3"><a href="defining-your-own-functions.html#cb1157-3"></a><span class="kw">map</span>(a, safe_sqrt)</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$result
## [1] NA
## 
## [[1]]$error
## &lt;simpleError in .Primitive(&quot;sqrt&quot;)(x): non-numeric argument to mathematical function&gt;
## 
## 
## [[2]]
## [[2]]$result
## [1] 2
## 
## [[2]]$error
## NULL
## 
## 
## [[3]]
## [[3]]$result
## [1] 2.236068
## 
## [[3]]$error
## NULL</code></pre>
<p>The output is a list with the first element being a list with a result and an error message. One
might want to have all the results in a single list, and all the error messages in another list.
This is possible with <code>transpose()</code>:</p>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1159-1"><a href="defining-your-own-functions.html#cb1159-1"></a>purrr<span class="op">::</span><span class="kw">transpose</span>(<span class="kw">map</span>(a, safe_sqrt))</span></code></pre></div>
<pre><code>## $result
## $result[[1]]
## [1] NA
## 
## $result[[2]]
## [1] 2
## 
## $result[[3]]
## [1] 2.236068
## 
## 
## $error
## $error[[1]]
## &lt;simpleError in .Primitive(&quot;sqrt&quot;)(x): non-numeric argument to mathematical function&gt;
## 
## $error[[2]]
## NULL
## 
## $error[[3]]
## NULL</code></pre>
<p>I explicitely call <code>purrr::transpose()</code> because there is also a <code>data.table::transpose()</code>, which
is not the same function. You have to be careful about that sort of thing, because it can cause
errors in your programs and debuging this type of error is a nightmare.</p>
<p>Now that we are familiar with functional programming, let‚Äôs try to apply some of its principles
to data manipulation.</p>
</div>
</div>
<div id="list-based-workflows-for-efficiency" class="section level2" number="7.12">
<h2><span class="header-section-number">7.12</span> List-based workflows for efficiency</h2>
<p>Once you wrote a function, you can easily use it inside a pipe workflow:</p>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1161-1"><a href="defining-your-own-functions.html#cb1161-1"></a>double_number &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb1161-2"><a href="defining-your-own-functions.html#cb1161-2"></a>  x<span class="op">+</span>x</span>
<span id="cb1161-3"><a href="defining-your-own-functions.html#cb1161-3"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="defining-your-own-functions.html#cb1162-1"></a>mtcars <span class="op">%&gt;%</span></span>
<span id="cb1162-2"><a href="defining-your-own-functions.html#cb1162-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">double_mpg =</span> <span class="kw">double_number</span>(mpg))</span></code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat    wt  qsec vs am gear carb double_mpg
## 1  21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4       42.0
## 2  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4       42.0
## 3  22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1       45.6
## 4  21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1       42.8
## 5  18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2       37.4
## 6  18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1       36.2
## 7  14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4       28.6
## 8  24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2       48.8
## 9  22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2       45.6
## 10 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4       38.4
## 11 17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4       35.6
## 12 16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3       32.8
## 13 17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3       34.6
## 14 15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3       30.4
## 15 10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4       20.8
## 16 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4       20.8
## 17 14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4       29.4
## 18 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1       64.8
## 19 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2       60.8
## 20 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1       67.8
## 21 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1       43.0
## 22 15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2       31.0
## 23 15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2       30.4
## 24 13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4       26.6
## 25 19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2       38.4
## 26 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1       54.6
## 27 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2       52.0
## 28 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2       60.8
## 29 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4       31.6
## 30 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6       39.4
## 31 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8       30.0
## 32 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2       42.8</code></pre>
<p>Granted this example is stupid, but it shows you, again, that functions you define are nothing
special. You can use them just as any other.</p>
<p>Now, let‚Äôs step back for a bit and think about what we learned up until now, and especially
the <code>map()</code> family of functions.</p>
<p>Let‚Äôs read the list of datasets from the previous chapter:</p>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="defining-your-own-functions.html#cb1164-1"></a>paths &lt;-<span class="st"> </span><span class="kw">Sys.glob</span>(<span class="st">&quot;datasets/unemployment/*.csv&quot;</span>)</span>
<span id="cb1164-2"><a href="defining-your-own-functions.html#cb1164-2"></a></span>
<span id="cb1164-3"><a href="defining-your-own-functions.html#cb1164-3"></a>all_datasets &lt;-<span class="st"> </span><span class="kw">import_list</span>(paths)</span>
<span id="cb1164-4"><a href="defining-your-own-functions.html#cb1164-4"></a></span>
<span id="cb1164-5"><a href="defining-your-own-functions.html#cb1164-5"></a><span class="kw">str</span>(all_datasets)</span></code></pre></div>
<pre><code>## List of 4
##  $ unemp_2013:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 223407 17802 1703 844 1431 4094 2146 971 1218 3002 ...
##   ..$ of which: Wage-earners    : int [1:118] 203535 15993 1535 750 1315 3800 1874 858 1029 2664 ...
##   ..$ of which: Non-wage-earners: int [1:118] 19872 1809 168 94 116 294 272 113 189 338 ...
##   ..$ Unemployed                : int [1:118] 19287 1071 114 25 74 261 98 45 66 207 ...
##   ..$ Active population         : int [1:118] 242694 18873 1817 869 1505 4355 2244 1016 1284 3209 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.95 5.67 6.27 2.88 4.92 ...
##   ..$ Year                      : int [1:118] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ unemp_2014:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 228423 18166 1767 845 1505 4129 2172 1007 1268 3124 ...
##   ..$ of which: Wage-earners    : int [1:118] 208238 16366 1606 757 1390 3840 1897 887 1082 2782 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20185 1800 161 88 115 289 275 120 186 342 ...
##   ..$ Unemployed                : int [1:118] 19362 1066 122 19 66 287 91 38 61 202 ...
##   ..$ Active population         : int [1:118] 247785 19232 1889 864 1571 4416 2263 1045 1329 3326 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.81 5.54 6.46 2.2 4.2 ...
##   ..$ Year                      : int [1:118] 2014 2014 2014 2014 2014 2014 2014 2014 2014 2014 ...
##  $ unemp_2015:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 233130 18310 1780 870 1470 4130 2170 1050 1300 3140 ...
##   ..$ of which: Wage-earners    : int [1:118] 212530 16430 1620 780 1350 3820 1910 920 1100 2770 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20600 1880 160 90 120 310 260 130 200 370 ...
##   ..$ Unemployed                : int [1:118] 18806 988 106 29 73 260 80 41 72 169 ...
##   ..$ Active population         : int [1:118] 251936 19298 1886 899 1543 4390 2250 1091 1372 3309 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.46 5.12 5.62 3.23 4.73 ...
##   ..$ Year                      : int [1:118] 2015 2015 2015 2015 2015 2015 2015 2015 2015 2015 ...
##  $ unemp_2016:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 236100 18380 1790 870 1470 4160 2160 1030 1330 3150 ...
##   ..$ of which: Wage-earners    : int [1:118] 215430 16500 1640 780 1350 3840 1900 900 1130 2780 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20670 1880 150 90 120 320 260 130 200 370 ...
##   ..$ Unemployed                : int [1:118] 18185 975 91 27 66 246 76 35 70 206 ...
##   ..$ Active population         : int [1:118] 254285 19355 1881 897 1536 4406 2236 1065 1400 3356 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.15 5.04 4.84 3.01 4.3 ...
##   ..$ Year                      : int [1:118] 2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ...</code></pre>
<p>The first thing we are going to do is use a function to clean the names of the datasets. These
names are not very easy to work with; there are spaces, and it would be better if the names of the
columns would be all lowercase. For this we are going to use the function <code>clean_names()</code> from the
<code>janitor</code> package. For a single dataset, I would write this:</p>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="defining-your-own-functions.html#cb1166-1"></a><span class="kw">library</span>(janitor)</span>
<span id="cb1166-2"><a href="defining-your-own-functions.html#cb1166-2"></a></span>
<span id="cb1166-3"><a href="defining-your-own-functions.html#cb1166-3"></a>one_dataset &lt;-<span class="st"> </span>one_dataset <span class="op">%&gt;%</span></span>
<span id="cb1166-4"><a href="defining-your-own-functions.html#cb1166-4"></a><span class="st">  </span><span class="kw">clean_names</span>()</span></code></pre></div>
<p>and I would get a dataset with column names in lowercase and spaces replaced by <code>_</code> (and other
corrections). How can I apply, or map, this function to each dataset in the list? To do this I need
to use <code>purrr::map()</code>:</p>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="defining-your-own-functions.html#cb1167-1"></a><span class="kw">library</span>(purrr)</span>
<span id="cb1167-2"><a href="defining-your-own-functions.html#cb1167-2"></a></span>
<span id="cb1167-3"><a href="defining-your-own-functions.html#cb1167-3"></a>all_datasets &lt;-<span class="st"> </span>all_datasets <span class="op">%&gt;%</span></span>
<span id="cb1167-4"><a href="defining-your-own-functions.html#cb1167-4"></a><span class="st">  </span><span class="kw">map</span>(clean_names)</span>
<span id="cb1167-5"><a href="defining-your-own-functions.html#cb1167-5"></a></span>
<span id="cb1167-6"><a href="defining-your-own-functions.html#cb1167-6"></a>all_datasets <span class="op">%&gt;%</span></span>
<span id="cb1167-7"><a href="defining-your-own-functions.html#cb1167-7"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## List of 4
##  $ unemp_2013:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 223407 17802 1703 844 1431 4094 2146 971 1218 3002 ...
##   ..$ of_which_wage_earners       : int [1:118] 203535 15993 1535 750 1315 3800 1874 858 1029 2664 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 19872 1809 168 94 116 294 272 113 189 338 ...
##   ..$ unemployed                  : int [1:118] 19287 1071 114 25 74 261 98 45 66 207 ...
##   ..$ active_population           : int [1:118] 242694 18873 1817 869 1505 4355 2244 1016 1284 3209 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.95 5.67 6.27 2.88 4.92 ...
##   ..$ year                        : int [1:118] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ unemp_2014:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 228423 18166 1767 845 1505 4129 2172 1007 1268 3124 ...
##   ..$ of_which_wage_earners       : int [1:118] 208238 16366 1606 757 1390 3840 1897 887 1082 2782 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20185 1800 161 88 115 289 275 120 186 342 ...
##   ..$ unemployed                  : int [1:118] 19362 1066 122 19 66 287 91 38 61 202 ...
##   ..$ active_population           : int [1:118] 247785 19232 1889 864 1571 4416 2263 1045 1329 3326 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.81 5.54 6.46 2.2 4.2 ...
##   ..$ year                        : int [1:118] 2014 2014 2014 2014 2014 2014 2014 2014 2014 2014 ...
##  $ unemp_2015:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 233130 18310 1780 870 1470 4130 2170 1050 1300 3140 ...
##   ..$ of_which_wage_earners       : int [1:118] 212530 16430 1620 780 1350 3820 1910 920 1100 2770 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20600 1880 160 90 120 310 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18806 988 106 29 73 260 80 41 72 169 ...
##   ..$ active_population           : int [1:118] 251936 19298 1886 899 1543 4390 2250 1091 1372 3309 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.46 5.12 5.62 3.23 4.73 ...
##   ..$ year                        : int [1:118] 2015 2015 2015 2015 2015 2015 2015 2015 2015 2015 ...
##  $ unemp_2016:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 236100 18380 1790 870 1470 4160 2160 1030 1330 3150 ...
##   ..$ of_which_wage_earners       : int [1:118] 215430 16500 1640 780 1350 3840 1900 900 1130 2780 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20670 1880 150 90 120 320 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18185 975 91 27 66 246 76 35 70 206 ...
##   ..$ active_population           : int [1:118] 254285 19355 1881 897 1536 4406 2236 1065 1400 3356 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.15 5.04 4.84 3.01 4.3 ...
##   ..$ year                        : int [1:118] 2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ...</code></pre>
<p>So now, what if I want to know, for each dataset, which <em>communes</em> have an unemployment rate that is
less than, say, 3%? For a single dataset I would do something like this:</p>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="defining-your-own-functions.html#cb1169-1"></a>one_dataset <span class="op">%&gt;%</span></span>
<span id="cb1169-2"><a href="defining-your-own-functions.html#cb1169-2"></a><span class="st">  </span><span class="kw">filter</span>(unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>)</span></code></pre></div>
<p>But for a list of datasets, <code>map()</code> is needed (and as you will see, that is not all that is needed):</p>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1170-1"><a href="defining-your-own-functions.html#cb1170-1"></a>all_datasets <span class="op">%&gt;%</span></span>
<span id="cb1170-2"><a href="defining-your-own-functions.html#cb1170-2"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">filter</span>(., unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>))</span></code></pre></div>
<pre><code>## $unemp_2013
##      commune total_employed_population of_which_wage_earners
## 1    Garnich                       844                   750
## 2 Leudelange                      1064                   937
## 3       Bech                       526                   463
##   of_which_non_wage_earners unemployed active_population
## 1                        94         25               869
## 2                       127         32              1096
## 3                        63         16               542
##   unemployment_rate_in_percent year
## 1                     2.876870 2013
## 2                     2.919708 2013
## 3                     2.952030 2013
## 
## $unemp_2014
##      commune total_employed_population of_which_wage_earners
## 1    Garnich                       845                   757
## 2 Leudelange                      1102                   965
## 3       Bech                       543                   476
## 4 Flaxweiler                       879                   789
##   of_which_non_wage_earners unemployed active_population
## 1                        88         19               864
## 2                       137         34              1136
## 3                        67         15               558
## 4                        90         27               906
##   unemployment_rate_in_percent year
## 1                     2.199074 2014
## 2                     2.992958 2014
## 3                     2.688172 2014
## 4                     2.980132 2014
## 
## $unemp_2015
##   commune total_employed_population of_which_wage_earners
## 1    Bech                       520                   450
## 2    Bous                       750                   680
##   of_which_non_wage_earners unemployed active_population
## 1                        70         14               534
## 2                        70         22               772
##   unemployment_rate_in_percent year
## 1                     2.621723 2015
## 2                     2.849741 2015
## 
## $unemp_2016
##             commune total_employed_population of_which_wage_earners
## 1 Reckange-sur-Mess                       980                   850
## 2              Bech                       520                   450
## 3          Betzdorf                      1500                  1350
## 4        Flaxweiler                       910                   820
##   of_which_non_wage_earners unemployed active_population
## 1                       130         30              1010
## 2                        70         11               531
## 3                       150         45              1545
## 4                        90         24               934
##   unemployment_rate_in_percent year
## 1                     2.970297 2016
## 2                     2.071563 2016
## 3                     2.912621 2016
## 4                     2.569593 2016</code></pre>
<p>I know what you‚Äôre thinking‚Ä¶ <em>what the hell?</em>. Let me explain: <code>map()</code> needs a function to map to
each element of the list. <code>all_datasets</code> is the list to which I want to map the function. But what
function? <code>filter()</code> is the function I need, so why doesn‚Äôt:</p>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="defining-your-own-functions.html#cb1172-1"></a>all_datasets <span class="op">%&gt;%</span></span>
<span id="cb1172-2"><a href="defining-your-own-functions.html#cb1172-2"></a><span class="st">  </span><span class="kw">map</span>(<span class="kw">filter</span>(unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>))</span></code></pre></div>
<p>work? This is a bit complicated, and has to do with what is called environments. If you try to run
the code above, you will get this error message:</p>
<pre><code>Error in filter(unemployment_rate_in_percent &lt; 3) :
  object &#39;unemployment_rate_in_percent&#39; not found</code></pre>
<p>I won‚Äôt go into details, but by writing <code>~filter(., unemployment_rate_in_percent &lt; 3)</code>, which is a
formula (<code>~</code> is the symbol to define formulas, more on this in the later chapters), <code>map()</code>
converts it to a function that it can use. If you want to know more about this, you can read it in
<a href="http://adv-r.had.co.nz/Functional-programming.html#closures">Advanced R</a> by Hadley Wickham, but it
is an advanced topic.</p>
<p>Before merging these datasets together, we would need them to have a <code>year</code> column indicating the
year. It would also be helpful if gave names to these datasets. For this task, we can use
<code>purrr::set_names()</code>:</p>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1174-1"><a href="defining-your-own-functions.html#cb1174-1"></a>all_datasets &lt;-<span class="st"> </span><span class="kw">set_names</span>(all_datasets, <span class="kw">as.character</span>(<span class="kw">seq</span>(<span class="dv">2013</span>, <span class="dv">2016</span>)))</span></code></pre></div>
<p>Let‚Äôs take a look at the list now:</p>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1175-1"><a href="defining-your-own-functions.html#cb1175-1"></a><span class="kw">str</span>(all_datasets)</span></code></pre></div>
<p>As you can see, each <code>data.frame</code> object contained in the list has been renamed. You can thus
access them with the <code>$</code> operator:</p>
<p><img src="pics/all_datasets_names.png" /><!-- --></p>
<p>Using <code>map()</code> we now know how to apply a function to each dataset of a list. But maybe it would be
easier to merge all the datasets first, and then manipulate them? Before that though, I am going to
teach you how to use <code>purrr::reduce()</code>, another very powerful function that works on lists. This is
a function that you can find in other programming languages, but sometimes it is called fold.</p>
<p>I think that the following example illustrates the power of <code>reduce()</code> well:</p>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="defining-your-own-functions.html#cb1176-1"></a>numbers &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>) <span class="co"># Create a vector with the numbers 1 to 5</span></span>
<span id="cb1176-2"><a href="defining-your-own-functions.html#cb1176-2"></a></span>
<span id="cb1176-3"><a href="defining-your-own-functions.html#cb1176-3"></a><span class="kw">reduce</span>(numbers, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dt">.init =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p><code>reduce()</code> takes a function as an argument, here the function <code>+</code><a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> and then does the following
computation:</p>
<pre><code>0 + numbers[1] + numbers[2] + numbers[3]...</code></pre>
<p>It applies the user supplied function successively but has to start with something, so we give it
the argument <code>init</code> also. This argument is actually optional, but I show it here because in some
cases it might be useful to start the computations at another value than <code>0</code>.<code>reduce()</code>
generalizes functions that only take two arguments. If you were to write a function that returns
the minimum between two numbers:</p>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1179-1"><a href="defining-your-own-functions.html#cb1179-1"></a>my_min &lt;-<span class="st"> </span><span class="cf">function</span>(a, b){</span>
<span id="cb1179-2"><a href="defining-your-own-functions.html#cb1179-2"></a>    <span class="cf">if</span>(a <span class="op">&lt;</span><span class="st"> </span>b){</span>
<span id="cb1179-3"><a href="defining-your-own-functions.html#cb1179-3"></a>        <span class="kw">return</span>(a)</span>
<span id="cb1179-4"><a href="defining-your-own-functions.html#cb1179-4"></a>    } <span class="cf">else</span> {</span>
<span id="cb1179-5"><a href="defining-your-own-functions.html#cb1179-5"></a>        <span class="kw">return</span>(b)</span>
<span id="cb1179-6"><a href="defining-your-own-functions.html#cb1179-6"></a>    }</span>
<span id="cb1179-7"><a href="defining-your-own-functions.html#cb1179-7"></a>}</span></code></pre></div>
<p>You could use <code>reduce()</code> to get the minimum of a list of numbers:</p>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1180-1"><a href="defining-your-own-functions.html#cb1180-1"></a>numbers2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">-8</span>, <span class="dv">9</span>)</span>
<span id="cb1180-2"><a href="defining-your-own-functions.html#cb1180-2"></a></span>
<span id="cb1180-3"><a href="defining-your-own-functions.html#cb1180-3"></a><span class="kw">reduce</span>(numbers2, my_min)</span></code></pre></div>
<pre><code>## [1] -8</code></pre>
<p>As long as you provide a function and a list of elements to <code>reduce()</code>, you will get a single
output. So how could <code>reduce()</code> help us with merging all the datasets that are in the list? <code>dplyr</code>
comes with a lot of function to merge <em>two</em> datasets. Remember that I said before that <code>reduce()</code>
allows you to generalize a function of two arguments? Let‚Äôs try it with our list of datasets:</p>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1182-1"><a href="defining-your-own-functions.html#cb1182-1"></a>unemp_lux &lt;-<span class="st"> </span><span class="kw">reduce</span>(all_datasets, full_join)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;commune&quot;, &quot;total_employed_population&quot;, &quot;of_which_wage_earners&quot;, &quot;of_which_non_wage_earners&quot;, &quot;unemployed&quot;, &quot;active_population&quot;, &quot;unemployment_rate_in_percent&quot;, &quot;year&quot;)
## Joining, by = c(&quot;commune&quot;, &quot;total_employed_population&quot;, &quot;of_which_wage_earners&quot;, &quot;of_which_non_wage_earners&quot;, &quot;unemployed&quot;, &quot;active_population&quot;, &quot;unemployment_rate_in_percent&quot;, &quot;year&quot;)
## Joining, by = c(&quot;commune&quot;, &quot;total_employed_population&quot;, &quot;of_which_wage_earners&quot;, &quot;of_which_non_wage_earners&quot;, &quot;unemployed&quot;, &quot;active_population&quot;, &quot;unemployment_rate_in_percent&quot;, &quot;year&quot;)</code></pre>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1184-1"><a href="defining-your-own-functions.html#cb1184-1"></a><span class="kw">glimpse</span>(unemp_lux)</span></code></pre></div>
<pre><code>## Rows: 472
## Columns: 8
## $ commune                      &lt;chr&gt; &quot;Grand-Duche de Luxembourg&quot;, &quot;Canton Cap‚Ä¶
## $ total_employed_population    &lt;int&gt; 223407, 17802, 1703, 844, 1431, 4094, 21‚Ä¶
## $ of_which_wage_earners        &lt;int&gt; 203535, 15993, 1535, 750, 1315, 3800, 18‚Ä¶
## $ of_which_non_wage_earners    &lt;int&gt; 19872, 1809, 168, 94, 116, 294, 272, 113‚Ä¶
## $ unemployed                   &lt;int&gt; 19287, 1071, 114, 25, 74, 261, 98, 45, 6‚Ä¶
## $ active_population            &lt;int&gt; 242694, 18873, 1817, 869, 1505, 4355, 22‚Ä¶
## $ unemployment_rate_in_percent &lt;dbl&gt; 7.947044, 5.674773, 6.274078, 2.876870, ‚Ä¶
## $ year                         &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013‚Ä¶</code></pre>
<p><code>full_join()</code> is one of the <code>dplyr</code> function that merges data. There are others that might be
useful depending on the kind of join operation you need. Let‚Äôs write this data to disk as we‚Äôre
going to keep using it for the next chapters:</p>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1186-1"><a href="defining-your-own-functions.html#cb1186-1"></a><span class="kw">export</span>(unemp_lux, <span class="st">&quot;datasets/unemp_lux.csv&quot;</span>)</span></code></pre></div>
<div id="functional-programming-and-plotting" class="section level3" number="7.12.1">
<h3><span class="header-section-number">7.12.1</span> Functional programming and plotting</h3>
<p>In this section, we are going to learn how to use the possibilities offered by the <code>purrr</code> package
and how it can work together with <code>ggplot2</code> to generate many plots. This is a more advanced topic,
but what comes next is also what makes R, and the functional programming paradigm so powerful.</p>
<p>For example, suppose that instead of wanting a single plot with the unemployment rate of each
commune, you need one unemployment plot, per commune:</p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="defining-your-own-functions.html#cb1187-1"></a>unemp_lux_data <span class="op">%&gt;%</span></span>
<span id="cb1187-2"><a href="defining-your-own-functions.html#cb1187-2"></a><span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Luxembourg&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1187-3"><a href="defining-your-own-functions.html#cb1187-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division)) <span class="op">+</span></span>
<span id="cb1187-4"><a href="defining-your-own-functions.html#cb1187-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb1187-5"><a href="defining-your-own-functions.html#cb1187-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span></span>
<span id="cb1187-6"><a href="defining-your-own-functions.html#cb1187-6"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-707-1.png" width="672" /></p>
<p>and then you would write the same for ‚ÄúEsch-sur-Alzette‚Äù and also for ‚ÄúWiltz‚Äù. If you only have to
make to make these 3 plots, copy and pasting the above lines is no big deal:</p>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1188-1"><a href="defining-your-own-functions.html#cb1188-1"></a>unemp_lux_data <span class="op">%&gt;%</span></span>
<span id="cb1188-2"><a href="defining-your-own-functions.html#cb1188-2"></a><span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Esch-sur-Alzette&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1188-3"><a href="defining-your-own-functions.html#cb1188-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division)) <span class="op">+</span></span>
<span id="cb1188-4"><a href="defining-your-own-functions.html#cb1188-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb1188-5"><a href="defining-your-own-functions.html#cb1188-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Esch-sur-Alzette&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span></span>
<span id="cb1188-6"><a href="defining-your-own-functions.html#cb1188-6"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-708-1.png" width="672" /></p>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="defining-your-own-functions.html#cb1189-1"></a>unemp_lux_data <span class="op">%&gt;%</span></span>
<span id="cb1189-2"><a href="defining-your-own-functions.html#cb1189-2"></a><span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Wiltz&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1189-3"><a href="defining-your-own-functions.html#cb1189-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division)) <span class="op">+</span></span>
<span id="cb1189-4"><a href="defining-your-own-functions.html#cb1189-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb1189-5"><a href="defining-your-own-functions.html#cb1189-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Esch-sur-Alzette&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span></span>
<span id="cb1189-6"><a href="defining-your-own-functions.html#cb1189-6"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-708-2.png" width="672" /></p>
<p>But copy and pasting is error prone. Can you spot the copy-paste mistake I made? And what if you
have to create the above plots for all 108 Luxembourguish communes? That‚Äôs a lot of copy pasting.
What if, once you are done copy pasting, you have to change something, for example, the theme? You
could use the search and replace function of RStudio, true, but sometimes search and replace can
also introduce bugs and typos. You can avoid all these issues by using <code>purrr::map()</code>. What do you
need to map over? The commune names. So let‚Äôs create a vector of commune names:</p>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1190-1"><a href="defining-your-own-functions.html#cb1190-1"></a>communes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)</span></code></pre></div>
<p>Now we can create the graphs using <code>map()</code>, or <code>map2()</code> to be exact:</p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="defining-your-own-functions.html#cb1191-1"></a>plots_tibble &lt;-<span class="st"> </span>unemp_lux_data <span class="op">%&gt;%</span></span>
<span id="cb1191-2"><a href="defining-your-own-functions.html#cb1191-2"></a><span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span>communes) <span class="op">%&gt;%</span></span>
<span id="cb1191-3"><a href="defining-your-own-functions.html#cb1191-3"></a><span class="st">  </span><span class="kw">group_by</span>(division) <span class="op">%&gt;%</span></span>
<span id="cb1191-4"><a href="defining-your-own-functions.html#cb1191-4"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></span>
<span id="cb1191-5"><a href="defining-your-own-functions.html#cb1191-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">plot =</span> <span class="kw">map2</span>(<span class="dt">.x =</span> data, <span class="dt">.y =</span> division, <span class="op">~</span><span class="kw">ggplot</span>(<span class="dt">data =</span> .x) <span class="op">+</span></span>
<span id="cb1191-6"><a href="defining-your-own-functions.html#cb1191-6"></a><span class="st">       </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb1191-7"><a href="defining-your-own-functions.html#cb1191-7"></a><span class="st">       </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb1191-8"><a href="defining-your-own-functions.html#cb1191-8"></a><span class="st">       </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Unemployment in&quot;</span>, .y))))</span></code></pre></div>
<p>Let‚Äôs study this line by line: the first line is easy, we simply use <code>filter()</code> to keep only the
communes we are interested in. Then we group by <code>division</code> and use <code>tidyr::nest()</code>. As a refresher,
let‚Äôs take a look at what this does:</p>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1192-1"><a href="defining-your-own-functions.html#cb1192-1"></a>unemp_lux_data <span class="op">%&gt;%</span></span>
<span id="cb1192-2"><a href="defining-your-own-functions.html#cb1192-2"></a><span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span>communes) <span class="op">%&gt;%</span></span>
<span id="cb1192-3"><a href="defining-your-own-functions.html#cb1192-3"></a><span class="st">  </span><span class="kw">group_by</span>(division) <span class="op">%&gt;%</span></span>
<span id="cb1192-4"><a href="defining-your-own-functions.html#cb1192-4"></a><span class="st">  </span><span class="kw">nest</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
## # Groups:   division [3]
##   division         data             
##   &lt;chr&gt;            &lt;list&gt;           
## 1 Esch-sur-Alzette &lt;tibble [15 √ó 7]&gt;
## 2 Luxembourg       &lt;tibble [15 √ó 7]&gt;
## 3 Wiltz            &lt;tibble [15 √ó 7]&gt;</code></pre>
<p>This creates a tibble with two columns, <code>division</code> and <code>data</code>, where each individual (or
commune in this case) is another tibble with all the original variables. This is very useful,
because now we can pass these tibbles to <code>map2()</code>, to generate the plots. But why <code>map2()</code> and
what‚Äôs the difference with <code>map()</code>? <code>map2()</code> works the same way as <code>map()</code>, but maps over two
inputs:</p>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1194-1"><a href="defining-your-own-functions.html#cb1194-1"></a>numbers1 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb1194-2"><a href="defining-your-own-functions.html#cb1194-2"></a></span>
<span id="cb1194-3"><a href="defining-your-own-functions.html#cb1194-3"></a>numbers2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">5</span>)</span>
<span id="cb1194-4"><a href="defining-your-own-functions.html#cb1194-4"></a></span>
<span id="cb1194-5"><a href="defining-your-own-functions.html#cb1194-5"></a><span class="kw">map2</span>(numbers1, numbers2, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 9
## 
## [[2]]
## [1] 16
## 
## [[3]]
## [1] 21
## 
## [[4]]
## [1] 24
## 
## [[5]]
## [1] 25</code></pre>
<p>In our example with the graphs, the two inputs are the data, and the names of the communes. This is
useful to create the title with <code>labs(title = paste("Unemployment in", .y))))</code> where <code>.y</code> is the
second input of <code>map2()</code>, the commune names contained in variable <code>division</code>.</p>
<p>So what happened? We now have a tibble called <code>plots_tibble</code> that looks like this:</p>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1196-1"><a href="defining-your-own-functions.html#cb1196-1"></a><span class="kw">print</span>(plots_tibble)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
## # Groups:   division [3]
##   division         data              plot  
##   &lt;chr&gt;            &lt;list&gt;            &lt;list&gt;
## 1 Esch-sur-Alzette &lt;tibble [15 √ó 7]&gt; &lt;gg&gt;  
## 2 Luxembourg       &lt;tibble [15 √ó 7]&gt; &lt;gg&gt;  
## 3 Wiltz            &lt;tibble [15 √ó 7]&gt; &lt;gg&gt;</code></pre>
<p>This tibble contains three columns, <code>division</code>, <code>data</code> and now a new one called <code>plot</code>, that we
created before using the last line <code>mutate(plot = ...)</code> (remember that <code>mutate()</code> adds columns to
tibbles). <code>plot</code> is a list-column, with elements‚Ä¶ being plots! Yes you read that right, the
elements of the column <code>plot</code> are literally plots. This is what I meant with list columns.
Let‚Äôs see what is inside the <code>data</code> and the <code>plot</code> columns exactly:</p>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1198-1"><a href="defining-your-own-functions.html#cb1198-1"></a>plots_tibble <span class="op">%&gt;%</span></span>
<span id="cb1198-2"><a href="defining-your-own-functions.html#cb1198-2"></a><span class="st">  </span><span class="kw">pull</span>(data)</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 15 x 7
##     year active_populati‚Ä¶ of_which_non_wa‚Ä¶ of_which_wage_e‚Ä¶ total_employed_‚Ä¶
##    &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1  2001             11.3              665             10.1             10.8
##  2  2002             11.7              677             10.3             11.0
##  3  2003             11.7              674             10.2             10.9
##  4  2004             12.2              659             10.6             11.3
##  5  2005             11.9              654             10.3             11.0
##  6  2006             12.2              657             10.5             11.2
##  7  2007             12.6              634             10.9             11.5
##  8  2008             12.9              638             11.0             11.6
##  9  2009             13.2              652             11.0             11.7
## 10  2010             13.6              638             11.2             11.8
## 11  2011             13.9              630             11.5             12.1
## 12  2012             14.3              684             11.8             12.5
## 13  2013             14.8              694             12.0             12.7
## 14  2014             15.2              703             12.5             13.2
## 15  2015             15.3              710             12.6             13.3
## # ‚Ä¶ with 2 more variables: unemployed &lt;dbl&gt;, unemployment_rate_in_percent &lt;dbl&gt;
## 
## [[2]]
## # A tibble: 15 x 7
##     year active_populati‚Ä¶ of_which_non_wa‚Ä¶ of_which_wage_e‚Ä¶ total_employed_‚Ä¶
##    &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1  2001             34.4             2.89             30.4             33.2
##  2  2002             34.8             2.94             30.3             33.2
##  3  2003             35.2             3.03             30.1             33.2
##  4  2004             35.6             3.06             30.1             33.2
##  5  2005             35.6             3.13             29.8             33.0
##  6  2006             35.5             3.12             30.3             33.4
##  7  2007             36.1             3.25             31.1             34.4
##  8  2008             37.5             3.39             31.9             35.3
##  9  2009             37.9             3.49             31.6             35.1
## 10  2010             38.6             3.54             32.1             35.7
## 11  2011             40.3             3.66             33.6             37.2
## 12  2012             41.8             3.81             34.6             38.4
## 13  2013             43.4             3.98             35.5             39.5
## 14  2014             44.6             4.11             36.7             40.8
## 15  2015             45.2             4.14             37.5             41.6
## # ‚Ä¶ with 2 more variables: unemployed &lt;dbl&gt;, unemployment_rate_in_percent &lt;dbl&gt;
## 
## [[3]]
## # A tibble: 15 x 7
##     year active_populati‚Ä¶ of_which_non_wa‚Ä¶ of_which_wage_e‚Ä¶ total_employed_‚Ä¶
##    &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1  2001             2.13              223             1.79             2.01
##  2  2002             2.14              220             1.78             2.00
##  3  2003             2.18              223             1.79             2.02
##  4  2004             2.24              227             1.85             2.08
##  5  2005             2.26              229             1.85             2.08
##  6  2006             2.20              206             1.82             2.02
##  7  2007             2.27              198             1.88             2.08
##  8  2008             2.30              200             1.90             2.10
##  9  2009             2.36              201             1.94             2.15
## 10  2010             2.42              195             1.97             2.17
## 11  2011             2.48              190             2.02             2.21
## 12  2012             2.59              188             2.10             2.29
## 13  2013             2.66              195             2.15             2.34
## 14  2014             2.69              185             2.19             2.38
## 15  2015             2.77              180             2.27             2.45
## # ‚Ä¶ with 2 more variables: unemployed &lt;dbl&gt;, unemployment_rate_in_percent &lt;dbl&gt;</code></pre>
<p>each element of data is a tibble for the specific country with columns <code>year</code>, <code>active_population</code>,
etc, the original columns. But obviously, there is no <code>division</code> column. So to plot the data, and
join all the dots together, we need to add <code>group = 1</code> in the call to <code>ggplot2()</code> (whereas if you
plot multiple lines in the same graph, you need to write <code>group = division</code>).</p>
<p>But more interestingly, how can you actually see the plots? If you want to simply look at them, it
is enough to use <code>pull()</code>:</p>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1200-1"><a href="defining-your-own-functions.html#cb1200-1"></a>plots_tibble <span class="op">%&gt;%</span></span>
<span id="cb1200-2"><a href="defining-your-own-functions.html#cb1200-2"></a><span class="st">  </span><span class="kw">pull</span>(plot)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="modern_R_files/figure-html/unnamed-chunk-715-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="modern_R_files/figure-html/unnamed-chunk-715-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="modern_R_files/figure-html/unnamed-chunk-715-3.png" width="672" /></p>
<p>And if we want to save these plots, we can do so using <code>map2()</code>:</p>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1204-1"><a href="defining-your-own-functions.html#cb1204-1"></a><span class="kw">map2</span>(<span class="kw">paste0</span>(plots_tibble<span class="op">$</span>division, <span class="st">&quot;.pdf&quot;</span>), plots_tibble<span class="op">$</span>plot, ggsave)</span></code></pre></div>
<pre><code>Saving 7 x 5 in image
Saving 6.01 x 3.94 in image
Saving 6.01 x 3.94 in image</code></pre>
<p>This was probably the most advanced topic we have studied yet; but you probably agree with me that
it is among the most useful ones. This section is a perfect illustration of the power of functional
programming; you can mix and match functions as long as you give them the correct arguments.
You can pass data to functions that use data and then pass these functions to other functions that
use functions as arguments, such as <code>map()</code>.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> <code>map()</code> does not care if the functions you pass to it produces tables,
graphs or even another function. <code>map()</code> will simply map this function to a list of inputs, and as
long as these inputs are correct arguments to the function, <code>map()</code> will do its magic. If you
combine this with list-columns, you can even use <code>map()</code> alongside <code>dplyr</code> functions and map your
function by first grouping, filtering, etc‚Ä¶</p>
</div>
<div id="modeling-with-functional-programming" class="section level3" number="7.12.2">
<h3><span class="header-section-number">7.12.2</span> Modeling with functional programming</h3>
<p>As written just above, <code>map()</code> simply applies a function to a list of inputs, and in the previous
section we mapped <code>ggplot()</code> to generate many plots at once. This approach can also be used to
map any modeling functions, for instance <code>lm()</code> to a list of datasets.</p>
<p>For instance, suppose that you wish to perform a Monte Carlo simulation. Suppose that you are
dealing with a binary choice problem; usually, you would use a logistic regression for this.</p>
<p>However, in certain disciplines, especially in the social sciences, the so-called Linear Probability
Model is often used as well. The LPM is a simple linear regression, but unlike the standard setting
of a linear regression, the dependent variable, or target, is a binary variable, and not a continuous
variable. Before you yell ‚ÄúWait, that‚Äôs illegal‚Äù, you should know that in practice LPMs do a good
job of estimating marginal effects, which is what social scientists and econometricians are often
interested in. Marginal effects are another way of interpreting models, giving how the outcome
(or the target) changes given a change in a independent variable (or a feature). For instance,
a marginal effect of 0.10 for age would mean that probability of success would increase by 10% for
each added year of age. We already discussed marginal effects in Chapter 6.</p>
<p>There has been a lot of discussion on logistic regression vs LPMs, and there are pros and cons
of using LPMs. Micro-econometricians are still fond of LPMs, even though the pros of LPMs are
not really convincing. However, quoting Angrist and Pischke:</p>
<p>‚ÄúWhile a nonlinear model may fit the CEF (population conditional expectation function) for LDVs
(limited dependent variables) more closely than a linear model, when it comes to marginal effects,
this probably matters little‚Äù (source: <em>Mostly Harmless Econometrics</em>)</p>
<p>so LPMs are still used for estimating marginal effects.</p>
<p>Let us check this assessment with one example. First, we simulate some data, then
run a logistic regression and compute the marginal effects, and then compare with a LPM:</p>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="defining-your-own-functions.html#cb1206-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb1206-2"><a href="defining-your-own-functions.html#cb1206-2"></a>x1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb1206-3"><a href="defining-your-own-functions.html#cb1206-3"></a>x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb1206-4"><a href="defining-your-own-functions.html#cb1206-4"></a>  </span>
<span id="cb1206-5"><a href="defining-your-own-functions.html#cb1206-5"></a>z &lt;-<span class="st"> </span><span class="fl">.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>x1 <span class="op">+</span><span class="st"> </span><span class="dv">4</span><span class="op">*</span>x2</span>
<span id="cb1206-6"><a href="defining-your-own-functions.html#cb1206-6"></a></span>
<span id="cb1206-7"><a href="defining-your-own-functions.html#cb1206-7"></a>p &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>z))</span>
<span id="cb1206-8"><a href="defining-your-own-functions.html#cb1206-8"></a></span>
<span id="cb1206-9"><a href="defining-your-own-functions.html#cb1206-9"></a>y &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, p)</span>
<span id="cb1206-10"><a href="defining-your-own-functions.html#cb1206-10"></a></span>
<span id="cb1206-11"><a href="defining-your-own-functions.html#cb1206-11"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">y =</span> y, <span class="dt">x1 =</span> x1, <span class="dt">x2 =</span> x2)</span></code></pre></div>
<p>This data generating process generates data from a binary choice model. Fitting the model using a
logistic regression allows us to recover the structural parameters:</p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="defining-your-own-functions.html#cb1207-1"></a>logistic_regression &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> df, <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>Let‚Äôs see a summary of the model fit:</p>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="defining-your-own-functions.html#cb1208-1"></a><span class="kw">summary</span>(logistic_regression)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ ., family = binomial(link = &quot;logit&quot;), data = df)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.91941  -0.44872   0.00038   0.42843   2.55426  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   0.0960     0.3293   0.292 0.770630    
## x1            1.6625     0.4628   3.592 0.000328 ***
## x2            3.6582     0.8059   4.539 5.64e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 138.629  on 99  degrees of freedom
## Residual deviance:  60.576  on 97  degrees of freedom
## AIC: 66.576
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<p>We do recover the parameters that generated the data, but what about the marginal effects? We can
get the marginal effects easily using the <code>{margins}</code> package:</p>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="defining-your-own-functions.html#cb1210-1"></a><span class="kw">library</span>(margins)</span>
<span id="cb1210-2"><a href="defining-your-own-functions.html#cb1210-2"></a></span>
<span id="cb1210-3"><a href="defining-your-own-functions.html#cb1210-3"></a><span class="kw">margins</span>(logistic_regression)</span></code></pre></div>
<pre><code>## Average marginal effects</code></pre>
<pre><code>## glm(formula = y ~ ., family = binomial(link = &quot;logit&quot;), data = df)</code></pre>
<pre><code>##      x1     x2
##  0.1598 0.3516</code></pre>
<p>Or, even better, we can compute the <em>true</em> marginal effects, since we know the data
generating process:</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="defining-your-own-functions.html#cb1214-1"></a>meffects &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, coefs){</span>
<span id="cb1214-2"><a href="defining-your-own-functions.html#cb1214-2"></a>  X &lt;-<span class="st"> </span>dataset <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1214-3"><a href="defining-your-own-functions.html#cb1214-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>y) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1214-4"><a href="defining-your-own-functions.html#cb1214-4"></a><span class="st">  </span><span class="kw">as.matrix</span>()</span>
<span id="cb1214-5"><a href="defining-your-own-functions.html#cb1214-5"></a>  </span>
<span id="cb1214-6"><a href="defining-your-own-functions.html#cb1214-6"></a>  dydx_x1 &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">dlogis</span>(X<span class="op">%*%</span><span class="kw">c</span>(coefs[<span class="dv">2</span>], coefs[<span class="dv">3</span>]))<span class="op">*</span>coefs[<span class="dv">2</span>])</span>
<span id="cb1214-7"><a href="defining-your-own-functions.html#cb1214-7"></a>  dydx_x2 &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">dlogis</span>(X<span class="op">%*%</span><span class="kw">c</span>(coefs[<span class="dv">2</span>], coefs[<span class="dv">3</span>]))<span class="op">*</span>coefs[<span class="dv">3</span>])</span>
<span id="cb1214-8"><a href="defining-your-own-functions.html#cb1214-8"></a>  </span>
<span id="cb1214-9"><a href="defining-your-own-functions.html#cb1214-9"></a>  <span class="kw">tribble</span>(<span class="op">~</span>term, <span class="op">~</span>true_effect,</span>
<span id="cb1214-10"><a href="defining-your-own-functions.html#cb1214-10"></a>          <span class="st">&quot;x1&quot;</span>, dydx_x1,</span>
<span id="cb1214-11"><a href="defining-your-own-functions.html#cb1214-11"></a>          <span class="st">&quot;x2&quot;</span>, dydx_x2)</span>
<span id="cb1214-12"><a href="defining-your-own-functions.html#cb1214-12"></a>}</span>
<span id="cb1214-13"><a href="defining-your-own-functions.html#cb1214-13"></a></span>
<span id="cb1214-14"><a href="defining-your-own-functions.html#cb1214-14"></a>(true_meffects &lt;-<span class="st"> </span><span class="kw">meffects</span>(df, <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>, <span class="dv">4</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   term  true_effect
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 x1          0.175
## 2 x2          0.350</code></pre>
<p>Ok, so now what about using this infamous Linear Probability Model to estimate the marginal effects?</p>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="defining-your-own-functions.html#cb1216-1"></a>lpm &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> df)</span>
<span id="cb1216-2"><a href="defining-your-own-functions.html#cb1216-2"></a></span>
<span id="cb1216-3"><a href="defining-your-own-functions.html#cb1216-3"></a><span class="kw">summary</span>(lpm)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ ., data = df)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.83953 -0.31588 -0.02885  0.28774  0.77407 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.51340    0.03587  14.314  &lt; 2e-16 ***
## x1           0.16771    0.03545   4.732 7.58e-06 ***
## x2           0.31250    0.03449   9.060 1.43e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3541 on 97 degrees of freedom
## Multiple R-squared:  0.5135, Adjusted R-squared:  0.5034 
## F-statistic: 51.18 on 2 and 97 DF,  p-value: 6.693e-16</code></pre>
<p>It‚Äôs not too bad, but maybe it could have been better in other circumstances. Perhaps if we had more
observations, or perhaps for a different set of structural parameters the results of the LPM
would have been closer. The LPM estimates the marginal effect of <code>x1</code> to be
0.1677134 vs 0.1597956
for the logistic regression and for <code>x2</code>, the LPM estimation is 0.3124966
vs 0.351607. The <em>true</em> marginal effects are
0.1750963 and 0.3501926 for <code>x1</code> and <code>x2</code> respectively.</p>
<p>Just as to assess the accuracy of a model data scientists perform cross-validation, a Monte Carlo
study can be performed to asses how close the estimation of the marginal effects using a LPM is
to the marginal effects derived from a logistic regression. It will allow us to test with datasets
of different sizes, and generated using different structural parameters.</p>
<p>First, let‚Äôs write a function that generates data. The function below generates 10 datasets of size
100 (the code is inspired by this <a href="https://stats.stackexchange.com/a/46525">StackExchange answer</a>):</p>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1218-1"><a href="defining-your-own-functions.html#cb1218-1"></a>generate_datasets &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">coefs =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="dt">sample_size =</span> <span class="dv">100</span>, <span class="dt">repeats =</span> <span class="dv">10</span>){</span>
<span id="cb1218-2"><a href="defining-your-own-functions.html#cb1218-2"></a></span>
<span id="cb1218-3"><a href="defining-your-own-functions.html#cb1218-3"></a>  generate_one_dataset &lt;-<span class="st"> </span><span class="cf">function</span>(coefs, sample_size){</span>
<span id="cb1218-4"><a href="defining-your-own-functions.html#cb1218-4"></a>  x1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(sample_size)</span>
<span id="cb1218-5"><a href="defining-your-own-functions.html#cb1218-5"></a>  x2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(sample_size)</span>
<span id="cb1218-6"><a href="defining-your-own-functions.html#cb1218-6"></a>  </span>
<span id="cb1218-7"><a href="defining-your-own-functions.html#cb1218-7"></a>  z &lt;-<span class="st"> </span>coefs[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>coefs[<span class="dv">2</span>]<span class="op">*</span>x1 <span class="op">+</span><span class="st"> </span>coefs[<span class="dv">3</span>]<span class="op">*</span>x2</span>
<span id="cb1218-8"><a href="defining-your-own-functions.html#cb1218-8"></a></span>
<span id="cb1218-9"><a href="defining-your-own-functions.html#cb1218-9"></a>  p &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>z))</span>
<span id="cb1218-10"><a href="defining-your-own-functions.html#cb1218-10"></a></span>
<span id="cb1218-11"><a href="defining-your-own-functions.html#cb1218-11"></a>  y &lt;-<span class="st"> </span><span class="kw">rbinom</span>(sample_size, <span class="dv">1</span>, p)</span>
<span id="cb1218-12"><a href="defining-your-own-functions.html#cb1218-12"></a></span>
<span id="cb1218-13"><a href="defining-your-own-functions.html#cb1218-13"></a>  df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">y =</span> y, <span class="dt">x1 =</span> x1, <span class="dt">x2 =</span> x2)</span>
<span id="cb1218-14"><a href="defining-your-own-functions.html#cb1218-14"></a>  }</span>
<span id="cb1218-15"><a href="defining-your-own-functions.html#cb1218-15"></a></span>
<span id="cb1218-16"><a href="defining-your-own-functions.html#cb1218-16"></a>  simulations &lt;-<span class="st"> </span><span class="kw">rerun</span>(<span class="dt">.n =</span> repeats, <span class="kw">generate_one_dataset</span>(coefs, sample_size))</span>
<span id="cb1218-17"><a href="defining-your-own-functions.html#cb1218-17"></a> </span>
<span id="cb1218-18"><a href="defining-your-own-functions.html#cb1218-18"></a>  <span class="kw">tibble</span>(<span class="st">&quot;coefs&quot;</span> =<span class="st"> </span><span class="kw">list</span>(coefs), <span class="st">&quot;sample_size&quot;</span> =<span class="st"> </span>sample_size, <span class="st">&quot;repeats&quot;</span> =<span class="st"> </span>repeats, <span class="st">&quot;simulations&quot;</span> =<span class="st"> </span><span class="kw">list</span>(simulations))</span>
<span id="cb1218-19"><a href="defining-your-own-functions.html#cb1218-19"></a>}</span></code></pre></div>
<p>Let‚Äôs first generate one dataset:</p>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1219-1"><a href="defining-your-own-functions.html#cb1219-1"></a>one_dataset &lt;-<span class="st"> </span><span class="kw">generate_datasets</span>(<span class="dt">repeats =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Let‚Äôs take a look at <code>one_dataset</code>:</p>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1220-1"><a href="defining-your-own-functions.html#cb1220-1"></a>one_dataset</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   coefs     sample_size repeats simulations
##   &lt;list&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;list&gt;     
## 1 &lt;dbl [3]&gt;         100       1 &lt;list [1]&gt;</code></pre>
<p>As you can see, the tibble with the simulated data is inside a list-column called <code>simulations</code>.
Let‚Äôs take a closer look:</p>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1222-1"><a href="defining-your-own-functions.html#cb1222-1"></a><span class="kw">str</span>(one_dataset<span class="op">$</span>simulations)</span></code></pre></div>
<pre><code>## List of 1
##  $ :List of 1
##   ..$ : tibble [100 √ó 3] (S3: tbl_df/tbl/data.frame)
##   .. ..$ y : int [1:100] 0 1 1 1 0 1 1 0 0 1 ...
##   .. ..$ x1: num [1:100] 0.437 1.06 0.452 0.663 -1.136 ...
##   .. ..$ x2: num [1:100] -2.316 0.562 -0.784 -0.226 -1.587 ...</code></pre>
<p>The structure is quite complex, and it‚Äôs important to understand this, because it will have an
impact on the next lines of code; it is a list, containing a list, containing a dataset! No worries
though, we can still map over the datasets directly, by using <code>modify_depth()</code> instead of <code>map()</code>.</p>
<p>Now, let‚Äôs fit a LPM and compare the estimation of the marginal effects with the <em>true</em> marginal
effects. In order to have some confidence in our results,
we will not simply run a linear regression on that single dataset, but will instead simulate hundreds,
then thousands and ten of thousands of data sets, get the marginal effects and compare
them to the true ones (but here I won‚Äôt simulate more than 500 datasets).</p>
<p>Let‚Äôs first generate 10 datasets:</p>
<div class="sourceCode" id="cb1224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1224-1"><a href="defining-your-own-functions.html#cb1224-1"></a>many_datasets &lt;-<span class="st"> </span><span class="kw">generate_datasets</span>()</span></code></pre></div>
<p>Now comes the tricky part. I have this object, <code>many_datasets</code> looking like this:</p>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1225-1"><a href="defining-your-own-functions.html#cb1225-1"></a>many_datasets</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   coefs     sample_size repeats simulations
##   &lt;list&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;list&gt;     
## 1 &lt;dbl [3]&gt;         100      10 &lt;list [10]&gt;</code></pre>
<p>I would like to fit LPMs to the 10 datasets. For this, I will need to use all the power of functional
programming and the <code>{tidyverse}</code>. I will be adding columns to this data frame using <code>mutate()</code>
and mapping over the <code>simulations</code> list-column using <code>modify_depth()</code>. The list of data frames is
at the second level (remember, it‚Äôs a list containing a list containing data frames).</p>
<p>I‚Äôll start by fitting the LPMs, then using <code>broom::tidy()</code> I will get a nice data frame of the
estimated parameters. I will then only select what I need, and then bind the rows of all the
data frames. I will do the same for the <em>true</em> marginal effects.</p>
<p>I highly suggest that you run the following lines, one after another. It is complicated to understand
what‚Äôs going on if you are not used to such workflows. However, I hope to convince you that once
it will click, it‚Äôll be much more intuitive than doing all this inside a loop. Here‚Äôs the code:</p>
<div class="sourceCode" id="cb1227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1227-1"><a href="defining-your-own-functions.html#cb1227-1"></a>results &lt;-<span class="st"> </span>many_datasets <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1227-2"><a href="defining-your-own-functions.html#cb1227-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">modify_depth</span>(simulations, <span class="dv">2</span>, <span class="op">~</span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .x))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1227-3"><a href="defining-your-own-functions.html#cb1227-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">modify_depth</span>(lpm, <span class="dv">2</span>, broom<span class="op">::</span>tidy)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1227-4"><a href="defining-your-own-functions.html#cb1227-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">modify_depth</span>(lpm, <span class="dv">2</span>, <span class="op">~</span><span class="kw">select</span>(., term, estimate))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1227-5"><a href="defining-your-own-functions.html#cb1227-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">modify_depth</span>(lpm, <span class="dv">2</span>, <span class="op">~</span><span class="kw">filter</span>(., term <span class="op">!=</span><span class="st"> &quot;(Intercept)&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1227-6"><a href="defining-your-own-functions.html#cb1227-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">map</span>(lpm, bind_rows)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1227-7"><a href="defining-your-own-functions.html#cb1227-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">true_effect =</span> <span class="kw">modify_depth</span>(simulations, <span class="dv">2</span>, <span class="op">~</span><span class="kw">meffects</span>(., <span class="dt">coefs =</span> coefs[[<span class="dv">1</span>]]))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1227-8"><a href="defining-your-own-functions.html#cb1227-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">true_effect =</span> <span class="kw">map</span>(true_effect, bind_rows))</span></code></pre></div>
<p>This is how results looks like:</p>
<div class="sourceCode" id="cb1228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1228-1"><a href="defining-your-own-functions.html#cb1228-1"></a>results</span></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   coefs     sample_size repeats simulations lpm               true_effect      
##   &lt;list&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;list&gt;      &lt;list&gt;            &lt;list&gt;           
## 1 &lt;dbl [3]&gt;         100      10 &lt;list [10]&gt; &lt;tibble [20 √ó 2]&gt; &lt;tibble [20 √ó 2]&gt;</code></pre>
<p>Let‚Äôs take a closer look to the <code>lpm</code> and <code>true_effect</code> columns:</p>
<div class="sourceCode" id="cb1230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1230-1"><a href="defining-your-own-functions.html#cb1230-1"></a>results<span class="op">$</span>lpm</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 20 x 2
##    term  estimate
##    &lt;chr&gt;    &lt;dbl&gt;
##  1 x1       0.228
##  2 x2       0.353
##  3 x1       0.180
##  4 x2       0.361
##  5 x1       0.165
##  6 x2       0.374
##  7 x1       0.182
##  8 x2       0.358
##  9 x1       0.125
## 10 x2       0.345
## 11 x1       0.171
## 12 x2       0.331
## 13 x1       0.122
## 14 x2       0.309
## 15 x1       0.129
## 16 x2       0.332
## 17 x1       0.102
## 18 x2       0.374
## 19 x1       0.176
## 20 x2       0.410</code></pre>
<div class="sourceCode" id="cb1232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1232-1"><a href="defining-your-own-functions.html#cb1232-1"></a>results<span class="op">$</span>true_effect</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 20 x 2
##    term  true_effect
##    &lt;chr&gt;       &lt;dbl&gt;
##  1 x1          0.183
##  2 x2          0.366
##  3 x1          0.166
##  4 x2          0.331
##  5 x1          0.174
##  6 x2          0.348
##  7 x1          0.169
##  8 x2          0.339
##  9 x1          0.167
## 10 x2          0.335
## 11 x1          0.173
## 12 x2          0.345
## 13 x1          0.157
## 14 x2          0.314
## 15 x1          0.170
## 16 x2          0.340
## 17 x1          0.182
## 18 x2          0.365
## 19 x1          0.161
## 20 x2          0.321</code></pre>
<p>Let‚Äôs bind the columns, and compute the difference between the <em>true</em> and estimated marginal
effects:</p>
<div class="sourceCode" id="cb1234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1234-1"><a href="defining-your-own-functions.html#cb1234-1"></a>simulation_results &lt;-<span class="st"> </span>results <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1234-2"><a href="defining-your-own-functions.html#cb1234-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">difference =</span> <span class="kw">map2</span>(<span class="dt">.x =</span> lpm, <span class="dt">.y =</span> true_effect, full_join)) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1234-3"><a href="defining-your-own-functions.html#cb1234-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">difference =</span> <span class="kw">map</span>(difference, <span class="op">~</span><span class="kw">mutate</span>(., <span class="dt">difference =</span> true_effect <span class="op">-</span><span class="st"> </span>estimate))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1234-4"><a href="defining-your-own-functions.html#cb1234-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">difference =</span> <span class="kw">map</span>(difference, <span class="op">~</span><span class="kw">select</span>(., term, difference))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1234-5"><a href="defining-your-own-functions.html#cb1234-5"></a><span class="st">  </span><span class="kw">pull</span>(difference) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1234-6"><a href="defining-your-own-functions.html#cb1234-6"></a><span class="st">  </span>.[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## Joining, by = &quot;term&quot;</code></pre>
<p>Let‚Äôs take a look at the simulation results:</p>
<div class="sourceCode" id="cb1236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1236-1"><a href="defining-your-own-functions.html#cb1236-1"></a>simulation_results <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1236-2"><a href="defining-your-own-functions.html#cb1236-2"></a><span class="st">  </span><span class="kw">group_by</span>(term) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1236-3"><a href="defining-your-own-functions.html#cb1236-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(difference), </span>
<span id="cb1236-4"><a href="defining-your-own-functions.html#cb1236-4"></a>            <span class="dt">sd =</span> <span class="kw">sd</span>(difference))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   term     mean     sd
##   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 x1     0.0122 0.0368
## 2 x2    -0.0141 0.0311</code></pre>
<p>Already with only 10 simulated datasets, the difference in means is not significant. Let‚Äôs rerun
the analysis, but for difference sizes. In order to make things easier, we can put all the code
into a nifty function:</p>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1239-1"><a href="defining-your-own-functions.html#cb1239-1"></a>monte_carlo &lt;-<span class="st"> </span><span class="cf">function</span>(coefs, sample_size, repeats){</span>
<span id="cb1239-2"><a href="defining-your-own-functions.html#cb1239-2"></a>  many_datasets &lt;-<span class="st"> </span><span class="kw">generate_datasets</span>(coefs, sample_size, repeats)</span>
<span id="cb1239-3"><a href="defining-your-own-functions.html#cb1239-3"></a>  </span>
<span id="cb1239-4"><a href="defining-your-own-functions.html#cb1239-4"></a>  results &lt;-<span class="st"> </span>many_datasets <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-5"><a href="defining-your-own-functions.html#cb1239-5"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">modify_depth</span>(simulations, <span class="dv">2</span>, <span class="op">~</span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .x))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-6"><a href="defining-your-own-functions.html#cb1239-6"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">modify_depth</span>(lpm, <span class="dv">2</span>, broom<span class="op">::</span>tidy)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-7"><a href="defining-your-own-functions.html#cb1239-7"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">modify_depth</span>(lpm, <span class="dv">2</span>, <span class="op">~</span><span class="kw">select</span>(., term, estimate))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-8"><a href="defining-your-own-functions.html#cb1239-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">modify_depth</span>(lpm, <span class="dv">2</span>, <span class="op">~</span><span class="kw">filter</span>(., term <span class="op">!=</span><span class="st"> &quot;(Intercept)&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-9"><a href="defining-your-own-functions.html#cb1239-9"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">lpm =</span> <span class="kw">map</span>(lpm, bind_rows)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-10"><a href="defining-your-own-functions.html#cb1239-10"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">true_effect =</span> <span class="kw">modify_depth</span>(simulations, <span class="dv">2</span>, <span class="op">~</span><span class="kw">meffects</span>(., <span class="dt">coefs =</span> coefs[[<span class="dv">1</span>]]))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-11"><a href="defining-your-own-functions.html#cb1239-11"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">true_effect =</span> <span class="kw">map</span>(true_effect, bind_rows))</span>
<span id="cb1239-12"><a href="defining-your-own-functions.html#cb1239-12"></a></span>
<span id="cb1239-13"><a href="defining-your-own-functions.html#cb1239-13"></a>  simulation_results &lt;-<span class="st"> </span>results <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-14"><a href="defining-your-own-functions.html#cb1239-14"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">difference =</span> <span class="kw">map2</span>(<span class="dt">.x =</span> lpm, <span class="dt">.y =</span> true_effect, full_join)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-15"><a href="defining-your-own-functions.html#cb1239-15"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">difference =</span> <span class="kw">map</span>(difference, <span class="op">~</span><span class="kw">mutate</span>(., <span class="dt">difference =</span> true_effect <span class="op">-</span><span class="st"> </span>estimate))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-16"><a href="defining-your-own-functions.html#cb1239-16"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">difference =</span> <span class="kw">map</span>(difference, <span class="op">~</span><span class="kw">select</span>(., term, difference))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-17"><a href="defining-your-own-functions.html#cb1239-17"></a><span class="st">    </span><span class="kw">pull</span>(difference) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-18"><a href="defining-your-own-functions.html#cb1239-18"></a><span class="st">    </span>.[[<span class="dv">1</span>]]</span>
<span id="cb1239-19"><a href="defining-your-own-functions.html#cb1239-19"></a></span>
<span id="cb1239-20"><a href="defining-your-own-functions.html#cb1239-20"></a>  simulation_results <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-21"><a href="defining-your-own-functions.html#cb1239-21"></a><span class="st">    </span><span class="kw">group_by</span>(term) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1239-22"><a href="defining-your-own-functions.html#cb1239-22"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(difference), </span>
<span id="cb1239-23"><a href="defining-your-own-functions.html#cb1239-23"></a>              <span class="dt">sd =</span> <span class="kw">sd</span>(difference))</span>
<span id="cb1239-24"><a href="defining-your-own-functions.html#cb1239-24"></a>}</span></code></pre></div>
<p>And now, let‚Äôs run the simulation for different parameters and sizes:</p>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1240-1"><a href="defining-your-own-functions.html#cb1240-1"></a><span class="kw">monte_carlo</span>(<span class="kw">c</span>(.<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="dv">100</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;term&quot;</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   term      mean     sd
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1 x1    -0.00826 0.0318
## 2 x2    -0.00732 0.0421</code></pre>
<div class="sourceCode" id="cb1244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1244-1"><a href="defining-your-own-functions.html#cb1244-1"></a><span class="kw">monte_carlo</span>(<span class="kw">c</span>(.<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="dv">100</span>, <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;term&quot;
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   term     mean     sd
##   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 x1    0.00360 0.0408
## 2 x2    0.00517 0.0459</code></pre>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1247-1"><a href="defining-your-own-functions.html#cb1247-1"></a><span class="kw">monte_carlo</span>(<span class="kw">c</span>(.<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="dv">100</span>, <span class="dv">500</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;term&quot;
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   term       mean     sd
##   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;
## 1 x1    -0.00152  0.0388
## 2 x2    -0.000701 0.0462</code></pre>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1250-1"><a href="defining-your-own-functions.html#cb1250-1"></a><span class="kw">monte_carlo</span>(<span class="kw">c</span>(pi, <span class="dv">6</span>, <span class="dv">9</span>), <span class="dv">100</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;term&quot;
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   term      mean     sd
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1 x1    -0.00829 0.0421
## 2 x2     0.00178 0.0397</code></pre>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1253-1"><a href="defining-your-own-functions.html#cb1253-1"></a><span class="kw">monte_carlo</span>(<span class="kw">c</span>(pi, <span class="dv">6</span>, <span class="dv">9</span>), <span class="dv">100</span>, <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;term&quot;
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   term     mean     sd
##   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 x1    0.0107  0.0576
## 2 x2    0.00831 0.0772</code></pre>
<div class="sourceCode" id="cb1256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1256-1"><a href="defining-your-own-functions.html#cb1256-1"></a><span class="kw">monte_carlo</span>(<span class="kw">c</span>(pi, <span class="dv">6</span>, <span class="dv">9</span>), <span class="dv">100</span>, <span class="dv">500</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;term&quot;
## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   term     mean     sd
##   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 x1    0.00879 0.0518
## 2 x2    0.0113  0.0687</code></pre>
<p>We see that, at least for this set of parameters, the LPM does a good job of estimating marginal
effects.</p>
<p>Now, this study might in itself not be very interesting to you, but I believe the general approach
is quite useful and flexible enough to be adapted to all kinds of use-cases.</p>
</div>
</div>
<div id="exercises-6" class="section level2" number="7.13">
<h2><span class="header-section-number">7.13</span> Exercises</h2>
<div id="exercise-1-6" class="section level3 unnumbered" number="">
<h3>Exercise 1</h3>
<p>Suppose you have an Excel workbook that contains data on three sheets. Create a function that
reads entire workbooks, and that returns a list of tibbles, where each tibble is the data of one
sheet (download the example Excel workbook, <code>example_workbook.xlsx</code>, from the <code>assets</code> folder on
the books github).</p>
</div>
<div id="exercise-2-4" class="section level3 unnumbered" number="">
<h3>Exercise 2</h3>
<p>Use one of the <code>map()</code> functions to combine two lists into one. Consider the following two lists:</p>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1259-1"><a href="defining-your-own-functions.html#cb1259-1"></a>mediterranean &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;starters&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;humous&quot;</span>, <span class="st">&quot;lasagna&quot;</span>), <span class="st">&quot;dishes&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;sardines&quot;</span>, <span class="st">&quot;olives&quot;</span>))</span>
<span id="cb1259-2"><a href="defining-your-own-functions.html#cb1259-2"></a></span>
<span id="cb1259-3"><a href="defining-your-own-functions.html#cb1259-3"></a>continental &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;starters&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;pea soup&quot;</span>, <span class="st">&quot;terrine&quot;</span>), <span class="st">&quot;dishes&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;frikadelle&quot;</span>, <span class="st">&quot;sauerkraut&quot;</span>))</span></code></pre></div>
<p>The result we‚Äôd like to have would look like this:</p>
<div class="sourceCode" id="cb1260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1260-1"><a href="defining-your-own-functions.html#cb1260-1"></a><span class="op">$</span>starters</span>
<span id="cb1260-2"><a href="defining-your-own-functions.html#cb1260-2"></a><span class="op">$</span>starters[[<span class="dv">1</span>]]</span>
<span id="cb1260-3"><a href="defining-your-own-functions.html#cb1260-3"></a>[<span class="dv">1</span>] <span class="st">&quot;humous&quot;</span></span>
<span id="cb1260-4"><a href="defining-your-own-functions.html#cb1260-4"></a></span>
<span id="cb1260-5"><a href="defining-your-own-functions.html#cb1260-5"></a><span class="op">$</span>starters[[<span class="dv">2</span>]]</span>
<span id="cb1260-6"><a href="defining-your-own-functions.html#cb1260-6"></a>[<span class="dv">1</span>] <span class="st">&quot;olives&quot;</span></span>
<span id="cb1260-7"><a href="defining-your-own-functions.html#cb1260-7"></a></span>
<span id="cb1260-8"><a href="defining-your-own-functions.html#cb1260-8"></a><span class="op">$</span>starters[[<span class="dv">3</span>]]</span>
<span id="cb1260-9"><a href="defining-your-own-functions.html#cb1260-9"></a>[<span class="dv">1</span>] <span class="st">&quot;pea soup&quot;</span></span>
<span id="cb1260-10"><a href="defining-your-own-functions.html#cb1260-10"></a></span>
<span id="cb1260-11"><a href="defining-your-own-functions.html#cb1260-11"></a><span class="op">$</span>starters[[<span class="dv">4</span>]]</span>
<span id="cb1260-12"><a href="defining-your-own-functions.html#cb1260-12"></a>[<span class="dv">1</span>] <span class="st">&quot;terrine&quot;</span></span>
<span id="cb1260-13"><a href="defining-your-own-functions.html#cb1260-13"></a></span>
<span id="cb1260-14"><a href="defining-your-own-functions.html#cb1260-14"></a></span>
<span id="cb1260-15"><a href="defining-your-own-functions.html#cb1260-15"></a><span class="op">$</span>dishes</span>
<span id="cb1260-16"><a href="defining-your-own-functions.html#cb1260-16"></a><span class="op">$</span>dishes[[<span class="dv">1</span>]]</span>
<span id="cb1260-17"><a href="defining-your-own-functions.html#cb1260-17"></a>[<span class="dv">1</span>] <span class="st">&quot;sardines&quot;</span></span>
<span id="cb1260-18"><a href="defining-your-own-functions.html#cb1260-18"></a></span>
<span id="cb1260-19"><a href="defining-your-own-functions.html#cb1260-19"></a><span class="op">$</span>dishes[[<span class="dv">2</span>]]</span>
<span id="cb1260-20"><a href="defining-your-own-functions.html#cb1260-20"></a>[<span class="dv">1</span>] <span class="st">&quot;lasagna&quot;</span></span>
<span id="cb1260-21"><a href="defining-your-own-functions.html#cb1260-21"></a></span>
<span id="cb1260-22"><a href="defining-your-own-functions.html#cb1260-22"></a><span class="op">$</span>dishes[[<span class="dv">3</span>]]</span>
<span id="cb1260-23"><a href="defining-your-own-functions.html#cb1260-23"></a>[<span class="dv">1</span>] <span class="st">&quot;frikadelle&quot;</span></span>
<span id="cb1260-24"><a href="defining-your-own-functions.html#cb1260-24"></a></span>
<span id="cb1260-25"><a href="defining-your-own-functions.html#cb1260-25"></a><span class="op">$</span>dishes[[<span class="dv">4</span>]]</span>
<span id="cb1260-26"><a href="defining-your-own-functions.html#cb1260-26"></a>[<span class="dv">1</span>] <span class="st">&quot;sauerkraut&quot;</span></span></code></pre></div>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="7">
<li id="fn7"><p>This is simply the <code>+</code> operator
you‚Äôre used to. Try this out: <code>`+`(1, 5)</code> and you‚Äôll see <code>+</code> is a function like any other. You
just have to write backticks around the plus symbol to make it work.<a href="defining-your-own-functions.html#fnref7" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn8"><p>Functions that have other functions as input are
called <em>higher order functions</em><a href="defining-your-own-functions.html#fnref8" class="footnote-back">‚Ü©Ô∏é</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistical-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="package-development.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
