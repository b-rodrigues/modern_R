<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Statistical models | Modern R with the tidyverse</title>
  <meta name="description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Statistical models | Modern R with the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Statistical models | Modern R with the tidyverse" />
  
  <meta name="twitter:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

<meta name="author" content="Bruno Rodrigues" />


<meta name="date" content="2020-01-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="graphs.html"/>
<link rel="next" href="defining-your-own-functions.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern R with the tidyverse</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#note-to-the-reader"><i class="fa fa-check"></i>Note to the reader</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-r"><i class="fa fa-check"></i>What is R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-is-this-book-for"><i class="fa fa-check"></i>Who is this book for?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this-book"><i class="fa fa-check"></i>Why this book?</a></li>
<li><a href="index.html#why-modern-r">Why <em>modern</em> R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-rstudio"><i class="fa fa-check"></i>What is RStudio?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect-from-this-book"><i class="fa fa-check"></i>What to expect from this book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-are-packages"><i class="fa fa-check"></i>What are packages?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-author"><i class="fa fa-check"></i>The author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting to know RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#panes"><i class="fa fa-check"></i><b>1.1</b> Panes</a></li>
<li class="chapter" data-level="1.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#console"><i class="fa fa-check"></i><b>1.2</b> Console</a></li>
<li class="chapter" data-level="1.3" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#scripts"><i class="fa fa-check"></i><b>1.3</b> Scripts</a><ul>
<li class="chapter" data-level="1.3.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-help-pane"><i class="fa fa-check"></i><b>1.3.1</b> The help pane</a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-environment-pane"><i class="fa fa-check"></i><b>1.3.2</b> The Environment pane</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#options"><i class="fa fa-check"></i><b>1.4</b> Options</a></li>
<li class="chapter" data-level="1.5" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>1.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="1.6" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#projects"><i class="fa fa-check"></i><b>1.6</b> Projects</a></li>
<li class="chapter" data-level="1.7" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#history"><i class="fa fa-check"></i><b>1.7</b> History</a></li>
<li class="chapter" data-level="1.8" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#plots"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
<li class="chapter" data-level="1.9" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#addins"><i class="fa fa-check"></i><b>1.9</b> Addins</a></li>
<li class="chapter" data-level="1.10" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#packages"><i class="fa fa-check"></i><b>1.10</b> Packages</a></li>
<li class="chapter" data-level="1.11" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercises"><i class="fa fa-check"></i><b>1.11</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html"><i class="fa fa-check"></i><b>2</b> Objects, types and useful R functions to get started</a><ul>
<li class="chapter" data-level="2.1" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-numeric-class"><i class="fa fa-check"></i><b>2.1</b> The <code>numeric</code> class</a></li>
<li class="chapter" data-level="2.2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-character-class"><i class="fa fa-check"></i><b>2.2</b> The <code>character</code> class</a></li>
<li class="chapter" data-level="2.3" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-factor-class"><i class="fa fa-check"></i><b>2.3</b> The <code>factor</code> class</a></li>
<li class="chapter" data-level="2.4" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-date-class"><i class="fa fa-check"></i><b>2.4</b> The <code>Date</code> class</a></li>
<li class="chapter" data-level="2.5" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-logical-class"><i class="fa fa-check"></i><b>2.5</b> The <code>logical</code> class</a></li>
<li class="chapter" data-level="2.6" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#vectors-and-matrices"><i class="fa fa-check"></i><b>2.6</b> Vectors and matrices</a><ul>
<li class="chapter" data-level="2.6.1" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-c-function"><i class="fa fa-check"></i><b>2.6.1</b> The <code>c()</code> function</a></li>
<li class="chapter" data-level="2.6.2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#cbind-and-rbind"><i class="fa fa-check"></i><b>2.6.2</b> <code>cbind()</code> and <code>rbind()</code></a></li>
<li class="chapter" data-level="2.6.3" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-matrix-class"><i class="fa fa-check"></i><b>2.6.3</b> The <code>matrix</code> class</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-list-class"><i class="fa fa-check"></i><b>2.7</b> The <code>list</code> class</a></li>
<li class="chapter" data-level="2.8" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-data.frame-and-tibble-classes"><i class="fa fa-check"></i><b>2.8</b> The <code>data.frame</code> and <code>tibble</code> classes</a></li>
<li class="chapter" data-level="2.9" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#formulas"><i class="fa fa-check"></i><b>2.9</b> Formulas</a></li>
<li class="chapter" data-level="2.10" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#models"><i class="fa fa-check"></i><b>2.10</b> Models</a></li>
<li class="chapter" data-level="2.11" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#null-na-and-nan"><i class="fa fa-check"></i><b>2.11</b> NULL, NA and NaN</a></li>
<li class="chapter" data-level="2.12" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#useful-functions-to-get-you-started"><i class="fa fa-check"></i><b>2.12</b> Useful functions to get you started</a><ul>
<li class="chapter" data-level="2.12.1" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#sequences"><i class="fa fa-check"></i><b>2.12.1</b> Sequences</a></li>
<li class="chapter" data-level="2.12.2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#basic-string-manipulation"><i class="fa fa-check"></i><b>2.12.2</b> Basic string manipulation</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercises-1"><i class="fa fa-check"></i><b>2.13</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-1-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-5"><i class="fa fa-check"></i>Exercise 5</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-6"><i class="fa fa-check"></i>Exercise 6</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-7"><i class="fa fa-check"></i>Exercise 7</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-8"><i class="fa fa-check"></i>Exercise 8</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>3</b> Reading and writing data</a><ul>
<li class="chapter" data-level="3.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#the-swiss-army-knife-of-data-import-and-export-rio"><i class="fa fa-check"></i><b>3.1</b> The swiss army knife of data import and export: <code>{rio}</code></a></li>
<li class="chapter" data-level="3.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-any-object-to-disk"><i class="fa fa-check"></i><b>3.2</b> Writing any object to disk</a></li>
<li class="chapter" data-level="3.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#using-rstudio-projects-to-manage-paths"><i class="fa fa-check"></i><b>3.3</b> Using RStudio projects to manage paths</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html"><i class="fa fa-check"></i><b>4</b> Descriptive statistics and data manipulation</a><ul>
<li class="chapter" data-level="4.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-data-exploration-exercice-using-base-r"><i class="fa fa-check"></i><b>4.1</b> A data exploration exercice using <em>base</em> R</a></li>
<li class="chapter" data-level="4.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#smoking-is-bad-for-you-but-pipes-are-your-friend"><i class="fa fa-check"></i><b>4.2</b> Smoking is bad for you, but pipes are your friend</a></li>
<li class="chapter" data-level="4.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#the-tidyverses-enfant-prodige-dplyr"><i class="fa fa-check"></i><b>4.3</b> The <code>{tidyverse}</code>‚Äôs <em>enfant prodige</em>: <code>{dplyr}</code></a><ul>
<li class="chapter" data-level="4.3.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-first-taste-of-data-manipulation-with-dplyr"><i class="fa fa-check"></i><b>4.3.1</b> A first taste of data manipulation with <code>{dplyr}</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter-the-rows-of-a-dataset-with-filter"><i class="fa fa-check"></i><b>4.3.2</b> Filter the rows of a dataset with <code>filter()</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#select-columns-with-select"><i class="fa fa-check"></i><b>4.3.3</b> Select columns with <code>select()</code></a></li>
<li class="chapter" data-level="4.3.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group-the-observations-of-your-dataset-with-group_by"><i class="fa fa-check"></i><b>4.3.4</b> Group the observations of your dataset with <code>group_by()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#get-summary-statistics-with-summarise"><i class="fa fa-check"></i><b>4.3.5</b> Get summary statistics with <code>summarise()</code></a></li>
<li class="chapter" data-level="4.3.6" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#adding-columns-with-mutate-and-transmute"><i class="fa fa-check"></i><b>4.3.6</b> Adding columns with <code>mutate()</code> and <code>transmute()</code></a></li>
<li class="chapter" data-level="4.3.7" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#joining-tibbles-with-full_join-left_join-right_join-and-all-the-others"><i class="fa fa-check"></i><b>4.3.7</b> Joining <code>tibble</code>s with <code>full_join()</code>, <code>left_join()</code>, <code>right_join()</code> and all the others</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#reshaping-data-with-tidyr"><i class="fa fa-check"></i><b>4.4</b> Reshaping data with <code>tidyr</code></a><ul>
<li class="chapter" data-level="4.4.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#pivot_wider-and-pivot_longer"><i class="fa fa-check"></i><b>4.4.1</b> <code>pivot_wider()</code> and <code>pivot_longer()</code></a></li>
<li class="chapter" data-level="4.4.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#spread-and-gather"><i class="fa fa-check"></i><b>4.4.2</b> <code>spread()</code> and <code>gather()</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#fill-and-full_seq"><i class="fa fa-check"></i><b>4.4.3</b> <code>fill()</code> and <code>full_seq()</code></a></li>
<li class="chapter" data-level="4.4.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#put-order-in-your-columns-with-separate-unite-and-in-your-rows-with-separate_rows"><i class="fa fa-check"></i><b>4.4.4</b> Put order in your columns with <code>separate()</code>, <code>unite()</code>, and in your rows with <code>separate_rows()</code></a></li>
<li class="chapter" data-level="4.4.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-sneak-peek-to-chapter-8-nest"><i class="fa fa-check"></i><b>4.4.5</b> A sneak peek to Chapter 8; <code>nest()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#scoped-tidyverse-verbs"><i class="fa fa-check"></i><b>4.5</b> Scoped <code>{tidyverse}</code> verbs</a><ul>
<li class="chapter" data-level="4.5.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter_"><i class="fa fa-check"></i><b>4.5.1</b> filter_*()</a></li>
<li class="chapter" data-level="4.5.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#select_-and-rename_"><i class="fa fa-check"></i><b>4.5.2</b> select_*() and rename_*()</a></li>
<li class="chapter" data-level="4.5.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group_by_"><i class="fa fa-check"></i><b>4.5.3</b> group_by_*()</a></li>
<li class="chapter" data-level="4.5.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#summarise_"><i class="fa fa-check"></i><b>4.5.4</b> summarise_()</a></li>
<li class="chapter" data-level="4.5.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#mutate_"><i class="fa fa-check"></i><b>4.5.5</b> mutate_*()</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#other-useful-tidyverse-functions"><i class="fa fa-check"></i><b>4.6</b> Other useful <code>{tidyverse}</code> functions</a><ul>
<li class="chapter" data-level="4.6.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#if_else-case_when-and-recode"><i class="fa fa-check"></i><b>4.6.1</b> <code>if_else()</code>, <code>case_when()</code> and <code>recode()</code></a></li>
<li class="chapter" data-level="4.6.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#lead-and-lag"><i class="fa fa-check"></i><b>4.6.2</b> <code>lead()</code> and <code>lag()</code></a></li>
<li class="chapter" data-level="4.6.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#ntile"><i class="fa fa-check"></i><b>4.6.3</b> <code>ntile()</code></a></li>
<li class="chapter" data-level="4.6.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#arrange"><i class="fa fa-check"></i><b>4.6.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.6.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#tally-and-count"><i class="fa fa-check"></i><b>4.6.5</b> <code>tally()</code> and <code>count()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#special-packages-for-special-kinds-of-data-forcats-lubridate-and-stringr"><i class="fa fa-check"></i><b>4.7</b> Special packages for special kinds of data: <code>{forcats}</code>, <code>{lubridate}</code>, and <code>{stringr}</code></a><ul>
<li class="chapter" data-level="4.7.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#section"><i class="fa fa-check"></i><b>4.7.1</b> üêàüêàüêàüêà</a></li>
<li class="chapter" data-level="4.7.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#get-your-dates-right-with-lubridate"><i class="fa fa-check"></i><b>4.7.2</b> Get your dates right with <code>{lubridate}</code></a></li>
<li class="chapter" data-level="4.7.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#manipulate-strings-with-stringr"><i class="fa fa-check"></i><b>4.7.3</b> Manipulate strings with <code>{stringr}</code></a></li>
<li class="chapter" data-level="4.7.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#tidy-data-frames-with-tibble"><i class="fa fa-check"></i><b>4.7.4</b> Tidy data frames with <code>{tibble}</code></a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#list-columns"><i class="fa fa-check"></i><b>4.8</b> List-columns</a></li>
<li class="chapter" data-level="4.9" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#going-beyond-descriptive-statistics-and-data-manipulation"><i class="fa fa-check"></i><b>4.9</b> Going beyond descriptive statistics and data manipulation</a></li>
<li class="chapter" data-level="4.10" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercises-2"><i class="fa fa-check"></i><b>4.10</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-1-2"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-2-1"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-3-1"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>5</b> Graphs</a><ul>
<li class="chapter" data-level="5.1" data-path="graphs.html"><a href="graphs.html#resources"><i class="fa fa-check"></i><b>5.1</b> Resources</a></li>
<li class="chapter" data-level="5.2" data-path="graphs.html"><a href="graphs.html#examples"><i class="fa fa-check"></i><b>5.2</b> Examples</a><ul>
<li class="chapter" data-level="5.2.1" data-path="graphs.html"><a href="graphs.html#barplots"><i class="fa fa-check"></i><b>5.2.1</b> Barplots</a></li>
<li class="chapter" data-level="5.2.2" data-path="graphs.html"><a href="graphs.html#scatter-plots"><i class="fa fa-check"></i><b>5.2.2</b> Scatter plots</a></li>
<li class="chapter" data-level="5.2.3" data-path="graphs.html"><a href="graphs.html#density"><i class="fa fa-check"></i><b>5.2.3</b> Density</a></li>
<li class="chapter" data-level="5.2.4" data-path="graphs.html"><a href="graphs.html#line-plots"><i class="fa fa-check"></i><b>5.2.4</b> Line plots</a></li>
<li class="chapter" data-level="5.2.5" data-path="graphs.html"><a href="graphs.html#facets"><i class="fa fa-check"></i><b>5.2.5</b> Facets</a></li>
<li class="chapter" data-level="5.2.6" data-path="graphs.html"><a href="graphs.html#pie-charts"><i class="fa fa-check"></i><b>5.2.6</b> Pie Charts</a></li>
<li class="chapter" data-level="5.2.7" data-path="graphs.html"><a href="graphs.html#adding-text-to-plots"><i class="fa fa-check"></i><b>5.2.7</b> Adding text to plots</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="graphs.html"><a href="graphs.html#customization"><i class="fa fa-check"></i><b>5.3</b> Customization</a><ul>
<li class="chapter" data-level="5.3.1" data-path="graphs.html"><a href="graphs.html#changing-titles-axes-labels-options-mixing-geoms-and-changing-themes"><i class="fa fa-check"></i><b>5.3.1</b> Changing titles, axes labels, options, mixing geoms and changing themes</a></li>
<li class="chapter" data-level="5.3.2" data-path="graphs.html"><a href="graphs.html#colour-schemes"><i class="fa fa-check"></i><b>5.3.2</b> Colour schemes</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="graphs.html"><a href="graphs.html#saving-plots-to-disk"><i class="fa fa-check"></i><b>5.4</b> Saving plots to disk</a></li>
<li class="chapter" data-level="5.5" data-path="graphs.html"><a href="graphs.html#exercises-3"><i class="fa fa-check"></i><b>5.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="graphs.html"><a href="graphs.html#exercise-1-3"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>6</b> Statistical models</a><ul>
<li class="chapter" data-level="6.1" data-path="statistical-models.html"><a href="statistical-models.html#terminology"><i class="fa fa-check"></i><b>6.1</b> Terminology</a></li>
<li class="chapter" data-level="6.2" data-path="statistical-models.html"><a href="statistical-models.html#fitting-a-model-to-data"><i class="fa fa-check"></i><b>6.2</b> Fitting a model to data</a></li>
<li class="chapter" data-level="6.3" data-path="statistical-models.html"><a href="statistical-models.html#diagnostics"><i class="fa fa-check"></i><b>6.3</b> Diagnostics</a></li>
<li class="chapter" data-level="6.4" data-path="statistical-models.html"><a href="statistical-models.html#interpreting-models"><i class="fa fa-check"></i><b>6.4</b> Interpreting models</a><ul>
<li class="chapter" data-level="6.4.1" data-path="statistical-models.html"><a href="statistical-models.html#marginal-effects"><i class="fa fa-check"></i><b>6.4.1</b> Marginal effects</a></li>
<li class="chapter" data-level="6.4.2" data-path="statistical-models.html"><a href="statistical-models.html#explainability-of-black-box-models"><i class="fa fa-check"></i><b>6.4.2</b> Explainability of <em>black-box</em> models</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="statistical-models.html"><a href="statistical-models.html#comparing-models"><i class="fa fa-check"></i><b>6.5</b> Comparing models</a></li>
<li class="chapter" data-level="6.6" data-path="statistical-models.html"><a href="statistical-models.html#using-a-model-for-prediction"><i class="fa fa-check"></i><b>6.6</b> Using a model for prediction</a></li>
<li class="chapter" data-level="6.7" data-path="statistical-models.html"><a href="statistical-models.html#beyond-linear-regression"><i class="fa fa-check"></i><b>6.7</b> Beyond linear regression</a></li>
<li class="chapter" data-level="6.8" data-path="statistical-models.html"><a href="statistical-models.html#hyper-parameters"><i class="fa fa-check"></i><b>6.8</b> Hyper-parameters</a><ul>
<li class="chapter" data-level="6.8.1" data-path="statistical-models.html"><a href="statistical-models.html#ridge-regression"><i class="fa fa-check"></i><b>6.8.1</b> Ridge regression</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="statistical-models.html"><a href="statistical-models.html#training-validating-and-testing-models"><i class="fa fa-check"></i><b>6.9</b> Training, validating, and testing models</a><ul>
<li class="chapter" data-level="6.9.1" data-path="statistical-models.html"><a href="statistical-models.html#set-up"><i class="fa fa-check"></i><b>6.9.1</b> Set up</a></li>
<li class="chapter" data-level="6.9.2" data-path="statistical-models.html"><a href="statistical-models.html#bayesian-hyperparameter-optimization"><i class="fa fa-check"></i><b>6.9.2</b> Bayesian hyperparameter optimization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html"><i class="fa fa-check"></i><b>7</b> Defining your own functions</a><ul>
<li class="chapter" data-level="7.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#control-flow"><i class="fa fa-check"></i><b>7.1</b> Control flow</a><ul>
<li class="chapter" data-level="7.1.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#if-else"><i class="fa fa-check"></i><b>7.1.1</b> If-else</a></li>
<li class="chapter" data-level="7.1.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#for-loops"><i class="fa fa-check"></i><b>7.1.2</b> For loops</a></li>
<li class="chapter" data-level="7.1.3" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#while-loops"><i class="fa fa-check"></i><b>7.1.3</b> While loops</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#writing-your-own-functions"><i class="fa fa-check"></i><b>7.2</b> Writing your own functions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#declaring-functions-in-r"><i class="fa fa-check"></i><b>7.2.1</b> Declaring functions in R</a></li>
<li class="chapter" data-level="7.2.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#fibonacci-numbers"><i class="fa fa-check"></i><b>7.2.2</b> Fibonacci numbers</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercises-4"><i class="fa fa-check"></i><b>7.3</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-1-4"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-2-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-3-2"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-take-functions-as-arguments-writing-your-own-higher-order-functions"><i class="fa fa-check"></i><b>7.4</b> Functions that take functions as arguments: writing your own higher-order functions</a></li>
<li class="chapter" data-level="7.5" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-take-columns-of-data-as-arguments"><i class="fa fa-check"></i><b>7.5</b> Functions that take columns of data as arguments</a><ul>
<li class="chapter" data-level="7.5.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#the-enquo---approach"><i class="fa fa-check"></i><b>7.5.1</b> The <code>enquo() - !!()</code> approach</a></li>
<li class="chapter" data-level="7.5.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#curly-curly-a-simplified-approach-to-the-enquo-and-framework"><i class="fa fa-check"></i><b>7.5.2</b> Curly Curly, a simplified approach to the <code>enquo()</code> and <code>!!()</code> framework</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-use-loops"><i class="fa fa-check"></i><b>7.6</b> Functions that use loops</a></li>
<li class="chapter" data-level="7.7" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#anonymous-functions"><i class="fa fa-check"></i><b>7.7</b> Anonymous functions</a></li>
<li class="chapter" data-level="7.8" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercises-5"><i class="fa fa-check"></i><b>7.8</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-1-5"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-2-3"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-3-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-4-1"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>8</b> Functional programming</a><ul>
<li class="chapter" data-level="8.1" data-path="functional-programming.html"><a href="functional-programming.html#function-definitions"><i class="fa fa-check"></i><b>8.1</b> Function definitions</a></li>
<li class="chapter" data-level="8.2" data-path="functional-programming.html"><a href="functional-programming.html#properties-of-functions"><i class="fa fa-check"></i><b>8.2</b> Properties of functions</a></li>
<li class="chapter" data-level="8.3" data-path="functional-programming.html"><a href="functional-programming.html#functional-programming-with-purrr"><i class="fa fa-check"></i><b>8.3</b> Functional programming with <code>{purrr}</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="functional-programming.html"><a href="functional-programming.html#doing-away-with-loops-the-map-family-of-functions"><i class="fa fa-check"></i><b>8.3.1</b> Doing away with loops: the <code>map*()</code> family of functions</a></li>
<li class="chapter" data-level="8.3.2" data-path="functional-programming.html"><a href="functional-programming.html#reducing-with-purrr"><i class="fa fa-check"></i><b>8.3.2</b> Reducing with <code>purrr</code></a></li>
<li class="chapter" data-level="8.3.3" data-path="functional-programming.html"><a href="functional-programming.html#error-handling-with-safely-and-possibly"><i class="fa fa-check"></i><b>8.3.3</b> Error handling with <code>safely()</code> and <code>possibly()</code></a></li>
<li class="chapter" data-level="8.3.4" data-path="functional-programming.html"><a href="functional-programming.html#partial-applications-with-partial"><i class="fa fa-check"></i><b>8.3.4</b> Partial applications with <code>partial()</code></a></li>
<li class="chapter" data-level="8.3.5" data-path="functional-programming.html"><a href="functional-programming.html#function-composition-using-compose"><i class="fa fa-check"></i><b>8.3.5</b> Function composition using <code>compose</code></a></li>
<li class="chapter" data-level="8.3.6" data-path="functional-programming.html"><a href="functional-programming.html#transposing-lists"><i class="fa fa-check"></i><b>8.3.6</b> ¬´Transposing lists¬ª</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="functional-programming.html"><a href="functional-programming.html#list-based-workflows-for-efficiency"><i class="fa fa-check"></i><b>8.4</b> List-based workflows for efficiency</a><ul>
<li class="chapter" data-level="8.4.1" data-path="functional-programming.html"><a href="functional-programming.html#functional-programming-and-plotting"><i class="fa fa-check"></i><b>8.4.1</b> Functional programming and plotting</a></li>
<li class="chapter" data-level="8.4.2" data-path="functional-programming.html"><a href="functional-programming.html#modeling-with-functional-programming"><i class="fa fa-check"></i><b>8.4.2</b> Modeling with functional programming</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="functional-programming.html"><a href="functional-programming.html#exercises-6"><i class="fa fa-check"></i><b>8.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="functional-programming.html"><a href="functional-programming.html#exercise-1-6"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="functional-programming.html"><a href="functional-programming.html#exercise-2-4"><i class="fa fa-check"></i>Exercise 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="package-development.html"><a href="package-development.html"><i class="fa fa-check"></i><b>9</b> Package development</a><ul>
<li class="chapter" data-level="9.1" data-path="package-development.html"><a href="package-development.html#why-you-need-to-write-your-own-package"><i class="fa fa-check"></i><b>9.1</b> Why you need to write your own package</a></li>
<li class="chapter" data-level="9.2" data-path="package-development.html"><a href="package-development.html#starting-easy-creating-a-package-to-share-data"><i class="fa fa-check"></i><b>9.2</b> Starting easy: creating a package to share data</a><ul>
<li class="chapter" data-level="9.2.1" data-path="package-development.html"><a href="package-development.html#setting-up-a-github-account"><i class="fa fa-check"></i><b>9.2.1</b> Setting up a Github account</a></li>
<li class="chapter" data-level="9.2.2" data-path="package-development.html"><a href="package-development.html#starting-your-package"><i class="fa fa-check"></i><b>9.2.2</b> Starting your package</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="package-development.html"><a href="package-development.html#including-data-inside-the-package"><i class="fa fa-check"></i><b>9.3</b> Including data inside the package</a></li>
<li class="chapter" data-level="9.4" data-path="package-development.html"><a href="package-development.html#adding-functions-to-your-package"><i class="fa fa-check"></i><b>9.4</b> Adding functions to your package</a></li>
<li class="chapter" data-level="9.5" data-path="package-development.html"><a href="package-development.html#documenting-your-package"><i class="fa fa-check"></i><b>9.5</b> Documenting your package</a></li>
<li class="chapter" data-level="9.6" data-path="package-development.html"><a href="package-development.html#unit-testing-your-package"><i class="fa fa-check"></i><b>9.6</b> Unit testing your package</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="further-topics.html"><a href="further-topics.html"><i class="fa fa-check"></i><b>10</b> Further topics</a><ul>
<li class="chapter" data-level="10.1" data-path="further-topics.html"><a href="further-topics.html#using-python-from-r-with-reticulate"><i class="fa fa-check"></i><b>10.1</b> Using Python from R with <code>{reticulate}</code></a></li>
<li class="chapter" data-level="10.2" data-path="further-topics.html"><a href="further-topics.html#generating-pdf-or-word-reports-with-r"><i class="fa fa-check"></i><b>10.2</b> Generating Pdf or Word reports with R</a></li>
<li class="chapter" data-level="10.3" data-path="further-topics.html"><a href="further-topics.html#scraping-the-internet"><i class="fa fa-check"></i><b>10.3</b> Scraping the internet</a></li>
<li class="chapter" data-level="10.4" data-path="further-topics.html"><a href="further-topics.html#regular-expressions"><i class="fa fa-check"></i><b>10.4</b> Regular expressions</a></li>
<li class="chapter" data-level="10.5" data-path="further-topics.html"><a href="further-topics.html#setting-up-a-blog-with-blogdown"><i class="fa fa-check"></i><b>10.5</b> Setting up a blog with <code>{blogdown}</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern R with the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="statistical-models" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Statistical models</h1>
<p>In this chapter, we will not learn about all the models out there that you may or may not need.
Instead, I will show you how can use what you have learned until now and how you can apply these
concepts to modeling. Also, as you read in the beginning of the book, R has many many packages. So
the model you need is most probably already implemented in some package and you will very likely
not need to write your own from scratch.</p>
<p>In the first section, I will discuss the terminology used in this book. Then I will discuss
linear regression; showing how linear regression works illsutrates very well how other models
work too, without loss of generality. Then I will introduce the concepte of hyper-parameters
with ridge regression. This chapter will then finish with an introduction to cross-validation as
a way to tune the hyper-parameters of models that features them.</p>
<div id="terminology" class="section level2">
<h2><span class="header-section-number">6.1</span> Terminology</h2>
<p>Before continuing discussing about statistical models and model fitting it is worthwhile to discuss
terminology a little bit. Depending on your background, you might call an explanatory variable a
feature or the dependent variable the target. These are the same objects. The matrix of features
is usually called a design matrix, and what statisticians call the intercept is what
machine learning engineers call the bias. Referring to the intercept by bias is unfortunate, as bias
also has a very different meaning; bias is also what we call the error in a model that may cause
<em>biased</em> estimates. To finish up, the estimated parameters of the model may be called coefficients
or weights. Here again, I don‚Äôt like the using <em>weight</em> as weight as a very different meaning in
statistics.
So, in the remainder of this chapter, and book, I will use the terminology from the statistical
litterature, using dependent and explanatory variables (<code>y</code> and <code>x</code>), and calling the
estimated parameters coefficients and the intercept‚Ä¶ well the intercept (the <span class="math inline">\(\beta\)</span>s of the model).
However, I will talk of <em>training</em> a model, instead of <em>estimating</em> a model.</p>
</div>
<div id="fitting-a-model-to-data" class="section level2">
<h2><span class="header-section-number">6.2</span> Fitting a model to data</h2>
<p>Suppose you have a variable <code>y</code> that you wish to explain using a set of other variables <code>x1</code>, <code>x2</code>,
<code>x3</code>, etc. Let‚Äôs take a look at the <code>Housing</code> dataset from the <code>Ecdat</code> package:</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb756-1" data-line-number="1"><span class="kw">library</span>(Ecdat)</a>
<a class="sourceLine" id="cb756-2" data-line-number="2"></a>
<a class="sourceLine" id="cb756-3" data-line-number="3"><span class="kw">data</span>(Housing)</a></code></pre></div>
<p>You can read a description of the dataset by running:</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb757-1" data-line-number="1">?Housing</a></code></pre></div>
<pre><code>Housing                 package:Ecdat                  R Documentation

Sales Prices of Houses in the City of Windsor

Description:

     a cross-section from 1987

     _number of observations_ : 546

     _observation_ : goods

     _country_ : Canada

Usage:

     data(Housing)

Format:

     A dataframe containing :

     price: sale price of a house

     lotsize: the lot size of a property in square feet

     bedrooms: number of bedrooms

     bathrms: number of full bathrooms

     stories: number of stories excluding basement

     driveway: does the house has a driveway ?

     recroom: does the house has a recreational room ?

     fullbase: does the house has a full finished basement ?

     gashw: does the house uses gas for hot water heating ?

     airco: does the house has central air conditioning ?

     garagepl: number of garage places

     prefarea: is the house located in the preferred neighbourhood of the city ?

Source:

     Anglin, P.M.  and R.  Gencay (1996) ‚ÄúSemiparametric estimation of
     a hedonic price function‚Äù, _Journal of Applied Econometrics_,
     *11(6)*, 633-648.

References:

     Verbeek, Marno (2004) _A Guide to Modern Econometrics_, John Wiley
     and Sons, chapter 3.

     Journal of Applied Econometrics data archive : &lt;URL:
     http://qed.econ.queensu.ca/jae/&gt;.

See Also:

     ‚ÄòIndex.Source‚Äô, ‚ÄòIndex.Economics‚Äô, ‚ÄòIndex.Econometrics‚Äô,
     ‚ÄòIndex.Observations‚Äô</code></pre>
<p>or by looking for <code>Housing</code> in the help pane of RStudio. Usually, you would take a look a the data
before doing any modeling:</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb759-1" data-line-number="1"><span class="kw">glimpse</span>(Housing)</a></code></pre></div>
<pre><code>## Observations: 546
## Variables: 12
## $ price    &lt;dbl&gt; 42000, 38500, 49500, 60500, 61000, 66000, 66000, 69000, 8380‚Ä¶
## $ lotsize  &lt;dbl&gt; 5850, 4000, 3060, 6650, 6360, 4160, 3880, 4160, 4800, 5500, ‚Ä¶
## $ bedrooms &lt;dbl&gt; 3, 2, 3, 3, 2, 3, 3, 3, 3, 3, 3, 2, 3, 3, 2, 2, 3, 4, 1, 2, ‚Ä¶
## $ bathrms  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, ‚Ä¶
## $ stories  &lt;dbl&gt; 2, 1, 1, 2, 1, 1, 2, 3, 1, 4, 1, 1, 2, 1, 1, 1, 2, 3, 1, 1, ‚Ä¶
## $ driveway &lt;fct&gt; yes, yes, yes, yes, yes, yes, yes, yes, yes, yes, yes, no, y‚Ä¶
## $ recroom  &lt;fct&gt; no, no, no, yes, no, yes, no, no, yes, yes, no, no, no, no, ‚Ä¶
## $ fullbase &lt;fct&gt; yes, no, no, no, no, yes, yes, no, yes, no, yes, no, no, no,‚Ä¶
## $ gashw    &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no, ‚Ä¶
## $ airco    &lt;fct&gt; no, no, no, no, no, yes, no, no, no, yes, yes, no, no, no, n‚Ä¶
## $ garagepl &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 2, 0, 0, 1, 3, 0, 0, 0, 0, 0, 1, 0, 0, 1, ‚Ä¶
## $ prefarea &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no, ‚Ä¶</code></pre>
<p>Housing prices depend on a set of variables such as the number of bedrooms, the area it is located
and so on. If you believe that housing prices depend linearly on a set of explanatory variables,
you will want to estimate a linear model. To estimate a <em>linear model</em>, you will need to use the
built-in <code>lm()</code> function:</p>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb761-1" data-line-number="1">model1 &lt;-<span class="st"> </span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span>lotsize <span class="op">+</span><span class="st"> </span>bedrooms, <span class="dt">data =</span> Housing)</a></code></pre></div>
<p><code>lm()</code> takes a formula as an argument, which defines the model you want to estimate. In this case,
I ran the following regression:</p>
<p><span class="math display">\[
\text{price} = \beta_0 + \beta_1 * \text{lotsize} + \beta_2 * \text{bedrooms} + \varepsilon
\]</span></p>
<p>where <span class="math inline">\(\beta_0, \beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> are three parameters to estimate. To take a look at the
results, you can use the <code>summary()</code> method (not to be confused with <code>dplyr::summarise()</code>):</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb762-1" data-line-number="1"><span class="kw">summary</span>(model1)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = price ~ lotsize + bedrooms, data = Housing)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -65665 -12498  -2075   8970  97205 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 5.613e+03  4.103e+03   1.368    0.172    
## lotsize     6.053e+00  4.243e-01  14.265  &lt; 2e-16 ***
## bedrooms    1.057e+04  1.248e+03   8.470 2.31e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21230 on 543 degrees of freedom
## Multiple R-squared:  0.3703, Adjusted R-squared:  0.3679 
## F-statistic: 159.6 on 2 and 543 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>if you wish to remove the intercept (<span class="math inline">\(\beta_0\)</span> in the above equation) from your model, you can
do so with <code>-1</code>:</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb764-1" data-line-number="1">model2 &lt;-<span class="st"> </span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>lotsize <span class="op">+</span><span class="st"> </span>bedrooms, <span class="dt">data =</span> Housing)</a>
<a class="sourceLine" id="cb764-2" data-line-number="2"></a>
<a class="sourceLine" id="cb764-3" data-line-number="3"><span class="kw">summary</span>(model2)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = price ~ -1 + lotsize + bedrooms, data = Housing)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -67229 -12342  -1333   9627  95509 
## 
## Coefficients:
##           Estimate Std. Error t value Pr(&gt;|t|)    
## lotsize      6.283      0.390   16.11   &lt;2e-16 ***
## bedrooms 11968.362    713.194   16.78   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21250 on 544 degrees of freedom
## Multiple R-squared:  0.916,  Adjusted R-squared:  0.9157 
## F-statistic:  2965 on 2 and 544 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>or if you want to use all the columns inside <code>Housing</code>, replacing the column names by <code>.</code>:</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb766-1" data-line-number="1">model3 &lt;-<span class="st"> </span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> Housing)</a>
<a class="sourceLine" id="cb766-2" data-line-number="2"></a>
<a class="sourceLine" id="cb766-3" data-line-number="3"><span class="kw">summary</span>(model3)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = price ~ ., data = Housing)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -41389  -9307   -591   7353  74875 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -4038.3504  3409.4713  -1.184 0.236762    
## lotsize         3.5463     0.3503  10.124  &lt; 2e-16 ***
## bedrooms     1832.0035  1047.0002   1.750 0.080733 .  
## bathrms     14335.5585  1489.9209   9.622  &lt; 2e-16 ***
## stories      6556.9457   925.2899   7.086 4.37e-12 ***
## drivewayyes  6687.7789  2045.2458   3.270 0.001145 ** 
## recroomyes   4511.2838  1899.9577   2.374 0.017929 *  
## fullbaseyes  5452.3855  1588.0239   3.433 0.000642 ***
## gashwyes    12831.4063  3217.5971   3.988 7.60e-05 ***
## aircoyes    12632.8904  1555.0211   8.124 3.15e-15 ***
## garagepl     4244.8290   840.5442   5.050 6.07e-07 ***
## prefareayes  9369.5132  1669.0907   5.614 3.19e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 15420 on 534 degrees of freedom
## Multiple R-squared:  0.6731, Adjusted R-squared:  0.6664 
## F-statistic: 99.97 on 11 and 534 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>You can access different elements of <code>model3</code> with <code>$</code>, because the result of <code>lm()</code> is a list:</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb768-1" data-line-number="1"><span class="kw">print</span>(model3<span class="op">$</span>coefficients)</a></code></pre></div>
<pre><code>##  (Intercept)      lotsize     bedrooms      bathrms      stories  drivewayyes 
## -4038.350425     3.546303  1832.003466 14335.558468  6556.945711  6687.778890 
##   recroomyes  fullbaseyes     gashwyes     aircoyes     garagepl  prefareayes 
##  4511.283826  5452.385539 12831.406266 12632.890405  4244.829004  9369.513239</code></pre>
<p>but I prefer to use the <code>{broom}</code> package, and more specifically the <code>tidy()</code> function, which
converts <code>model3</code> into a neat <code>data.frame</code>:</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb770-1" data-line-number="1">results3 &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw">tidy</span>(model3)</a>
<a class="sourceLine" id="cb770-2" data-line-number="2"></a>
<a class="sourceLine" id="cb770-3" data-line-number="3"><span class="kw">glimpse</span>(results3)</a></code></pre></div>
<pre><code>## Observations: 12
## Variables: 5
## $ term      &lt;chr&gt; &quot;(Intercept)&quot;, &quot;lotsize&quot;, &quot;bedrooms&quot;, &quot;bathrms&quot;, &quot;stories&quot;,‚Ä¶
## $ estimate  &lt;dbl&gt; -4038.350425, 3.546303, 1832.003466, 14335.558468, 6556.945‚Ä¶
## $ std.error &lt;dbl&gt; 3409.4713, 0.3503, 1047.0002, 1489.9209, 925.2899, 2045.245‚Ä¶
## $ statistic &lt;dbl&gt; -1.184451, 10.123618, 1.749764, 9.621691, 7.086369, 3.26991‚Ä¶
## $ p.value   &lt;dbl&gt; 2.367616e-01, 3.732442e-22, 8.073341e-02, 2.570369e-20, 4.3‚Ä¶</code></pre>
<p>I explicitely write <code>broom::tidy()</code> because <code>tidy()</code> is a popular function name. For instance,
it is also a function from the <code>{yardstick}</code> package, which does not do the same thing at all. Since
I will also be using <code>{yardstick}</code> I prefer to explicitely write <code>broom::tidy()</code> to avoid conflicts.</p>
<p>Using <code>broom::tidy()</code> is useful, because you can then work on the results easily, for example if
you wish to only keep results that are significant at the 5% level:</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb772-1" data-line-number="1">results3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb772-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(p.value <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
##    term        estimate std.error statistic  p.value
##    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 lotsize         3.55     0.350     10.1  3.73e-22
##  2 bathrms     14336.    1490.         9.62 2.57e-20
##  3 stories      6557.     925.         7.09 4.37e-12
##  4 drivewayyes  6688.    2045.         3.27 1.15e- 3
##  5 recroomyes   4511.    1900.         2.37 1.79e- 2
##  6 fullbaseyes  5452.    1588.         3.43 6.42e- 4
##  7 gashwyes    12831.    3218.         3.99 7.60e- 5
##  8 aircoyes    12633.    1555.         8.12 3.15e-15
##  9 garagepl     4245.     841.         5.05 6.07e- 7
## 10 prefareayes  9370.    1669.         5.61 3.19e- 8</code></pre>
<p>You can even add new columns, such as the confidence intervals:</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb774-1" data-line-number="1">results3 &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw">tidy</span>(model3, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>, <span class="dt">conf.level =</span> <span class="fl">0.95</span>)</a>
<a class="sourceLine" id="cb774-2" data-line-number="2"></a>
<a class="sourceLine" id="cb774-3" data-line-number="3"><span class="kw">print</span>(results3)</a></code></pre></div>
<pre><code>## # A tibble: 12 x 7
##    term        estimate std.error statistic  p.value  conf.low conf.high
##    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept) -4038.    3409.        -1.18 2.37e- 1 -10736.     2659.  
##  2 lotsize         3.55     0.350     10.1  3.73e-22      2.86      4.23
##  3 bedrooms     1832.    1047.         1.75 8.07e- 2   -225.     3889.  
##  4 bathrms     14336.    1490.         9.62 2.57e-20  11409.    17262.  
##  5 stories      6557.     925.         7.09 4.37e-12   4739.     8375.  
##  6 drivewayyes  6688.    2045.         3.27 1.15e- 3   2670.    10705.  
##  7 recroomyes   4511.    1900.         2.37 1.79e- 2    779.     8244.  
##  8 fullbaseyes  5452.    1588.         3.43 6.42e- 4   2333.     8572.  
##  9 gashwyes    12831.    3218.         3.99 7.60e- 5   6511.    19152.  
## 10 aircoyes    12633.    1555.         8.12 3.15e-15   9578.    15688.  
## 11 garagepl     4245.     841.         5.05 6.07e- 7   2594.     5896.  
## 12 prefareayes  9370.    1669.         5.61 3.19e- 8   6091.    12648.</code></pre>
<p>Going back to model estimation, you can of course use <code>lm()</code> in a pipe workflow:</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb776-1" data-line-number="1">Housing <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb776-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>driveway, <span class="op">-</span>stories) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb776-3" data-line-number="3"><span class="st">  </span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb776-4" data-line-number="4"><span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>()</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
##    term        estimate std.error statistic  p.value
##    &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)  3025.    3263.        0.927 3.54e- 1
##  2 lotsize         3.67     0.363    10.1   4.52e-22
##  3 bedrooms     4140.    1036.        3.99  7.38e- 5
##  4 bathrms     16443.    1546.       10.6   4.29e-24
##  5 recroomyes   5660.    2010.        2.82  5.05e- 3
##  6 fullbaseyes  2241.    1618.        1.38  1.67e- 1
##  7 gashwyes    13568.    3411.        3.98  7.93e- 5
##  8 aircoyes    15578.    1597.        9.75  8.53e-21
##  9 garagepl     4232.     883.        4.79  2.12e- 6
## 10 prefareayes 10729.    1753.        6.12  1.81e- 9</code></pre>
<p>The first <code>.</code> in the <code>lm()</code> function is used to indicate that we wish to use all the data from <code>Housing</code>
(minus <code>driveway</code> and <code>stories</code> which I removed using <code>select()</code> and the <code>-</code> sign), and the second <code>.</code> is
used to <em>place</em> the result from the two <code>dplyr</code> instructions that preceded is to be placed there.
The picture below should help you understand:</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb778-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;pics/pipe_to_second_position.png&quot;</span>)</a></code></pre></div>
<p><img src="pics/pipe_to_second_position.png" width="288" /></p>
<p>You have to specify this, because by default, when using <code>%&gt;%</code> the left hand side argument gets
passed as the first argument of the function on the right hand side.</p>
</div>
<div id="diagnostics" class="section level2">
<h2><span class="header-section-number">6.3</span> Diagnostics</h2>
<p>Diagnostics are useful metrics to assess model fit. You can read some of these diagnostics, such as
the <span class="math inline">\(R^2\)</span> at the bottom of the summary (when running <code>summary(my_model)</code>), but if you want to do
more than simply reading these diagnostics from RStudio, you can put those in a <code>data.frame</code> too,
using <code>broom::glance()</code>:</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb779-1" data-line-number="1"><span class="kw">glance</span>(model3)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared  sigma statistic   p.value    df logLik    AIC    BIC
##       &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     0.673         0.666 15423.      100. 6.18e-122    12 -6034. 12094. 12150.
## # ‚Ä¶ with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>You can also plot the usual diagnostics plots using <code>ggfortify::autoplot()</code> which uses the
<code>{ggplot2}</code> package under the hood:</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb781-1" data-line-number="1"><span class="kw">library</span>(ggfortify)</a>
<a class="sourceLine" id="cb781-2" data-line-number="2"></a>
<a class="sourceLine" id="cb781-3" data-line-number="3"><span class="kw">autoplot</span>(model3, <span class="dt">which =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>()</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-478-1.png" width="672" /></p>
<p><code>which=1:6</code> is an additional option that shows you all the diagnostics plot. If you omit this
option, you will only get 4 of them.</p>
<p>You can also get the residuals of the regression in two ways; either you grab them directly from
the model fit:</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb782-1" data-line-number="1">resi3 &lt;-<span class="st"> </span><span class="kw">residuals</span>(model3)</a></code></pre></div>
<p>or you can augment the original data with a residuals column, using <code>broom::augment()</code>:</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb783-1" data-line-number="1">housing_aug &lt;-<span class="st"> </span><span class="kw">augment</span>(model3)</a></code></pre></div>
<p>Let‚Äôs take a look at <code>housing_aug</code>:</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb784-1" data-line-number="1"><span class="kw">glimpse</span>(housing_aug)</a></code></pre></div>
<pre><code>## Observations: 546
## Variables: 19
## $ price      &lt;dbl&gt; 42000, 38500, 49500, 60500, 61000, 66000, 66000, 69000, 83‚Ä¶
## $ lotsize    &lt;dbl&gt; 5850, 4000, 3060, 6650, 6360, 4160, 3880, 4160, 4800, 5500‚Ä¶
## $ bedrooms   &lt;dbl&gt; 3, 2, 3, 3, 2, 3, 3, 3, 3, 3, 3, 2, 3, 3, 2, 2, 3, 4, 1, 2‚Ä¶
## $ bathrms    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2‚Ä¶
## $ stories    &lt;dbl&gt; 2, 1, 1, 2, 1, 1, 2, 3, 1, 4, 1, 1, 2, 1, 1, 1, 2, 3, 1, 1‚Ä¶
## $ driveway   &lt;fct&gt; yes, yes, yes, yes, yes, yes, yes, yes, yes, yes, yes, no,‚Ä¶
## $ recroom    &lt;fct&gt; no, no, no, yes, no, yes, no, no, yes, yes, no, no, no, no‚Ä¶
## $ fullbase   &lt;fct&gt; yes, no, no, no, no, yes, yes, no, yes, no, yes, no, no, n‚Ä¶
## $ gashw      &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no‚Ä¶
## $ airco      &lt;fct&gt; no, no, no, no, no, yes, no, no, no, yes, yes, no, no, no,‚Ä¶
## $ garagepl   &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 2, 0, 0, 1, 3, 0, 0, 0, 0, 0, 1, 0, 0, 1‚Ä¶
## $ prefarea   &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, no‚Ä¶
## $ .fitted    &lt;dbl&gt; 66037.98, 41391.15, 39889.63, 63689.09, 49760.43, 66387.12‚Ä¶
## $ .se.fit    &lt;dbl&gt; 1790.507, 1406.500, 1534.102, 2262.056, 1567.689, 2366.755‚Ä¶
## $ .resid     &lt;dbl&gt; -24037.9757, -2891.1515, 9610.3699, -3189.0873, 11239.5735‚Ä¶
## $ .hat       &lt;dbl&gt; 0.013477335, 0.008316321, 0.009893730, 0.021510891, 0.0103‚Ä¶
## $ .sigma     &lt;dbl&gt; 15402.01, 15437.14, 15431.98, 15437.02, 15429.89, 15437.64‚Ä¶
## $ .cooksd    &lt;dbl&gt; 2.803214e-03, 2.476265e-05, 3.265481e-04, 8.004787e-05, 4.‚Ä¶
## $ .std.resid &lt;dbl&gt; -1.56917096, -0.18823924, 0.62621736, -0.20903274, 0.73253‚Ä¶</code></pre>
<p>A few columns have been added to the original data, among them <code>.resid</code> which contains the
residuals. Let‚Äôs plot them:</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb786-1" data-line-number="1"><span class="kw">ggplot</span>(housing_aug) <span class="op">+</span></a>
<a class="sourceLine" id="cb786-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(.resid))</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-483-1.png" width="672" /></p>
<p>Fitted values are also added to the original data, under the variable <code>.fitted</code>. It would also have
been possible to get the fitted values with:</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb787-1" data-line-number="1">fit3 &lt;-<span class="st"> </span><span class="kw">fitted</span>(model3)</a></code></pre></div>
<p>but I prefer using <code>augment()</code>, because the columns get merged to the original data, which then
makes it easier to find specific individuals, for example, you might want to know for which housing
units the model underestimates the price:</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb788-1" data-line-number="1">total_pos &lt;-<span class="st"> </span>housing_aug <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb788-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(.resid <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb788-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb788-4" data-line-number="4"><span class="st">  </span><span class="kw">pull</span>(total)</a></code></pre></div>
<p>we find 261 individuals where the residuals are positive. It is also easier to
extract outliers:</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb789-1" data-line-number="1">housing_aug <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb789-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prank =</span> <span class="kw">cume_dist</span>(.cooksd)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb789-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(prank <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.99</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb789-4" data-line-number="4"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 6
## Variables: 20
## $ price      &lt;dbl&gt; 163000, 125000, 132000, 175000, 190000, 174500
## $ lotsize    &lt;dbl&gt; 7420, 4320, 3500, 9960, 7420, 7500
## $ bedrooms   &lt;dbl&gt; 4, 3, 4, 3, 4, 4
## $ bathrms    &lt;dbl&gt; 1, 1, 2, 2, 2, 2
## $ stories    &lt;dbl&gt; 2, 2, 2, 2, 3, 2
## $ driveway   &lt;fct&gt; yes, yes, yes, yes, yes, yes
## $ recroom    &lt;fct&gt; yes, no, no, no, no, no
## $ fullbase   &lt;fct&gt; yes, yes, no, yes, no, yes
## $ gashw      &lt;fct&gt; no, yes, yes, no, no, no
## $ airco      &lt;fct&gt; yes, no, no, no, yes, yes
## $ garagepl   &lt;dbl&gt; 2, 2, 2, 2, 2, 3
## $ prefarea   &lt;fct&gt; no, no, no, yes, yes, yes
## $ .fitted    &lt;dbl&gt; 94826.68, 77688.37, 85495.58, 108563.18, 115125.03, 118549‚Ä¶
## $ .se.fit    &lt;dbl&gt; 2520.691, 3551.954, 3544.961, 2589.680, 2185.603, 2586.007
## $ .resid     &lt;dbl&gt; 68173.32, 47311.63, 46504.42, 66436.82, 74874.97, 55951.00
## $ .hat       &lt;dbl&gt; 0.02671105, 0.05303793, 0.05282929, 0.02819317, 0.02008141‚Ä¶
## $ .sigma     &lt;dbl&gt; 15144.70, 15293.34, 15298.27, 15159.14, 15085.99, 15240.66
## $ .cooksd    &lt;dbl&gt; 0.04590995, 0.04637969, 0.04461464, 0.04616068, 0.04107317‚Ä¶
## $ .std.resid &lt;dbl&gt; 4.480428, 3.152300, 3.098176, 4.369631, 4.904193, 3.679815
## $ prank      &lt;dbl&gt; 0.9963370, 1.0000000, 0.9945055, 0.9981685, 0.9926740, 0.9‚Ä¶</code></pre>
<p><code>prank</code> is a variable I created with <code>cume_dist()</code> which is a <code>dplyr</code> function that returns the
proportion of all values less than or equal to the current rank. For example:</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb791-1" data-line-number="1">example &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="fl">4.6</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="fl">0.8</span>, <span class="dv">0</span>, <span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb791-2" data-line-number="2"><span class="kw">cume_dist</span>(example)</a></code></pre></div>
<pre><code>## [1] 1.0000000 0.8571429 0.7142857 0.5714286 0.4285714 0.2857143 0.1428571</code></pre>
<p>by filtering <code>prank &gt; 0.99</code> we get the top 1% of outliers according to Cook‚Äôs distance.</p>
</div>
<div id="interpreting-models" class="section level2">
<h2><span class="header-section-number">6.4</span> Interpreting models</h2>
<p>Model interpretation is essential in the social sciences, but it is also getting very important
in machine learning. As usual, the terminology is different; in machine learning, we speak about
explainability. There is a very important aspect that one has to understand when it comes to
interpretability/explainability: <em>classical, parametric</em> models, and <em>black-box</em> models. This
is very well explained in <span class="citation">Breiman (<a href="#ref-breiman2001">2001</a>)</span>, an absolute must read (link to paper, in PDF format:
<a href="https://projecteuclid.org/download/pdf_1/euclid.ss/1009213726">click here</a>). The gist of the paper
is that there are two cultures of statistical modeling; one culture relies on modeling the data
generating process, for instance, by considering that a variable y (independent variable, or target)
is a linear combination of input variables x (dependent variables, or features) plus some noise. The
other culture uses complex algorithms (random forests, neural networks)
to model the relationship between y and x. The author argues that most statisticians have relied
for too long on modeling data generating processes and do not use all the potential offered by
these complex algorithms. I think that a lot of things have changed since then, and that nowadays
any practitioner that uses data is open to use any type of model or algorithm, as long as it does
the job. However, the paper is very interesting, and the discussion on trade-off between
simplicity of the model and interpretability/explainability is still relevant today.</p>
<p>In this section, I will explain how one can go about interpreting or explaining models from these
two cultures.</p>
<p>Also, it is important to note here that the discussion that will follow will be heavily influenced
by my econometrics background. I will focus on marginal effects as way to interpret parametric
models (models from the first culture described above), but depending on the field, practitioners
might use something else (for instance by computing odds ratios in a logistic regression).</p>
<p>I will start by interpretability of <em>classical</em> statistical models.</p>
<div id="marginal-effects" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Marginal effects</h3>
<p>If one wants to know the effect of variable <code>x</code> on the dependent variable <code>y</code>,
marginal effects have to be computed. This is easily done in R with the <code>{margins}</code> package, which
aims to provide the same functionality as the <code>margins</code> command in STATA:</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb793-1" data-line-number="1"><span class="kw">library</span>(margins)</a>
<a class="sourceLine" id="cb793-2" data-line-number="2"></a>
<a class="sourceLine" id="cb793-3" data-line-number="3">effects_model3 &lt;-<span class="st"> </span><span class="kw">margins</span>(model3)</a>
<a class="sourceLine" id="cb793-4" data-line-number="4"></a>
<a class="sourceLine" id="cb793-5" data-line-number="5"><span class="kw">summary</span>(effects_model3)</a></code></pre></div>
<pre><code>##       factor        AME        SE       z      p      lower      upper
##     aircoyes 12632.8904 1555.0329  8.1239 0.0000  9585.0819 15680.6989
##      bathrms 14335.5585 1493.2618  9.6002 0.0000 11408.8192 17262.2978
##     bedrooms  1832.0035 1055.0015  1.7365 0.0825  -235.7615  3899.7684
##  drivewayyes  6687.7789 2045.2440  3.2699 0.0011  2679.1742 10696.3835
##  fullbaseyes  5452.3855 1588.0282  3.4334 0.0006  2339.9075  8564.8636
##     garagepl  4244.8290  842.0260  5.0412 0.0000  2594.4883  5895.1697
##     gashwyes 12831.4063 3217.6216  3.9879 0.0001  6524.9839 19137.8286
##      lotsize     3.5463    0.3505 10.1179 0.0000     2.8593     4.2333
##  prefareayes  9369.5132 1669.1034  5.6135 0.0000  6098.1307 12640.8957
##   recroomyes  4511.2838 1899.9722  2.3744 0.0176   787.4068  8235.1608
##      stories  6556.9457  921.1921  7.1179 0.0000  4751.4424  8362.4490</code></pre>
<p>It is also possible to plot the results:</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb795-1" data-line-number="1"><span class="kw">plot</span>(effects_model3)</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-489-1.png" width="672" /></p>
<p>This uses the basic R plotting capabilities, which is useful because it is a simple call to the
function <code>plot()</code> but if you‚Äôve been using <code>{ggplot2}</code> and want this graph to have the same feel as
the others made with <code>{ggplot2}</code> you first need to save the summary in a variable.
<code>summary(effects_model3)</code> is a <code>data.frame</code> with many details. Let‚Äôs overwrite this
<code>effects_model3</code> with its summary:</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb796-1" data-line-number="1">effects_model3 &lt;-<span class="st"> </span><span class="kw">summary</span>(effects_model3)</a></code></pre></div>
<p>And now it is possible to use <code>ggplot2</code> to have the same plot:</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb797-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> effects_model3) <span class="op">+</span></a>
<a class="sourceLine" id="cb797-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(factor, AME)) <span class="op">+</span></a>
<a class="sourceLine" id="cb797-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> factor, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper)) <span class="op">+</span></a>
<a class="sourceLine" id="cb797-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb797-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb797-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>))</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-491-1.png" width="672" /></p>
<p>Of course for <code>model3</code>, the marginal effects are the same as the coefficients, so let‚Äôs estimate a
logit model and compute the marginal effects. You might know logit models as <em>logistic regression</em>.
Logit models can be estimated using the <code>glm()</code> function, which stands for generalized linear
models.</p>
<p>As an example, we are going to use the <code>Participation</code> data, also from the <code>{Ecdat}</code> package:</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb798-1" data-line-number="1"><span class="kw">data</span>(Participation)</a></code></pre></div>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb799-1" data-line-number="1">?Particpation</a></code></pre></div>
<pre><code>Participation              package:Ecdat               R Documentation

Labor Force Participation

Description:

     a cross-section

     _number of observations_ : 872

     _observation_ : individuals

     _country_ : Switzerland

Usage:

     data(Participation)

Format:

     A dataframe containing :

     lfp labour force participation ?

     lnnlinc the log of nonlabour income

     age age in years divided by 10

     educ years of formal education

     nyc the number of young children (younger than 7)

     noc number of older children

     foreign foreigner ?

Source:

     Gerfin, Michael (1996) ‚ÄúParametric and semiparametric estimation
     of the binary response‚Äù, _Journal of Applied Econometrics_,
     *11(3)*, 321-340.

References:

     Davidson, R.  and James G.  MacKinnon (2004) _Econometric Theory
     and Methods_, New York, Oxford University Press, &lt;URL:
     http://www.econ.queensu.ca/ETM/&gt;, chapter 11.

     Journal of Applied Econometrics data archive : &lt;URL:
     http://qed.econ.queensu.ca/jae/&gt;.

See Also:

     ‚ÄòIndex.Source‚Äô, ‚ÄòIndex.Economics‚Äô, ‚ÄòIndex.Econometrics‚Äô,
     ‚ÄòIndex.Observations‚Äô</code></pre>
<p>The variable of interest is <code>lfp</code>: whether the individual participates in the labour force or not.
To know which variables are relevant in the decision to participate in the labour force, one could
train a logit model, using <code>glm()</code>:</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb801-1" data-line-number="1">logit_participation &lt;-<span class="st"> </span><span class="kw">glm</span>(lfp <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> Participation, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</a>
<a class="sourceLine" id="cb801-2" data-line-number="2"></a>
<a class="sourceLine" id="cb801-3" data-line-number="3">broom<span class="op">::</span><span class="kw">tidy</span>(logit_participation)</a></code></pre></div>
<pre><code>## # A tibble: 7 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)  10.4       2.17       4.79  1.69e- 6
## 2 lnnlinc      -0.815     0.206     -3.97  7.31e- 5
## 3 age          -0.510     0.0905    -5.64  1.72e- 8
## 4 educ          0.0317    0.0290     1.09  2.75e- 1
## 5 nyc          -1.33      0.180     -7.39  1.51e-13
## 6 noc          -0.0220    0.0738    -0.298 7.66e- 1
## 7 foreignyes    1.31      0.200      6.56  5.38e-11</code></pre>
<p>From the results above, one can only interpret the sign of the coefficients. To know how much a
variable influences the labour force participation, one has to use <code>margins()</code>:</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb803-1" data-line-number="1">effects_logit_participation &lt;-<span class="st"> </span><span class="kw">margins</span>(logit_participation) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb803-2" data-line-number="2"><span class="st">  </span><span class="kw">summary</span>()</a>
<a class="sourceLine" id="cb803-3" data-line-number="3"></a>
<a class="sourceLine" id="cb803-4" data-line-number="4"><span class="kw">print</span>(effects_logit_participation)</a></code></pre></div>
<pre><code>##      factor     AME     SE       z      p   lower   upper
##         age -0.1064 0.0176 -6.0494 0.0000 -0.1409 -0.0719
##        educ  0.0066 0.0060  1.0955 0.2733 -0.0052  0.0185
##  foreignyes  0.2834 0.0399  7.1102 0.0000  0.2053  0.3615
##     lnnlinc -0.1699 0.0415 -4.0994 0.0000 -0.2512 -0.0887
##         noc -0.0046 0.0154 -0.2981 0.7656 -0.0347  0.0256
##         nyc -0.2775 0.0333 -8.3433 0.0000 -0.3426 -0.2123</code></pre>
<p>We can use the previous code to plot the marginal effects:</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb805-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> effects_logit_participation) <span class="op">+</span></a>
<a class="sourceLine" id="cb805-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(factor, AME)) <span class="op">+</span></a>
<a class="sourceLine" id="cb805-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> factor, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper)) <span class="op">+</span></a>
<a class="sourceLine" id="cb805-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb805-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb805-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>))</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-496-1.png" width="672" /></p>
<p>So an infinitesimal increase, in say, non-labour income (<code>lnnlinc</code>) of 0.001 is associated with a
decrease of the probability of labour force participation by 0.001*17 percentage points.</p>
<p>You can also extract the marginal effects of a single variable:</p>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb806-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">dydx</span>(Participation, logit_participation, <span class="st">&quot;lnnlinc&quot;</span>))</a></code></pre></div>
<pre><code>##   dydx_lnnlinc
## 1  -0.15667764
## 2  -0.20014487
## 3  -0.18495109
## 4  -0.05377262
## 5  -0.18710476
## 6  -0.19586986</code></pre>
<p>Which makes it possible to extract the effect for a list of individuals that you can create yourself:</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb808-1" data-line-number="1">my_subjects &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb808-2" data-line-number="2">    <span class="op">~</span>lfp,  <span class="op">~</span>lnnlinc, <span class="op">~</span>age, <span class="op">~</span>educ, <span class="op">~</span>nyc, <span class="op">~</span>noc, <span class="op">~</span>foreign,</a>
<a class="sourceLine" id="cb808-3" data-line-number="3">    <span class="st">&quot;yes&quot;</span>,   <span class="fl">10.780</span>,  <span class="fl">7.0</span>,     <span class="dv">4</span>,    <span class="dv">1</span>,   <span class="dv">1</span>,     <span class="st">&quot;yes&quot;</span>,</a>
<a class="sourceLine" id="cb808-4" data-line-number="4">    <span class="st">&quot;no&quot;</span>,      <span class="fl">1.30</span>,  <span class="fl">9.0</span>,     <span class="dv">1</span>,    <span class="dv">4</span>,   <span class="dv">1</span>,     <span class="st">&quot;yes&quot;</span></a>
<a class="sourceLine" id="cb808-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb808-6" data-line-number="6"></a>
<a class="sourceLine" id="cb808-7" data-line-number="7"><span class="kw">dydx</span>(my_subjects, logit_participation, <span class="st">&quot;lnnlinc&quot;</span>)</a></code></pre></div>
<pre><code>##   dydx_lnnlinc
## 1  -0.09228119
## 2  -0.17953451</code></pre>
<p>I used the <code>tribble()</code> function from the <code>{tibble}</code> package to create this test data set, row by row.
Then, using <code>dydx()</code>, I get the marginal effect of variable <code>lnnlinc</code> for these two individuals.</p>
</div>
<div id="explainability-of-black-box-models" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Explainability of <em>black-box</em> models</h3>
</div>
</div>
<div id="comparing-models" class="section level2">
<h2><span class="header-section-number">6.5</span> Comparing models</h2>
<p>Let‚Äôs estimate another model on the same data; prices are only positive, so a linear regression
might not be the best model, because the model could predict negative prices. Let‚Äôs look at the
distribution of prices:</p>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb810-1" data-line-number="1"><span class="kw">ggplot</span>(Housing) <span class="op">+</span></a>
<a class="sourceLine" id="cb810-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(price))</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-499-1.png" width="672" /></p>
<p>it looks like modeling the log of <code>price</code> might provide a better fit:</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb811-1" data-line-number="1">model_log &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(price) <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> Housing)</a>
<a class="sourceLine" id="cb811-2" data-line-number="2"></a>
<a class="sourceLine" id="cb811-3" data-line-number="3">result_log &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw">tidy</span>(model_log)</a>
<a class="sourceLine" id="cb811-4" data-line-number="4"></a>
<a class="sourceLine" id="cb811-5" data-line-number="5"><span class="kw">print</span>(result_log)</a></code></pre></div>
<pre><code>## # A tibble: 12 x 5
##    term          estimate  std.error statistic  p.value
##    &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept) 10.0       0.0472        212.   0.      
##  2 lotsize      0.0000506 0.00000485     10.4  2.91e-23
##  3 bedrooms     0.0340    0.0145          2.34 1.94e- 2
##  4 bathrms      0.168     0.0206          8.13 3.10e-15
##  5 stories      0.0923    0.0128          7.20 2.10e-12
##  6 drivewayyes  0.131     0.0283          4.61 5.04e- 6
##  7 recroomyes   0.0735    0.0263          2.79 5.42e- 3
##  8 fullbaseyes  0.0994    0.0220          4.52 7.72e- 6
##  9 gashwyes     0.178     0.0446          4.00 7.22e- 5
## 10 aircoyes     0.178     0.0215          8.26 1.14e-15
## 11 garagepl     0.0508    0.0116          4.36 1.58e- 5
## 12 prefareayes  0.127     0.0231          5.50 6.02e- 8</code></pre>
<p>Let‚Äôs take a look at the diagnostics:</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb813-1" data-line-number="1"><span class="kw">glance</span>(model_log)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.677         0.670 0.214      102. 3.67e-123    12   73.9 -122. -65.8
## # ‚Ä¶ with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>Let‚Äôs compare these to the ones from the previous model:</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb815-1" data-line-number="1">diag_lm &lt;-<span class="st"> </span><span class="kw">glance</span>(model3)</a>
<a class="sourceLine" id="cb815-2" data-line-number="2"></a>
<a class="sourceLine" id="cb815-3" data-line-number="3">diag_lm &lt;-<span class="st"> </span>diag_lm <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb815-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;lin-lin model&quot;</span>)</a>
<a class="sourceLine" id="cb815-5" data-line-number="5"></a>
<a class="sourceLine" id="cb815-6" data-line-number="6">diag_log &lt;-<span class="st"> </span><span class="kw">glance</span>(model_log)</a>
<a class="sourceLine" id="cb815-7" data-line-number="7"></a>
<a class="sourceLine" id="cb815-8" data-line-number="8">diag_log  &lt;-<span class="st"> </span>diag_log <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb815-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;log-lin model&quot;</span>)</a>
<a class="sourceLine" id="cb815-10" data-line-number="10"></a>
<a class="sourceLine" id="cb815-11" data-line-number="11">diagnostics_models &lt;-<span class="st"> </span><span class="kw">full_join</span>(diag_lm, diag_log)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;r.squared&quot;, &quot;adj.r.squared&quot;, &quot;sigma&quot;, &quot;statistic&quot;, &quot;p.value&quot;,
## &quot;df&quot;, &quot;logLik&quot;, &quot;AIC&quot;, &quot;BIC&quot;, &quot;deviance&quot;, &quot;df.residual&quot;, &quot;model&quot;)</code></pre>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb817-1" data-line-number="1"><span class="kw">print</span>(diagnostics_models)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 12
##   r.squared adj.r.squared   sigma statistic   p.value    df  logLik    AIC
##       &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1     0.673         0.666 1.54e+4      100. 6.18e-122    12 -6034.  12094.
## 2     0.677         0.670 2.14e-1      102. 3.67e-123    12    73.9  -122.
## # ‚Ä¶ with 4 more variables: BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, df.residual &lt;int&gt;,
## #   model &lt;chr&gt;</code></pre>
<p>I saved the diagnostics in two different <code>data.frame</code> objects using the <code>glance()</code> function and added a
<code>model</code> column to indicate which model the diagnostics come from. Then I merged both datasets using
<code>full_join()</code>, a <code>{dplyr}</code> function.</p>
<p>As you can see, the model with the logarithm of the prices as the dependent variable has a higher
likelihood (and thus lower AIC and BIC) than the simple linear model. Let‚Äôs take a look at the
diagnostics plots:</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb819-1" data-line-number="1"><span class="kw">autoplot</span>(model_log, <span class="dt">which =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>()</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-504-1.png" width="672" /></p>
</div>
<div id="using-a-model-for-prediction" class="section level2">
<h2><span class="header-section-number">6.6</span> Using a model for prediction</h2>
<p>Once you estimated a model, you might want to use it for prediction. This is easily done using the
<code>predict()</code> function that works with most models. Prediction is also useful as a way to test the
accuracy of your model: split your data into a training set (used for training) and a testing
set (used for the pseudo-prediction) and see if your model overfits the data. We are going to see
how to do that in a later section; for now, let‚Äôs just get acquainted with <code>predict()</code> and other
functions. I insist, keep in mind that this section is only to get acquainted with these functions.
We are going to explore prediction, overfitting and tuning of models in a later section.</p>
<p>Let‚Äôs go back to the models we trained in the previous section, <code>model3</code> and <code>model_log</code>. Let‚Äôs also
take a subsample of data, which we will be using for prediction:</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb820-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb820-2" data-line-number="2"></a>
<a class="sourceLine" id="cb820-3" data-line-number="3">pred_set &lt;-<span class="st"> </span>Housing <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb820-4" data-line-number="4"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">20</span>)</a></code></pre></div>
<p>In order to always get the same <code>pred_set</code>, I set the random seed first. Let‚Äôs take a look at the
data:</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb821-1" data-line-number="1"><span class="kw">print</span>(pred_set)</a></code></pre></div>
<pre><code>##     price lotsize bedrooms bathrms stories driveway recroom fullbase gashw
## 1   45000    6750        2       1       1      yes      no       no    no
## 2   57000    4500        3       2       2       no      no      yes    no
## 3   85000    7231        3       1       2      yes     yes      yes    no
## 4   59900    8250        3       1       1      yes      no      yes    no
## 5  125000    4320        3       1       2      yes      no      yes   yes
## 6   99000    8880        3       2       2      yes      no      yes    no
## 7   55000    3180        2       2       1      yes      no      yes    no
## 8   59000    4632        4       1       2      yes      no       no    no
## 9  112500    6550        3       1       2      yes      no      yes    no
## 10  63900    3510        3       1       2      yes      no       no    no
## 11  60500    6650        3       1       2      yes     yes       no    no
## 12  42000    2700        2       1       1       no      no       no    no
## 13  33000    3180        2       1       1      yes      no       no    no
## 14  70000    4646        3       1       2      yes     yes      yes    no
## 15  88000    5450        4       2       1      yes      no      yes    no
## 16  64000    4040        3       1       2      yes      no       no    no
## 17  62900    2880        3       1       2      yes      no       no    no
## 18  84000    7160        3       1       1      yes      no      yes    no
## 19  58500    3680        3       2       2      yes      no       no    no
## 20  35000    4840        2       1       2      yes      no       no    no
##    airco garagepl prefarea
## 1     no        0       no
## 2    yes        0       no
## 3    yes        0      yes
## 4     no        3       no
## 5     no        2       no
## 6    yes        1       no
## 7     no        2       no
## 8    yes        0       no
## 9    yes        0      yes
## 10    no        0       no
## 11    no        0       no
## 12    no        0       no
## 13    no        0       no
## 14    no        2       no
## 15   yes        0      yes
## 16    no        1       no
## 17    no        0      yes
## 18    no        2      yes
## 19    no        0       no
## 20    no        0       no</code></pre>
<p>If we wish to use it for prediction, this is easily done with <code>predict()</code>:</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb823-1" data-line-number="1"><span class="kw">predict</span>(model3, pred_set)</a></code></pre></div>
<pre><code>##         1         2         3         4         5         6         7         8 
##  51143.48  77286.31  93204.28  76481.82  77688.37 103751.72  66760.79  66486.26 
##         9        10        11        12        13        14        15        16 
##  86277.96  48042.41  63689.09  30093.18  38483.18  70524.34  91987.65  54166.78 
##        17        18        19        20 
##  55177.75  77741.03  62980.84  50926.99</code></pre>
<p>This returns a vector of predicted prices. This can then be used to compute the Root Mean Squared Error
for instance. Let‚Äôs do it within a <code>tidyverse</code> pipeline:</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb825-1" data-line-number="1">rmse &lt;-<span class="st"> </span>pred_set <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb825-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predictions =</span> <span class="kw">predict</span>(model3, .)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb825-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">sqrt</span>(<span class="kw">sum</span>(predictions <span class="op">-</span><span class="st"> </span>price)<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="kw">n</span>()))</a></code></pre></div>
<p>The root mean square error of <code>model3</code> is 3646.0817347.</p>
<p>I also used the <code>n()</code> function which returns the number of observations in a group (or all the
observations, if the data is not grouped). Let‚Äôs compare <code>model3</code> ‚Äôs RMSE with the one from
<code>model_log</code>:</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb826-1" data-line-number="1">rmse2 &lt;-<span class="st"> </span>pred_set <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb826-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predictions =</span> <span class="kw">exp</span>(<span class="kw">predict</span>(model_log, .))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb826-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">sqrt</span>(<span class="kw">sum</span>(predictions <span class="op">-</span><span class="st"> </span>price)<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="kw">n</span>()))</a></code></pre></div>
<p>Don‚Äôt forget to exponentiate the predictions, remember you‚Äôre dealing with a log-linear model! <code>model_log</code>‚Äôs
RMSE is 1.212513310^{4} which is lower than <code>model3</code>‚Äôs. However, keep in mind that the model was trained
on the whole data, and then the prediction quality was assessed using a subsample of the data the
model was trained on‚Ä¶ so actually we can‚Äôt really say if <code>model_log</code>‚Äôs predictions are very useful.
Of course, this is the same for <code>model3</code>.
In a later section we are going to learn how to do cross validation to avoid this issue.</p>
<p>Also another problem of what I did before, unrelated to statistics per se, is that I wanted to compute
the same quantity for two different models, and did so by copy and pasting 3 lines of code. That‚Äôs not
much, but if I wanted to compare 10 models, copy and paste mistakes could have sneaked in. Instead,
it would have been nice to have a function that computes the RMSE and then use it on my models. We
are going to learn how to write our own function and use it just like if it was another built-in
R function.</p>
</div>
<div id="beyond-linear-regression" class="section level2">
<h2><span class="header-section-number">6.7</span> Beyond linear regression</h2>
<p>R has a lot of other built-in functions for regression, such as <code>glm()</code> (for Generalized Linear
Models) and <code>nls()</code> for (for Nonlinear Least Squares). There are also functions and additional
packages for time series, panel data, machine learning, bayesian and nonparametric methods.
Presenting everything here would take too much space, and would be pretty useless as you can find
whatever you need using an internet search engine. What you have learned until now is quite general
and should work on many type of models. To help you out, here is a list of methods and the
recommended packages that you can use:</p>
<table>
<thead>
<tr class="header">
<th>Model</th>
<th>Package</th>
<th>Quick example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Robust Linear Regression</td>
<td><code>MASS</code></td>
<td><code>rlm(y ~ x, data = mydata)</code></td>
</tr>
<tr class="even">
<td>Nonlinear Least Squares</td>
<td><code>stats</code><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></td>
<td><code>nls(y ~ x1 / (1 + x2), data = mydata)</code><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></td>
</tr>
<tr class="odd">
<td>Logit</td>
<td><code>stats</code></td>
<td><code>glm(y ~ x, data = mydata, family = &quot;binomial&quot;)</code></td>
</tr>
<tr class="even">
<td>Probit</td>
<td><code>stats</code></td>
<td><code>glm(y ~ x, data = mydata, family = binomial(link = &quot;probit&quot;))</code></td>
</tr>
<tr class="odd">
<td>K-Means</td>
<td><code>stats</code></td>
<td><code>kmeans(data, n)</code><a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></td>
</tr>
<tr class="even">
<td>PCA</td>
<td><code>stats</code></td>
<td><code>prcomp(data, scale = TRUE, center = TRUE)</code><a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></td>
</tr>
<tr class="odd">
<td>Multinomial Logit</td>
<td><code>mlogit</code></td>
<td>Requires several steps of data pre-processing and formula definition, refer to the <a href="https://cran.r-project.org/web/packages/mlogit/vignettes/mlogit.pdf">Vignette</a> for more details.</td>
</tr>
<tr class="even">
<td>Cox PH</td>
<td><code>survival</code></td>
<td><code>coxph(Surv(y_time, y_status) ~ x, data = mydata)</code><a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></td>
</tr>
<tr class="odd">
<td>Time series</td>
<td>Several, depending on your needs.</td>
<td>Time series in R is a vast subject that would require a very thick book to cover. You can get started with the following series of blog articles, <a href="http://www.business-science.io/timeseries-analysis/2017/07/02/tidy-timeseries-analysis.html">Tidy time-series, part 1</a>, <a href="http://www.business-science.io/timeseries-analysis/2017/07/23/tidy-timeseries-analysis-pt-2.html">Tidy time-series, part 2</a>, <a href="http://www.business-science.io/timeseries-analysis/2017/07/30/tidy-timeseries-analysis-pt-3.html">Tidy time-series, part 3</a> and <a href="http://www.business-science.io/timeseries-analysis/2017/08/30/tidy-timeseries-analysis-pt-4.html">Tidy time-series, part 3</a></td>
</tr>
<tr class="even">
<td>Panel data</td>
<td><code>plm</code></td>
<td><code>plm(y ~ x, data = mydata, model = &quot;within|random&quot;)</code></td>
</tr>
<tr class="odd">
<td>Neural Networks</td>
<td>Several, depending on your needs.</td>
<td>R is a very popular programming language for machine learning. <a href="http://ww.rblog.uni-freiburg.de/2017/02/07/deep-learning-in-r">This blog post</a> lists and compares some of the most useful packages for Neural nets and deep learning.</td>
</tr>
<tr class="even">
<td>Nonparametric regression</td>
<td><code>np</code></td>
<td>Several functions and options available, refer to the <a href="https://cran.r-project.org/web/packages/np/vignettes/np.pdf">Vignette</a> for more details.</td>
</tr>
</tbody>
</table>
<p>I put neural networks in the table, but you can also find packages for regression trees, naive
bayes, and pretty much any machine learning method out there! The same goes for Bayesian methods.
Popular packages include <code>{rstan}</code>, <code>{rjags}</code> which link R to STAN and JAGS (two other pieces of software
that do the Gibbs sampling for you) which are tools that allow you to fit very general models. It
is also possible to train models using Bayesian inference without the need of external tools,
with the <code>{bayesm}</code> package which estimates the usual micro-econometric models.
There really are a lot of packages available for Bayesian inference, and you can find them all in the
<a href="https://cran.r-project.org/web/views/Bayesian.html">related CRAN Task View</a>.</p>
</div>
<div id="hyper-parameters" class="section level2">
<h2><span class="header-section-number">6.8</span> Hyper-parameters</h2>
<p>Hyper-parameters are parameters of the model that cannot be directly learned from the data.
A linear regression does not have any hyper-parameters, but a random forest for instance has several.
You might have heard of ridge regression, lasso and elasticnet. These are
extensions of linear models that avoid over-fitting by penalizing <em>large</em> models. These
extensions of the linear regression have hyper-parameters that the practitioner has to tune. There
are several ways one can tune these parameters, for example, by doing a grid-search, or a random
search over the grid or using more elaborate methods. To introduce hyper-parameters, let‚Äôs get
to know ridge regression, also called Tikhonov regularization.</p>
<div id="ridge-regression" class="section level3">
<h3><span class="header-section-number">6.8.1</span> Ridge regression</h3>
<p>Ridge regression is used when the data you are working with has a lot of explanatory variables,
or when there is a risk that a simple linear regression might overfit to the training data, because,
for example, your explanatory variables are collinear.
If you are training a linear model and then you notice that it generalizes very badly to new,
unseen data, it is very likely that the linear model you trained overfit the data.
In this case, ridge regression might prove useful. The way ridge regression works might seem
counter-intuititive; it boils down to fitting a <em>worse</em> model to the training data, but in return,
this worse model will generalize better to new data.</p>
<p>The closed form solution of the ordinary least squares estimator is defined as:</p>
<p><span class="math display">\[
\widehat{\beta} = (X&#39;X)^{-1}X&#39;Y
\]</span></p>
<p>where <span class="math inline">\(X\)</span> is the design matrix (the matrix made up of the explanatory variables) and <span class="math inline">\(Y\)</span> is the
dependent variable. For ridge regression, this closed form solution changes a little bit:</p>
<p><span class="math display">\[
\widehat{\beta} = (X&#39;X + \lambda I_p)^{-1}X&#39;Y
\]</span></p>
<p>where <span class="math inline">\(\lambda \in \mathbb{R}\)</span> is an hyper-parameter and <span class="math inline">\(I_p\)</span> is the identity matrix of dimension <span class="math inline">\(p\)</span>
(<span class="math inline">\(p\)</span> is the number of explanatory variables).
This formula above is the closed form solution to the following optimisation program:</p>
<p><span class="math display">\[
\sum_{i=1}^n \left(y_i - \sum_{j=1}^px_{ij}\beta_j\right)^2 
\]</span></p>
<p>such that:</p>
<p><span class="math display">\[
\sum_{j=1}^p(\beta_j)^2 &lt; c
\]</span></p>
<p>for any strictly positive <span class="math inline">\(c\)</span>.</p>
<p>The <code>glmnet()</code> function from the <code>{glmnet}</code> package can be used for ridge regression, by setting
the <code>alpha</code> argument to 0 (setting it to 1 would do LASSO, and setting it to a number between
0 and 1 would do elasticnet). But in order to compare linear regression and ridge regression,
let me first divide the data into a training set and a testing set:</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb827-1" data-line-number="1">index &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Housing)</a>
<a class="sourceLine" id="cb827-2" data-line-number="2"></a>
<a class="sourceLine" id="cb827-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb827-4" data-line-number="4">train_index &lt;-<span class="st"> </span><span class="kw">sample</span>(index, <span class="kw">round</span>(<span class="fl">0.90</span><span class="op">*</span><span class="kw">nrow</span>(Housing)), <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb827-5" data-line-number="5"></a>
<a class="sourceLine" id="cb827-6" data-line-number="6">test_index &lt;-<span class="st"> </span><span class="kw">setdiff</span>(index, train_index)</a>
<a class="sourceLine" id="cb827-7" data-line-number="7"></a>
<a class="sourceLine" id="cb827-8" data-line-number="8">train_x &lt;-<span class="st"> </span>Housing[train_index, ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb827-9" data-line-number="9"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>price)</a>
<a class="sourceLine" id="cb827-10" data-line-number="10"></a>
<a class="sourceLine" id="cb827-11" data-line-number="11">train_y &lt;-<span class="st"> </span>Housing[train_index, ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb827-12" data-line-number="12"><span class="st">    </span><span class="kw">pull</span>(price)</a>
<a class="sourceLine" id="cb827-13" data-line-number="13"></a>
<a class="sourceLine" id="cb827-14" data-line-number="14">test_x &lt;-<span class="st"> </span>Housing[test_index, ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb827-15" data-line-number="15"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>price)</a>
<a class="sourceLine" id="cb827-16" data-line-number="16"></a>
<a class="sourceLine" id="cb827-17" data-line-number="17">test_y &lt;-<span class="st"> </span>Housing[test_index, ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb827-18" data-line-number="18"><span class="st">    </span><span class="kw">pull</span>(price)</a></code></pre></div>
<p>I do the train/test split this way, because <code>glmnet()</code> requires a design matrix as input, and not
a formula. Design matrices can be created using the <code>model.matrix()</code> function:</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb828-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;glmnet&quot;</span>)</a>
<a class="sourceLine" id="cb828-2" data-line-number="2"></a>
<a class="sourceLine" id="cb828-3" data-line-number="3">train_matrix &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(train_y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_x)</a>
<a class="sourceLine" id="cb828-4" data-line-number="4"></a>
<a class="sourceLine" id="cb828-5" data-line-number="5">test_matrix &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(test_y <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> test_x)</a></code></pre></div>
<p>Let‚Äôs now run a linear regression, by setting the penalty to 0:</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb829-1" data-line-number="1">model_lm_ridge &lt;-<span class="st"> </span><span class="kw">glmnet</span>(<span class="dt">y =</span> train_y, <span class="dt">x =</span> train_matrix, <span class="dt">alpha =</span> <span class="dv">0</span>, <span class="dt">lambda =</span> <span class="dv">0</span>)</a></code></pre></div>
<p>The model above provides the same result as a linear regression, because I set <code>lambda</code> to 0. Let‚Äôs
compare the coefficients between the two:</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb830-1" data-line-number="1"><span class="kw">coef</span>(model_lm_ridge)</a></code></pre></div>
<pre><code>## 13 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                       s0
## (Intercept) -2667.542863
## (Intercept)     .       
## lotsize         3.397596
## bedrooms     2081.087654
## bathrms     13294.192823
## stories      6400.454580
## drivewayyes  6530.644895
## recroomyes   5389.856794
## fullbaseyes  4899.099463
## gashwyes    12575.611265
## aircoyes    13078.144146
## garagepl     4155.249461
## prefareayes 10260.781753</code></pre>
<p>and now the coefficients of the linear regression (because I provide a design matrix, I have to use
<code>lm.fit()</code> instead of <code>lm()</code> which requires a formula, not a matrix.)</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb832-1" data-line-number="1"><span class="kw">coef</span>(<span class="kw">lm.fit</span>(<span class="dt">x =</span> train_matrix, <span class="dt">y =</span> train_y))</a></code></pre></div>
<pre><code>##  (Intercept)      lotsize     bedrooms      bathrms      stories  drivewayyes 
## -2667.052098     3.397629  2081.344118 13293.707725  6400.416730  6529.972544 
##   recroomyes  fullbaseyes     gashwyes     aircoyes     garagepl  prefareayes 
##  5388.871137  4899.024787 12575.970220 13077.988867  4155.269629 10261.056772</code></pre>
<p>as you can see, the coefficients are the same. Let‚Äôs compute the RMSE for the unpenalized linear
regression:</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb834-1" data-line-number="1">preds_lm &lt;-<span class="st"> </span><span class="kw">predict</span>(model_lm_ridge, test_matrix)</a>
<a class="sourceLine" id="cb834-2" data-line-number="2"></a>
<a class="sourceLine" id="cb834-3" data-line-number="3">rmse_lm &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(preds_lm <span class="op">-</span><span class="st"> </span>test_y)<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<p>The RMSE for the linear unpenalized regression is equal to 1731.5553157.</p>
<p>Let‚Äôs now run a ridge regression, with <code>lambda</code> equal to 100, and see if the RMSE is smaller:</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb835-1" data-line-number="1">model_ridge &lt;-<span class="st"> </span><span class="kw">glmnet</span>(<span class="dt">y =</span> train_y, <span class="dt">x =</span> train_matrix, <span class="dt">alpha =</span> <span class="dv">0</span>, <span class="dt">lambda =</span> <span class="dv">100</span>)</a></code></pre></div>
<p>and let‚Äôs compute the RMSE again:</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb836-1" data-line-number="1">preds &lt;-<span class="st"> </span><span class="kw">predict</span>(model_ridge, test_matrix)</a>
<a class="sourceLine" id="cb836-2" data-line-number="2"></a>
<a class="sourceLine" id="cb836-3" data-line-number="3">rmse &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(preds <span class="op">-</span><span class="st"> </span>test_y)<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<p>The RMSE for the linear penalized regression is equal to 1726.7632312, which is smaller than before.
But which value of <code>lambda</code> gives smallest RMSE? To find out, one must run model over a grid of
<code>lambda</code> values and pick the model with lowest RMSE. This procedure is available in the <code>cv.glmnet()</code>
function, which picks the best value for <code>lambda</code>:</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb837-1" data-line-number="1">best_model &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(train_matrix, train_y)</a>
<a class="sourceLine" id="cb837-2" data-line-number="2"><span class="co"># lambda that minimises the MSE</span></a>
<a class="sourceLine" id="cb837-3" data-line-number="3">best_model<span class="op">$</span>lambda.min</a></code></pre></div>
<pre><code>## [1] 61.42681</code></pre>
<p>According to <code>cv.glmnet()</code> the best value for <code>lambda</code> is 61.4268059. In the
next section, we will implement cross validation ourselves, in order to find the hyper-parameters
of a random forest.</p>
</div>
</div>
<div id="training-validating-and-testing-models" class="section level2">
<h2><span class="header-section-number">6.9</span> Training, validating, and testing models</h2>
<p>Cross-validation is an important procedure which is used to compare models but also to tune the
hyper-parameters of a model. In this section, we are going to use several packages from the
<a href="https://github.com/tidymodels"><code>{tidymodels}</code></a> collection of packages, namely
<a href="https://tidymodels.github.io/recipes/"><code>{recipes}</code></a>,
<a href="https://tidymodels.github.io/rsample/"><code>{rsample}</code></a> and
<a href="https://tidymodels.github.io/parsnip/"><code>{parsnip}</code></a> to train a random forest the tidy way. I will
also use <a href="http://mlrmbo.mlr-org.com/"><code>{mlrMBO}</code></a> to tune the hyper-parameters of the random forest.</p>
<div id="set-up" class="section level3">
<h3><span class="header-section-number">6.9.1</span> Set up</h3>
<p>Let‚Äôs load the needed packages:</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb839-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a>
<a class="sourceLine" id="cb839-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;recipes&quot;</span>)</a>
<a class="sourceLine" id="cb839-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;rsample&quot;</span>)</a>
<a class="sourceLine" id="cb839-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;parsnip&quot;</span>)</a>
<a class="sourceLine" id="cb839-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;yardstick&quot;</span>)</a>
<a class="sourceLine" id="cb839-6" data-line-number="6"><span class="kw">library</span>(<span class="st">&quot;brotools&quot;</span>)</a>
<a class="sourceLine" id="cb839-7" data-line-number="7"><span class="kw">library</span>(<span class="st">&quot;mlbench&quot;</span>)</a></code></pre></div>
<p>Load the data which is included in the <code>{mlrbench}</code> package:</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb840-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;BostonHousing2&quot;</span>)</a></code></pre></div>
<p>I will train a random forest to predict the housing prices, which is the <code>cmedv</code> column:</p>
<div class="sourceCode" id="cb841"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb841-1" data-line-number="1"><span class="kw">head</span>(BostonHousing2)</a></code></pre></div>
<pre><code>##         town tract      lon     lat medv cmedv    crim zn indus chas   nox
## 1     Nahant  2011 -70.9550 42.2550 24.0  24.0 0.00632 18  2.31    0 0.538
## 2 Swampscott  2021 -70.9500 42.2875 21.6  21.6 0.02731  0  7.07    0 0.469
## 3 Swampscott  2022 -70.9360 42.2830 34.7  34.7 0.02729  0  7.07    0 0.469
## 4 Marblehead  2031 -70.9280 42.2930 33.4  33.4 0.03237  0  2.18    0 0.458
## 5 Marblehead  2032 -70.9220 42.2980 36.2  36.2 0.06905  0  2.18    0 0.458
## 6 Marblehead  2033 -70.9165 42.3040 28.7  28.7 0.02985  0  2.18    0 0.458
##      rm  age    dis rad tax ptratio      b lstat
## 1 6.575 65.2 4.0900   1 296    15.3 396.90  4.98
## 2 6.421 78.9 4.9671   2 242    17.8 396.90  9.14
## 3 7.185 61.1 4.9671   2 242    17.8 392.83  4.03
## 4 6.998 45.8 6.0622   3 222    18.7 394.63  2.94
## 5 7.147 54.2 6.0622   3 222    18.7 396.90  5.33
## 6 6.430 58.7 6.0622   3 222    18.7 394.12  5.21</code></pre>
<p>Only keep relevant columns:</p>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb843-1" data-line-number="1">boston &lt;-<span class="st"> </span>BostonHousing2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb843-2" data-line-number="2"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>medv, <span class="op">-</span>tract, <span class="op">-</span>lon, <span class="op">-</span>lat) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb843-3" data-line-number="3"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">price =</span> cmedv)</a></code></pre></div>
<p>I remove <code>tract</code>, <code>lat</code> and <code>lon</code> because the information contained in the column <code>town</code> is enough.</p>
<p>To train and evaluate the model‚Äôs performance, I split the data in two.
One data set, called the training set, will be further split into two down below. I won‚Äôt
touch the second data set, the test set, until the very end, to finally assess the model‚Äôs
performance.</p>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb844-1" data-line-number="1">train_test_split &lt;-<span class="st"> </span><span class="kw">initial_split</span>(boston, <span class="dt">prop =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb844-2" data-line-number="2"></a>
<a class="sourceLine" id="cb844-3" data-line-number="3">housing_train &lt;-<span class="st"> </span><span class="kw">training</span>(train_test_split)</a>
<a class="sourceLine" id="cb844-4" data-line-number="4"></a>
<a class="sourceLine" id="cb844-5" data-line-number="5">housing_test &lt;-<span class="st"> </span><span class="kw">testing</span>(train_test_split)</a></code></pre></div>
<p><code>initial_split()</code>, <code>training()</code> and <code>testing()</code> are functions from the <code>{rsample}</code> package.</p>
<p>I will train a random forest on the training data, but the question, is <em>which</em> random forest?
Because random forests have several hyper-parameters, and as explained in the intro these
hyper-parameters cannot be directly learned from the data, which one should we choose? We could
train 6 random forests for instance and compare their performance, but why only 6? Why not 16?</p>
<p>In order to find the right hyper-parameters, the practitioner can
use values from the literature that seemed to have worked well (like is done in Macro-econometrics)
or you can further split the train set into two, create a grid of hyperparameter, train the model
on one part of the data for all values of the grid, and compare the predictions of the models on the
second part of the data. You then stick with the model that performed the best, for example, the
model with lowest RMSE. The thing is, you can‚Äôt estimate the true value of the RMSE with only
one value. It‚Äôs like if you wanted to estimate the height of the population by drawing one single
observation from the population. You need a bit more observations. To approach the true value of the
RMSE for a give set of hyperparameters, instead of doing one split, let‚Äôs do 30. Then we
compute the average RMSE, which implies training 30 models for each combination of the values of the
hyperparameters.</p>
<p>First, let‚Äôs split the training data again, using the <code>mc_cv()</code> function from <code>{rsample}</code> package.
This function implements Monte Carlo cross-validation:</p>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb845-1" data-line-number="1">validation_data &lt;-<span class="st"> </span><span class="kw">mc_cv</span>(housing_train, <span class="dt">prop =</span> <span class="fl">0.9</span>, <span class="dt">times =</span> <span class="dv">30</span>)</a></code></pre></div>
<p>What does <code>validation_data</code> look like?</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb846-1" data-line-number="1">validation_data</a></code></pre></div>
<pre><code>## # # Monte Carlo cross-validation (0.9/0.1) with 30 resamples  
## # A tibble: 30 x 2
##    splits           id        
##    &lt;list&gt;           &lt;chr&gt;     
##  1 &lt;split [411/45]&gt; Resample01
##  2 &lt;split [411/45]&gt; Resample02
##  3 &lt;split [411/45]&gt; Resample03
##  4 &lt;split [411/45]&gt; Resample04
##  5 &lt;split [411/45]&gt; Resample05
##  6 &lt;split [411/45]&gt; Resample06
##  7 &lt;split [411/45]&gt; Resample07
##  8 &lt;split [411/45]&gt; Resample08
##  9 &lt;split [411/45]&gt; Resample09
## 10 &lt;split [411/45]&gt; Resample10
## # ‚Ä¶ with 20 more rows</code></pre>
<p>Let‚Äôs look further down:</p>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb848-1" data-line-number="1">validation_data<span class="op">$</span>splits[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## &lt;411/45/456&gt;</code></pre>
<p>The first value is the number of rows of the first set, the second value of the second, and the third
was the original amount of values in the training data, before splitting again.</p>
<p>How should we call these two new data sets? The author of <code>{rsample}</code>, Max Kuhn, talks about
the <em>analysis</em> and the <em>assessment</em> sets:</p>
{{% tweet "1066131042615140353" %}}
<p>Now, in order to continue I need to pre-process the data. I will do this in three steps.
The first and the second steps are used to center and scale the numeric variables and the third step
converts character and factor variables to dummy variables. This is needed because I will train a
random forest, which cannot handle factor variables directly. Let‚Äôs define a recipe to do that,
and start by pre-processing the testing set. I write a wrapper function around the recipe,
because I will need to apply this recipe to various data sets:</p>
<div class="sourceCode" id="cb850"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb850-1" data-line-number="1">simple_recipe &lt;-<span class="st"> </span><span class="cf">function</span>(dataset){</a>
<a class="sourceLine" id="cb850-2" data-line-number="2">    <span class="kw">recipe</span>(price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dataset) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb850-3" data-line-number="3"><span class="st">        </span><span class="kw">step_center</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb850-4" data-line-number="4"><span class="st">        </span><span class="kw">step_scale</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb850-5" data-line-number="5"><span class="st">        </span><span class="kw">step_dummy</span>(<span class="kw">all_nominal</span>())</a>
<a class="sourceLine" id="cb850-6" data-line-number="6">}</a></code></pre></div>
<p>We have not learned yet about writing functions, and will do so in the next chapter. However, for
now, you only need to know that you can write your own functions, and that these functions can
take any arguments you need. In the case of the above function, which we called <code>simple_recipe()</code>,
we only need one argument, which is a dataset, and which we called <code>dataset</code>.</p>
<p>Once the recipe is defined, I can use the <code>prep()</code> function, which estimates the parameters from
the data which are needed to process the data. For example, for centering, <code>prep()</code> estimates
the mean which will then be subtracted from the variables. With <code>bake()</code> the estimates are then
applied on the data:</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb851-1" data-line-number="1">testing_rec &lt;-<span class="st"> </span><span class="kw">prep</span>(<span class="kw">simple_recipe</span>(housing_test), <span class="dt">testing =</span> housing_test)</a>
<a class="sourceLine" id="cb851-2" data-line-number="2"></a>
<a class="sourceLine" id="cb851-3" data-line-number="3">test_data &lt;-<span class="st"> </span><span class="kw">bake</span>(testing_rec, <span class="dt">new_data =</span> housing_test)</a></code></pre></div>
<p>It is important to split the data before using <code>prep()</code> and <code>bake()</code>, because if not, you will
use observations from the test set in the <code>prep()</code> step, and thus introduce knowledge from the test
set into the training data. This is called data leakage, and must be avoided. This is why it is
necessary to first split the training data into an analysis and an assessment set, and then also
pre-process these sets separately. However, the <code>validation_data</code> object cannot now be used with
<code>recipe()</code>, because it is not a dataframe. No worries, I simply need to write a function that extracts
the analysis and assessment sets from the <code>validation_data</code> object, applies the pre-processing, trains
the model, and returns the RMSE. This will be a big function, at the center of the analysis.</p>
<p>But before that, let‚Äôs run a simple linear regression, as a benchmark. For the linear regression, I will
not use any CV, so let‚Äôs pre-process the training set:</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb852-1" data-line-number="1">trainlm_rec &lt;-<span class="st"> </span><span class="kw">prep</span>(<span class="kw">simple_recipe</span>(housing_train), <span class="dt">testing =</span> housing_train)</a>
<a class="sourceLine" id="cb852-2" data-line-number="2"></a>
<a class="sourceLine" id="cb852-3" data-line-number="3">trainlm_data &lt;-<span class="st"> </span><span class="kw">bake</span>(trainlm_rec, <span class="dt">new_data =</span> housing_train)</a>
<a class="sourceLine" id="cb852-4" data-line-number="4"></a>
<a class="sourceLine" id="cb852-5" data-line-number="5">linreg_model &lt;-<span class="st"> </span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> trainlm_data)</a>
<a class="sourceLine" id="cb852-6" data-line-number="6"></a>
<a class="sourceLine" id="cb852-7" data-line-number="7">broom<span class="op">::</span><span class="kw">augment</span>(linreg_model, <span class="dt">newdata =</span> test_data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb852-8" data-line-number="8"><span class="st">    </span>yardstick<span class="op">::</span><span class="kw">rmse</span>(price, .fitted)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       0.344</code></pre>
<p><code>broom::augment()</code> adds the predictions to the <code>test_data</code> in a new column, <code>.fitted</code>. I won‚Äôt
use this trick with the random forest, because there is no <code>augment()</code> method for random forests
from the <code>{ranger}</code> package which I‚Äôll use. I‚Äôll add the predictions to the data myself.</p>
<p>Ok, now let‚Äôs go back to the random forest and write the big function:</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb854-1" data-line-number="1">my_rf &lt;-<span class="st"> </span><span class="cf">function</span>(mtry, trees, split, id){</a>
<a class="sourceLine" id="cb854-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb854-3" data-line-number="3">    analysis_set &lt;-<span class="st"> </span><span class="kw">analysis</span>(split)</a>
<a class="sourceLine" id="cb854-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb854-5" data-line-number="5">    analysis_prep &lt;-<span class="st"> </span><span class="kw">prep</span>(<span class="kw">simple_recipe</span>(analysis_set), <span class="dt">training =</span> analysis_set)</a>
<a class="sourceLine" id="cb854-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb854-7" data-line-number="7">    analysis_processed &lt;-<span class="st"> </span><span class="kw">bake</span>(analysis_prep, <span class="dt">new_data =</span> analysis_set)</a>
<a class="sourceLine" id="cb854-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb854-9" data-line-number="9">    model &lt;-<span class="st"> </span><span class="kw">rand_forest</span>(<span class="dt">mode =</span> <span class="st">&quot;regression&quot;</span>, <span class="dt">mtry =</span> mtry, <span class="dt">trees =</span> trees) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb854-10" data-line-number="10"><span class="st">        </span><span class="kw">set_engine</span>(<span class="st">&quot;ranger&quot;</span>, <span class="dt">importance =</span> <span class="st">&#39;impurity&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb854-11" data-line-number="11"><span class="st">        </span><span class="kw">fit</span>(price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> analysis_processed)</a>
<a class="sourceLine" id="cb854-12" data-line-number="12"></a>
<a class="sourceLine" id="cb854-13" data-line-number="13">    assessment_set &lt;-<span class="st"> </span><span class="kw">assessment</span>(split)</a>
<a class="sourceLine" id="cb854-14" data-line-number="14">    </a>
<a class="sourceLine" id="cb854-15" data-line-number="15">    assessment_prep &lt;-<span class="st"> </span><span class="kw">prep</span>(<span class="kw">simple_recipe</span>(assessment_set), <span class="dt">testing =</span> assessment_set)</a>
<a class="sourceLine" id="cb854-16" data-line-number="16">    </a>
<a class="sourceLine" id="cb854-17" data-line-number="17">    assessment_processed &lt;-<span class="st"> </span><span class="kw">bake</span>(assessment_prep, <span class="dt">new_data =</span> assessment_set)</a>
<a class="sourceLine" id="cb854-18" data-line-number="18"></a>
<a class="sourceLine" id="cb854-19" data-line-number="19">    tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="st">&quot;id&quot;</span> =<span class="st"> </span>id,</a>
<a class="sourceLine" id="cb854-20" data-line-number="20">        <span class="st">&quot;truth&quot;</span> =<span class="st"> </span>assessment_processed<span class="op">$</span>price,</a>
<a class="sourceLine" id="cb854-21" data-line-number="21">        <span class="st">&quot;prediction&quot;</span> =<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">predict</span>(model, <span class="dt">new_data =</span> assessment_processed)))</a>
<a class="sourceLine" id="cb854-22" data-line-number="22">}</a></code></pre></div>
<p>The <code>rand_forest()</code> function is available in the <code>{parsnip}</code> package. This package provides an
unified interface to a lot of other machine learning packages. This means that instead of having to
learn the syntax of <code>range()</code> and <code>randomForest()</code> and, and‚Ä¶ you can simply use the <code>rand_forest()</code>
function and change the <code>engine</code> argument to the one you want (<code>ranger</code>, <code>randomForest</code>, etc).</p>
<p>Let‚Äôs try this function:</p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb855-1" data-line-number="1">results_example &lt;-<span class="st"> </span><span class="kw">map2_df</span>(<span class="dt">.x =</span> validation_data<span class="op">$</span>splits,</a>
<a class="sourceLine" id="cb855-2" data-line-number="2">                           <span class="dt">.y =</span> validation_data<span class="op">$</span>id,</a>
<a class="sourceLine" id="cb855-3" data-line-number="3">                           <span class="op">~</span><span class="kw">my_rf</span>(<span class="dt">mtry =</span> <span class="dv">3</span>, <span class="dt">trees =</span> <span class="dv">200</span>, <span class="dt">split =</span> .x, <span class="dt">id =</span> .y))</a></code></pre></div>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb856-1" data-line-number="1"><span class="kw">head</span>(results_example)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   id           truth prediction
##   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
## 1 Resample01 -0.200     -0.0125
## 2 Resample01 -0.391     -0.0741
## 3 Resample01 -0.711     -0.154 
## 4 Resample01 -0.798     -0.286 
## 5 Resample01  0.0593     0.367 
## 6 Resample01  1.10       0.975</code></pre>
<p>I can now compute the RMSE when <code>mtry</code> = 3 and <code>trees</code> = 200:</p>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb858-1" data-line-number="1">results_example <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb858-2" data-line-number="2"><span class="st">    </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb858-3" data-line-number="3"><span class="st">    </span>yardstick<span class="op">::</span><span class="kw">rmse</span>(truth, prediction) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb858-4" data-line-number="4"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_rmse =</span> <span class="kw">mean</span>(.estimate)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb858-5" data-line-number="5"><span class="st">    </span>pull</a></code></pre></div>
<pre><code>## [1] 0.6105356</code></pre>
<p>The random forest has already lower RMSE than the linear regression. The goal now is to lower this
RMSE by tuning the <code>mtry</code> and <code>trees</code> hyperparameters. For this, I will use Bayesian Optimization
methods implemented in the <code>{mlrMBO}</code> package.</p>
</div>
<div id="bayesian-hyperparameter-optimization" class="section level3">
<h3><span class="header-section-number">6.9.2</span> Bayesian hyperparameter optimization</h3>
<p>I will re-use the code from above, and define a function that does everything from pre-processing
to returning the metric I want to minimize by tuning the hyperparameters, the RMSE:</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb860-1" data-line-number="1">tuning &lt;-<span class="st"> </span><span class="cf">function</span>(param, validation_data){</a>
<a class="sourceLine" id="cb860-2" data-line-number="2"></a>
<a class="sourceLine" id="cb860-3" data-line-number="3">    mtry &lt;-<span class="st"> </span>param[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb860-4" data-line-number="4">    trees &lt;-<span class="st"> </span>param[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb860-5" data-line-number="5"></a>
<a class="sourceLine" id="cb860-6" data-line-number="6">    results &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map2_df</span>(<span class="dt">.x =</span> validation_data<span class="op">$</span>splits,</a>
<a class="sourceLine" id="cb860-7" data-line-number="7">                       <span class="dt">.y =</span> validation_data<span class="op">$</span>id,</a>
<a class="sourceLine" id="cb860-8" data-line-number="8">                       <span class="op">~</span><span class="kw">my_rf</span>(<span class="dt">mtry =</span> mtry, <span class="dt">trees =</span> trees, <span class="dt">split =</span> .x, <span class="dt">id =</span> .y))</a>
<a class="sourceLine" id="cb860-9" data-line-number="9"></a>
<a class="sourceLine" id="cb860-10" data-line-number="10">    results <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb860-11" data-line-number="11"><span class="st">        </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb860-12" data-line-number="12"><span class="st">        </span>yardstick<span class="op">::</span><span class="kw">rmse</span>(truth, prediction) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb860-13" data-line-number="13"><span class="st">        </span><span class="kw">summarise</span>(<span class="dt">mean_rmse =</span> <span class="kw">mean</span>(.estimate)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb860-14" data-line-number="14"><span class="st">        </span>pull</a>
<a class="sourceLine" id="cb860-15" data-line-number="15">}</a></code></pre></div>
<p>This is exactly the code from before, but it now returns the RMSE. Let‚Äôs try the function
with the values from before:</p>
<div class="sourceCode" id="cb861"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb861-1" data-line-number="1"><span class="kw">tuning</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">200</span>), validation_data)</a></code></pre></div>
<pre><code>## [1] 0.6064237</code></pre>
<p>I now follow the code that can be found in the <a href="https://arxiv.org/abs/1703.03373">arxiv</a> paper to
run the optimization. A simpler model, called the surrogate model, is used to look for promising
points and to evaluate the value of the function at these points. This seems somewhat similar
(in spirit) to the <em>Indirect Inference</em> method as described in
<a href="https://www.jstor.org/stable/2285076">Gourieroux, Monfort, Renault</a>.</p>
<p>If you don‚Äôt really get what follows, no worries, it is not really important as such. The idea
is simply to look for hyper-parameters in an efficient way, and bayesian optimisation provides
this efficient way. However, you could use another method, for example a grid search. This would not
change anything to the general approach. So I will not spend too much time explaining what is
going on below, as you can read the details in the paper cited above as well as the package‚Äôs
documentation.</p>
<p>Let‚Äôs first load the package and create the function to optimize:</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb863-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;mlrMBO&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb864-1" data-line-number="1">fn &lt;-<span class="st"> </span><span class="kw">makeSingleObjectiveFunction</span>(<span class="dt">name =</span> <span class="st">&quot;tuning&quot;</span>,</a>
<a class="sourceLine" id="cb864-2" data-line-number="2">                                 <span class="dt">fn =</span> tuning,</a>
<a class="sourceLine" id="cb864-3" data-line-number="3">                                 <span class="dt">par.set =</span> <span class="kw">makeParamSet</span>(<span class="kw">makeIntegerParam</span>(<span class="st">&quot;x1&quot;</span>, <span class="dt">lower =</span> <span class="dv">3</span>, <span class="dt">upper =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb864-4" data-line-number="4">                                                        <span class="kw">makeIntegerParam</span>(<span class="st">&quot;x2&quot;</span>, <span class="dt">lower =</span> <span class="dv">100</span>, <span class="dt">upper =</span> <span class="dv">500</span>)))</a></code></pre></div>
<p>This function is based on the function I defined before. The parameters to optimize are also
defined as are their bounds. I will look for <code>mtry</code> between the values of 3 and 8, and <code>trees</code>
between 50 and 500.</p>
<p>We still need to define some other objects before continuing:</p>
<div class="sourceCode" id="cb865"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb865-1" data-line-number="1"><span class="co"># Create initial random Latin Hypercube Design of 10 points</span></a>
<a class="sourceLine" id="cb865-2" data-line-number="2"><span class="kw">library</span>(lhs)<span class="co"># for randomLHS</span></a>
<a class="sourceLine" id="cb865-3" data-line-number="3">des &lt;-<span class="st"> </span><span class="kw">generateDesign</span>(<span class="dt">n =</span> 5L <span class="op">*</span><span class="st"> </span>2L, <span class="kw">getParamSet</span>(fn), <span class="dt">fun =</span> randomLHS)</a></code></pre></div>
<p>Then we choose the surrogate model, a random forest too:</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb866-1" data-line-number="1"><span class="co"># Specify kriging model with standard error estimation</span></a>
<a class="sourceLine" id="cb866-2" data-line-number="2">surrogate &lt;-<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;regr.ranger&quot;</span>, <span class="dt">predict.type =</span> <span class="st">&quot;se&quot;</span>, <span class="dt">keep.inbag =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Here I define some options:</p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb867-1" data-line-number="1"><span class="co"># Set general controls</span></a>
<a class="sourceLine" id="cb867-2" data-line-number="2">ctrl &lt;-<span class="st"> </span><span class="kw">makeMBOControl</span>()</a>
<a class="sourceLine" id="cb867-3" data-line-number="3">ctrl &lt;-<span class="st"> </span><span class="kw">setMBOControlTermination</span>(ctrl, <span class="dt">iters =</span> 10L)</a>
<a class="sourceLine" id="cb867-4" data-line-number="4">ctrl &lt;-<span class="st"> </span><span class="kw">setMBOControlInfill</span>(ctrl, <span class="dt">crit =</span> <span class="kw">makeMBOInfillCritEI</span>())</a></code></pre></div>
<p>And this is the optimization part:</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb868-1" data-line-number="1"><span class="co"># Start optimization</span></a>
<a class="sourceLine" id="cb868-2" data-line-number="2">result &lt;-<span class="st"> </span><span class="kw">mbo</span>(fn, des, surrogate, ctrl, <span class="dt">more.args =</span> <span class="kw">list</span>(<span class="st">&quot;validation_data&quot;</span> =<span class="st"> </span>validation_data))</a></code></pre></div>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb869-1" data-line-number="1">result</a></code></pre></div>
<pre><code>## Recommended parameters:
## x1=8; x2=314
## Objective: y = 0.484
## 
## Optimization path
## 10 + 10 entries in total, displaying last 10 (or less):
##    x1  x2         y dob eol error.message exec.time            ei error.model
## 11  8 283 0.4855415   1  NA          &lt;NA&gt;     7.353 -3.276847e-04        &lt;NA&gt;
## 12  8 284 0.4852047   2  NA          &lt;NA&gt;     7.321 -3.283713e-04        &lt;NA&gt;
## 13  8 314 0.4839817   3  NA          &lt;NA&gt;     7.703 -3.828517e-04        &lt;NA&gt;
## 14  8 312 0.4841398   4  NA          &lt;NA&gt;     7.633 -2.829713e-04        &lt;NA&gt;
## 15  8 318 0.4841066   5  NA          &lt;NA&gt;     7.692 -2.668354e-04        &lt;NA&gt;
## 16  8 314 0.4845221   6  NA          &lt;NA&gt;     7.574 -1.382333e-04        &lt;NA&gt;
## 17  8 321 0.4843018   7  NA          &lt;NA&gt;     7.693 -3.828924e-05        &lt;NA&gt;
## 18  8 318 0.4868457   8  NA          &lt;NA&gt;     7.696 -8.692828e-07        &lt;NA&gt;
## 19  8 310 0.4862687   9  NA          &lt;NA&gt;     7.594 -1.061185e-07        &lt;NA&gt;
## 20  8 313 0.4878694  10  NA          &lt;NA&gt;     7.628 -5.153015e-07        &lt;NA&gt;
##    train.time prop.type propose.time           se      mean
## 11      0.011 infill_ei        0.450 0.0143886864 0.5075765
## 12      0.011 infill_ei        0.427 0.0090265872 0.4971003
## 13      0.012 infill_ei        0.443 0.0062693960 0.4916927
## 14      0.012 infill_ei        0.435 0.0037308971 0.4878950
## 15      0.012 infill_ei        0.737 0.0024446891 0.4860699
## 16      0.013 infill_ei        0.442 0.0012713838 0.4850705
## 17      0.012 infill_ei        0.444 0.0006371109 0.4847248
## 18      0.013 infill_ei        0.467 0.0002106381 0.4844576
## 19      0.014 infill_ei        0.435 0.0002182254 0.4846214
## 20      0.013 infill_ei        0.748 0.0002971160 0.4847383</code></pre>
<p>So the recommended parameters are 8 for <code>mtry</code> and 314 for <code>trees</code>. The
user can access these recommended parameters with <code>result$x$x1</code> and <code>result$x$x2</code>.
The value of the RMSE is lower than before, and equals 0.4839817. It can be accessed with
<code>result$y</code>.
Let‚Äôs now train the random forest on the training data with this values. First, I pre-process the
training data</p>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb871-1" data-line-number="1">training_rec &lt;-<span class="st"> </span><span class="kw">prep</span>(<span class="kw">simple_recipe</span>(housing_train), <span class="dt">testing =</span> housing_train)</a>
<a class="sourceLine" id="cb871-2" data-line-number="2"></a>
<a class="sourceLine" id="cb871-3" data-line-number="3">train_data &lt;-<span class="st"> </span><span class="kw">bake</span>(training_rec, <span class="dt">new_data =</span> housing_train)</a></code></pre></div>
<p>Let‚Äôs now train our final model and predict the prices:</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb872-1" data-line-number="1">final_model &lt;-<span class="st"> </span><span class="kw">rand_forest</span>(<span class="dt">mode =</span> <span class="st">&quot;regression&quot;</span>, <span class="dt">mtry =</span> result<span class="op">$</span>x<span class="op">$</span>x1, <span class="dt">trees =</span> result<span class="op">$</span>x<span class="op">$</span>x2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb872-2" data-line-number="2"><span class="st">        </span><span class="kw">set_engine</span>(<span class="st">&quot;ranger&quot;</span>, <span class="dt">importance =</span> <span class="st">&#39;impurity&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb872-3" data-line-number="3"><span class="st">        </span><span class="kw">fit</span>(price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_data)</a>
<a class="sourceLine" id="cb872-4" data-line-number="4"></a>
<a class="sourceLine" id="cb872-5" data-line-number="5">price_predict &lt;-<span class="st"> </span><span class="kw">predict</span>(final_model, <span class="dt">new_data =</span> <span class="kw">select</span>(test_data, <span class="op">-</span>price))</a></code></pre></div>
<p>Let‚Äôs transform the data back and compare the predicted prices to the true ones visually:</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb873-1" data-line-number="1"><span class="kw">cbind</span>(price_predict <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(housing_train<span class="op">$</span>price) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(housing_train<span class="op">$</span>price), </a>
<a class="sourceLine" id="cb873-2" data-line-number="2">      housing_test<span class="op">$</span>price)</a></code></pre></div>
<pre><code>##       .pred housing_test$price
## 1  20.96034               16.5
## 2  21.68968               18.9
## 3  17.72526               14.5
## 4  22.55790               20.0
## 5  32.89044               26.6
## 6  21.87593               19.4
## 7  24.64060               19.4
## 8  33.41603               28.7
## 9  25.08696               22.9
## 10 21.07804               18.6
## 11 21.00591               19.3
## 12 19.40768               18.3
## 13 21.04855               19.2
## 14 19.14319               17.3
## 15 19.04456               19.6
## 16 17.37219               13.8
## 17 20.15995               15.3
## 18 17.96205               19.4
## 19 40.04755               50.0
## 20 21.56691               25.0
## 21 21.28502               23.8
## 22 28.19695               26.4
## 23 31.22712               30.3
## 24 21.48888               21.7
## 25 37.12705               46.7
## 26 35.24885               30.1
## 27 37.14262               50.0
## 28 34.21900               33.2
## 29 23.88894               23.9
## 30 20.90597               19.4
## 31 23.65346               20.4
## 32 22.25659               22.2
## 33 22.39752               18.5
## 34 26.18525               16.5
## 35 28.12241               23.1
## 36 24.79439               18.6
## 37 21.30455               25.0
## 38 28.44648               50.0
## 39 11.78735               10.5
## 40 15.47773               15.1
## 41 11.38912                5.0
## 42 19.55224               15.0
## 43 13.47125               10.5
## 44 19.58692               19.9
## 45 18.66857               20.1
## 46 17.93450               21.4
## 47 21.07210               23.0
## 48 20.85616               21.8
## 49 20.17755               20.6
## 50 16.05127               15.2</code></pre>
<p>Let‚Äôs now compute the RMSE:</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb875-1" data-line-number="1">tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="st">&quot;truth&quot;</span> =<span class="st"> </span>test_data<span class="op">$</span>price,</a>
<a class="sourceLine" id="cb875-2" data-line-number="2">        <span class="st">&quot;prediction&quot;</span> =<span class="st"> </span><span class="kw">unlist</span>(price_predict)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb875-3" data-line-number="3"><span class="st">    </span>yardstick<span class="op">::</span><span class="kw">rmse</span>(truth, prediction)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       0.543</code></pre>
<p>As I mentioned above, all the part about looking for hyper-parameters could be changed to something
else. The general approach though remains what I have described, and can be applied for any models
that have hyper-parameters.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-breiman2001">
<p>Breiman, Leo. 2001. ‚ÄúStatistical Modeling: The Two Cultures (with Comments and a Rejoinder by the Author).‚Äù <em>Statist. Sci.</em> 16 (3). The Institute of Mathematical Statistics: 199‚Äì231. <a href="https://doi.org/10.1214/ss/1009213726" class="uri">https://doi.org/10.1214/ss/1009213726</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>This package gets installed with R, no need to add it<a href="statistical-models.html#fnref2" class="footnote-back">‚Ü©</a></p></li>
<li id="fn3"><p>The formula in the example is shown for illustration purposes.<a href="statistical-models.html#fnref3" class="footnote-back">‚Ü©</a></p></li>
<li id="fn4"><p><code>data</code> must only contain numeric values, and <code>n</code> is the number of clusters.<a href="statistical-models.html#fnref4" class="footnote-back">‚Ü©</a></p></li>
<li id="fn5"><p><code>data</code> must only contain numeric values, or a formula can be provided.<a href="statistical-models.html#fnref5" class="footnote-back">‚Ü©</a></p></li>
<li id="fn6"><p><code>Surv(y_time, y_status)</code> creates a <em>survival</em> object, where <code>y_time</code> is the time to event <code>y_status</code>. It is possible to create more complex survival objects depending on exactly which data you are dealing with.<a href="statistical-models.html#fnref6" class="footnote-back">‚Ü©</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="graphs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="defining-your-own-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
